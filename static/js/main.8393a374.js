/*! For license information please see main.8393a374.js.LICENSE.txt */
!function(){var t={757:function(t,e,n){t.exports=n(727)},322:function(t){"use strict";function e(t,e){this.x=t,this.y=e}t.exports=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x+n*(this.x-e.x)-i*(this.y-e.y),a=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}},137:function(t,e,n){t.exports.VectorTile=n(361),n(353),n(954)},361:function(t,e,n){"use strict";var i=n(954);function r(t,e,n){if(3===t){var r=new i(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}t.exports=function(t,e){this.layers=t.readFields(r,{},e)}},353:function(t,e,n){"use strict";var i=n(322);function r(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(a,this,e)}function a(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){var n=t.readVarint()+t.pos;for(;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function o(t){for(var e,n,i=0,r=0,a=t.length,o=a-1;r<a;o=r++)e=t[r],i+=((n=t[o]).x-e.x)*(e.y+n.y);return i}t.exports=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,a=0,o=0,s=0,u=[];t.pos<n;){if(a<=0){var l=t.readVarint();r=7&l,a=l>>3}if(a--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new i(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},r.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(i<=0){var c=t.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=t.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,u,s,l]},r.prototype.toGeoJSON=function(t,e,n){var i,a,s=this.extent*Math.pow(2,n),u=this.extent*t,l=this.extent*e,c=this.loadGeometry(),h=r.types[this.type];function p(t){for(var e=0;e<t.length;e++){var n=t[e],i=180-360*(n.y+l)/s;t[e]=[360*(n.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(i=0;i<c.length;i++)f[i]=c[i][0];p(c=f);break;case 2:for(i=0;i<c.length;i++)p(c[i]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],a=0;a<e;a++){var s=o(t[a]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[t[a]]):n.push(t[a]))}n&&r.push(n);return r}(c),i=0;i<c.length;i++)for(a=0;a<c[i].length;a++)p(c[i][a])}1===c.length?c=c[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},954:function(t,e,n){"use strict";var i=n(353);function r(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(a,this,e),this.length=this._features.length}function a(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){var e=null,n=t.readVarint()+t.pos;for(;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}t.exports=r,r.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,e,this.extent,this._keys,this._values)}},110:function(t,e,n){"use strict";var i=n(441),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function u(t){return i.isMemo(t)?o:s[t.$$typeof]||r}s[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[i.Memo]=o;var l=Object.defineProperty,c=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,d=Object.prototype;t.exports=function t(e,n,i){if("string"!==typeof n){if(d){var r=f(n);r&&r!==d&&t(e,r,i)}var o=c(n);h&&(o=o.concat(h(n)));for(var s=u(e),v=u(n),m=0;m<o.length;++m){var g=o[m];if(!a[g]&&(!i||!i[g])&&(!v||!v[g])&&(!s||!s[g])){var y=p(n,g);try{l(e,g,y)}catch(_){}}}}return e}},38:function(t,e){e.read=function(t,e,n,i,r){var a,o,s=8*r-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?r-1:0,p=n?-1:1,f=t[e+h];for(h+=p,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=p,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=l}return(f?-1:1)*o*Math.pow(2,a-i)},e.write=function(t,e,n,i,r,a){var o,s,u,l=8*a-r-1,c=(1<<l)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,d=i?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+f]=255&s,f+=d,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;t[n+f]=255&o,f+=d,o/=256,l-=8);t[n+f-d]|=128*v}},571:function(t){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},669:function(t){t.exports=function(){"use strict";var t,e,n;function i(i,r){if(t)if(e){var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",o={};t(o),n=r(o),"undefined"!==typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else e=r;else t=r}return i(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=i;function i(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,i,r,a,o;for(void 0===e&&(e=1e-6),r=t,o=0;o<8;o++){if(a=this.sampleCurveX(r)-t,Math.abs(a)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=a/s}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(a=this.sampleCurveX(r),Math.abs(a-t)<e)return r;t>a?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=a;function a(t,e){this.x=t,this.y=e}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var o="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1;function u(t,e,i,r){var a=new n(t,e,i,r);return function(t){return a.solve(t)}}var l=u(.25,.1,.25,1);function c(t,e,n){return Math.min(n,Math.max(e,t))}function h(t,e,n){var i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function p(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var a=r[i];for(var o in a)t[o]=a[o]}return t}var f=1;function d(){return f++}function v(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function m(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function g(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function y(t,e){return-1!==t.indexOf(e,t.length-e.length)}function _(t,e,n){var i={};for(var r in t)i[r]=e.call(n||this,t[r],r,t);return i}function b(t,e,n){var i={};for(var r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?_(t,x):t}var w={};function S(t){w[t]||("undefined"!=typeof console&&console.warn(t),w[t]=!0)}function k(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function M(t){for(var e=0,n=0,i=t.length,r=i-1,a=void 0,o=void 0;n<i;r=n++)e+=((o=t[r]).x-(a=t[n]).x)*(a.y+o.y);return e}function T(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function E(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,i,r){var a=i||r;return e[n]=!a||a.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var C=null;function I(t){if(null==C){var e=t.navigator?t.navigator.userAgent:null;C=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return C}function P(t){try{var e=o[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var A,L,R,D,z=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now.bind(Date),O=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,F=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame,N={now:z,frame:function(t){var e=O(t);return{cancel:function(){return F(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=o.document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,i.drawImage(t,0,0,t.width,t.height),i.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return A||(A=o.document.createElement("a")),A.href=t,A.href},hardwareConcurrency:o.navigator&&o.navigator.hardwareConcurrency||4,get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==L&&(L=o.matchMedia("(prefers-reduced-motion: reduce)")),L.matches)}},B={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},j={supported:!1,testSupport:function(t){!V&&D&&(U?$(t):R=t)}},V=!1,U=!1;function $(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D),t.isContextLost())return;j.supported=!0}catch(t){}t.deleteTexture(e),V=!0}o.document&&((D=o.document.createElement("img")).onload=function(){R&&$(R),R=null,U=!0},D.onerror=function(){V=!0,R=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var H="01",q=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function W(t){return 0===t.indexOf("mapbox:")}q.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},q.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},q.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},q.prototype.normalizeStyleURL=function(t,e){if(!W(t))return t;var n=Y(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},q.prototype.normalizeGlyphsURL=function(t,e){if(!W(t))return t;var n=Y(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},q.prototype.normalizeSourceURL=function(t,e){if(!W(t))return t;var n=Y(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},q.prototype.normalizeSpriteURL=function(t,e,n,i){var r=Y(t);return W(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+n,this._makeAPIURL(r,this._customAccessToken||i)):(r.path+=""+e+n,K(r))},q.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!W(t))return t;var n=Y(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(N.devicePixelRatio>=2||512===e?"@2x":"")+(j.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var i=this._customAccessToken||function(t){for(var e=0,n=t;e<n.length;e+=1){var i=n[e].match(/^access_token=(.*)$/);if(i)return i[1]}return null}(n.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,i)},q.prototype.canonicalizeTileURL=function(t,e){var n=Y(t);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return t;var i="mapbox://tiles/";i+=n.path.replace("/v4/","");var r=n.params;return e&&(r=r.filter((function(t){return!t.match(/^access_token=/)}))),r.length&&(i+="?"+r.join("&")),i},q.prototype.canonicalizeTileset=function(t,e){for(var n=!!e&&W(e),i=[],r=0,a=t.tiles||[];r<a.length;r+=1){var o=a[r];Z(o)?i.push(this.canonicalizeTileURL(o,n)):i.push(o)}return i},q.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=Y(B.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"http"===t.protocol){var r=t.params.indexOf("secure");r>=0&&t.params.splice(r,1)}if("/"!==i.path&&(t.path=""+i.path+t.path),!B.REQUIRE_ACCESS_TOKEN)return K(t);if(!(e=e||B.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),K(t)},q.prototype.setTransformRequest=function(t){this._transformRequestFn=t};var G=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Z(t){return G.test(t)}var X=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Y(t){var e=t.match(X);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function K(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function J(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var Q=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Q.prototype.getStorageKey=function(t){var e,n=J(B.ACCESS_TOKEN);return e=n&&n.u?o.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):B.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},Q.prototype.fetchEventData=function(){var t=P("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var i=o.localStorage.getItem(e);i&&(this.eventData=JSON.parse(i));var r=o.localStorage.getItem(n);r&&(this.anonId=r)}catch(t){S("Unable to read from LocalStorage")}},Q.prototype.saveEventData=function(){var t=P("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{o.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){S("Unable to write to LocalStorage")}},Q.prototype.processRequests=function(t){},Q.prototype.postEvent=function(t,e,n,i){var r=this;if(B.EVENTS_URL){var a=Y(B.EVENTS_URL);a.params.push("access_token="+(i||B.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.15.2",skuId:H,userId:this.anonId},s=e?p(o,e):o,u={url:K(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=wt(u,(function(t){r.pendingRequest=null,n(t),r.saveEventData(),r.processRequests(i)}))}},Q.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var tt,et,nt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,i){this.skuToken=n,(B.EVENTS_URL&&i||B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return W(t)||Z(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},i)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),i=n.id,r=n.timestamp;i&&this.success[i]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=v()),this.postEvent(r,{skuToken:this.skuToken},(function(t){t||i&&(e.success[i]=!0)}),t))}},e}(Q),it=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return W(t)||Z(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=J(B.ACCESS_TOKEN),i=n?n.u:B.ACCESS_TOKEN,r=i!==this.eventData.tokenU;m(this.anonId)||(this.anonId=v(),r=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),u=(a-this.eventData.lastSuccess)/864e5;r=r||u>=1||u<-1||o.getDate()!==s.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=a,e.eventData.tokenU=i)}),t)}},e}(Q)),rt=it.postTurnstileEvent.bind(it),at=new nt,ot=at.postMapLoadEvent.bind(at),st=500,ut=50;function lt(){o.caches&&!tt&&(tt=o.caches.open("mapbox-tiles"))}function ct(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ht,pt=1/0;function ft(){return null==ht&&(ht=o.OffscreenCanvas&&new o.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof o.createImageBitmap),ht}var dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(dt);var vt=function(t){function e(e,n,i){401===n&&Z(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=i,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),mt=T()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===o.location.protocol?o.parent:o).location.href};function gt(t,e){var n,i=new o.AbortController,r=new o.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:mt(),signal:i.signal}),a=!1,s=!1,u=(n=r.url).indexOf("sku=")>0&&Z(n);"json"===t.type&&r.headers.set("Accept","application/json");var l=function(n,i,a){if(!s){if(n&&"SecurityError"!==n.message&&S(n),i&&a)return c(i);var l=Date.now();o.fetch(r).then((function(n){if(n.ok){var i=u?n.clone():null;return c(n,i,l)}return e(new vt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(n,i,u){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){s||(i&&u&&function(t,e,n){if(lt(),tt){var i={status:e.status,statusText:e.statusText,headers:new o.Headers};e.headers.forEach((function(t,e){return i.headers.set(e,t)}));var r=E(e.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(e,(function(e){var n=new o.Response(e,i);lt(),tt&&tt.then((function(e){return e.put(ct(t.url),n)})).catch((function(t){return S(t.message)}))})))}}(r,i,u),a=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return u?function(t,e){if(lt(),!tt)return e(null);var n=ct(t.url);tt.then((function(t){t.match(n).then((function(i){var r=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=E(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(i);t.delete(n),r&&t.put(n,i.clone()),e(null,i,r)})).catch(e)})).catch(e)}(r,l):l(null,null),{cancel:function(){s=!0,a||i.abort()}}}var yt,_t,bt=function(t,e){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(T()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e);if(!T()){var n=t.url.substring(0,t.url.indexOf("://"));return(B.REGISTERED_PROTOCOLS[n]||gt)(t,e)}}if(!(/^file:/.test(i=t.url)||/^file:/.test(mt())&&!/^\w+:/.test(i))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return gt(t,e);if(T()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){var n=new o.XMLHttpRequest;for(var i in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new vt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},xt=function(t,e){return bt(p(t,{type:"arrayBuffer"}),e)},wt=function(t,e){return bt(p(t,{method:"POST"}),e)},St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";yt=[],_t=0;var kt=function t(e,n){if(j.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),_t>=B.MAX_PARALLEL_IMAGE_REQUESTS){var i={requestParameters:e,callback:n,cancelled:!1,cancel:function(){this.cancelled=!0}};return yt.push(i),i}_t++;var r=!1,a=function(){if(!r)for(r=!0,_t--;yt.length&&_t<B.MAX_PARALLEL_IMAGE_REQUESTS;){var e=yt.shift();e.cancelled||(e.cancel=t(e.requestParameters,e.callback).cancel)}},s=xt(e,(function(t,e,i,r){a(),t?n(t):e&&(ft()?function(t,e){var n=new o.Blob([new Uint8Array(t)],{type:"image/png"});o.createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(e,n):function(t,e,n,i){var r=new o.Image,a=o.URL;r.onload=function(){e(null,r),a.revokeObjectURL(r.src),r.onload=null,o.requestAnimationFrame((function(){r.src=St}))},r.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new o.Blob([new Uint8Array(t)],{type:"image/png"});r.cacheControl=n,r.expires=i,r.src=t.byteLength?a.createObjectURL(s):St}(e,n,i,r))}));return{cancel:function(){s.cancel(),a()}}};function Mt(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Tt(t,e,n){if(n&&n[t]){var i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}var Et=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},Ct=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",p({error:e},n))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Et),It=function(){};It.prototype.on=function(t,e){return this._listeners=this._listeners||{},Mt(t,e,this._listeners),this},It.prototype.off=function(t,e){return Tt(t,e,this._listeners),Tt(t,e,this._oneTimeListeners),this},It.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Mt(t,e,this._oneTimeListeners),this},It.prototype.fire=function(t,e){"string"==typeof t&&(t=new Et(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var i=0,r=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];i<r.length;i+=1)r[i].call(this,t);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];a<o.length;a+=1){var s=o[a];Tt(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof Ct&&console.error(t.error);return this},It.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},It.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},At=function(t,e,n,i){this.message=(t?t+": ":"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)};function Lt(t){var e=t.value;return e?[new At(t.key,e,"constants have been deprecated as of v8")]:[]}function Rt(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var a=r[i];for(var o in a)t[o]=a[o]}return t}function Dt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function zt(t){if(Array.isArray(t))return t.map(zt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=zt(t[n]);return e}return Dt(t)}var Ot=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Ft=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,i=e;n<i.length;n+=1){var r=i[n];this.bindings[r[0]]=r[1]}};Ft.prototype.concat=function(t){return new Ft(this,t)},Ft.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Ft.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Nt={kind:"null"},Bt={kind:"number"},jt={kind:"string"},Vt={kind:"boolean"},Ut={kind:"color"},$t={kind:"object"},Ht={kind:"value"},qt={kind:"collator"},Wt={kind:"formatted"},Gt={kind:"resolvedImage"};function Zt(t,e){return{kind:"array",itemType:t,N:e}}function Xt(t){if("array"===t.kind){var e=Xt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Yt=[Nt,Bt,jt,Vt,Ut,Wt,$t,Zt(Ht),Gt];function Kt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,i=Yt;n<i.length;n+=1)if(!Kt(i[n],e))return null}return"Expected "+Xt(t)+" but found "+Xt(e)+" instead."}function Jt(t,e){return e.some((function(e){return e.kind===t.kind}))}function Qt(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var te=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return i("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function a(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function o(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),h=s.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=a(h[1]),v=a(h[2]),m=v<=.5?v*(d+1):v+d-v*d,g=2*v-m;return[i(255*o(g,m,f+1/3)),i(255*o(g,m,f)),i(255*o(g,m,f-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,ee=function(t,e,n,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=n,this.a=i};ee.parse=function(t){if(t){if(t instanceof ee)return t;if("string"==typeof t){var e=te(t);if(e)return new ee(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ee.prototype.toString=function(){var t=this.toArray(),e=t[1],n=t[2],i=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(n)+","+i+")"},ee.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ee.black=new ee(0,0,0,1),ee.white=new ee(1,1,1,1),ee.transparent=new ee(0,0,0,0),ee.red=new ee(1,0,0,1);var ne=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ne.prototype.compare=function(t,e){return this.collator.compare(t,e)},ne.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ie=function(t,e,n,i,r){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r},re=function(t){this.sections=t};re.fromString=function(t){return new re([new ie(t,null,null,null,null)])},re.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},re.factory=function(t){return t instanceof re?t:re.fromString(t)},re.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},re.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var i=n[e];if(i.image)t.push(["image",i.image.name]);else{t.push(i.text);var r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(r)}}return t};var ae=function(t){this.name=t.name,this.available=t.available};function oe(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value ["+[t,e,n,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function se(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ee)return!0;if(t instanceof ne)return!0;if(t instanceof re)return!0;if(t instanceof ae)return!0;if(Array.isArray(t)){for(var e=0,n=t;e<n.length;e+=1)if(!se(n[e]))return!1;return!0}if("object"==typeof t){for(var i in t)if(!se(t[i]))return!1;return!0}return!1}function ue(t){if(null===t)return Nt;if("string"==typeof t)return jt;if("boolean"==typeof t)return Vt;if("number"==typeof t)return Bt;if(t instanceof ee)return Ut;if(t instanceof ne)return qt;if(t instanceof re)return Wt;if(t instanceof ae)return Gt;if(Array.isArray(t)){for(var e,n=t.length,i=0,r=t;i<r.length;i+=1){var a=ue(r[i]);if(e){if(e===a)continue;e=Ht;break}e=a}return Zt(e||Ht,n)}return $t}function le(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ee||t instanceof re||t instanceof ae?t.toString():JSON.stringify(t)}ae.prototype.toString=function(){return this.name},ae.fromString=function(t){return t?new ae({name:t,available:!1}):null},ae.prototype.serialize=function(){return["image",this.name]};var ce=function(t,e){this.type=t,this.value=e};ce.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!se(t[1]))return e.error("invalid value");var n=t[1],i=ue(n),r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new ce(i,n)},ce.prototype.evaluate=function(){return this.value},ce.prototype.eachChild=function(){},ce.prototype.outputDefined=function(){return!0},ce.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ee?["rgba"].concat(this.value.toArray()):this.value instanceof re?this.value.serialize():this.value};var he=function(t){this.name="ExpressionEvaluationError",this.message=t};he.prototype.toJSON=function(){return this.message};var pe={string:jt,number:Bt,boolean:Vt,object:$t},fe=function(t,e){this.type=t,this.args=e};fe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,i=1,r=t[0];if("array"===r){var a,o;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in pe)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=pe[s],i++}else a=Ht;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],i++}n=Zt(a,o)}else n=pe[r];for(var u=[];i<t.length;i++){var l=e.parse(t[i],i,Ht);if(!l)return null;u.push(l)}return new fe(n,u)},fe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Kt(this.type,ue(n)))return n;if(e===this.args.length-1)throw new he("Expected value to be of type "+Xt(this.type)+", but found "+Xt(ue(n))+" instead.")}return null},fe.prototype.eachChild=function(t){this.args.forEach(t)},fe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},fe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var de=function(t){this.type=Wt,this.sections=t};de.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");for(var i=[],r=!1,a=1;a<=t.length-1;++a){var o=t[a];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;var s=null;if(o["font-scale"]&&!(s=e.parse(o["font-scale"],1,Bt)))return null;var u=null;if(o["text-font"]&&!(u=e.parse(o["text-font"],1,Zt(jt))))return null;var l=null;if(o["text-color"]&&!(l=e.parse(o["text-color"],1,Ut)))return null;var c=i[i.length-1];c.scale=s,c.font=u,c.textColor=l}else{var h=e.parse(t[a],1,Ht);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:h,scale:null,font:null,textColor:null})}}return new de(i)},de.prototype.evaluate=function(t){return new re(this.sections.map((function(e){var n=e.content.evaluate(t);return ue(n)===Gt?new ie("",n,null,null,null):new ie(le(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},de.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t.push(i.content.serialize());var r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),t.push(r)}return t};var ve=function(t){this.type=Gt,this.input=t};ve.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,jt);return n?new ve(n):e.error("No image name provided.")},ve.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=ae.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n},ve.prototype.eachChild=function(t){t(this.input)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){return["image",this.input.serialize()]};var me={"to-boolean":Vt,"to-color":Ut,"to-number":Bt,"to-string":jt},ge=function(t,e){this.type=t,this.args=e};ge.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var i=me[n],r=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,Ht);if(!o)return null;r.push(o)}return new ge(i,r)},ge.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,i=0,r=this.args;i<r.length;i+=1){if(n=null,(e=r[i].evaluate(t))instanceof ee)return e;if("string"==typeof e){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":oe(e[0],e[1],e[2],e[3])))return new ee(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new he(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null===(o=u[s].evaluate(t)))return 0;var l=Number(o);if(!isNaN(l))return l}throw new he("Could not convert "+JSON.stringify(o)+" to number.")}return"formatted"===this.type.kind?re.fromString(le(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ae.fromString(le(this.args[0].evaluate(t))):le(this.args[0].evaluate(t))},ge.prototype.eachChild=function(t){this.args.forEach(t)},ge.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ge.prototype.serialize=function(){if("formatted"===this.type.kind)return new de([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ve(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ye=["Unknown","Point","LineString","Polygon"],_e=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};_e.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},_e.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ye[this.feature.type]:this.feature.type:null},_e.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},_e.prototype.canonicalID=function(){return this.canonical},_e.prototype.properties=function(){return this.feature&&this.feature.properties||{}},_e.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ee.parse(t)),e};var be=function(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i};be.prototype.evaluate=function(t){return this._evaluate(t,this.args)},be.prototype.eachChild=function(t){this.args.forEach(t)},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},be.parse=function(t,e){var n,i=t[0],r=be.definitions[i];if(!r)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new Ue(e.registry,e.path,null,e.scope);for(var d=[],v=!1,m=1;m<t.length;m++){var g=t[m],y=Array.isArray(p)?p[m-1]:p.type,_=u.parse(g,1+d.length,y);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var b=0;b<d.length;b++){var x=Array.isArray(p)?p[b]:p.type,w=d[b];u.concat(b+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new be(i,a,f,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var S=(s.length?s:o).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Xt).join(", ")+")":"("+Xt(e.type)+"...)"})).join(" | "),k=[],M=1;M<t.length;M++){var T=e.parse(t[M],1+k.length);if(!T)return null;k.push(Xt(T.type))}e.error("Expected arguments of type "+S+", but found ("+k.join(", ")+") instead.")}return null},be.register=function(t,e){for(var n in be.definitions=e,e)t[n]=be};var xe=function(t,e,n){this.type=qt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function we(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Se(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ke(t,e){var n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*8192),Math.round(i*r*8192)]}function Me(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function Te(t,e){for(var n,i,r,a,o,s,u,l=!1,c=0,h=e.length;c<h;c++)for(var p=e[c],f=0,d=p.length;f<d-1;f++){if((a=(n=t)[0]-(i=p[f])[0])*(u=n[1]-(r=p[f+1])[1])-(s=n[0]-r[0])*(o=n[1]-i[1])==0&&a*s<=0&&o*u<=0)return!1;Me(t,p[f],p[f+1])&&(l=!l)}return l}function Ee(t,e){for(var n=0;n<e.length;n++)if(Te(t,e[n]))return!0;return!1}function Ce(t,e,n,i){var r=i[0]-n[0],a=i[1]-n[1],o=(t[0]-n[0])*a-r*(t[1]-n[1]),s=(e[0]-n[0])*a-r*(e[1]-n[1]);return o>0&&s<0||o<0&&s>0}function Ie(t,e,n){for(var i=0,r=n;i<r.length;i+=1)for(var a=r[i],o=0;o<a.length-1;++o)if(0!=(h=[(c=a[o+1])[0]-(l=a[o])[0],c[1]-l[1]])[0]*(p=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*p[0]&&Ce(s,u,l,c)&&Ce(l,c,s,u))return!0;var s,u,l,c,h,p;return!1}function Pe(t,e){for(var n=0;n<t.length;++n)if(!Te(t[n],e))return!1;for(var i=0;i<t.length-1;++i)if(Ie(t[i],t[i+1],e))return!1;return!0}function Ae(t,e){for(var n=0;n<e.length;n++)if(Pe(t,e[n]))return!0;return!1}function Le(t,e,n){for(var i=[],r=0;r<t.length;r++){for(var a=[],o=0;o<t[r].length;o++){var s=ke(t[r][o],n);we(e,s),a.push(s)}i.push(a)}return i}function Re(t,e,n){for(var i=[],r=0;r<t.length;r++){var a=Le(t[r],e,n);i.push(a)}return i}function De(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){var r=.5*i,a=t[0]-n[0]>r?-i:n[0]-t[0]>r?i:0;0===a&&(a=t[0]-n[2]>r?-i:n[2]-t[0]>r?i:0),t[0]+=a}we(e,t)}function ze(t,e,n,i){for(var r=8192*Math.pow(2,i.z),a=[8192*i.x,8192*i.y],o=[],s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var h=c[l],p=[h.x+a[0],h.y+a[1]];De(p,e,n,r),o.push(p)}return o}function Oe(t,e,n,i){for(var r,a=8192*Math.pow(2,i.z),o=[8192*i.x,8192*i.y],s=[],u=0,l=t;u<l.length;u+=1){for(var c=[],h=0,p=l[u];h<p.length;h+=1){var f=p[h],d=[f.x+o[0],f.y+o[1]];we(e,d),c.push(d)}s.push(c)}if(e[2]-e[0]<=a/2){(r=e)[0]=r[1]=1/0,r[2]=r[3]=-1/0;for(var v=0,m=s;v<m.length;v+=1)for(var g=0,y=m[v];g<y.length;g+=1)De(y[g],e,n,a)}return s}xe.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Vt);if(!i)return null;var r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Vt);if(!r)return null;var a=null;return n.locale&&!(a=e.parse(n.locale,1,jt))?null:new xe(i,r,a)},xe.prototype.evaluate=function(t){return new ne(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},xe.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Fe=function(t,e){this.type=Vt,this.geojson=t,this.geometries=e};function Ne(t){if(t instanceof be){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Fe)return!1;var e=!0;return t.eachChild((function(t){e&&!Ne(t)&&(e=!1)})),e}function Be(t){if(t instanceof be&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Be(t)&&(e=!1)})),e}function je(t,e){if(t instanceof be&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!je(t,e)&&(n=!1)})),n}Fe.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(se(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var i=0;i<n.features.length;++i){var r=n.features[i].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Fe(n,n.features[i].geometry)}else if("Feature"===n.type){var a=n.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Fe(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new Fe(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Fe.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){var a=Le(e.coordinates,i,r),o=ze(t.geometry(),n,i,r);if(!Se(n,i))return!1;for(var s=0,u=o;s<u.length;s+=1)if(!Te(u[s],a))return!1}if("MultiPolygon"===e.type){var l=Re(e.coordinates,i,r),c=ze(t.geometry(),n,i,r);if(!Se(n,i))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Ee(p[h],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){var a=Le(e.coordinates,i,r),o=Oe(t.geometry(),n,i,r);if(!Se(n,i))return!1;for(var s=0,u=o;s<u.length;s+=1)if(!Pe(u[s],a))return!1}if("MultiPolygon"===e.type){var l=Re(e.coordinates,i,r),c=Oe(t.geometry(),n,i,r);if(!Se(n,i))return!1;for(var h=0,p=c;h<p.length;h+=1)if(!Ae(p[h],l))return!1}return!0}(t,this.geometries)}return!1},Fe.prototype.eachChild=function(){},Fe.prototype.outputDefined=function(){return!0},Fe.prototype.serialize=function(){return["within",this.geojson]};var Ve=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Ve.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new Ve(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},Ve.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ve.prototype.eachChild=function(){},Ve.prototype.outputDefined=function(){return!1},Ve.prototype.serialize=function(){return["var",this.name]};var Ue=function(t,e,n,i,r){void 0===e&&(e=[]),void 0===i&&(i=new Ft),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=i,this.errors=r,this.expectedType=n};function $e(t,e){for(var n,i=t.length-1,r=0,a=i,o=0;r<=a;)if((n=t[o=Math.floor((r+a)/2)])<=e){if(o===i||e<t[o+1])return o;r=o+1}else{if(!(n>e))throw new he("Input is not a number.");a=o-1}return 0}Ue.prototype.parse=function(t,e,n,i,r){return void 0===r&&(r={}),e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)},Ue.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new fe(e,[t]):"coerce"===n?new ge(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found "+typeof i+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var r=this.registry[i];if(r){var a=r.parse(t,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=n(a,o,e.typeAnnotation||"coerce");else a=n(a,o,e.typeAnnotation||"assert")}if(!(a instanceof ce)&&"resolvedImage"!==a.type.kind&&function t(e){if(e instanceof Ve)return t(e.boundExpression);if(e instanceof be&&"error"===e.name)return!1;if(e instanceof xe)return!1;if(e instanceof Fe)return!1;var n=e instanceof ge||e instanceof fe,i=!0;return e.eachChild((function(e){i=n?i&&t(e):i&&e instanceof ce})),!!i&&Ne(e)&&je(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var u=new _e;try{a=new ce(a.type,a.evaluate(u))}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ue.prototype.concat=function(t,e,n){var i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new Ue(this.registry,i,e||null,r,this.errors)},Ue.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var i=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Ot(i,t))},Ue.prototype.checkSubtype=function(t,e){var n=Kt(t,e);return n&&this.error(n),n};var He=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,r=n;i<r.length;i+=1){var a=r[i],o=a[1];this.labels.push(a[0]),this.outputs.push(o)}};function qe(t,e,n){return t*(1-n)+e*n}He.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,Bt);if(!n)return null;var i=[],r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var a=1;a<t.length;a+=2){var o=1===a?-1/0:t[a],s=t[a+1],u=a,l=a+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([o,c])}return new He(r,n,i)},He.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[$e(e,i)].evaluate(t)},He.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},He.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},He.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var We=Object.freeze({__proto__:null,number:qe,color:function(t,e,n){return new ee(qe(t.r,e.r,n),qe(t.g,e.g,n),qe(t.b,e.b,n),qe(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,i){return qe(t,e[i],n)}))}}),Ge=6/29*3*(6/29),Ze=Math.PI/180,Xe=180/Math.PI;function Ye(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ge+4/29}function Ke(t){return t>6/29?t*t*t:Ge*(t-4/29)}function Je(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Qe(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tn(t){var e=Qe(t.r),n=Qe(t.g),i=Qe(t.b),r=Ye((.4124564*e+.3575761*n+.1804375*i)/.95047),a=Ye((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*a-16,a:500*(r-a),b:200*(a-Ye((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function en(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*Ke(e),n=.95047*Ke(n),i=1.08883*Ke(i),new ee(Je(3.2404542*n-1.5371385*e-.4985314*i),Je(-.969266*n+1.8760108*e+.041556*i),Je(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function nn(t,e,n){var i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}var rn={forward:tn,reverse:en,interpolate:function(t,e,n){return{l:qe(t.l,e.l,n),a:qe(t.a,e.a,n),b:qe(t.b,e.b,n),alpha:qe(t.alpha,e.alpha,n)}}},an={forward:function(t){var e=tn(t),n=e.l,i=e.a,r=e.b,a=Math.atan2(r,i)*Xe;return{h:a<0?a+360:a,c:Math.sqrt(i*i+r*r),l:n,alpha:t.a}},reverse:function(t){var e=t.h*Ze,n=t.c;return en({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:nn(t.h,e.h,n),c:qe(t.c,e.c,n),l:qe(t.l,e.l,n),alpha:qe(t.alpha,e.alpha,n)}}},on=Object.freeze({__proto__:null,lab:rn,hcl:an}),sn=function(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(var a=0,o=r;a<o.length;a+=1){var s=o[a],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function un(t,e,n,i){var r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}sn.interpolationFactor=function(t,e,i,r){var a=0;if("exponential"===t.name)a=un(e,t.base,i,r);else if("linear"===t.name)a=un(e,1,i,r);else if("cubic-bezier"===t.name){var o=t.controlPoints;a=new n(o[0],o[1],o[2],o[3]).solve(un(e,1,i,r))}return a},sn.parse=function(t,e){var n=t[0],i=t[1],r=t[2],a=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var o=i[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:o}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var s=i.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,2,Bt)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=Ut:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<a.length;c+=2){var h=a[c],p=a[c+1],f=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var v=e.parse(p,d,l);if(!v)return null;l=l||v.type,u.push([h,v])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new sn(l,n,i,r,u):e.error("Type "+Xt(l)+" is not interpolatable.")},sn.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);var a=$e(e,i),o=sn.interpolationFactor(this.interpolation,i,e[a],e[a+1]),s=n[a].evaluate(t),u=n[a+1].evaluate(t);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](s,u,o):"interpolate-hcl"===this.operator?an.reverse(an.interpolate(an.forward(s),an.forward(u),o)):rn.reverse(rn.interpolate(rn.forward(s),rn.forward(u),o))},sn.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},sn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},sn.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var ln=function(t,e){this.type=t,this.args=e};ln.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,i=e.expectedType;i&&"value"!==i.kind&&(n=i);for(var r=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=e.parse(o[a],1+r.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,r.push(s)}var u=i&&r.some((function(t){return Kt(i,t.type)}));return new ln(u?Ht:n,r)},ln.prototype.evaluate=function(t){for(var e,n=null,i=0,r=0,a=this.args;r<a.length&&(i++,(n=a[r].evaluate(t))&&n instanceof ae&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null===n);r+=1);return n},ln.prototype.eachChild=function(t){this.args.forEach(t)},ln.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ln.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var cn=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};cn.prototype.evaluate=function(t){return this.result.evaluate(t)},cn.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},cn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],i=1;i<t.length-1;i+=2){var r=t[i];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var a=e.parse(t[i+1],i+1);if(!a)return null;n.push([r,a])}var o=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return o?new cn(n,o):null},cn.prototype.outputDefined=function(){return this.result.outputDefined()},cn.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var i=n[e];t.push(i[0],i[1].serialize())}return t.push(this.result.serialize()),t};var hn=function(t,e,n){this.type=t,this.index=e,this.input=n};hn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Bt),i=e.parse(t[2],2,Zt(e.expectedType||Ht));return n&&i?new hn(i.type.itemType,n,i):null},hn.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new he("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new he("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new he("Array index must be an integer, but found "+e+" instead.");return n[e]},hn.prototype.eachChild=function(t){t(this.index),t(this.input)},hn.prototype.outputDefined=function(){return!1},hn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var pn=function(t,e){this.type=Vt,this.needle=t,this.haystack=e};pn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Ht),i=e.parse(t[2],2,Ht);return n&&i?Jt(n.type,[Vt,jt,Bt,Nt,Ht])?new pn(n,i):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Xt(n.type)+" instead"):null},pn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!Qt(e,["boolean","string","number","null"]))throw new he("Expected first argument to be of type boolean, string, number or null, but found "+Xt(ue(e))+" instead.");if(!Qt(n,["string","array"]))throw new he("Expected second argument to be of type array or string, but found "+Xt(ue(n))+" instead.");return n.indexOf(e)>=0},pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},pn.prototype.outputDefined=function(){return!0},pn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var fn=function(t,e,n){this.type=Bt,this.needle=t,this.haystack=e,this.fromIndex=n};fn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Ht),i=e.parse(t[2],2,Ht);if(!n||!i)return null;if(!Jt(n.type,[Vt,jt,Bt,Nt,Ht]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Xt(n.type)+" instead");if(4===t.length){var r=e.parse(t[3],3,Bt);return r?new fn(n,i,r):null}return new fn(n,i)},fn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Qt(e,["boolean","string","number","null"]))throw new he("Expected first argument to be of type boolean, string, number or null, but found "+Xt(ue(e))+" instead.");if(!Qt(n,["string","array"]))throw new he("Expected second argument to be of type array or string, but found "+Xt(ue(n))+" instead.");if(this.fromIndex){var i=this.fromIndex.evaluate(t);return n.indexOf(e,i)}return n.indexOf(e)},fn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},fn.prototype.outputDefined=function(){return!1},fn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var dn=function(t,e,n,i,r,a){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a};dn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var r={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var l=e.concat(o);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,ue(p)))return null}else n=ue(p);if(void 0!==r[String(p)])return l.error("Branch labels must be unique.");r[String(p)]=a.length}var f=e.parse(u,o,i);if(!f)return null;i=i||f.type,a.push(f)}var d=e.parse(t[1],1,Ht);if(!d)return null;var v=e.parse(t[t.length-1],t.length-1,i);return v?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new dn(n,i,d,r,a,v):null},dn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(ue(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},dn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},dn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},dn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],i={},r=0,a=Object.keys(this.cases).sort();r<a.length;r+=1){var o=a[r];void 0===(h=i[this.cases[o]])?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[h][1].push(o)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var vn=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};vn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i=[],r=1;r<t.length-1;r+=2){var a=e.parse(t[r],r,Vt);if(!a)return null;var o=e.parse(t[r+1],r+1,n);if(!o)return null;i.push([a,o]),n=n||o.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new vn(n,i,s):null},vn.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[1];if(i[0].evaluate(t))return r.evaluate(t)}return this.otherwise.evaluate(t)},vn.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[1];t(i[0]),t(r)}t(this.otherwise)},vn.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},vn.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var mn=function(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i};function gn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function yn(t,e,n,i){return 0===i.compare(e,n)}function _n(t,e,n){var i="=="!==t&&"!="!==t;return function(){function r(t,e,n){this.type=Vt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return r.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],a=e.parse(t[1],1,Ht);if(!a)return null;if(!gn(n,a.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Xt(a.type)+"'.");var o=e.parse(t[2],2,Ht);if(!o)return null;if(!gn(n,o.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Xt(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '"+Xt(a.type)+"' and '"+Xt(o.type)+"'.");i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new fe(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new fe(a.type,[o])));var s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,qt)))return null}return new r(a,o,s)},r.prototype.evaluate=function(r){var a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){var s=ue(a),u=ue(o);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new he('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!i&&this.hasUntypedArgument){var l=ue(a),c=ue(o);if("string"!==l.kind||"string"!==c.kind)return e(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):e(r,a,o)},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},r.prototype.outputDefined=function(){return!0},r.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},r}()}mn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Ht),i=e.parse(t[2],2,Bt);if(!n||!i)return null;if(!Jt(n.type,[Zt(Ht),jt,Ht]))return e.error("Expected first argument to be of type array or string, but found "+Xt(n.type)+" instead");if(4===t.length){var r=e.parse(t[3],3,Bt);return r?new mn(n.type,n,i,r):null}return new mn(n.type,n,i)},mn.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!Qt(e,["string","array"]))throw new he("Expected first argument to be of type array or string, but found "+Xt(ue(e))+" instead.");if(this.endIndex){var i=this.endIndex.evaluate(t);return e.slice(n,i)}return e.slice(n)},mn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},mn.prototype.outputDefined=function(){return!1},mn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var bn=_n("==",(function(t,e,n){return e===n}),yn),xn=_n("!=",(function(t,e,n){return e!==n}),(function(t,e,n,i){return!yn(0,e,n,i)})),wn=_n("<",(function(t,e,n){return e<n}),(function(t,e,n,i){return i.compare(e,n)<0})),Sn=_n(">",(function(t,e,n){return e>n}),(function(t,e,n,i){return i.compare(e,n)>0})),kn=_n("<=",(function(t,e,n){return e<=n}),(function(t,e,n,i){return i.compare(e,n)<=0})),Mn=_n(">=",(function(t,e,n){return e>=n}),(function(t,e,n,i){return i.compare(e,n)>=0})),Tn=function(t,e,n,i,r){this.type=jt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r};Tn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Bt);if(!n)return null;var i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");var r=null;if(i.locale&&!(r=e.parse(i.locale,1,jt)))return null;var a=null;if(i.currency&&!(a=e.parse(i.currency,1,jt)))return null;var o=null;if(i["min-fraction-digits"]&&!(o=e.parse(i["min-fraction-digits"],1,Bt)))return null;var s=null;return i["max-fraction-digits"]&&!(s=e.parse(i["max-fraction-digits"],1,Bt))?null:new Tn(n,r,a,o,s)},Tn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Tn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var En=function(t){this.type=Bt,this.input=t};En.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Xt(n.type)+" instead."):new En(n):null},En.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new he("Expected value to be of type string or array, but found "+Xt(ue(e))+" instead.")},En.prototype.eachChild=function(t){t(this.input)},En.prototype.outputDefined=function(){return!1},En.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Cn={"==":bn,"!=":xn,">":Sn,"<":wn,">=":Mn,"<=":kn,array:fe,at:hn,boolean:fe,case:vn,coalesce:ln,collator:xe,format:de,image:ve,in:pn,"index-of":fn,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:En,let:cn,literal:ce,match:dn,number:fe,"number-format":Tn,object:fe,slice:mn,step:He,string:fe,"to-boolean":ge,"to-color":ge,"to-number":ge,"to-string":ge,var:Ve,within:Fe};function In(t,e){var n=e[0],i=e[1],r=e[2],a=e[3];n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);var o=a?a.evaluate(t):1,s=oe(n,i,r,o);if(s)throw new he(s);return new ee(n/255*o,i/255*o,r/255*o,o)}function Pn(t,e){return t in e}function An(t,e){var n=e[t];return void 0===n?null:n}function Ln(t){return{type:t}}function Rn(t){return{result:"success",value:t}}function Dn(t){return{result:"error",value:t}}function zn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function On(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Fn(t){return!!t.expression&&t.expression.interpolated}function Nn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Bn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function jn(t){return t}function Vn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Un(t,e,n,i,r){return Vn(typeof n===r?i[n]:void 0,t.default,e.default)}function $n(t,e,n){if("number"!==Nn(n))return Vn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var r=$e(t.stops.map((function(t){return t[0]})),n);return t.stops[r][1]}function Hn(t,e,n){var i=void 0!==t.base?t.base:1;if("number"!==Nn(n))return Vn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var a=$e(t.stops.map((function(t){return t[0]})),n),o=function(t,e,n,i){var r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],l=We[e.type]||jn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=on[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),i=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return l(n,i,o)}}:l(s,u,o)}function qn(t,e,n){return"color"===e.type?n=ee.parse(n):"formatted"===e.type?n=re.fromString(n.toString()):"resolvedImage"===e.type?n=ae.fromString(n.toString()):Nn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Vn(n,t.default,e.default)}be.register(Cn,{error:[{kind:"error"},[jt],function(t,e){throw new he(e[0].evaluate(t))}],typeof:[jt,[Ht],function(t,e){return Xt(ue(e[0].evaluate(t)))}],"to-rgba":[Zt(Bt,4),[Ut],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Ut,[Bt,Bt,Bt],In],rgba:[Ut,[Bt,Bt,Bt,Bt],In],has:{type:Vt,overloads:[[[jt],function(t,e){return Pn(e[0].evaluate(t),t.properties())}],[[jt,$t],function(t,e){var n=e[1];return Pn(e[0].evaluate(t),n.evaluate(t))}]]},get:{type:Ht,overloads:[[[jt],function(t,e){return An(e[0].evaluate(t),t.properties())}],[[jt,$t],function(t,e){var n=e[1];return An(e[0].evaluate(t),n.evaluate(t))}]]},"feature-state":[Ht,[jt],function(t,e){return An(e[0].evaluate(t),t.featureState||{})}],properties:[$t,[],function(t){return t.properties()}],"geometry-type":[jt,[],function(t){return t.geometryType()}],id:[Ht,[],function(t){return t.id()}],zoom:[Bt,[],function(t){return t.globals.zoom}],"heatmap-density":[Bt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Bt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Ht,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Bt,Ln(Bt),function(t,e){for(var n=0,i=0,r=e;i<r.length;i+=1)n+=r[i].evaluate(t);return n}],"*":[Bt,Ln(Bt),function(t,e){for(var n=1,i=0,r=e;i<r.length;i+=1)n*=r[i].evaluate(t);return n}],"-":{type:Bt,overloads:[[[Bt,Bt],function(t,e){var n=e[1];return e[0].evaluate(t)-n.evaluate(t)}],[[Bt],function(t,e){return-e[0].evaluate(t)}]]},"/":[Bt,[Bt,Bt],function(t,e){var n=e[1];return e[0].evaluate(t)/n.evaluate(t)}],"%":[Bt,[Bt,Bt],function(t,e){var n=e[1];return e[0].evaluate(t)%n.evaluate(t)}],ln2:[Bt,[],function(){return Math.LN2}],pi:[Bt,[],function(){return Math.PI}],e:[Bt,[],function(){return Math.E}],"^":[Bt,[Bt,Bt],function(t,e){var n=e[1];return Math.pow(e[0].evaluate(t),n.evaluate(t))}],sqrt:[Bt,[Bt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Bt,[Bt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Bt,[Bt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Bt,[Bt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Bt,[Bt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Bt,[Bt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Bt,[Bt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Bt,[Bt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Bt,[Bt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Bt,[Bt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Bt,Ln(Bt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Bt,Ln(Bt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Bt,[Bt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Bt,[Bt],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Bt,[Bt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Bt,[Bt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Vt,[jt,Ht],function(t,e){var n=e[0],i=e[1];return t.properties()[n.value]===i.value}],"filter-id-==":[Vt,[Ht],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[Vt,[jt],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[Vt,[jt,Ht],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Vt,[Ht],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Vt,[jt,Ht],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Vt,[Ht],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Vt,[jt,Ht],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Vt,[Ht],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Vt,[jt,Ht],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Vt,[Ht],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Vt,[Ht],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Vt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Vt,[Zt(jt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Vt,[Zt(Ht)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Vt,[jt,Zt(Ht)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Vt,[jt,Zt(Ht)],function(t,e){var n=e[0],i=e[1];return function(t,e,n,i){for(;n<=i;){var r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Vt,overloads:[[[Vt,Vt],function(t,e){var n=e[1];return e[0].evaluate(t)&&n.evaluate(t)}],[Ln(Vt),function(t,e){for(var n=0,i=e;n<i.length;n+=1)if(!i[n].evaluate(t))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],function(t,e){var n=e[1];return e[0].evaluate(t)||n.evaluate(t)}],[Ln(Vt),function(t,e){for(var n=0,i=e;n<i.length;n+=1)if(i[n].evaluate(t))return!0;return!1}]]},"!":[Vt,[Vt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Vt,[jt],function(t,e){var n=t.globals&&t.globals.isSupportedScript;return!n||n(e[0].evaluate(t))}],upcase:[jt,[jt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[jt,[jt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[jt,Ln(Ht),function(t,e){return e.map((function(e){return le(e.evaluate(t))})).join("")}],"resolved-locale":[jt,[qt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Wn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new _e,this._defaultValue=e?function(t){return"color"===t.type&&Bn(t.default)?new ee(0,0,0,0):"color"===t.type?ee.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Gn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Cn}function Zn(t,e){var n=new Ue(Cn,[],e?function(t){var e={color:Ut,string:jt,number:Bt,enum:jt,boolean:Vt,formatted:Wt,resolvedImage:Gt};return"array"===t.type?Zt(e[t.value]||Ht,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?Rn(new Wn(i,e)):Dn(n.errors)}Wn.prototype.evaluateWithoutErrorHandling=function(t,e,n,i,r,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)},Wn.prototype.evaluate=function(t,e,n,i,r,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new he("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Xn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Be(e.expression)};Xn.prototype.evaluateWithoutErrorHandling=function(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)},Xn.prototype.evaluate=function(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)};var Yn=function(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Be(e.expression),this.interpolationType=i};function Kn(t,e){if("error"===(t=Zn(t,e)).result)return t;var n=t.value.expression,i=Ne(n);if(!i&&!zn(e))return Dn([new Ot("","data expressions not supported")]);var r=je(n,["zoom"]);if(!r&&!On(e))return Dn([new Ot("","zoom expressions not supported")]);var a=function t(e){var n=null;if(e instanceof cn)n=t(e.result);else if(e instanceof ln)for(var i=0,r=e.args;i<r.length&&!(n=t(r[i]));i+=1);else(e instanceof He||e instanceof sn)&&e.input instanceof be&&"zoom"===e.input.name&&(n=e);return n instanceof Ot||e.eachChild((function(e){var i=t(e);i instanceof Ot?n=i:!n&&i?n=new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&i&&n!==i&&(n=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return a||r?a instanceof Ot?Dn([a]):a instanceof sn&&!Fn(e)?Dn([new Ot("",'"interpolate" expressions cannot be used with this property')]):Rn(a?new Yn(i?"camera":"composite",t.value,a.labels,a instanceof sn?a.interpolation:void 0):new Xn(i?"constant":"source",t.value)):Dn([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Yn.prototype.evaluateWithoutErrorHandling=function(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)},Yn.prototype.evaluate=function(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)},Yn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?sn.interpolationFactor(this.interpolationType,t,e,n):0};var Jn=function(t,e){this._parameters=t,this._specification=e,Rt(this,function t(e,n){var i,r,a,o="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Fn(n)?"exponential":"interval");if(o&&((e=Rt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],ee.parse(t[1])]}))),e.default=ee.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!on[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)i=Hn;else if("interval"===l)i=$n;else if("categorical"===l){i=Un,r=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];r[p[0]]=p[1]}a=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');i=qn}if(s){for(var f={},d=[],v=0;v<e.stops.length;v++){var m=e.stops[v],g=m[0].zoom;void 0===f[g]&&(f[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},d.push(g)),f[g].stops.push([m[0].value,m[1]])}for(var y=[],_=0,b=d;_<b.length;_+=1){var x=b[_];y.push([f[x].zoom,t(f[x],n)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:sn.interpolationFactor.bind(void 0,w),zoomStops:y.map((function(t){return t[0]})),evaluate:function(t,i){var r=t.zoom;return Hn({stops:y,base:e.base},n,r).evaluate(r,i)}}}if(u){var S="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:sn.interpolationFactor.bind(void 0,S),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return i(e,n,t.zoom,r,a)}}}return{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?Vn(e.default,n.default):i(e,n,s,r,a)}}}(this._parameters,this._specification))};function Qn(t){var e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],u=Nn(n);if("object"!==u)return[new At(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=i[c]||i["*"],p=void 0;if(r[c])p=r[c];else if(i[c])p=ki;else if(r["*"])p=r["*"];else{if(!i["*"]){s.push(new At(e,n[l],'unknown property "'+l+'"'));continue}p=ki}s=s.concat(p({key:(e?e+".":e)+l,value:n[l],valueSpec:h,style:a,styleSpec:o,object:n,objectKey:l},n))}for(var f in i)r[f]||i[f].required&&void 0===i[f].default&&void 0===n[f]&&s.push(new At(e,n,'missing required property "'+f+'"'));return s}function ti(t){var e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,a=t.key,o=t.arrayElementValidator||ki;if("array"!==Nn(e))return[new At(a,e,"array expected, "+Nn(e)+" found")];if(n.length&&e.length!==n.length)return[new At(a,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new At(a,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};r.$version<7&&(s.function=n.function),"object"===Nn(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(o({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:i,styleSpec:r,key:a+"["+l+"]"}));return u}function ei(t){var e=t.key,n=t.value,i=t.valueSpec,r=Nn(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new At(e,n,"number expected, "+r+" found")]:"minimum"in i&&n<i.minimum?[new At(e,n,n+" is less than the minimum value "+i.minimum)]:"maximum"in i&&n>i.maximum?[new At(e,n,n+" is greater than the maximum value "+i.maximum)]:[]}function ni(t){var e,n,i,r=t.valueSpec,a=Dt(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,u=!s,l="array"===Nn(t.value.stops)&&"array"===Nn(t.value.stops[0])&&"object"===Nn(t.value.stops[0][0]),c=Qn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return[new At(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(ti({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Nn(n)&&0===n.length&&e.push(new At(t.key,n,"array must have at least one stop")),e},default:function(t){return ki({key:t.key,value:t.value,valueSpec:r,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===a&&s&&c.push(new At(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||c.push(new At(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!Fn(t.valueSpec)&&c.push(new At(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!zn(t.valueSpec)?c.push(new At(t.key,t.value,"property functions not supported")):s&&!On(t.valueSpec)&&c.push(new At(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!l||void 0!==t.value.property||c.push(new At(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],a=t.value,s=t.key;if("array"!==Nn(a))return[new At(s,a,"array expected, "+Nn(a)+" found")];if(2!==a.length)return[new At(s,a,"array length 2 expected, length "+a.length+" found")];if(l){if("object"!==Nn(a[0]))return[new At(s,a,"object expected, "+Nn(a[0])+" found")];if(void 0===a[0].zoom)return[new At(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new At(s,a,"object stop key must have value")];if(i&&i>Dt(a[0].zoom))return[new At(s,a[0].zoom,"stop zoom values must appear in ascending order")];Dt(a[0].zoom)!==i&&(i=Dt(a[0].zoom),n=void 0,o={}),e=e.concat(Qn({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:ei,value:p}}))}else e=e.concat(p({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return Gn(zt(a[1]))?e.concat([new At(s+"[1]",a[1],"expressions are not allowed in function stops.")]):e.concat(ki({key:s+"[1]",value:a[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function p(t,i){var s=Nn(t.value),u=Dt(t.value),l=null!==t.value?t.value:i;if(e){if(s!==e)return[new At(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new At(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, "+s+" found";return zn(r)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new At(t.key,l,c)]}return"categorical"!==a||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&void 0!==n&&u<n?[new At(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===a&&u in o?[new At(t.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new At(t.key,l,"integer expected, found "+u)]}}function ii(t){var e=("property"===t.expressionContext?Kn:Zn)(zt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new At(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new At(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Be(n))return[new At(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Be(n))return[new At(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!je(n,["zoom","feature-state"]))return[new At(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ne(n))return[new At(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ri(t){var e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Dt(n))&&r.push(new At(e,n,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(i.values).indexOf(Dt(n))&&r.push(new At(e,n,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(n)+" found")),r}function ai(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var i=n[e];if(!ai(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}Jn.deserialize=function(t){return new Jn(t._parameters,t._specification)},Jn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var oi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function si(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};ai(t)||(t=li(t));var e=Zn(t,oi);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,n,i){return e.value.evaluate(t,n,{},i)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function ui(t,e){return t<e?-1:t>e?1:0}function li(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?ci(t[1],t[2],"=="):"!="===n?fi(ci(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?ci(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(li))):"all"===n?["all"].concat(t.slice(1).map(li)):"none"===n?["all"].concat(t.slice(1).map(li).map(fi)):"in"===n?hi(t[1],t.slice(2)):"!in"===n?fi(hi(t[1],t.slice(2))):"has"===n?pi(t[1]):"!has"===n?fi(pi(t[1])):"within"!==n||t}function ci(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function hi(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(ui)]]:["filter-in-small",t,["literal",e]]}}function pi(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function fi(t){return["!",t]}function di(t){return ai(zt(t.value))?ii(Rt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,i=e.key;if("array"!==Nn(n))return[new At(i,n,"array expected, "+Nn(n)+" found")];var r,a=e.styleSpec,o=[];if(n.length<1)return[new At(i,n,"filter array must have at least 1 element")];switch(o=o.concat(ri({key:i+"[0]",value:n[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),Dt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Dt(n[1])&&o.push(new At(i,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&o.push(new At(i,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(r=Nn(n[1]))&&o.push(new At(i+"[1]",n[1],"string expected, "+r+" found"));for(var s=2;s<n.length;s++)r=Nn(n[s]),"$type"===Dt(n[1])?o=o.concat(ri({key:i+"["+s+"]",value:n[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new At(i+"["+s+"]",n[s],"string, number, or boolean expected, "+r+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)o=o.concat(t({key:i+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Nn(n[1]),2!==n.length?o.push(new At(i,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==r&&o.push(new At(i+"[1]",n[1],"string expected, "+r+" found"));break;case"within":r=Nn(n[1]),2!==n.length?o.push(new At(i,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==r&&o.push(new At(i+"[1]",n[1],"object expected, "+r+" found"))}return o}(t)}function vi(t,e){var n=t.key,i=t.style,r=t.styleSpec,a=t.value,o=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return ki({key:n,value:a,valueSpec:r.transition,style:i,styleSpec:r});var l,c=t.valueSpec||s[o];if(!c)return[new At(n,a,'unknown property "'+o+'"')];if("string"===Nn(a)&&zn(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new At(n,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new At(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Bn(zt(a))&&"identity"===Dt(a.type)&&h.push(new At(n,a,'"text-font" does not support identity functions'))),h.concat(ki({key:t.key,value:a,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:o}))}function mi(t){return vi(t,"paint")}function gi(t){return vi(t,"layout")}function yi(t){var e=[],n=t.value,i=t.key,r=t.style,a=t.styleSpec;n.type||n.ref||e.push(new At(i,n,'either "type" or "ref" is required'));var o,s=Dt(n.type),u=Dt(n.ref);if(n.id)for(var l=Dt(n.id),c=0;c<t.arrayIndex;c++){var h=r.layers[c];Dt(h.id)===l&&e.push(new At(i,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new At(i,n[t],'"'+t+'" is prohibited for ref layers'))})),r.layers.forEach((function(t){Dt(t.id)===u&&(o=t)})),o?o.ref?e.push(new At(i,n.ref,"ref cannot reference another ref layer")):s=Dt(o.type):e.push(new At(i,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var p=r.sources&&r.sources[n.source],f=p&&Dt(p.type);p?"vector"===f&&"raster"===s?e.push(new At(i,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new At(i,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new At(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new At(i,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new At(i,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new At(i,n.source,'source "'+n.source+'" not found'))}else e.push(new At(i,n,'missing required property "source"'));return e=e.concat(Qn({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ki({key:i+".type",value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:di,layout:function(t){return Qn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return gi(Rt({layerType:s},t))}}})},paint:function(t){return Qn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mi(Rt({layerType:s},t))}}})}}}))}function _i(t){var e=t.value,n=t.key,i=Nn(e);return"string"!==i?[new At(n,e,"string expected, "+i+" found")]:[]}var bi={promoteId:function(t){var e=t.key,n=t.value;if("string"===Nn(n))return _i({key:e,value:n});var i=[];for(var r in n)i.push.apply(i,_i({key:e+"."+r,value:n[r]}));return i}};function xi(t){var e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new At(n,e,'"type" is required')];var a,o=Dt(e.type);switch(o){case"vector":case"raster":case"raster-dem":return Qn({key:n,value:e,valueSpec:i["source_"+o.replace("-","_")],style:t.style,styleSpec:i,objectElementValidators:bi});case"geojson":if(a=Qn({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:bi}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;a.push.apply(a,ii({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),a.push.apply(a,ii({key:n+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return a;case"video":return Qn({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return Qn({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new At(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ri({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function wi(t){var e=t.value,n=t.styleSpec,i=n.light,r=t.style,a=[],o=Nn(e);if(void 0===e)return a;if("object"!==o)return a.concat([new At("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);a=a.concat(u&&i[u[1]]&&i[u[1]].transition?ki({key:s,value:e[s],valueSpec:n.transition,style:r,styleSpec:n}):i[s]?ki({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n}):[new At(s,e[s],'unknown property "'+s+'"')])}return a}var Si={"*":function(){return[]},array:ti,boolean:function(t){var e=t.value,n=t.key,i=Nn(e);return"boolean"!==i?[new At(n,e,"boolean expected, "+i+" found")]:[]},number:ei,color:function(t){var e=t.key,n=t.value,i=Nn(n);return"string"!==i?[new At(e,n,"color expected, "+i+" found")]:null===te(n)?[new At(e,n,'color expected, "'+n+'" found')]:[]},constants:Lt,enum:ri,filter:di,function:ni,layer:yi,object:Qn,source:xi,light:wi,string:_i,formatted:function(t){return 0===_i(t).length?[]:ii(t)},resolvedImage:function(t){return 0===_i(t).length?[]:ii(t)}};function ki(t){var e=t.value,n=t.valueSpec,i=t.styleSpec;return n.expression&&Bn(Dt(e))?ni(t):n.expression&&Gn(zt(e))?ii(t):n.type&&Si[n.type]?Si[n.type](t):Qn(Rt({},t,{valueSpec:n.type?i[n.type]:n}))}function Mi(t){var e=t.value,n=t.key,i=_i(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new At(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new At(n,e,'"glyphs" url must include a "{range}" token'))),i}function Ti(t,e){void 0===e&&(e=Pt);var n=[];return n=n.concat(ki({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Mi,"*":function(){return[]}}})),t.constants&&(n=n.concat(Lt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Ei(n)}function Ei(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Ci(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Ei(t.apply(this,e))}}Ti.source=Ci(xi),Ti.light=Ci(wi),Ti.layer=Ci(yi),Ti.filter=Ci(di),Ti.paintProperty=Ci(mi),Ti.layoutProperty=Ci(gi);var Ii=Ti,Pi=Ii.light,Ai=Ii.paintProperty,Li=Ii.layoutProperty;function Ri(t,e){var n=!1;if(e&&e.length)for(var i=0,r=e;i<r.length;i+=1)t.fire(new Ct(new Error(r[i].message))),n=!0;return n}var Di=zi;function zi(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(var a=0;a<this.d*this.d;a++){var o=r[3+a],s=r[3+a+1];i.push(o===s?null:r.subarray(o,s))}var u=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],u),this.bboxes=r.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var c=n/e*t;this.min=-c,this.max=t+c}zi.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},zi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},zi.prototype._insertCell=function(t,e,n,i,r,a){this.cells[r].push(a)},zi.prototype.query=function(t,e,n,i,r){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,i,this._queryCell,s,{},r),s},zi.prototype._queryCell=function(t,e,n,i,r,a,o,s){var u=this.cells[r];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===o[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&n>=c[f+0]&&i>=c[f+1])?(o[p]=!0,a.push(l[p])):o[p]=!1}}},zi.prototype._forEachCell=function(t,e,n,i,r,a,o,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),h=this._convertToCellCoord(i),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&r.call(this,t,e,n,i,d,a,o,s))return}},zi.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},zi.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},zi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(e+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];r[3+o]=a,r.set(s,a),a+=s.length}return r[3+t.length]=a,r.set(this.keys,a),r[3+t.length+1]=a+=this.keys.length,r.set(this.bboxes,a),a+=this.bboxes.length,r.buffer};var Oi=o.ImageData,Fi=o.ImageBitmap,Ni={};function Bi(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Ni[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var ji in Bi("Object",Object),Di.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Di.deserialize=function(t){return new Di(t.buffer)},Bi("Grid",Di),Bi("Color",ee),Bi("Error",Error),Bi("ResolvedImage",ae),Bi("StylePropertyFunction",Jn),Bi("StyleExpression",Wn,{omit:["_evaluator"]}),Bi("ZoomDependentExpression",Yn),Bi("ZoomConstantExpression",Xn),Bi("CompoundExpression",be,{omit:["_evaluate"]}),Cn)Cn[ji]._classRegistryKey||Bi("Expression_"+ji,Cn[ji]);function Vi(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Ui(t){return Fi&&t instanceof Fi}function $i(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Vi(t)||Ui(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Oi)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],r=0,a=t;r<a.length;r+=1)i.push($i(a[r],e));return i}if("object"==typeof t){var o=t.constructor,s=o._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=o.serialize?o.serialize(t,e):{};if(!o.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(Ni[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=Ni[s].shallow.indexOf(l)>=0?c:$i(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Hi(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Vi(t)||Ui(t)||ArrayBuffer.isView(t)||t instanceof Oi)return t;if(Array.isArray(t))return t.map(Hi);if("object"==typeof t){var e=t.$name||"Object",n=Ni[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var i=Object.create(n.prototype),r=0,a=Object.keys(t);r<a.length;r+=1){var o=a[r];if("$name"!==o){var s=t[o];i[o]=Ni[e].shallow.indexOf(o)>=0?s:Hi(s)}}return i}throw new Error("can't deserialize object of type "+typeof t)}var qi=function(){this.first=!0};qi.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var Wi={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Gi(t){for(var e=0,n=t;e<n.length;e+=1)if(Zi(n[e].charCodeAt(0)))return!0;return!1}function Zi(t){return!(746!==t&&747!==t&&(t<4352||!(Wi["Bopomofo Extended"](t)||Wi.Bopomofo(t)||Wi["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Wi["CJK Compatibility Ideographs"](t)||Wi["CJK Compatibility"](t)||Wi["CJK Radicals Supplement"](t)||Wi["CJK Strokes"](t)||!(!Wi["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Wi["CJK Unified Ideographs Extension A"](t)||Wi["CJK Unified Ideographs"](t)||Wi["Enclosed CJK Letters and Months"](t)||Wi["Hangul Compatibility Jamo"](t)||Wi["Hangul Jamo Extended-A"](t)||Wi["Hangul Jamo Extended-B"](t)||Wi["Hangul Jamo"](t)||Wi["Hangul Syllables"](t)||Wi.Hiragana(t)||Wi["Ideographic Description Characters"](t)||Wi.Kanbun(t)||Wi["Kangxi Radicals"](t)||Wi["Katakana Phonetic Extensions"](t)||Wi.Katakana(t)&&12540!==t||!(!Wi["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Wi["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Wi["Unified Canadian Aboriginal Syllabics"](t)||Wi["Unified Canadian Aboriginal Syllabics Extended"](t)||Wi["Vertical Forms"](t)||Wi["Yijing Hexagram Symbols"](t)||Wi["Yi Syllables"](t)||Wi["Yi Radicals"](t))))}function Xi(t){return!(Zi(t)||function(t){return!!(Wi["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Wi["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Wi["Letterlike Symbols"](t)||Wi["Number Forms"](t)||Wi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Wi["Control Pictures"](t)&&9251!==t||Wi["Optical Character Recognition"](t)||Wi["Enclosed Alphanumerics"](t)||Wi["Geometric Shapes"](t)||Wi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Wi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wi["CJK Symbols and Punctuation"](t)||Wi.Katakana(t)||Wi["Private Use Area"](t)||Wi["CJK Compatibility Forms"](t)||Wi["Small Form Variants"](t)||Wi["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Yi(t){return t>=1424&&t<=2303||Wi["Arabic Presentation Forms-A"](t)||Wi["Arabic Presentation Forms-B"](t)}function Ki(t,e){return!(!e&&Yi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Wi.Khmer(t))}function Ji(t){for(var e=0,n=t;e<n.length;e+=1)if(Yi(n[e].charCodeAt(0)))return!0;return!1}var Qi=null,tr="unavailable",er=null,nr=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(tr="error"),Qi&&Qi(t)};function ir(){rr.fire(new Et("pluginStateChange",{pluginStatus:tr,pluginURL:er}))}var rr=new It,ar=function(){return tr},or=function(){if("deferred"!==tr||!er)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tr="loading",ir(),er&&xt({url:er},(function(t){t?nr(t):(tr="loaded",ir())}))},sr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===tr||null!=sr.applyArabicShaping},isLoading:function(){return"loading"===tr},setState:function(t){tr=t.pluginStatus,er=t.pluginURL},isParsed:function(){return null!=sr.applyArabicShaping&&null!=sr.processBidirectionalText&&null!=sr.processStyledBidirectionalText},getPluginURL:function(){return er}},ur=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qi,this.transition={})};ur.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,i=t;n<i.length;n+=1)if(!Ki(i[n].charCodeAt(0),e))return!1;return!0}(t,sr.isLoaded())},ur.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ur.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var lr=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Bn(t))return new Jn(t,e);if(Gn(t)){var n=Kn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=ee.parse(t)),{kind:"constant",evaluate:function(){return i}}}(void 0===e?t.specification.default:e,t.specification)};lr.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},lr.prototype.possiblyEvaluate=function(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)};var cr=function(t){this.property=t,this.value=new lr(t,void 0)};cr.prototype.transitioned=function(t,e){return new pr(this.property,this.value,e,p({},t.transition,this.transition),t.now)},cr.prototype.untransitioned=function(){return new pr(this.property,this.value,null,{},0)};var hr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};hr.prototype.getValue=function(t){return x(this._values[t].value.value)},hr.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new cr(this._values[t].property)),this._values[t].value=new lr(this._values[t].property,null===e?void 0:x(e))},hr.prototype.getTransition=function(t){return x(this._values[t].transition)},hr.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new cr(this._values[t].property)),this._values[t].transition=x(e)||void 0},hr.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r);var a=this.getTransition(i);void 0!==a&&(t[i+"-transition"]=a)}return t},hr.prototype.transitioned=function(t,e){for(var n=new fr(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var a=r[i];n._values[a]=this._values[a].transitioned(t,e._values[a])}return n},hr.prototype.untransitioned=function(){for(var t=new fr(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e];t._values[i]=this._values[i].untransitioned()}return t};var pr=function(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)};pr.prototype.possiblyEvaluate=function(t,e,n){var i=t.now||0,r=this.value.possiblyEvaluate(t,e,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return a.possiblyEvaluate(t,e,n);var o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t,e,n),r,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(o))}return r};var fr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};fr.prototype.possiblyEvaluate=function(t,e,n){for(var i=new mr(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var o=a[r];i._values[o]=this._values[o].possiblyEvaluate(t,e,n)}return i},fr.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var dr=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};dr.prototype.getValue=function(t){return x(this._values[t].value)},dr.prototype.setValue=function(t,e){this._values[t]=new lr(this._values[t].property,null===e?void 0:x(e))},dr.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r)}return t},dr.prototype.possiblyEvaluate=function(t,e,n){for(var i=new mr(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var o=a[r];i._values[o]=this._values[o].possiblyEvaluate(t,e,n)}return i};var vr=function(t,e,n){this.property=t,this.value=e,this.parameters=n};vr.prototype.isConstant=function(){return"constant"===this.value.kind},vr.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},vr.prototype.evaluate=function(t,e,n,i){return this.property.evaluate(this.value,this.parameters,t,e,n,i)};var mr=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mr.prototype.get=function(t){return this._values[t]};var gr=function(t){this.specification=t};gr.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},gr.prototype.interpolate=function(t,e,n){var i=We[this.specification.type];return i?i(t,e,n):t};var yr=function(t,e){this.specification=t,this.overrides=e};yr.prototype.possiblyEvaluate=function(t,e,n,i){return new vr(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,i)}:t.expression,e)},yr.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new vr(this,{kind:"constant",value:void 0},t.parameters);var i=We[this.specification.type];return i?new vr(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.parameters):t},yr.prototype.evaluate=function(t,e,n,i,r,a){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r,a)};var _r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,n,i){if(void 0===t.value)return new vr(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var r=t.expression.evaluate(e,null,{},n,i),a="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(a,a,a,e);return new vr(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new vr(this,{kind:"constant",value:s},e)}return new vr(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,i,r,a){if("source"===t.kind){var o=t.evaluate(e,n,i,r,a);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value},e.prototype._calculate=function(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(yr),br=function(t){this.specification=t};br.prototype.possiblyEvaluate=function(t,e,n,i){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e,null,{},n,i);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new ur(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ur(Math.floor(e.zoom),e)),t.expression.evaluate(new ur(Math.floor(e.zoom+1),e)),e)}},br.prototype._calculate=function(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},br.prototype.interpolate=function(t){return t};var xr=function(t){this.specification=t};xr.prototype.possiblyEvaluate=function(t,e,n,i){return!!t.expression.evaluate(e,null,{},n,i)},xr.prototype.interpolate=function(){return!1};var wr=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var i=this.defaultPropertyValues[e]=new lr(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new cr(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}};Bi("DataDrivenProperty",yr),Bi("DataConstantProperty",gr),Bi("CrossFadedDataDrivenProperty",_r),Bi("CrossFadedProperty",br),Bi("ColorRampProperty",xr);var Sr=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new dr(n.layout)),n.paint)){for(var i in this._transitionablePaint=new hr(n.paint),e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(var r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mr(n.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){void 0===n&&(n={}),null!=e&&this._validate(Li,"layers."+this.id+".layout."+t,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return y(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e&&this._validate(Ai,"layers."+this.id+".paint."+t,t,e,n))return!1;if(y(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var i=this._transitionablePaint._values[t],r="cross-faded-data-driven"===i.property.specification["property-type"],a=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||a||r||this._handleOverridablePaintPropertyUpdate(t,o,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),b(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,i,r){return void 0===r&&(r={}),(!r||!1!==r.validate)&&Ri(this,t.call(Ii,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof vr&&zn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(It),kr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Mr=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Tr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Er(t,e){void 0===e&&(e=1);var n=0,i=0;return{members:t.map((function(t){var r=kr[t.type].BYTES_PER_ELEMENT,a=n=Cr(n,Math.max(e,r)),o=t.components||1;return i=Math.max(i,r),n+=r*o,{name:t.name,type:t.type,components:o,offset:a}})),size:Cr(n,Math.max(i,e)),alignment:e}}function Cr(t,e){return Math.ceil(t/e)*e}Tr.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Tr.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Tr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Tr.prototype.clear=function(){this.length=0},Tr.prototype.resize=function(t){this.reserve(t),this.length=t},Tr.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Tr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ir=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t},e}(Tr);Ir.prototype.bytesPerElement=4,Bi("StructArrayLayout2i4",Ir);var Pr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,t},e}(Tr);Pr.prototype.bytesPerElement=8,Bi("StructArrayLayout4i8",Pr);var Ar=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)},e.prototype.emplace=function(t,e,n,i,r,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Tr);Ar.prototype.bytesPerElement=12,Bi("StructArrayLayout2i4i12",Ar);var Lr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)},e.prototype.emplace=function(t,e,n,i,r,a,o){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=i,this.uint8[u+5]=r,this.uint8[u+6]=a,this.uint8[u+7]=o,t},e}(Tr);Lr.prototype.bytesPerElement=8,Bi("StructArrayLayout2i4ub8",Lr);var Rr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t},e}(Tr);Rr.prototype.bytesPerElement=8,Bi("StructArrayLayout2f8",Rr);var Dr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,i,r,a,o,s,u,l)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=l,this.uint16[h+9]=c,t},e}(Tr);Dr.prototype.bytesPerElement=20,Bi("StructArrayLayout10ui20",Dr);var zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l,c,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,n,i,r,a,o,s,u,l,c,h)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c,h,p){var f=12*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.uint16[f+4]=a,this.uint16[f+5]=o,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=l,this.int16[f+9]=c,this.int16[f+10]=h,this.int16[f+11]=p,t},e}(Tr);zr.prototype.bytesPerElement=24,Bi("StructArrayLayout4i4ui4i24",zr);var Or=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t},e}(Tr);Or.prototype.bytesPerElement=12,Bi("StructArrayLayout3f12",Or);var Fr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Tr);Fr.prototype.bytesPerElement=4,Bi("StructArrayLayout1ul4",Fr);var Nr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,i,r,a,o,s,u)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=i,this.int16[c+3]=r,this.int16[c+4]=a,this.int16[c+5]=o,this.uint32[h+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,t},e}(Tr);Nr.prototype.bytesPerElement=20,Bi("StructArrayLayout6i1ul2ui20",Nr);var Br=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)},e.prototype.emplace=function(t,e,n,i,r,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Tr);Br.prototype.bytesPerElement=12,Bi("StructArrayLayout2i2i2i12",Br);var jr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r)},e.prototype.emplace=function(t,e,n,i,r,a){var o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[s+6]=r,this.int16[s+7]=a,t},e}(Tr);jr.prototype.bytesPerElement=16,Bi("StructArrayLayout2f1f2i16",jr);var Vr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var a=12*t,o=3*t;return this.uint8[a+0]=e,this.uint8[a+1]=n,this.float32[o+1]=i,this.float32[o+2]=r,t},e}(Tr);Vr.prototype.bytesPerElement=12,Bi("StructArrayLayout2ub2f12",Vr);var Ur=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t},e}(Tr);Ur.prototype.bytesPerElement=6,Bi("StructArrayLayout3ui6",Ur);var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m){var g=this.length;return this.resize(g+1),this.emplace(g,t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g){var y=24*t,_=12*t,b=48*t;return this.int16[y+0]=e,this.int16[y+1]=n,this.uint16[y+2]=i,this.uint16[y+3]=r,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[y+10]=u,this.uint16[y+11]=l,this.uint16[y+12]=c,this.float32[_+7]=h,this.float32[_+8]=p,this.uint8[b+36]=f,this.uint8[b+37]=d,this.uint8[b+38]=v,this.uint32[_+10]=m,this.int16[y+22]=g,t},e}(Tr);$r.prototype.bytesPerElement=48,Bi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$r);var Hr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M,T,E){var C=this.length;return this.resize(C+1),this.emplace(C,t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M,T,E)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M,T,E,C){var I=34*t,P=17*t;return this.int16[I+0]=e,this.int16[I+1]=n,this.int16[I+2]=i,this.int16[I+3]=r,this.int16[I+4]=a,this.int16[I+5]=o,this.int16[I+6]=s,this.int16[I+7]=u,this.uint16[I+8]=l,this.uint16[I+9]=c,this.uint16[I+10]=h,this.uint16[I+11]=p,this.uint16[I+12]=f,this.uint16[I+13]=d,this.uint16[I+14]=v,this.uint16[I+15]=m,this.uint16[I+16]=g,this.uint16[I+17]=y,this.uint16[I+18]=_,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=w,this.uint16[I+22]=S,this.uint32[P+12]=k,this.float32[P+13]=M,this.float32[P+14]=T,this.float32[P+15]=E,this.float32[P+16]=C,t},e}(Tr);Hr.prototype.bytesPerElement=68,Bi("StructArrayLayout8i15ui1ul4f68",Hr);var qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Tr);qr.prototype.bytesPerElement=4,Bi("StructArrayLayout1f4",qr);var Wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t},e}(Tr);Wr.prototype.bytesPerElement=6,Bi("StructArrayLayout3i6",Wr);var Gr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=n,this.uint16[r+3]=i,t},e}(Tr);Gr.prototype.bytesPerElement=8,Bi("StructArrayLayout1ul2ui8",Gr);var Zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t},e}(Tr);Zr.prototype.bytesPerElement=4,Bi("StructArrayLayout2ui4",Zr);var Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Tr);Xr.prototype.bytesPerElement=2,Bi("StructArrayLayout1ui2",Xr);var Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,t},e}(Tr);Yr.prototype.bytesPerElement=16,Bi("StructArrayLayout4f16",Yr);var Kr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new r(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Mr);Kr.prototype.size=20;var Jr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Kr(this,t)},e}(Nr);Bi("CollisionBoxArray",Jr);var Qr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,n),e}(Mr);Qr.prototype.size=48;var ta=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Qr(this,t)},e}($r);Bi("PlacedSymbolArray",ta);var ea=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,n),e}(Mr);ea.prototype.size=68;var na=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new ea(this,t)},e}(Hr);Bi("SymbolInstanceArray",na);var ia=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(qr);Bi("GlyphOffsetArray",ia);var ra=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Wr);Bi("SymbolLineVertexArray",ra);var aa=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,n),e}(Mr);aa.prototype.size=8;var oa=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new aa(this,t)},e}(Gr);Bi("FeatureIndexArray",oa);var sa=Er([{name:"a_pos",components:2,type:"Int16"}],4).members,ua=function(t){void 0===t&&(t=[]),this.segments=t};function la(t,e){return 256*(t=c(Math.floor(t),0,255))+c(Math.floor(e),0,255)}ua.prototype.prepareSegment=function(t,e,n,i){var r=this.segments[this.segments.length-1];return t>ua.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+ua.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!r||r.vertexLength+t>ua.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r},ua.prototype.get=function(){return this.segments},ua.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var i in n.vaos)n.vaos[i].destroy()}},ua.simpleSegment=function(t,e,n,i){return new ua([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])},ua.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bi("SegmentVector",ua);var ca=Er([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ha=e((function(t){t.exports=function(t,e){var n,i,r,a,o,s,u,l;for(i=t.length-(n=3&t.length),r=e,o=3432918353,s=461845907,l=0;l<i;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,r=27492+(65535&(a=5*(65535&(r=(r^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:r^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),pa=e((function(t){t.exports=function(t,e){for(var n,i=t.length,r=e^i,a=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:r^=(255&t.charCodeAt(a+2))<<16;case 2:r^=(255&t.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),fa=ha,da=pa;fa.murmur3=ha,fa.murmur2=da;var va=function(){this.ids=[],this.positions=[],this.indexed=!1};va.prototype.add=function(t,e,n,i){this.ids.push(ga(t)),this.positions.push(e,n,i)},va.prototype.getPositions=function(t){for(var e=ga(t),n=0,i=this.ids.length-1;n<i;){var r=n+i>>1;this.ids[r]>=e?i=r:n=r+1}for(var a=[];this.ids[n]===e;)a.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return a},va.serialize=function(t,e){var n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return function t(e,n,i,r){for(;i<r;){for(var a=e[i+r>>1],o=i-1,s=r+1;;){do{o++}while(e[o]<a);do{s--}while(e[s]>a);if(o>=s)break;ya(e,o,s),ya(n,3*o,3*s),ya(n,3*o+1,3*s+1),ya(n,3*o+2,3*s+2)}s-i<r-s?(t(e,n,i,s),i=s+1):(t(e,n,s+1,r),r=s)}}(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}},va.deserialize=function(t){var e=new va;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var ma=Math.pow(2,53)-1;function ga(t){var e=+t;return!isNaN(e)&&e<=ma?e:fa(String(t))}function ya(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}Bi("FeaturePositionMap",va);var _a=function(t,e){this.gl=t.gl,this.location=e},ba=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(_a),xa=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(_a),wa=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(_a),Sa=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(_a),ka=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(_a),Ma=function(t){function e(e,n){t.call(this,e,n),this.current=ee.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(_a),Ta=new Float32Array(16),Ea=function(t){function e(e,n){t.call(this,e,n),this.current=Ta}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(_a);function Ca(t){return[la(255*t.r,255*t.g),la(255*t.b,255*t.a)]}var Ia=function(t,e,n){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=n};Ia.prototype.setUniform=function(t,e,n){t.set(n.constantOr(this.value))},Ia.prototype.getBinding=function(t,e,n){return"color"===this.type?new Ma(t,e):new xa(t,e)};var Pa=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Pa.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Pa.prototype.setUniform=function(t,e,n,i){var r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&t.set(r)},Pa.prototype.getBinding=function(t,e,n){return"u_pattern"===n.substr(0,9)?new ka(t,e):new xa(t,e)};var Aa=function(t,e,n,i){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new i};Aa.prototype.populatePaintArray=function(t,e,n,i,r){var a=this.paintVertexArray.length,o=this.expression.evaluate(new ur(0),e,{},i,[],r);this.paintVertexArray.resize(t),this._setPaintValue(a,t,o)},Aa.prototype.updatePaintArray=function(t,e,n,i){var r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(t,e,r)},Aa.prototype._setPaintValue=function(t,e,n){if("color"===this.type)for(var i=Ca(n),r=t;r<e;r++)this.paintVertexArray.emplace(r,i[0],i[1]);else{for(var a=t;a<e;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Aa.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Aa.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var La=function(t,e,n,i,r,a){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new a};La.prototype.populatePaintArray=function(t,e,n,i,r){var a=this.expression.evaluate(new ur(this.zoom),e,{},i,[],r),o=this.expression.evaluate(new ur(this.zoom+1),e,{},i,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,a,o)},La.prototype.updatePaintArray=function(t,e,n,i){var r=this.expression.evaluate({zoom:this.zoom},n,i),a=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(t,e,r,a)},La.prototype._setPaintValue=function(t,e,n,i){if("color"===this.type)for(var r=Ca(n),a=Ca(i),o=t;o<e;o++)this.paintVertexArray.emplace(o,r[0],r[1],a[0],a[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}},La.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},La.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},La.prototype.setUniform=function(t,e){var n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,i=c(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(i)},La.prototype.getBinding=function(t,e,n){return new xa(t,e)};var Ra=function(t,e,n,i,r,a){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=i,this.layerId=a,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r};Ra.prototype.populatePaintArray=function(t,e,n){var i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],n)},Ra.prototype.updatePaintArray=function(t,e,n,i,r){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],r)},Ra.prototype._setPaintValues=function(t,e,n,i){if(i&&n){var r=i[n.min],a=i[n.mid],o=i[n.max];if(r&&a&&o)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],r.tl[0],r.tl[1],r.br[0],r.br[1],a.pixelRatio,r.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],a.pixelRatio,o.pixelRatio)}},Ra.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ca.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ca.members,this.expression.isStateDependent))},Ra.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Da=function(t,e,n){this.binders={},this._buffers=[];var i=[];for(var r in t.paint._values)if(n(r)){var a=t.paint.get(r);if(a instanceof vr&&zn(a.property.specification)){var o=Oa(r,t.type),s=a.value,u=a.property.specification.type,l=a.property.useIntegerZoom,c=a.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[r]=h?new Pa(s.value,o):new Ia(s.value,o,u),i.push("/u_"+r);else if("source"===s.kind||h){var p=Fa(r,u,"source");this.binders[r]=h?new Ra(s,u,l,e,p,t.id):new Aa(s,o,u,p),i.push("/a_"+r)}else{var f=Fa(r,u,"composite");this.binders[r]=new La(s,o,u,l,e,f),i.push("/z_"+r)}}}this.cacheKey=i.sort().join("")};Da.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Aa||e instanceof La?e.maxValue:0},Da.prototype.populatePaintArrays=function(t,e,n,i,r){for(var a in this.binders){var o=this.binders[a];(o instanceof Aa||o instanceof La||o instanceof Ra)&&o.populatePaintArray(t,e,n,i,r)}},Da.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders){var i=this.binders[n];i instanceof Pa&&i.setConstantPatternPositions(t,e)}},Da.prototype.updatePaintArrays=function(t,e,n,i,r){var a=!1;for(var o in t)for(var s=0,u=e.getPositions(o);s<u.length;s+=1){var l=u[s],c=n.feature(l.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof Aa||p instanceof La||p instanceof Ra)&&!0===p.expression.isStateDependent){var f=i.paint.get(h);p.expression=f.value,p.updatePaintArray(l.start,l.end,c,t[o],r),a=!0}}}return a},Da.prototype.defines=function(){var t=[];for(var e in this.binders){var n=this.binders[e];(n instanceof Ia||n instanceof Pa)&&t.push.apply(t,n.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Da.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Aa||n instanceof La)for(var i=0;i<n.paintVertexAttributes.length;i++)t.push(n.paintVertexAttributes[i].name);else if(n instanceof Ra)for(var r=0;r<ca.members.length;r++)t.push(ca.members[r].name)}return t},Da.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Ia||n instanceof Pa||n instanceof La)for(var i=0,r=n.uniformNames;i<r.length;i+=1)t.push(r[i])}return t},Da.prototype.getPaintVertexBuffers=function(){return this._buffers},Da.prototype.getUniforms=function(t,e){var n=[];for(var i in this.binders){var r=this.binders[i];if(r instanceof Ia||r instanceof Pa||r instanceof La)for(var a=0,o=r.uniformNames;a<o.length;a+=1){var s=o[a];if(e[s]){var u=r.getBinding(t,e[s],s);n.push({name:s,property:i,binding:u})}}}return n},Da.prototype.setUniforms=function(t,e,n,i){for(var r=0,a=e;r<a.length;r+=1){var o=a[r],s=o.name,u=o.property;this.binders[u].setUniform(o.binding,i,n.get(u),s)}},Da.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var n=this.binders[e];if(t&&n instanceof Ra){var i=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;i&&this._buffers.push(i)}else(n instanceof Aa||n instanceof La)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Da.prototype.upload=function(t){for(var e in this.binders){var n=this.binders[e];(n instanceof Aa||n instanceof La||n instanceof Ra)&&n.upload(t)}this.updatePaintBuffers()},Da.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Aa||e instanceof La||e instanceof Ra)&&e.destroy()}};var za=function(t,e,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var i=0,r=t;i<r.length;i+=1){var a=r[i];this.programConfigurations[a.id]=new Da(a,e,n)}this.needsUpload=!1,this._featureMap=new va,this._bufferOffset=0};function Oa(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Fa(t,e,n){var i={color:{source:Rr,composite:Yr},number:{source:qr,composite:Rr}},r=function(t){return{"line-pattern":{source:Dr,composite:Dr},"fill-pattern":{source:Dr,composite:Dr},"fill-extrusion-pattern":{source:Dr,composite:Dr}}[t]}(t);return r&&r[n]||i[e][n]}za.prototype.populatePaintArrays=function(t,e,n,i,r,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,i,r,a);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},za.prototype.updatePaintArrays=function(t,e,n,i){for(var r=0,a=n;r<a.length;r+=1){var o=a[r];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,i)||this.needsUpload}},za.prototype.get=function(t){return this.programConfigurations[t]},za.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},za.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Bi("ConstantBinder",Ia),Bi("CrossFadedConstantBinder",Pa),Bi("SourceExpressionBinder",Aa),Bi("CrossFadedCompositeBinder",Ra),Bi("CompositeExpressionBinder",La),Bi("ProgramConfiguration",Da,{omit:["_buffers"]}),Bi("ProgramConfigurationSet",za);var Na=Math.pow(2,14)-1,Ba=-Na-1;function ja(t){for(var e=8192/t.extent,n=t.loadGeometry(),i=0;i<n.length;i++)for(var r=n[i],a=0;a<r.length;a++){var o=r[a],s=Math.round(o.x*e),u=Math.round(o.y*e);o.x=c(s,Ba,Na),o.y=c(u,Ba,Na),(s<o.x||s>o.x+1||u<o.y||u>o.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function Va(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ja(t):[]}}function Ua(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}var $a=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ir,this.indexArray=new Ur,this.segments=new ua,this.programConfigurations=new za(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ha(t,e){for(var n=0;n<t.length;n++)if(Qa(e,t[n]))return!0;for(var i=0;i<e.length;i++)if(Qa(t,e[i]))return!0;return!!Za(t,e)}function qa(t,e,n){return!!Qa(t,e)||!!Ya(e,t,n)}function Wa(t,e){if(1===t.length)return Ja(e,t[0]);for(var n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.length;r++)if(Qa(t,i[r]))return!0;for(var a=0;a<t.length;a++)if(Ja(e,t[a]))return!0;for(var o=0;o<e.length;o++)if(Za(t,e[o]))return!0;return!1}function Ga(t,e,n){if(t.length>1){if(Za(t,e))return!0;for(var i=0;i<e.length;i++)if(Ya(e[i],t,n))return!0}for(var r=0;r<t.length;r++)if(Ya(t[r],e,n))return!0;return!1}function Za(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var i=t[n],r=t[n+1],a=0;a<e.length-1;a++)if(Xa(i,r,e[a],e[a+1]))return!0;return!1}function Xa(t,e,n,i){return k(t,n,i)!==k(e,n,i)&&k(t,e,n)!==k(t,e,i)}function Ya(t,e,n){var i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(var r=1;r<e.length;r++)if(Ka(t,e[r-1],e[r])<i)return!0;return!1}function Ka(t,e,n){var i=e.distSqr(n);if(0===i)return t.distSqr(e);var r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function Ja(t,e){for(var n,i,r,a=!1,o=0;o<t.length;o++)for(var s=0,u=(n=t[o]).length-1;s<n.length;u=s++)(i=n[s]).y>e.y!=(r=n[u]).y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(a=!a);return a}function Qa(t,e){for(var n=!1,i=0,r=t.length-1;i<t.length;r=i++){var a=t[i],o=t[r];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function to(t,e,n){var i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;var a=k(t,e,n[0]);return a!==k(t,e,n[1])||a!==k(t,e,n[2])||a!==k(t,e,n[3])}function eo(t,e,n){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function no(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function io(t,e,n,i,a){if(!e[0]&&!e[1])return t;var o=r.convert(e)._mult(a);"viewport"===n&&o._rotate(-i);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(o));return s}$a.prototype.populate=function(t,e,n){var i=this.layers[0],r=[],a=null,o=!1;"circle"===i.type&&(o=!(a=i.layout.get("circle-sort-key")).isConstant());for(var s=0,u=t;s<u.length;s+=1){var l=u[s],c=l.feature,h=l.id,p=l.index,f=l.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,v=Va(c,d);if(this.layers[0]._featureFilter.filter(new ur(this.zoom),v,n)){var m=o?a.evaluate(v,{},n):void 0,g={id:h,properties:c.properties,type:c.type,sourceLayerIndex:f,index:p,geometry:d?v.geometry:ja(c),patterns:{},sortKey:m};r.push(g)}}o&&r.sort((function(t,e){return t.sortKey-e.sortKey}));for(var y=0,_=r;y<_.length;y+=1){var b=_[y],x=b.geometry,w=b.index,S=b.sourceLayerIndex,k=t[w].feature;this.addFeature(b,x,w,n),e.featureIndex.insert(k,x,w,S,this.index)}},$a.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},$a.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},$a.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$a.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sa),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},$a.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$a.prototype.addFeature=function(t,e,n,i){for(var r=0,a=e;r<a.length;r+=1)for(var o=0,s=a[r];o<s.length;o+=1){var u=s[o],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;Ua(this.layoutVertexArray,l,c,-1,-1),Ua(this.layoutVertexArray,l,c,1,-1),Ua(this.layoutVertexArray,l,c,1,1),Ua(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},i)},Bi("CircleBucket",$a,{omit:["layers"]});var ro=new wr({"circle-sort-key":new yr(Pt.layout_circle["circle-sort-key"])}),ao={paint:new wr({"circle-radius":new yr(Pt.paint_circle["circle-radius"]),"circle-color":new yr(Pt.paint_circle["circle-color"]),"circle-blur":new yr(Pt.paint_circle["circle-blur"]),"circle-opacity":new yr(Pt.paint_circle["circle-opacity"]),"circle-translate":new gr(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new gr(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gr(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gr(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yr(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yr(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yr(Pt.paint_circle["circle-stroke-opacity"])}),layout:ro},oo="undefined"!=typeof Float32Array?Float32Array:Array;function so(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uo(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*i+b*s+x*h+w*v,t[1]=_*r+b*u+x*p+w*m,t[2]=_*a+b*l+x*f+w*g,t[3]=_*o+b*c+x*d+w*y,t[4]=(_=n[4])*i+(b=n[5])*s+(x=n[6])*h+(w=n[7])*v,t[5]=_*r+b*u+x*p+w*m,t[6]=_*a+b*l+x*f+w*g,t[7]=_*o+b*c+x*d+w*y,t[8]=(_=n[8])*i+(b=n[9])*s+(x=n[10])*h+(w=n[11])*v,t[9]=_*r+b*u+x*p+w*m,t[10]=_*a+b*l+x*f+w*g,t[11]=_*o+b*c+x*d+w*y,t[12]=(_=n[12])*i+(b=n[13])*s+(x=n[14])*h+(w=n[15])*v,t[13]=_*r+b*u+x*p+w*m,t[14]=_*a+b*l+x*f+w*g,t[15]=_*o+b*c+x*d+w*y,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)});var lo,co=uo;function ho(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t}lo=new oo(3),oo!=Float32Array&&(lo[0]=0,lo[1]=0,lo[2]=0),function(){var t=new oo(4);oo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var po=(function(){var t=new oo(2);oo!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,ao)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new $a(t)},e.prototype.queryRadius=function(t){var e=t;return eo("circle-radius",this,e)+eo("circle-stroke-width",this,e)+no(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,r,a,o,s){for(var u=io(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return t.map((function(t){return fo(t,e)}))}(u,s),p=c?l*o:l,f=0,d=i;f<d.length;f+=1)for(var v=0,m=d[f];v<m.length;v+=1){var g=m[v],y=c?g:fo(g,s),_=p,b=ho([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=a.cameraToCenterDistance/b[3]),qa(h,y,_))return!0}return!1},e}(Sr));function fo(t,e){var n=ho([],[t.x,t.y,0,1],e);return new r(n[0]/n[3],n[1]/n[3])}var vo=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}($a);function mo(t,e,n,i){var r=e.width,a=e.height;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*a*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*a*n);return t.width=r,t.height=a,t.data=i,t}function go(t,e,n){var i=e.width,r=e.height;if(i!==t.width||r!==t.height){var a=mo({},{width:i,height:r},n);yo(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=a.data}}function yo(t,e,n,i,r,a){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<r.height;u++)for(var l=((n.y+u)*t.width+n.x)*a,c=((i.y+u)*e.width+i.x)*a,h=0;h<r.width*a;h++)s[c+h]=o[l+h];return e}Bi("HeatmapBucket",vo,{omit:["layers"]});var _o=function(t,e){mo(this,t,1,e)};_o.prototype.resize=function(t){go(this,t,1)},_o.prototype.clone=function(){return new _o({width:this.width,height:this.height},new Uint8Array(this.data))},_o.copy=function(t,e,n,i,r){yo(t,e,n,i,r,1)};var bo=function(t,e){mo(this,t,4,e)};bo.prototype.resize=function(t){go(this,t,4)},bo.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},bo.prototype.clone=function(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))},bo.copy=function(t,e,n,i,r){yo(t,e,n,i,r,4)},Bi("AlphaImage",_o),Bi("RGBAImage",bo);var xo={paint:new wr({"heatmap-radius":new yr(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yr(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gr(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xr(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gr(Pt.paint_heatmap["heatmap-opacity"])})};function wo(t){var e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new bo({width:n,height:i}),a=function(n,i,a){e[t.evaluationKey]=a;var o=t.expression.evaluate(e);r.data[n+i+0]=Math.floor(255*o.r/o.a),r.data[n+i+1]=Math.floor(255*o.g/o.a),r.data[n+i+2]=Math.floor(255*o.b/o.a),r.data[n+i+3]=Math.floor(255*o.a)};if(t.clips)for(var o=0,s=0;o<i;++o,s+=4*n)for(var u=0,l=0;u<n;u++,l+=4){var c=u/(n-1),h=t.clips[o];a(s,l,h.start*(1-c)+h.end*c)}else for(var p=0,f=0;p<n;p++,f+=4)a(0,f,p/(n-1));return r}var So=function(t){function e(e){t.call(this,e,xo),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new vo(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=wo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Sr),ko={paint:new wr({"hillshade-illumination-direction":new gr(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gr(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gr(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gr(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gr(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gr(Pt.paint_hillshade["hillshade-accent-color"])})},Mo=function(t){function e(e){t.call(this,e,ko)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Sr),To=Er([{name:"a_pos",components:2,type:"Int16"}],4).members,Eo=Io,Co=Io;function Io(t,e,n){n=n||2;var i,r,a,o,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Po(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,i){var r,a,o,s=[];for(r=0,a=e.length;r<a;r++)(o=Po(t,e[r]*i,r<a-1?e[r+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),s.push(Vo(o));for(s.sort(Fo),r=0;r<s.length;r++)No(s[r],n),n=Ao(n,n.next);return n}(t,e,p,n)),t.length>80*n){i=a=t[0],r=o=t[1];for(var d=n;d<h;d+=n)(s=t[d])<i&&(i=s),(u=t[d+1])<r&&(r=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-i,o-r))?1/l:0}return Lo(p,f,n,i,r,l),f}function Po(t,e,n,i,r){var a,o;if(r===ts(t,e,n,i)>0)for(a=e;a<n;a+=i)o=Ko(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=Ko(a,t[a],t[a+1],o);return o&&qo(o,o.next)&&(Jo(o),o=o.next),o}function Ao(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!qo(i,i.next)&&0!==Ho(i.prev,i,i.next))i=i.next;else{if(Jo(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Lo(t,e,n,i,r,a,o){if(t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=jo(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,a,o,s,u,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?Do(t,i,r,a):Ro(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Jo(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Lo(t=zo(Ao(t),e,n),e,n,i,r,a,2):2===o&&Oo(t,e,n,i,r,a):Lo(Ao(t),e,n,i,r,a,1);break}}}function Ro(t){var e=t.prev,n=t,i=t.next;if(Ho(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Uo(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Ho(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Do(t,e,n,i){var r=t.prev,a=t,o=t.next;if(Ho(r,a,o)>=0)return!1;for(var s=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,l=jo(r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,e,n,i),c=jo(s,u,e,n,i),h=t.prevZ,p=t.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&Uo(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&Ho(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&Uo(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Ho(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&Uo(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&Ho(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&Uo(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Ho(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function zo(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!qo(r,a)&&Wo(r,i,i.next,a)&&Xo(r,a)&&Xo(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),Jo(i),Jo(i.next),i=t=a),i=i.next}while(i!==t);return Ao(i)}function Oo(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&$o(o,s)){var u=Yo(o,s);return o=Ao(o,o.next),u=Ao(u,u.next),Lo(o,e,n,i,r,a),void Lo(u,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function Fo(t,e){return t.x-e.x}function No(t,e){if(e=function(t,e){var n,i=e,r=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n;var u,l=n,c=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&Uo(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(r-i.x),Xo(i,t)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&Bo(n,i)))&&(n=i,p=u)),i=i.next}while(i!==l);return n}(t,e)){var n=Yo(e,t);Ao(e,e.next),Ao(n,n.next)}}function Bo(t,e){return Ho(t.prev,t,e.prev)<0&&Ho(e.next,t,t.next)<0}function jo(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Vo(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Uo(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function $o(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wo(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Xo(t,e)&&Xo(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Ho(t.prev,t,e.prev)||Ho(t,e.prev,e))||qo(t,e)&&Ho(t.prev,t,t.next)>0&&Ho(e.prev,e,e.next)>0)}function Ho(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function qo(t,e){return t.x===e.x&&t.y===e.y}function Wo(t,e,n,i){var r=Zo(Ho(t,e,n)),a=Zo(Ho(t,e,i)),o=Zo(Ho(n,i,t)),s=Zo(Ho(n,i,e));return r!==a&&o!==s||!(0!==r||!Go(t,n,e))||!(0!==a||!Go(t,i,e))||!(0!==o||!Go(n,t,i))||!(0!==s||!Go(n,e,i))}function Go(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zo(t){return t>0?1:t<0?-1:0}function Xo(t,e){return Ho(t.prev,t,t.next)<0?Ho(t,e,t.next)>=0&&Ho(t,t.prev,e)>=0:Ho(t,e,t.prev)<0||Ho(t,t.next,e)<0}function Yo(t,e){var n=new Qo(t.i,t.x,t.y),i=new Qo(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Ko(t,e,n,i){var r=new Qo(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Jo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qo(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ts(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}function es(t,e,n,i,r){!function t(e,n,i,r,a){for(;r>i;){if(r-i>600){var o=r-i+1,s=n-i+1,u=Math.log(o),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(o-l)/o)*(s-o/2<0?-1:1);t(e,n,Math.max(i,Math.floor(n-s*l/o+c)),Math.min(r,Math.floor(n+(o-s)*l/o+c)),a)}var h=e[n],p=i,f=r;for(ns(e,i,n),a(e[r],h)>0&&ns(e,i,r);p<f;){for(ns(e,p,f),p++,f--;a(e[p],h)<0;)p++;for(;a(e[f],h)>0;)f--}0===a(e[i],h)?ns(e,i,f):ns(e,++f,r),f<=n&&(i=f+1),n<=f&&(r=f-1)}}(t,e,n||0,i||t.length-1,r||is)}function ns(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function is(t,e){return t<e?-1:t>e?1:0}function rs(t,e){var n=t.length;if(n<=1)return[t];for(var i,r,a=[],o=0;o<n;o++){var s=M(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(i&&a.push(i),i=[t[o]]):i.push(t[o]))}if(i&&a.push(i),e>1)for(var u=0;u<a.length;u++)a[u].length<=e||(es(a[u],e,1,a[u].length-1,as),a[u]=a[u].slice(0,e));return a}function as(t,e){return e.area-t.area}function os(t,e,n){for(var i=n.patternDependencies,r=!1,a=0,o=e;a<o.length;a+=1){var s=o[a].paint.get(t+"-pattern");s.isConstant()||(r=!0);var u=s.constantOr(null);u&&(r=!0,i[u.to]=!0,i[u.from]=!0)}return r}function ss(t,e,n,i,r){for(var a=r.patternDependencies,o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:i-1},n,{},r.availableImages),h=l.evaluate({zoom:i},n,{},r.availableImages),p=l.evaluate({zoom:i+1},n,{},r.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,a[c=c&&c.name?c.name:c]=!0,a[h]=!0,a[p]=!0,n.patterns[u.id]={min:c,mid:h,max:p}}}return n}Io.deviation=function(t,e,n,i){var r=e&&e.length,a=Math.abs(ts(t,0,r?e[0]*n:t.length,n));if(r)for(var o=0,s=e.length;o<s;o++)a-=Math.abs(ts(t,e[o]*n,o<s-1?e[o+1]*n:t.length,n));var u=0;for(o=0;o<i.length;o+=3){var l=i[o]*n,c=i[o+1]*n,h=i[o+2]*n;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},Io.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)n.vertices.push(t[r][a][o]);r>0&&n.holes.push(i+=t[r-1].length)}return n},Eo.default=Co;var us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ir,this.indexArray=new Ur,this.indexArray2=new Zr,this.programConfigurations=new za(t.layers,t.zoom),this.segments=new ua,this.segments2=new ua,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};us.prototype.populate=function(t,e,n){this.hasPattern=os("fill",this.layers,e);for(var i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=u.feature,c=u.id,h=u.index,p=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Va(l,f);if(this.layers[0]._featureFilter.filter(new ur(this.zoom),d,n)){var v=r?i.evaluate(d,{},n,e.availableImages):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:p,index:h,geometry:f?d.geometry:ja(l),patterns:{},sortKey:v};a.push(m)}}r&&a.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=a;g<y.length;g+=1){var _=y[g],b=_.geometry,x=_.index,w=_.sourceLayerIndex;if(this.hasPattern){var S=ss("fill",this.layers,_,this.zoom,e);this.patternFeatures.push(S)}else this.addFeature(_,b,x,n,{});e.featureIndex.insert(t[x].feature,b,x,w,this.index)}},us.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},us.prototype.addFeatures=function(t,e,n){for(var i=0,r=this.patternFeatures;i<r.length;i+=1){var a=r[i];this.addFeature(a,a.geometry,a.index,e,n)}},us.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,To),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},us.prototype.addFeature=function(t,e,n,i,r){for(var a=0,o=rs(e,500);a<o.length;a+=1){for(var s=o[a],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),p=h.vertexLength,f=[],d=[],v=0,m=s;v<m.length;v+=1){var g=m[v];if(0!==g.length){g!==s[0]&&d.push(f.length/2);var y=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),_=y.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(_+g.length-1,_),f.push(g[0].x),f.push(g[0].y);for(var b=1;b<g.length;b++)this.layoutVertexArray.emplaceBack(g[b].x,g[b].y),this.indexArray2.emplaceBack(_+b-1,_+b),f.push(g[b].x),f.push(g[b].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var x=Eo(f,d),w=0;w<x.length;w+=3)this.indexArray.emplaceBack(p+x[w],p+x[w+1],p+x[w+2]);h.vertexLength+=u,h.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)},Bi("FillBucket",us,{omit:["layers","patternFeatures"]});var ls=new wr({"fill-sort-key":new yr(Pt.layout_fill["fill-sort-key"])}),cs={paint:new wr({"fill-antialias":new gr(Pt.paint_fill["fill-antialias"]),"fill-opacity":new yr(Pt.paint_fill["fill-opacity"]),"fill-color":new yr(Pt.paint_fill["fill-color"]),"fill-outline-color":new yr(Pt.paint_fill["fill-outline-color"]),"fill-translate":new gr(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new gr(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _r(Pt.paint_fill["fill-pattern"])}),layout:ls},hs=function(t){function e(e){t.call(this,e,cs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new us(t)},e.prototype.queryRadius=function(){return no(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,r,a,o){return Wa(io(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),i)},e.prototype.isTileClipped=function(){return!0},e}(Sr),ps=Er([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,fs=ds;function ds(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(vs,this,e)}function vs(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function ms(t){for(var e,n,i=0,r=0,a=t.length,o=a-1;r<a;o=r++)i+=((n=t[o]).x-(e=t[r]).x)*(e.y+n.y);return i}ds.types=["Unknown","Point","LineString","Polygon"],ds.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,a=0,o=0,s=0,u=[];t.pos<n;){if(a<=0){var l=t.readVarint();i=7&l,a=l>>3}if(a--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},ds.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(i<=0){var c=t.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=t.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,u,s,l]},ds.prototype.toGeoJSON=function(t,e,n){var i,r,a=this.extent*Math.pow(2,n),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=ds.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<u.length;i++)h[i]=u[i][0];c(u=h);break;case 2:for(i=0;i<u.length;i++)c(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],a=0;a<e;a++){var o=ms(t[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[t[a]]):n.push(t[a]))}return n&&r.push(n),r}(u),i=0;i<u.length;i++)for(r=0;r<u[i].length;r++)c(u[i][r])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var gs=ys;function ys(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(_s,this,e),this.length=this._features.length}function _s(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}function bs(t,e,n){if(3===t){var i=new gs(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}ys.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new fs(this._pbf,e,this.extent,this._keys,this._values)};var xs={VectorTile:function(t,e){this.layers=t.readFields(bs,{},e)},VectorTileFeature:fs,VectorTileLayer:gs},ws=xs.VectorTileFeature.types,Ss=Math.pow(2,13);function ks(t,e,n,i,r,a,o,s){t.emplaceBack(e,n,2*Math.floor(i*Ss)+o,r*Ss*2,a*Ss*2,Math.round(s))}var Ms=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ar,this.indexArray=new Ur,this.programConfigurations=new za(t.layers,t.zoom),this.segments=new ua,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Ms.prototype.populate=function(t,e,n){this.features=[],this.hasPattern=os("fill-extrusion",this.layers,e);for(var i=0,r=t;i<r.length;i+=1){var a=r[i],o=a.feature,s=a.id,u=a.index,l=a.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=Va(o,c);if(this.layers[0]._featureFilter.filter(new ur(this.zoom),h,n)){var p={id:s,sourceLayerIndex:l,index:u,geometry:c?h.geometry:ja(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(ss("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,u,n,{}),e.featureIndex.insert(o,p.geometry,u,l,this.index,!0)}}},Ms.prototype.addFeatures=function(t,e,n){for(var i=0,r=this.features;i<r.length;i+=1){var a=r[i];this.addFeature(a,a.geometry,a.index,e,n)}},Ms.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ms.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ps),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ms.prototype.addFeature=function(t,e,n,i,r){for(var a=0,o=rs(e,500);a<o.length;a+=1){for(var s=o[a],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,f=s;p<f.length;p+=1){var d=f[p];if(0!==d.length&&!((L=d).every((function(t){return t.x<0}))||L.every((function(t){return t.x>8192}))||L.every((function(t){return t.y<0}))||L.every((function(t){return t.y>8192}))))for(var v=0,m=0;m<d.length;m++){var g=d[m];if(m>=1){var y=d[m-1];if(!Ts(g,y)){h.vertexLength+4>ua.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=g.sub(y)._perp()._unit(),b=y.dist(g);v+b>32768&&(v=0),ks(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,v),ks(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,v),ks(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,v+=b),ks(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,v);var x=h.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>ua.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===ws[t.type]){for(var w=[],S=[],k=h.vertexLength,M=0,T=s;M<T.length;M+=1){var E=T[M];if(0!==E.length){E!==s[0]&&S.push(w.length/2);for(var C=0;C<E.length;C++){var I=E[C];ks(this.layoutVertexArray,I.x,I.y,0,0,1,1,0),w.push(I.x),w.push(I.y)}}}for(var P=Eo(w,S),A=0;A<P.length;A+=3)this.indexArray.emplaceBack(k+P[A],k+P[A+2],k+P[A+1]);h.primitiveLength+=P.length/3,h.vertexLength+=u}}var L;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)},Bi("FillExtrusionBucket",Ms,{omit:["layers","features"]});var Es={paint:new wr({"fill-extrusion-opacity":new gr(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yr(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gr(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gr(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _r(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yr(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yr(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gr(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Cs=function(t){function e(e){t.call(this,e,Es)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Ms(t)},e.prototype.queryRadius=function(){return no(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,i,a,o,s,u){var l=io(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),p=function(t,e,n,i){for(var a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=[u.x,u.y,0,1];ho(l,l,e),a.push(new r(l[0]/l[3],l[1]/l[3]))}return a}(l,u),f=function(t,e,n,i){for(var a=[],o=[],s=i[8]*e,u=i[9]*e,l=i[10]*e,c=i[11]*e,h=i[8]*n,p=i[9]*n,f=i[10]*n,d=i[11]*n,v=0,m=t;v<m.length;v+=1){for(var g=[],y=[],_=0,b=m[v];_<b.length;_+=1){var x=b[_],w=x.x,S=x.y,k=i[0]*w+i[4]*S+i[12],M=i[1]*w+i[5]*S+i[13],T=i[2]*w+i[6]*S+i[14],E=i[3]*w+i[7]*S+i[15],C=T+l,I=E+c,P=k+h,A=M+p,L=T+f,R=E+d,D=new r((k+s)/I,(M+u)/I);D.z=C/I,g.push(D);var z=new r(P/R,A/R);z.z=L/R,y.push(z)}a.push(g),o.push(y)}return[a,o]}(i,h,c,u);return function(t,e,n){var i=1/0;Wa(n,e)&&(i=Ps(n,e[0]));for(var r=0;r<e.length;r++)for(var a=e[r],o=t[r],s=0;s<a.length-1;s++){var u=a[s],l=[u,a[s+1],o[s+1],o[s],u];Ha(n,l)&&(i=Math.min(i,Ps(n,l)))}return i!==1/0&&i}(f[0],f[1],p)},e}(Sr);function Is(t,e){return t.x*e.x+t.y*e.y}function Ps(t,e){if(1===t.length){for(var n,i=0,r=e[i++];!n||r.equals(n);)if(!(n=e[i++]))return 1/0;for(;i<e.length;i++){var a=e[i],o=t[0],s=n.sub(r),u=a.sub(r),l=o.sub(r),c=Is(s,s),h=Is(s,u),p=Is(u,u),f=Is(l,s),d=Is(l,u),v=c*p-h*h,m=(p*f-h*d)/v,g=(c*d-h*f)/v,y=r.z*(1-m-g)+n.z*m+a.z*g;if(isFinite(y))return y}return 1/0}for(var _=1/0,b=0,x=e;b<x.length;b+=1)_=Math.min(_,x[b].z);return _}var As=Er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ls=Er([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Rs=xs.VectorTileFeature.types,Ds=Math.cos(Math.PI/180*37.5),zs=Math.pow(2,14)/.5,Os=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Lr,this.layoutVertexArray2=new Rr,this.indexArray=new Ur,this.programConfigurations=new za(t.layers,t.zoom),this.segments=new ua,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Os.prototype.populate=function(t,e,n){this.hasPattern=os("line",this.layers,e);for(var i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=u.feature,c=u.id,h=u.index,p=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Va(l,f);if(this.layers[0]._featureFilter.filter(new ur(this.zoom),d,n)){var v=r?i.evaluate(d,{},n):void 0,m={id:c,properties:l.properties,type:l.type,sourceLayerIndex:p,index:h,geometry:f?d.geometry:ja(l),patterns:{},sortKey:v};a.push(m)}}r&&a.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=a;g<y.length;g+=1){var _=y[g],b=_.geometry,x=_.index,w=_.sourceLayerIndex;if(this.hasPattern){var S=ss("line",this.layers,_,this.zoom,e);this.patternFeatures.push(S)}else this.addFeature(_,b,x,n,{});e.featureIndex.insert(t[x].feature,b,x,w,this.index)}},Os.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Os.prototype.addFeatures=function(t,e,n){for(var i=0,r=this.patternFeatures;i<r.length;i+=1){var a=r[i];this.addFeature(a,a.geometry,a.index,e,n)}},Os.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Os.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Os.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ls)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,As),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Os.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Os.prototype.addFeature=function(t,e,n,i,r){var a=this.layers[0].layout,o=a.get("line-join").evaluate(t,{}),s=a.get("line-cap"),u=a.get("line-miter-limit"),l=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,o,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)},Os.prototype.addLine=function(t,e,n,i,r,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<t.length-1;o++)this.totalDistance+=t[o].dist(t[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Rs[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===n&&(r=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),f=void 0,d=void 0,v=void 0,m=void 0;this.e1=this.e2=-1,s&&(m=t[l].sub(c=t[u-2])._unit()._perp());for(var g=l;g<u;g++)if(!(d=g===u-1?s?t[l+1]:void 0:t[g+1])||!t[g].equals(d)){m&&(v=m),c&&(f=c),c=t[g],m=d?d.sub(c)._unit()._perp():v;var y=(v=v||m).add(m);0===y.x&&0===y.y||y._unit();var _=v.x*m.x+v.y*m.y,b=y.x*m.x+y.y*m.y,x=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),S=b<Ds&&f&&d,k=v.x*m.y-v.y*m.x>0;if(S&&g>l){var M=c.dist(f);if(M>2*h){var T=c.sub(c.sub(f)._mult(h/M)._round());this.updateDistance(f,T),this.addCurrentVertex(T,v,0,0,p),f=T}}var E=f&&d,C=E?n:s?"butt":i;if(E&&"round"===C&&(x<a?C="miter":x<=2&&(C="fakeround")),"miter"===C&&x>r&&(C="bevel"),"bevel"===C&&(x>2&&(C="flipbevel"),x<r&&(C="miter")),f&&this.updateDistance(f,c),"miter"===C)y._mult(x),this.addCurrentVertex(c,y,0,0,p);else if("flipbevel"===C){if(x>100)y=m.mult(-1);else{var I=x*v.add(m).mag()/v.sub(m).mag();y._perp()._mult(I*(k?-1:1))}this.addCurrentVertex(c,y,0,0,p),this.addCurrentVertex(c,y.mult(-1),0,0,p)}else if("bevel"===C||"fakeround"===C){var P=-Math.sqrt(x*x-1),A=k?P:0,L=k?0:P;if(f&&this.addCurrentVertex(c,v,A,L,p),"fakeround"===C)for(var R=Math.round(180*w/Math.PI/20),D=1;D<R;D++){var z=D/R;if(.5!==z){var O=z-.5;z+=z*O*(z-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*O*O+(.848013+_*(.215638*_-1.06021)))}var F=m.sub(v)._mult(z)._add(v)._unit()._mult(k?-1:1);this.addHalfVertex(c,F.x,F.y,!1,k,0,p)}d&&this.addCurrentVertex(c,m,-A,-L,p)}else if("butt"===C)this.addCurrentVertex(c,y,0,0,p);else if("square"===C){var N=f?1:-1;this.addCurrentVertex(c,y,N,N,p)}else"round"===C&&(f&&(this.addCurrentVertex(c,v,0,0,p),this.addCurrentVertex(c,v,1,1,p,!0)),d&&(this.addCurrentVertex(c,m,-1,-1,p,!0),this.addCurrentVertex(c,m,0,0,p)));if(S&&g<u-1){var B=c.dist(d);if(B>2*h){var j=c.add(d.sub(c)._mult(h/B)._round());this.updateDistance(c,j),this.addCurrentVertex(j,m,0,0,p),c=j}}}}},Os.prototype.addCurrentVertex=function(t,e,n,i,r,a){void 0===a&&(a=!1);var o=e.y*i-e.x,s=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,a,!1,n,r),this.addHalfVertex(t,o,s,a,!0,-i,r),this.distance>zs/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,i,r,a))},Os.prototype.addHalfVertex=function(t,e,n,i,r,a,o){var s=.5*(this.lineClips?this.scaledDistance*(zs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(i?1:0),(t.y<<1)+(r?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),r?this.e2=u:this.e1=u},Os.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Os.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Bi("LineBucket",Os,{omit:["layers","patternFeatures"]});var Fs=new wr({"line-cap":new gr(Pt.layout_line["line-cap"]),"line-join":new yr(Pt.layout_line["line-join"]),"line-miter-limit":new gr(Pt.layout_line["line-miter-limit"]),"line-round-limit":new gr(Pt.layout_line["line-round-limit"]),"line-sort-key":new yr(Pt.layout_line["line-sort-key"])}),Ns={paint:new wr({"line-opacity":new yr(Pt.paint_line["line-opacity"]),"line-color":new yr(Pt.paint_line["line-color"]),"line-translate":new gr(Pt.paint_line["line-translate"]),"line-translate-anchor":new gr(Pt.paint_line["line-translate-anchor"]),"line-width":new yr(Pt.paint_line["line-width"]),"line-gap-width":new yr(Pt.paint_line["line-gap-width"]),"line-offset":new yr(Pt.paint_line["line-offset"]),"line-blur":new yr(Pt.paint_line["line-blur"]),"line-dasharray":new br(Pt.paint_line["line-dasharray"]),"line-pattern":new _r(Pt.paint_line["line-pattern"]),"line-gradient":new xr(Pt.paint_line["line-gradient"])}),layout:Fs},Bs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new ur(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,i,r){return n=p({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,i,r)},e}(yr))(Ns.paint.properties["line-width"].specification);Bs.useIntegerZoom=!0;var js=function(t){function e(e){t.call(this,e,Ns),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof He,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=Bs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Os(t)},e.prototype.queryRadius=function(t){var e=t,n=Vs(eo("line-width",this,e),eo("line-gap-width",this,e)),i=eo("line-offset",this,e);return n/2+Math.abs(i)+no(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,a,o,s){var u=io(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),l=s/2*Vs(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(i=function(t,e){for(var n=[],i=new r(0,0),a=0;a<t.length;a++){for(var o=t[a],s=[],u=0;u<o.length;u++){var l=o[u],c=o[u+1],h=0===u?i:l.sub(o[u-1])._unit()._perp(),p=u===o.length-1?i:c.sub(l)._unit()._perp(),f=h._add(p)._unit();f._mult(1/(f.x*p.x+f.y*p.y)),s.push(f._mult(e)._add(l))}n.push(s)}return n}(i,c*s)),function(t,e,n){for(var i=0;i<e.length;i++){var r=e[i];if(t.length>=3)for(var a=0;a<r.length;a++)if(Qa(t,r[a]))return!0;if(Ga(t,r,n))return!0}return!1}(u,i,l)},e.prototype.isTileClipped=function(){return!0},e}(Sr);function Vs(t,e){return e>0?e+2*t:t}var Us=Er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$s=Er([{name:"a_projected_pos",components:3,type:"Float32"}],4),Hs=(Er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),qs=(Er([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Er([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ws=Er([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gs(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),sr.applyArabicShaping&&(t=sr.applyArabicShaping(t)),t}(t.text,e,n)})),t}Er([{name:"triangle",components:3,type:"Uint16"}]),Er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Er([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Er([{type:"Float32",name:"offsetX"}]),Er([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Zs={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},Xs=function(t,e,n,i,r){var a,o,s=8*r-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?r-1:0,p=n?-1:1,f=t[e+h];for(h+=p,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=p,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=l}return(f?-1:1)*o*Math.pow(2,a-i)},Ys=function(t,e,n,i,r,a){var o,s,u,l=8*a-r-1,c=(1<<l)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,d=i?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+f]=255&s,f+=d,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;t[n+f]=255&o,f+=d,o/=256,l-=8);t[n+f-d]|=128*v},Ks=Js;function Js(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Js.Varint=0,Js.Fixed64=1,Js.Bytes=2,Js.Fixed32=5;var Qs="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function tu(t){return t.type===Js.Bytes?t.readVarint()+t.pos:t.pos+1}function eu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function nu(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function iu(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function ru(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function cu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function hu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function pu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function fu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function du(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function vu(t,e,n){1===t&&n.readMessage(mu,e)}function mu(t,e,n){if(3===t){var i=n.readMessage(gu,{}),r=i.width,a=i.height,o=i.left,s=i.top,u=i.advance;e.push({id:i.id,bitmap:new _o({width:r+6,height:a+6},i.bitmap),metrics:{width:r,height:a,left:o,top:s,advance:u}})}}function gu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function yu(t){for(var e=0,n=0,i=0,r=t;i<r.length;i+=1){var a=r[i];e+=a.w*a.h,n=Math.max(n,a.w)}t.sort((function(t,e){return e.h-t.h}));for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],p=o.length-1;p>=0;p--){var f=o[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=o.pop();p<o.length&&(o[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(o.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Js.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,t(r,e,this),this.pos===a&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=pu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=du(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=pu(this.buf,this.pos)+4294967296*pu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=pu(this.buf,this.pos)+4294967296*du(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Xs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,a=n.buf;if(i=(112&(r=a[n.pos++]))>>4,r<128)return eu(t,i,e);if(i|=(127&(r=a[n.pos++]))<<3,r<128)return eu(t,i,e);if(i|=(127&(r=a[n.pos++]))<<10,r<128)return eu(t,i,e);if(i|=(127&(r=a[n.pos++]))<<17,r<128)return eu(t,i,e);if(i|=(127&(r=a[n.pos++]))<<24,r<128)return eu(t,i,e);if(i|=(1&(r=a[n.pos++]))<<31,r<128)return eu(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Qs?function(t,e,n){return Qs.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var i="",r=e;r<n;){var a,o,s,u=t[r],l=null,c=u>239?4:u>223?3:u>191?2:1;if(r+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(a=t[r+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(o=t[r+2],128==(192&(a=t[r+1]))&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[r+2],s=t[r+3],128==(192&(a=t[r+1]))&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Js.Bytes)return t.push(this.readVarint(e));var n=tu(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Js.Bytes)return t.push(this.readSVarint());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Js.Bytes)return t.push(this.readBoolean());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Js.Bytes)return t.push(this.readFloat());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Js.Bytes)return t.push(this.readDouble());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed32());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed32());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed64());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed64());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Js.Varint)for(;this.buf[this.pos++]>127;);else if(e===Js.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Js.Fixed32)this.pos+=4;else{if(e!==Js.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),fu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),fu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),fu(this.buf,-1&t,this.pos),fu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),fu(this.buf,-1&t,this.pos),fu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,a=0;a<e.length;a++){if((i=e.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&nu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Ys(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ys(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&nu(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,Js.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,cu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,hu,e)},writeBytesField:function(t,e){this.writeTag(t,Js.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Js.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Js.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var _u=function(t,e){var n=e.pixelRatio,i=e.version,r=e.stretchX,a=e.stretchY,o=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=r,this.stretchY=a,this.content=o,this.version=i},bu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};bu.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},bu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},bu.tlbr.get=function(){return this.tl.concat(this.br)},bu.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(_u.prototype,bu);var xu=function(t,e){var n={},i={};this.haveRenderCallbacks=[];var r=[];this.addImages(t,n,r),this.addImages(e,i,r);var a=yu(r),o=new bo({width:a.w||1,height:a.h||1});for(var s in t){var u=t[s],l=n[s].paddedRect;bo.copy(u.data,o,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var h=e[c],p=i[c].paddedRect,f=p.x+1,d=p.y+1,v=h.data.width,m=h.data.height;bo.copy(h.data,o,{x:0,y:0},{x:f,y:d},h.data),bo.copy(h.data,o,{x:0,y:m-1},{x:f,y:d-1},{width:v,height:1}),bo.copy(h.data,o,{x:0,y:0},{x:f,y:d+m},{width:v,height:1}),bo.copy(h.data,o,{x:v-1,y:0},{x:f-1,y:d},{width:1,height:m}),bo.copy(h.data,o,{x:0,y:0},{x:f+v,y:d},{width:1,height:m})}this.image=o,this.iconPositions=n,this.patternPositions=i};xu.prototype.addImages=function(t,e,n){for(var i in t){var r=t[i],a={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(a),e[i]=new _u(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}},xu.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},xu.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var i=t.tl;n.update(e.data,void 0,{x:i[0],y:i[1]})}},Bi("ImagePosition",_u),Bi("ImageAtlas",xu);var wu={horizontal:1,vertical:2,horizontalOnly:3},Su=function(){this.scale=1,this.fontStack="",this.imageName=null};Su.forText=function(t,e){var n=new Su;return n.scale=t||1,n.fontStack=e,n},Su.forImage=function(t){var e=new Su;return e.imageName=t,e};var ku=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Mu(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v){var m,g=ku.fromFeature(t,r);h===wu.vertical&&g.verticalizePunctuation();var y=sr.processBidirectionalText,_=sr.processStyledBidirectionalText;if(y&&1===g.sections.length){m=[];for(var b=0,x=y(g.toString(),Lu(g,l,a,e,i,f,d));b<x.length;b+=1){var w=x[b],S=new ku;S.text=w,S.sections=g.sections;for(var k=0;k<w.length;k++)S.sectionIndex.push(0);m.push(S)}}else if(_){m=[];for(var M=0,T=_(g.text,g.sectionIndex,Lu(g,l,a,e,i,f,d));M<T.length;M+=1){var E=T[M],C=new ku;C.text=E[0],C.sectionIndex=E[1],C.sections=g.sections,m.push(C)}}else m=function(t,e){for(var n=[],i=t.text,r=0,a=0,o=e;a<o.length;a+=1){var s=o[a];n.push(t.substring(r,s)),r=s}return r<i.length&&n.push(t.substring(r,i.length)),n}(g,Lu(g,l,a,e,i,f,d));var I=[],P={positionedLines:I,text:g.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,i,r,a,o,s,u,l,c,h){for(var p=0,f=-17,d=0,v=0,m="right"===s?1:"left"===s?0:.5,g=0,y=0,_=r;y<_.length;y+=1){var b=_[y];b.trim();var x=b.getMaxScale(),w=24*(x-1),S={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=S;var k=S.positionedGlyphs,M=0;if(b.length()){for(var T=0;T<b.length();T++){var E=b.getSection(T),C=b.getSectionIndex(T),I=b.getCharCode(T),P=0,A=null,L=null,R=null,D=24,z=!(u===wu.horizontal||!c&&!Zi(I)||c&&(Tu[I]||(H=I,Wi.Arabic(H)||Wi["Arabic Supplement"](H)||Wi["Arabic Extended-A"](H)||Wi["Arabic Presentation Forms-A"](H)||Wi["Arabic Presentation Forms-B"](H))));if(E.imageName){var O=i[E.imageName];if(!O)continue;R=E.imageName,t.iconsInText=t.iconsInText||!0,L=O.paddedRect;var F=O.displaySize;E.scale=24*E.scale/h,P=w+(24-F[1]*E.scale),D=(A={width:F[0],height:F[1],left:1,top:-3,advance:z?F[1]:F[0]}).advance;var N=z?F[0]*E.scale-24*x:F[1]*E.scale-24*x;N>0&&N>M&&(M=N)}else{var B=n[E.fontStack],j=B&&B[I];if(j&&j.rect)L=j.rect,A=j.metrics;else{var V=e[E.fontStack],U=V&&V[I];if(!U)continue;A=U.metrics}P=24*(x-E.scale)}z?(t.verticalizable=!0,k.push({glyph:I,imageName:R,x:p,y:f+P,vertical:z,scale:E.scale,fontStack:E.fontStack,sectionIndex:C,metrics:A,rect:L}),p+=D*E.scale+l):(k.push({glyph:I,imageName:R,x:p,y:f+P,vertical:z,scale:E.scale,fontStack:E.fontStack,sectionIndex:C,metrics:A,rect:L}),p+=A.advance*E.scale+l)}0!==k.length&&(d=Math.max(p-l,d),Du(k,0,k.length-1,m,M)),p=0;var $=a*x+M;S.lineOffset=Math.max(M,w),f+=$,v=Math.max($,v),++g}else f+=a,++g}var H,q=f- -17,W=Ru(o),G=W.horizontalAlign,Z=W.verticalAlign;(function(t,e,n,i,r,a,o,s,u){var l,c=(e-n)*r;l=a!==o?-s*i- -17:(-i*u+.5)*o;for(var h=0,p=t;h<p.length;h+=1)for(var f=0,d=p[h].positionedGlyphs;f<d.length;f+=1){var v=d[f];v.x+=c,v.y+=l}})(t.positionedLines,m,G,Z,d,v,a,q,r.length),t.top+=-Z*q,t.bottom=t.top+q,t.left+=-G*d,t.right=t.left+d}(P,e,n,i,m,o,s,u,h,l,p,v),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(I)&&P}ku.fromFeature=function(t,e){for(var n=new ku,i=0;i<t.sections.length;i++){var r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n},ku.prototype.length=function(){return this.text.length},ku.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},ku.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},ku.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},ku.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;e+=i&&Xi(i)&&!Zs[t[n+1]]||r&&Xi(r)&&!Zs[t[n-1]]||!Zs[t[n]]?t[n]:Zs[t[n]]}return e}(this.text)},ku.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Tu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,i=this.text.length-1;i>=0&&i>=t&&Tu[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},ku.prototype.substring=function(t,e){var n=new ku;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},ku.prototype.toString=function(){return this.text},ku.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},ku.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(Su.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,i=0;i<t.text.length;++i)this.sectionIndex.push(n)},ku.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Su.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},ku.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Eu={};function Cu(t,e,n,i,r,a){if(e.imageName){var o=i[e.imageName];return o?o.displaySize[0]*e.scale*24/a+r:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+r:0}function Iu(t,e,n,i){var r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function Pu(t,e,n){var i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Au(t,e,n,i,r,a){for(var o=null,s=Iu(e,n,r,a),u=0,l=i;u<l.length;u+=1){var c=l[u],h=Iu(e-c.x,n,r,a)+c.badness;h<=s&&(o=c,s=h)}return{index:t,x:e,priorBreak:o,badness:s}}function Lu(t,e,n,i,r,a,o){if("point"!==a)return[];if(!t)return[];for(var s,u=[],l=function(t,e,n,i,r,a){for(var o=0,s=0;s<t.length();s++){var u=t.getSection(s);o+=Cu(t.getCharCode(s),u,i,r,e,a)}return o/Math.max(1,Math.ceil(o/n))}(t,e,n,i,r,o),c=t.text.indexOf("\u200b")>=0,h=0,p=0;p<t.length();p++){var f=t.getSection(p),d=t.getCharCode(p);if(Tu[d]||(h+=Cu(d,f,i,r,e,o)),p<t.length()-1){var v=!((s=d)<11904||!(Wi["Bopomofo Extended"](s)||Wi.Bopomofo(s)||Wi["CJK Compatibility Forms"](s)||Wi["CJK Compatibility Ideographs"](s)||Wi["CJK Compatibility"](s)||Wi["CJK Radicals Supplement"](s)||Wi["CJK Strokes"](s)||Wi["CJK Symbols and Punctuation"](s)||Wi["CJK Unified Ideographs Extension A"](s)||Wi["CJK Unified Ideographs"](s)||Wi["Enclosed CJK Letters and Months"](s)||Wi["Halfwidth and Fullwidth Forms"](s)||Wi.Hiragana(s)||Wi["Ideographic Description Characters"](s)||Wi["Kangxi Radicals"](s)||Wi["Katakana Phonetic Extensions"](s)||Wi.Katakana(s)||Wi["Vertical Forms"](s)||Wi["Yi Radicals"](s)||Wi["Yi Syllables"](s)));(Eu[d]||v||f.imageName)&&u.push(Au(p+1,h,l,u,Pu(d,t.getCharCode(p+1),v&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Au(t.length(),h,l,u,0,!0))}function Ru(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Du(t,e,n,i,r){if(i||r)for(var a=t[n],o=(t[n].x+a.metrics.advance*a.scale)*i,s=e;s<=n;s++)t[s].x-=o,t[s].y+=r}function zu(t,e,n,i,r,a){var o,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;o=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,p,f,d=e.left*a,v=e.right*a;"width"===n||"both"===n?(f=r[0]+d-i[3],h=r[0]+v+i[1]):h=(f=r[0]+(d+v-s.displaySize[0])/2)+s.displaySize[0];var m=e.top*a,g=e.bottom*a;return"height"===n||"both"===n?(c=r[1]+m-i[0],p=r[1]+g+i[2]):p=(c=r[1]+(m+g-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:p,left:f,collisionPadding:o}}Eu[10]=!0,Eu[32]=!0,Eu[38]=!0,Eu[40]=!0,Eu[41]=!0,Eu[43]=!0,Eu[45]=!0,Eu[47]=!0,Eu[173]=!0,Eu[183]=!0,Eu[8203]=!0,Eu[8208]=!0,Eu[8211]=!0,Eu[8231]=!0;var Ou=function(t){function e(e,n,i,r){t.call(this,e,n),this.angle=i,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(r);function Fu(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ur(t+1))};if("source"===n.kind)return{kind:"source"};for(var i=n.zoomStops,r=n.interpolationType,a=0;a<i.length&&i[a]<=t;)a++;for(var o=a=Math.max(0,a-1);o<i.length&&i[o]<t+1;)o++;o=Math.min(i.length-1,o);var s=i[a],u=i[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new ur(s)),maxSize:n.evaluate(new ur(u)),interpolationType:r}}function Nu(t,e,n){var i=e.uSize,r=n.lowerSize;return"source"===t.kind?r/128:"composite"===t.kind?qe(r/128,n.upperSize/128,e.uSizeT):i}function Bu(t,e){var n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){var r=t.interpolationType,a=r?c(sn.interpolationFactor(r,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?i=qe(t.minSize,t.maxSize,a):n=a}return{uSizeT:n,uSize:i}}Bi("Anchor",Ou);var ju=Object.freeze({__proto__:null,getSizeData:Fu,evaluateSizeForFeature:Nu,evaluateSizeForZoom:Bu,SIZE_PACK_FACTOR:128});function Vu(t,e,n,i,r){if(void 0===e.segment)return!0;for(var a=e,o=e.segment+1,s=0;s>-n/2;){if(--o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;for(var u=[],l=0;s<n/2;){var c=t[o],h=t[o+1];if(!h)return!1;var p=t[o-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),l+=p;s-u[0].distance>i;)l-=u.shift().angleDelta;if(l>r)return!1;o++,s+=c.dist(h)}return!0}function Uu(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function $u(t,e,n){return t?.6*e*n:0}function Hu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function qu(t,e,n,i,r,a){for(var o=$u(n,r,a),s=Hu(n,i)*a,u=0,l=Uu(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,v=qe(h.x,p.x,d),m=qe(h.y,p.y,d),g=new Ou(v,m,p.angleTo(h),c);return g._round(),!o||Vu(t,g,s,o,e)?g:void 0}u+=f}}function Wu(t,e,n,i,r,a,o,s,u){var l=$u(i,a,o),c=Hu(i,r),h=c*o,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,i,r,a,o,s,u,l){for(var c=o/2,h=Uu(e),p=0,f=n-i,d=[],v=0;v<e.length-1;v++){for(var m=e[v],g=e[v+1],y=m.dist(g),_=g.angleTo(m);f+i<p+y;){var b=((f+=i)-p)/y,x=qe(m.x,g.x,b),w=qe(m.y,g.y,b);if(x>=0&&x<l&&w>=0&&w<l&&f-c>=0&&f+c<=h){var S=new Ou(x,w,_,v);S._round(),r&&!Vu(e,S,o,r,a)||d.push(S)}}p+=y}return u||d.length||s||(d=t(e,p/2,i,r,a,o,s,!0,l)),d}(t,p?e/2*s%e:(c/2+2*a)*o*s%e,e,l,n,h,p,!1,u)}function Gu(t,e,n,i,a){for(var o=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<e&&p.x<e||(h.x<e?h=new r(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<e&&(p=new r(e,h.y+(e-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<n&&p.y<n||(h.y<n?h=new r(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round():p.y<n&&(p=new r(h.x+(n-h.y)/(p.y-h.y)*(p.x-h.x),n)._round()),h.x>=i&&p.x>=i||(h.x>=i?h=new r(i,h.y+(i-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=i&&(p=new r(i,h.y+(i-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=a&&p.y>=a||(h.y>=a?h=new r(h.x+(a-h.y)/(p.y-h.y)*(p.x-h.x),a)._round():p.y>=a&&(p=new r(h.x+(a-h.y)/(p.y-h.y)*(p.x-h.x),a)._round()),l&&h.equals(l[l.length-1])||o.push(l=[h]),l.push(p)))))}return o}function Zu(t,e,n,i){var a=[],o=t.image,s=o.pixelRatio,u=o.paddedRect.w-2,l=o.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,p=o.stretchX||[[0,u]],f=o.stretchY||[[0,l]],d=function(t,e){return t+e[1]-e[0]},v=p.reduce(d,0),m=f.reduce(d,0),g=u-v,y=l-m,_=0,b=v,x=0,w=m,S=0,k=g,M=0,T=y;if(o.content&&i){var E=o.content;_=Xu(p,0,E[0]),x=Xu(f,0,E[1]),b=Xu(p,E[0],E[2]),w=Xu(f,E[1],E[3]),S=E[0]-_,M=E[1]-x,k=E[2]-E[0]-b,T=E[3]-E[1]-w}var C=function(i,a,u,l){var p=Ku(i.stretch-_,b,c,t.left),f=Ju(i.fixed-S,k,i.stretch,v),d=Ku(a.stretch-x,w,h,t.top),g=Ju(a.fixed-M,T,a.stretch,m),y=Ku(u.stretch-_,b,c,t.left),E=Ju(u.fixed-S,k,u.stretch,v),C=Ku(l.stretch-x,w,h,t.top),I=Ju(l.fixed-M,T,l.stretch,m),P=new r(p,d),A=new r(y,d),L=new r(y,C),R=new r(p,C),D=new r(f/s,g/s),z=new r(E/s,I/s),O=e*Math.PI/180;if(O){var F=Math.sin(O),N=Math.cos(O),B=[N,-F,F,N];P._matMult(B),A._matMult(B),R._matMult(B),L._matMult(B)}var j=i.stretch+i.fixed,V=a.stretch+a.fixed;return{tl:P,tr:A,bl:R,br:L,tex:{x:o.paddedRect.x+1+j,y:o.paddedRect.y+1+V,w:u.stretch+u.fixed-j,h:l.stretch+l.fixed-V},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:z,minFontScaleX:k/s/c,minFontScaleY:T/s/h,isSDF:n}};if(i&&(o.stretchX||o.stretchY))for(var I=Yu(p,g,v),P=Yu(f,y,m),A=0;A<I.length-1;A++)for(var L=I[A],R=I[A+1],D=0;D<P.length-1;D++)a.push(C(L,P[D],R,P[D+1]));else a.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return a}function Xu(t,e,n){for(var i=0,r=0,a=t;r<a.length;r+=1){var o=a[r];i+=Math.max(e,Math.min(n,o[1]))-Math.max(e,Math.min(n,o[0]))}return i}function Yu(t,e,n){for(var i=[{fixed:-1,stretch:0}],r=0,a=t;r<a.length;r+=1){var o=a[r],s=o[0],u=o[1],l=i[i.length-1];i.push({fixed:s-l.stretch,stretch:l.stretch}),i.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return i.push({fixed:e+1,stretch:n}),i}function Ku(t,e,n,i){return t/e*n+i}function Ju(t,e,n,i){return t-e*n/i}var Qu=function(t,e,n,i,a,o,s,u,l,c){if(this.boxStartIndex=t.length,l){var h=o.top,p=o.bottom,f=o.collisionPadding;f&&(h-=f[1],p+=f[3]);var d=p-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var v=o.top*s-u,m=o.bottom*s+u,g=o.left*s-u,y=o.right*s+u,_=o.collisionPadding;if(_&&(g-=_[0]*s,v-=_[1]*s,y+=_[2]*s,m+=_[3]*s),c){var b=new r(g,v),x=new r(y,v),w=new r(g,m),S=new r(y,m),k=c*Math.PI/180;b._rotate(k),x._rotate(k),w._rotate(k),S._rotate(k),g=Math.min(b.x,x.x,w.x,S.x),y=Math.max(b.x,x.x,w.x,S.x),v=Math.min(b.y,x.y,w.y,S.y),m=Math.max(b.y,x.y,w.y,S.y)}t.emplaceBack(e.x,e.y,g,v,y,m,n,i,a)}this.boxEndIndex=t.length},tl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=el),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function el(t,e){return t<e?-1:t>e?1:0}function nl(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var i=1/0,a=1/0,o=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<i)&&(i=c.x),(!l||c.y<a)&&(a=c.y),(!l||c.x>o)&&(o=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(o-i,s-a),p=h/2,f=new tl([],il);if(0===h)return new r(i,a);for(var d=i;d<o;d+=h)for(var v=a;v<s;v+=h)f.push(new rl(d+p,v+p,p,t));for(var m=function(t){for(var e=0,n=0,i=0,r=t[0],a=0,o=r.length,s=o-1;a<o;s=a++){var u=r[a],l=r[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,i+=(u.y+l.y)*c,e+=3*c}return new rl(n/e,i/e,0,t)}(t),g=f.length;f.length;){var y=f.pop();(y.d>m.d||!m.d)&&(m=y,n&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,g)),y.max-m.d<=e||(f.push(new rl(y.p.x-(p=y.h/2),y.p.y-p,p,t)),f.push(new rl(y.p.x+p,y.p.y-p,p,t)),f.push(new rl(y.p.x-p,y.p.y+p,p,t)),f.push(new rl(y.p.x+p,y.p.y+p,p,t)),g+=4)}return n&&(console.log("num probes: "+g),console.log("best distance: "+m.d)),m.p}function il(t,e){return e.max-t.max}function rl(t,e,n,i){this.p=new r(t,e),this.h=n,this.d=function(t,e){for(var n=!1,i=1/0,r=0;r<e.length;r++)for(var a=e[r],o=0,s=a.length,u=s-1;o<s;u=o++){var l=a[o],c=a[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),i=Math.min(i,Ka(t,l,c))}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}tl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},tl.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},tl.prototype.peek=function(){return this.data[0]},tl.prototype._up=function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i},tl.prototype._down=function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&n(e[s],o)<0&&(a=s,o=e[s]),n(o,r)>=0)break;e[t]=o,t=a}e[t]=r};var al=Number.POSITIVE_INFINITY;function ol(t,e){return e[1]!==al?function(t,e,n){var i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(t,e[0],e[1]):function(t,e){var n=0,i=0;e<0&&(e=0);var r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(t,e[0])}function sl(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ul(t,e,n,i,a,o,s,u,l,c,h,p,f,d,v){var m=function(t,e,n,i,a,o,s,u){for(var l=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,c=[],h=0,p=e.positionedLines;h<p.length;h+=1)for(var f=p[h],d=0,v=f.positionedGlyphs;d<v.length;d+=1){var m=v[d];if(m.rect){var g=m.rect||{},y=4,_=!0,b=1,x=0,w=(a||u)&&m.vertical,S=m.metrics.advance*m.scale/2;if(u&&e.verticalizable&&(x=f.lineOffset/2-(m.imageName?-(24-m.metrics.width*m.scale)/2:24*(m.scale-1))),m.imageName){var k=s[m.imageName];_=k.sdf,y=1/(b=k.pixelRatio)}var M=a?[m.x+S,m.y]:[0,0],T=a?[0,0]:[m.x+S+n[0],m.y+n[1]-x],E=[0,0];w&&(E=T,T=[0,0]);var C=(m.metrics.left-y)*m.scale-S+T[0],I=(-m.metrics.top-y)*m.scale+T[1],P=C+g.w*m.scale/b,A=I+g.h*m.scale/b,L=new r(C,I),R=new r(P,I),D=new r(C,A),z=new r(P,A);if(w){var O=new r(-S,S- -17),F=-Math.PI/2,N=12-S,B=new r(22-N,-(m.imageName?N:0)),j=new(Function.prototype.bind.apply(r,[null].concat(E)));L._rotateAround(F,O)._add(B)._add(j),R._rotateAround(F,O)._add(B)._add(j),D._rotateAround(F,O)._add(B)._add(j),z._rotateAround(F,O)._add(B)._add(j)}if(l){var V=Math.sin(l),U=Math.cos(l),$=[U,-V,V,U];L._matMult($),R._matMult($),D._matMult($),z._matMult($)}var H=new r(0,0),q=new r(0,0);c.push({tl:L,tr:R,bl:D,br:z,tex:g,writingMode:e.writingMode,glyphOffset:M,sectionIndex:m.sectionIndex,isSDF:_,pixelOffsetTL:H,pixelOffsetBR:q,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,u,a,o,s,i,t.allowVerticalPlacement),g=t.textSizeData,y=null;"source"===g.kind?(y=[128*a.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===g.kind&&((y=[128*d.compositeTextSizes[0].evaluate(s,{},v),128*d.compositeTextSizes[1].evaluate(s,{},v)])[0]>32640||y[1]>32640)&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,m,y,u,o,s,c,e,l.lineStartIndex,l.lineLength,f,v);for(var _=0,b=h;_<b.length;_+=1)p[b[_]]=t.text.placedSymbolArray.length-1;return 4*m.length}function ll(t){for(var e in t)return t[e];return null}function cl(t,e,n,i){var r=t.compareText;if(e in r){for(var a=r[e],o=a.length-1;o>=0;o--)if(i.dist(a[o])<n)return!0}else r[e]=[];return r[e].push(i),!1}var hl=xs.VectorTileFeature.types,pl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fl(t,e,n,i,r,a,o,s,u,l,c,h,p){var f=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),a,o,(f<<1)+(u?1:0),d,16*l,16*c,256*h,256*p)}function dl(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function vl(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Ji(n[e].text))return!0;return!1}var ml=function(t){this.layoutVertexArray=new zr,this.indexArray=new Ur,this.programConfigurations=t,this.segments=new ua,this.dynamicLayoutVertexArray=new Or,this.opacityVertexArray=new Fr,this.placedSymbolArray=new ta};ml.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},ml.prototype.upload=function(t,e,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Us.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,$s.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,pl,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t))},ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Bi("SymbolBuffers",ml);var gl=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new ua,this.collisionVertexArray=new Vr};gl.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Hs.members,!0)},gl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Bi("CollisionBuffers",gl);var yl=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=so([]),this.placementViewportMatrix=so([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fu(this.zoom,e["text-size"]),this.iconSizeData=Fu(this.zoom,e["icon-size"]);var n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&!i.isConstant(),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return wu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};yl.prototype.createArrays=function(){this.text=new ml(new za(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new ml(new za(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new ia,this.lineVertexArray=new ra,this.symbolInstances=new na},yl.prototype.calculateGlyphDependencies=function(t,e,n,i,r){for(var a=0;a<t.length;a++)if(e[t.charCodeAt(a)]=!0,(n||i)&&r){var o=Zs[t.charAt(a)];o&&(e[o.charCodeAt(0)]=!0)}},yl.prototype.populate=function(t,e,n){var i=this.layers[0],r=i.layout,a=r.get("text-font"),o=r.get("text-field"),s=r.get("icon-image"),u=("constant"!==o.value.kind||o.value.value instanceof re&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=r.get("symbol-sort-key");if(this.features=[],u||l){for(var h=e.iconDependencies,p=e.glyphDependencies,f=e.availableImages,d=new ur(this.zoom),v=0,m=t;v<m.length;v+=1){var g=m[v],y=g.feature,_=g.id,b=g.index,x=g.sourceLayerIndex,w=i._featureFilter.needGeometry,S=Va(y,w);if(i._featureFilter.filter(d,S,n)){w||(S.geometry=ja(y));var k=void 0;if(u){var M=i.getValueAndResolveTokens("text-field",S,n,f),T=re.factory(M);vl(T)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ar()||this.hasRTLText&&sr.isParsed())&&(k=Gs(T,i,S))}var E=void 0;if(l){var C=i.getValueAndResolveTokens("icon-image",S,n,f);E=C instanceof ae?C:ae.fromString(C)}if(k||E){var I=this.sortFeaturesByKey?c.evaluate(S,{},n):void 0;if(this.features.push({id:_,text:k,icon:E,index:b,sourceLayerIndex:x,geometry:S.geometry,properties:y.properties,type:hl[y.type],sortKey:I}),E&&(h[E.name]=!0),k){var P=a.evaluate(S,{},n).join(","),A="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wu.vertical)>=0;for(var L=0,R=k.sections;L<R.length;L+=1){var D=R[L];if(D.image)h[D.image.name]=!0;else{var z=Gi(k.toString()),O=D.fontStack||P,F=p[O]=p[O]||{};this.calculateGlyphDependencies(D.text,F,A,this.allowVerticalPlacement,z)}}}}}}"line"===r.get("symbol-placement")&&(this.features=function(t){var e={},n={},i=[],r=0;function a(e){i.push(t[e]),r++}function o(t,e,r){var a=n[t];return delete n[t],n[e]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(r[0]),a}function s(t,n,r){var a=e[n];return delete e[n],e[t]=a,i[a].geometry[0].shift(),i[a].geometry[0]=r[0].concat(i[a].geometry[0]),a}function u(t,e,n){var i=n?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in n&&d in e&&n[f]!==e[d]){var v=s(f,d,h),m=o(f,d,i[v].geometry);delete e[f],delete n[d],n[u(p,i[m].geometry,!0)]=m,i[v].geometry=null}else f in n?o(f,d,h):d in e?s(f,d,h):(a(l),e[f]=r-1,n[d]=r-1)}else a(l)}return i.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},yl.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},yl.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},yl.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},yl.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},yl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},yl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},yl.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o<e.length-1&&(i+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},s>0&&(r+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=a[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},yl.prototype.addSymbols=function(t,e,n,i,r,a,o,s,u,l,c,h){for(var p=t.indexArray,f=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,f,p,this.canOverlap?a.sortKey:void 0),v=this.glyphOffsetArray.length,m=d.vertexLength,g=this.allowVerticalPlacement&&o===wu.vertical?Math.PI/2:0,y=a.text&&a.text.sections,_=0;_<e.length;_++){var b=e[_],x=b.tl,w=b.tr,S=b.bl,k=b.br,M=b.tex,T=b.pixelOffsetTL,E=b.pixelOffsetBR,C=b.minFontScaleX,I=b.minFontScaleY,P=b.glyphOffset,A=b.isSDF,L=b.sectionIndex,R=d.vertexLength,D=P[1];fl(f,s.x,s.y,x.x,D+x.y,M.x,M.y,n,A,T.x,T.y,C,I),fl(f,s.x,s.y,w.x,D+w.y,M.x+M.w,M.y,n,A,E.x,T.y,C,I),fl(f,s.x,s.y,S.x,D+S.y,M.x,M.y+M.h,n,A,T.x,E.y,C,I),fl(f,s.x,s.y,k.x,D+k.y,M.x+M.w,M.y+M.h,n,A,E.x,E.y,C,I),dl(t.dynamicLayoutVertexArray,s,g),p.emplaceBack(R,R+1,R+2),p.emplaceBack(R+1,R+2,R+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),_!==e.length-1&&L===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,a,a.index,{},h,y&&y[L])}t.placedSymbolArray.emplaceBack(s.x,s.y,v,this.glyphOffsetArray.length-v,m,u,l,s.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,0,!1,0,c)},yl.prototype._addCollisionDebugVertex=function(t,e,n,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(a.x),Math.round(a.y))},yl.prototype.addCollisionDebugVertices=function(t,e,n,i,a,o,s){var u=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=u.vertexLength,c=a.layoutVertexArray,h=a.collisionVertexArray,p=s.anchorX,f=s.anchorY;this._addCollisionDebugVertex(c,h,o,p,f,new r(t,e)),this._addCollisionDebugVertex(c,h,o,p,f,new r(n,e)),this._addCollisionDebugVertex(c,h,o,p,f,new r(n,i)),this._addCollisionDebugVertex(c,h,o,p,f,new r(t,i)),u.vertexLength+=4;var d=a.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),u.primitiveLength+=4},yl.prototype.addDebugCollisionBoxes=function(t,e,n,i){for(var r=t;r<e;r++){var a=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,i?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,n)}},yl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gl(Br,qs.members,Zr),this.iconCollisionBox=new gl(Br,qs.members,Zr);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},yl.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,i,r,a,o,s,u){for(var l={},c=e;c<n;c++){var h=t.get(c);l.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.textFeatureIndex=h.featureIndex;break}for(var p=i;p<r;p++){var f=t.get(p);l.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},l.verticalTextFeatureIndex=f.featureIndex;break}for(var d=a;d<o;d++){var v=t.get(d);l.iconBox={x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,anchorPointX:v.anchorPointX,anchorPointY:v.anchorPointY},l.iconFeatureIndex=v.featureIndex;break}for(var m=s;m<u;m++){var g=t.get(m);l.verticalIconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},l.verticalIconFeatureIndex=g.featureIndex;break}return l},yl.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},yl.prototype.hasTextData=function(){return this.text.segments.get().length>0},yl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},yl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},yl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},yl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},yl.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs,r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+1,r+2),t.indexArray.emplaceBack(r+1,r+2,r+3)},yl.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),i=[],r=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);i.push(0|Math.round(e*s.anchorX+n*s.anchorY)),r.push(s.featureIndex)}return a.sort((function(t,e){return i[t]-i[e]||r[e]-r[t]})),a},yl.prototype.addToSortKeyRanges=function(t,e){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},yl.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,i=this.symbolInstanceIndexes;n<i.length;n+=1){var r=this.symbolInstances.get(i[n]);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((function(t,n,i){t>=0&&i.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Bi("SymbolBucket",yl,{omit:["layers","collisionBoxArray","features","compareText"]}),yl.MAX_GLYPHS=65535,yl.addDynamicAttributes=dl;var _l=new wr({"symbol-placement":new gr(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new gr(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gr(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yr(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gr(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gr(Pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gr(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new gr(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gr(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yr(Pt.layout_symbol["icon-size"]),"icon-text-fit":new gr(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gr(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yr(Pt.layout_symbol["icon-image"]),"icon-rotate":new yr(Pt.layout_symbol["icon-rotate"]),"icon-padding":new gr(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new gr(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new yr(Pt.layout_symbol["icon-offset"]),"icon-anchor":new yr(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gr(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gr(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gr(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new yr(Pt.layout_symbol["text-field"]),"text-font":new yr(Pt.layout_symbol["text-font"]),"text-size":new yr(Pt.layout_symbol["text-size"]),"text-max-width":new yr(Pt.layout_symbol["text-max-width"]),"text-line-height":new gr(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new yr(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new yr(Pt.layout_symbol["text-justify"]),"text-radial-offset":new yr(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gr(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new yr(Pt.layout_symbol["text-anchor"]),"text-max-angle":new gr(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new gr(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new yr(Pt.layout_symbol["text-rotate"]),"text-padding":new gr(Pt.layout_symbol["text-padding"]),"text-keep-upright":new gr(Pt.layout_symbol["text-keep-upright"]),"text-transform":new yr(Pt.layout_symbol["text-transform"]),"text-offset":new yr(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new gr(Pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gr(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new gr(Pt.layout_symbol["text-optional"])}),bl={paint:new wr({"icon-opacity":new yr(Pt.paint_symbol["icon-opacity"]),"icon-color":new yr(Pt.paint_symbol["icon-color"]),"icon-halo-color":new yr(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yr(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yr(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new gr(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new gr(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new yr(Pt.paint_symbol["text-opacity"]),"text-color":new yr(Pt.paint_symbol["text-color"],{runtimeType:Ut,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new yr(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new yr(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new yr(Pt.paint_symbol["text-halo-blur"]),"text-translate":new gr(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new gr(Pt.paint_symbol["text-translate-anchor"])}),layout:_l},xl=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Nt,this.defaultValue=t};xl.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},xl.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},xl.prototype.outputDefined=function(){return!1},xl.prototype.serialize=function(){return null},Bi("FormatSectionOverride",xl,{omit:["defaultValue"]});var wl=function(t){function e(e){t.call(this,e,bl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var i=this.layout.get("text-writing-mode");if(i){for(var r=[],a=0,o=i;a<o.length;a+=1){var s=o[a];r.indexOf(s)<0&&r.push(s)}this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n,i){var r=this.layout.get(t).evaluate(e,{},n,i),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||Gn(a.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,r)},e.prototype.createBucket=function(t){return new yl(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=bl.paint.overridableProperties;t<n.length;t+=1){var i=n[t];if(e.hasPaintOverride(this.layout,i)){var r,a=this.paint.get(i),o=new xl(a),s=new Wn(o,a.property.specification);r="constant"===a.value.kind||"source"===a.value.kind?new Xn("source",s):new Yn("composite",s,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new vr(a.property,r,a.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),i=bl.paint.properties[e],r=!1,a=function(t){for(var e=0,n=t;e<n.length;e+=1)if(i.overrides&&i.overrides.hasOverride(n[e]))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof re)a(n.value.value.sections);else if("source"===n.value.kind){var o=function t(e){r||(e instanceof ce&&ue(e.value)===Wt?a(e.value.sections):e instanceof de?a(e.sections):e.eachChild(t))},s=n.value;s._styleExpression&&o(s._styleExpression.expression)}return r},e}(Sr),Sl={paint:new wr({"background-color":new gr(Pt.paint_background["background-color"]),"background-pattern":new br(Pt.paint_background["background-pattern"]),"background-opacity":new gr(Pt.paint_background["background-opacity"])})},kl=function(t){function e(e){t.call(this,e,Sl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Sr),Ml={paint:new wr({"raster-opacity":new gr(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new gr(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gr(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gr(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new gr(Pt.paint_raster["raster-saturation"]),"raster-contrast":new gr(Pt.paint_raster["raster-contrast"]),"raster-resampling":new gr(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new gr(Pt.paint_raster["raster-fade-duration"])})},Tl=function(t){function e(e){t.call(this,e,Ml)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Sr),El=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(Sr),Cl={circle:po,heatmap:So,hillshade:Mo,fill:hs,"fill-extrusion":Cs,line:js,symbol:wl,background:kl,raster:Tl},Il=o.HTMLImageElement,Pl=o.HTMLCanvasElement,Al=o.HTMLVideoElement,Ll=o.ImageData,Rl=o.ImageBitmap,Dl=function(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)};Dl.prototype.update=function(t,e,n){var i=t.width,r=t.height,a=!(this.size&&this.size[0]===i&&this.size[1]===r||n),o=this.context,s=o.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[i,r],t instanceof Il||t instanceof Pl||t instanceof Al||t instanceof Ll||Rl&&t instanceof Rl?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,r,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof Il||t instanceof Pl||t instanceof Al||t instanceof Ll||Rl&&t instanceof Rl?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,i,r,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Dl.prototype.bind=function(t,e,n){var i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)},Dl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Dl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var zl=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};zl.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},zl.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ol=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},g(["receive","process"],this),this.invoker=new zl(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=T()?t:o};function Fl(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}Ol.prototype.send=function(t,e,n,i,r){var a=this;void 0===r&&(r=!1);var o=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[o]=n);var s=I(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:t,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:$i(e,s)},s),{cancel:function(){n&&delete a.callbacks[o],a.target.postMessage({id:o,type:"<cancel>",targetMapId:i,sourceMapId:a.mapId})}}},Ol.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var i=this.cancelCallbacks[n];delete this.cancelCallbacks[n],i&&i()}else T()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},Ol.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Ol.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Hi(e.error)):i(null,Hi(e.data)))}else{var r=!1,a=I(this.globalScope)?void 0:[],o=e.hasCallback?function(e,i){r=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?$i(e):null,data:$i(i,a)},a)}:function(t){r=!0},s=null,u=Hi(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,o);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,o)}else o(new Error("Could not find function "+e.type));!r&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Ol.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Nl=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Nl.prototype.setNorthEast=function(t){return this._ne=t instanceof Bl?new Bl(t.lng,t.lat):Bl.convert(t),this},Nl.prototype.setSouthWest=function(t){return this._sw=t instanceof Bl?new Bl(t.lng,t.lat):Bl.convert(t),this},Nl.prototype.extend=function(t){var e,n,i=this._sw,r=this._ne;if(t instanceof Bl)e=t,n=t;else{if(!(t instanceof Nl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Nl.convert(t)):this.extend(Bl.convert(t)):this;if(n=t._ne,!(e=t._sw)||!n)return this}return i||r?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new Bl(e.lng,e.lat),this._ne=new Bl(n.lng,n.lat)),this},Nl.prototype.getCenter=function(){return new Bl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Nl.prototype.getSouthWest=function(){return this._sw},Nl.prototype.getNorthEast=function(){return this._ne},Nl.prototype.getNorthWest=function(){return new Bl(this.getWest(),this.getNorth())},Nl.prototype.getSouthEast=function(){return new Bl(this.getEast(),this.getSouth())},Nl.prototype.getWest=function(){return this._sw.lng},Nl.prototype.getSouth=function(){return this._sw.lat},Nl.prototype.getEast=function(){return this._ne.lng},Nl.prototype.getNorth=function(){return this._ne.lat},Nl.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Nl.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Nl.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Nl.prototype.contains=function(t){var e=Bl.convert(t),n=e.lng,i=e.lat,r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r},Nl.convert=function(t){return!t||t instanceof Nl?t:new Nl(t)};var Bl=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Bl.prototype.wrap=function(){return new Bl(h(this.lng,-180,180),this.lat)},Bl.prototype.toArray=function(){return[this.lng,this.lat]},Bl.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Bl.prototype.distanceTo=function(t){var e=Math.PI/180,n=this.lat*e,i=t.lat*e,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(r,1))},Bl.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new Nl(new Bl(this.lng-n,this.lat-e),new Bl(this.lng+n,this.lat+e))},Bl.convert=function(t){if(t instanceof Bl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Bl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Bl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var jl=2*Math.PI*6371008.8;function Vl(t){return jl*Math.cos(t*Math.PI/180)}function Ul(t){return(180+t)/360}function $l(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Hl(t,e){return t/Vl(e)}function ql(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Wl=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};Wl.fromLngLat=function(t,e){void 0===e&&(e=0);var n=Bl.convert(t);return new Wl(Ul(n.lng),$l(n.lat),Hl(e,n.lat))},Wl.prototype.toLngLat=function(){return new Bl(360*this.x-180,ql(this.y))},Wl.prototype.toAltitude=function(){return this.z*Vl(ql(this.y))},Wl.prototype.meterInMercatorCoordinateUnits=function(){return 1/jl*(t=ql(this.y),1/Math.cos(t*Math.PI/180));var t};var Gl=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Yl(0,t,t,e,n)};Gl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Gl.prototype.url=function(t,e){var n,i,r,a,o,s=(i=this.y,r=this.z,a=Fl(256*(n=this.x),256*(i=Math.pow(2,r)-i-1),r),o=Fl(256*(n+1),256*(i+1),r),a[0]+","+a[1]+","+o[0]+","+o[1]),u=function(t,e,n){for(var i,r="",a=t;a>0;a--)r+=(e&(i=1<<a-1)?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Gl.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new r(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},Gl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Zl=function(t,e){this.wrap=t,this.canonical=e,this.key=Yl(t,e.z,e.z,e.x,e.y)},Xl=function(t,e,n,i,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Gl(n,+i,+r),this.key=Yl(e,t,n,i,r)};function Yl(t,e,n,i,r){(t*=2)<0&&(t=-1*t-1);var a=1<<n;return(a*a*t+a*r+i).toString(36)+n.toString(36)+e.toString(36)}Xl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Xl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Xl.prototype.calculateScaledKey=function(t,e){var n=this.canonical.z-t;return t>this.canonical.z?Yl(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Yl(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)},Xl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Xl.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Xl(e,this.wrap,e,n,i),new Xl(e,this.wrap,e,n+1,i),new Xl(e,this.wrap,e,n,i+1),new Xl(e,this.wrap,e,n+1,i+1)]},Xl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xl.prototype.wrapped=function(){return new Xl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xl.prototype.unwrapTo=function(t){return new Xl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xl.prototype.toUnwrapped=function(){return new Zl(this.wrap,this.canonical)},Xl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Wl(t.x-this.wrap,t.y))},Bi("CanonicalTileID",Gl),Bi("OverscaledTileID",Xl,{omit:["posMatrix"]});var Kl=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return S('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var i=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var r=0;r<i;r++)this.data[this._idx(-1,r)]=this.data[this._idx(0,r)],this.data[this._idx(i,r)]=this.data[this._idx(i-1,r)],this.data[this._idx(r,-1)]=this.data[this._idx(r,0)],this.data[this._idx(r,i)]=this.data[this._idx(r,i-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(i,-1)]=this.data[this._idx(i-1,0)],this.data[this._idx(-1,i)]=this.data[this._idx(0,i-1)],this.data[this._idx(i,i)]=this.data[this._idx(i-1,i-1)]};Kl.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[i],n[i+1],n[i+2])},Kl.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Kl.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Kl.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Kl.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Kl.prototype.getPixels=function(){return new bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Kl.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var i=e*this.dim,r=e*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}for(var s=-e*this.dim,u=-n*this.dim,l=a;l<o;l++)for(var c=i;c<r;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},Bi("DEMData",Kl);var Jl=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Jl.prototype.encode=function(t){return this._stringToNumber[t]},Jl.prototype.decode=function(t){return this._numberToString[t]};var Ql=function(t,e,n,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,this.id=r},tc={geometry:{configurable:!0}};tc.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},tc.geometry.set=function(t){this._geometry=t},Ql.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Ql.prototype,tc);var ec=function(){this.state={},this.stateChanges={},this.deletedStates={}};ec.prototype.updateState=function(t,e,n){var i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},p(this.stateChanges[t][i],n),null===this.deletedStates[t])for(var r in this.deletedStates[t]={},this.state[t])r!==i&&(this.deletedStates[t][r]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][i])for(var a in this.deletedStates[t][i]={},this.state[t][i])n[a]||(this.deletedStates[t][i][a]=null);else for(var o in n)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][o]&&delete this.deletedStates[t][i][o]},ec.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}},ec.prototype.getState=function(t,e){var n=String(e),i=p({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var r=this.deletedStates[t][e];if(null===r)return{};for(var a in r)delete i[a]}return i},ec.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},ec.prototype.coalesceChanges=function(t,e){var n={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var r={};for(var a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),p(this.state[i][a],this.stateChanges[i][a]),r[a]=this.state[i][a];n[i]=r}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var u in this.state[o])s[u]={},this.state[o][u]={};else for(var l in this.deletedStates[o]){if(null===this.deletedStates[o][l])this.state[o][l]={};else for(var c=0,h=Object.keys(this.deletedStates[o][l]);c<h.length;c+=1)delete this.state[o][l][h[c]];s[l]=this.state[o][l]}n[o]=n[o]||{},p(n[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var f in t)t[f].setFeatureState(n,e)};var nc=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Di(8192,16,0),this.grid3D=new Di(8192,16,0),this.featureIndexArray=new oa,this.promoteId=e};function ic(t,e,n,i,r){return _(t,(function(t,a){var o=e instanceof mr?e.get(a):null;return o&&o.evaluate?o.evaluate(n,i,r):o}))}function rc(t){for(var e=1/0,n=1/0,i=-1/0,r=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y)}return{minX:e,minY:n,maxX:i,maxY:r}}function ac(t,e){return e-t}nc.prototype.insert=function(t,e,n,i,r,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);for(var s=a?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(o,c[0],c[1],c[2],c[3])}},nc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new xs.VectorTile(new Ks(this.rawTileData)).layers,this.sourceLayerCoder=new Jl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},nc.prototype.query=function(t,e,n,i){var a=this;this.loadVTLayers();for(var o=t.params||{},s=8192/t.tileSize/t.scale,u=si(o.filter),l=t.queryGeometry,c=t.queryPadding*s,h=rc(l),p=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),f=rc(t.cameraQueryGeometry),d=this.grid3D.query(f.minX-c,f.minY-c,f.maxX+c,f.maxY+c,(function(e,n,i,a){return function(t,e,n,i,a){for(var o=0,s=t;o<s.length;o+=1){var u=s[o];if(e<=u.x&&n<=u.y&&i>=u.x&&a>=u.y)return!0}var l=[new r(e,n),new r(e,a),new r(i,a),new r(i,n)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if(Qa(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(to(t[p],t[p+1],l))return!0;return!1}(t.cameraQueryGeometry,e-c,n-c,i+c,a+c)})),v=0,m=d;v<m.length;v+=1)p.push(m[v]);p.sort(ac);for(var g,y={},_=function(r){var c=p[r];if(c!==g){g=c;var h=a.featureIndexArray.get(c),f=null;a.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,o.layers,o.availableImages,e,n,i,(function(e,n,i){return f||(f=ja(e)),n.queryIntersectsFeature(l,e,i,f,a.z,t.transform,s,t.pixelPosMatrix)}))}},b=0;b<p.length;b++)_(b);return y},nc.prototype.loadMatchingFeature=function(t,e,n,i,r,a,o,s,u,l,c){var h=this.bucketLayerIDs[e];if(!a||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(a,h)){var f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(i);if(r.needGeometry){var v=Va(d,!0);if(!r.filter(new ur(this.tileID.overscaledZ),v,this.tileID.canonical))return}else if(!r.filter(new ur(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,f),g=0;g<h.length;g++){var y=h[g];if(!(a&&a.indexOf(y)<0)){var _=s[y];if(_){var b={};void 0!==m&&l&&(b=l.getState(_.sourceLayer||"_geojsonTileLayer",m));var x=p({},u[y]);x.paint=ic(x.paint,_.paint,d,b,o),x.layout=ic(x.layout,_.layout,d,b,o);var w=!c||c(d,_,b);if(w){var S=new Ql(d,this.z,this.x,this.y,m);S.layer=x;var k=t[y];void 0===k&&(k=t[y]=[]),k.push({featureIndex:i,feature:S,intersectionZ:w})}}}}}},nc.prototype.lookupSymbolFeatures=function(t,e,n,i,r,a,o,s){var u={};this.loadVTLayers();for(var l=si(r),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(u,n,i,h[c],l,a,o,s,e);return u},nc.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var i=0,r=n[e];i<r.length;i+=1)if(t===r[i])return!0;return!1},nc.prototype.getId=function(t,e){var n=t.id;return this.promoteId&&"boolean"==typeof(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(n=Number(n)),n},Bi("FeatureIndex",nc,{omit:["rawTileData","sourceLayerCoder"]});var oc=function(t,e){this.tileID=t,this.uid=d(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};oc.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<N.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},oc.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},oc.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var i in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var i=function(){var t=a[r],i=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==i.length){t.layers=i,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return i.filter((function(e){return e.id===t}))[0]})));for(var o=0,s=i;o<s.length;o+=1)n[s[o].id]=t}},r=0,a=t;r<a.length;r+=1)i();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var r=this.buckets[i];if(r instanceof yl){if(this.hasSymbolBuckets=!0,!n)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof yl&&o.hasRTLText){this.hasRTLText=!0,sr.isLoading()||sr.isLoaded()||"deferred"!==ar()||or();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Jr},oc.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},oc.prototype.getBucket=function(t){return this.buckets[t.id]},oc.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dl(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dl(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)},oc.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},oc.prototype.queryRenderedFeatures=function(t,e,n,i,r,a,o,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:a,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:o,queryPadding:this.queryPadding*u},t,e,n):{}},oc.prototype.querySourceFeatures=function(t,e){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var i=n.loadVTLayers(),r=e?e.sourceLayer:"",a=i._geojsonTileLayer||i[r];if(a)for(var o=si(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},p=0;p<a.length;p++){var f=a.feature(p);if(o.needGeometry){var d=Va(f,!0);if(!o.filter(new ur(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!o.filter(new ur(this.tileID.overscaledZ),f))continue;var v=n.getId(f,r),m=new Ql(f,u,l,c,v);m.tile=h,t.push(m)}}},oc.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},oc.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},oc.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=E(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),r=!1;if(this.expirationTime>i)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var a=this.expirationTime-e;a?this.expirationTime=i+Math.max(a,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},oc.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},oc.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var i in this.buckets)if(e.style.hasLayer(i)){var r=this.buckets[i],a=r.layers[0].sourceLayer||"_geojsonTileLayer",o=n[a],s=t[a];if(o&&s&&0!==Object.keys(s).length){r.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(i);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(r)))}}}},oc.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},oc.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()},oc.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},oc.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=N.now()+t},oc.prototype.setDependencies=function(t,e){for(var n={},i=0,r=e;i<r.length;i+=1)n[r[i]]=!0;this.dependencies[t]=n},oc.prototype.hasDependency=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=this.dependencies[i[n]];if(r)for(var a=0,o=e;a<o.length;a+=1)if(r[o[a]])return!0}return!1};var sc=o.performance,uc=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},sc.mark(this._marks.start)};uc.prototype.finish=function(){sc.mark(this._marks.end);var t=sc.getEntriesByName(this._marks.measure);return 0===t.length&&(sc.measure(this._marks.measure,this._marks.start,this._marks.end),t=sc.getEntriesByName(this._marks.measure),sc.clearMarks(this._marks.start),sc.clearMarks(this._marks.end),sc.clearMeasures(this._marks.measure)),t},t.Actor=Ol,t.AlphaImage=_o,t.CanonicalTileID=Gl,t.CollisionBoxArray=Jr,t.Color=ee,t.DEMData=Kl,t.DataConstantProperty=gr,t.DictionaryCoder=Jl,t.EXTENT=8192,t.ErrorEvent=Ct,t.EvaluationParameters=ur,t.Event=Et,t.Evented=It,t.FeatureIndex=nc,t.FillBucket=us,t.FillExtrusionBucket=Ms,t.ImageAtlas=xu,t.ImagePosition=_u,t.LineBucket=Os,t.LngLat=Bl,t.LngLatBounds=Nl,t.MercatorCoordinate=Wl,t.ONE_EM=24,t.OverscaledTileID=Xl,t.Point=r,t.Point$1=r,t.Properties=wr,t.Protobuf=Ks,t.RGBAImage=bo,t.RequestManager=q,t.RequestPerformance=uc,t.ResourceType=dt,t.SegmentVector=ua,t.SourceFeatureState=ec,t.StructArrayLayout1ui2=Xr,t.StructArrayLayout2f1f2i16=jr,t.StructArrayLayout2i4=Ir,t.StructArrayLayout3ui6=Ur,t.StructArrayLayout4i8=Pr,t.SymbolBucket=yl,t.Texture=Dl,t.Tile=oc,t.Transitionable=hr,t.Uniform1f=xa,t.Uniform1i=ba,t.Uniform2f=wa,t.Uniform3f=Sa,t.Uniform4f=ka,t.UniformColor=Ma,t.UniformMatrix4f=Ea,t.UnwrappedTileID=Zl,t.ValidationError=At,t.WritingMode=wu,t.ZoomHistory=qi,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=dl,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var i=t.length,r=new Array(t.length),a=null;t.forEach((function(t,o){e(t,(function(t,e){t&&(a=t),r[o]=e,0==--i&&n(a,r)}))}))},t.bezier=u,t.bindAll=g,t.browser=N,t.cacheEntryPossiblyAdded=function(t){++pt>ut&&(t.getActor().send("enforceCacheSizeLimit",st),pt=0)},t.clamp=c,t.clearTileCache=function(t){var e=o.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Gu,t.clone=function(t){var e=new oo(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=x,t.clone$2=function(t){var e=new oo(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Ws,t.config=B,t.create=function(){var t=new oo(16);return oo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new oo(9);return oo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new oo(4);return oo!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Zn,t.createLayout=Er,t.createStyleLayer=function(t){return"custom"===t.type?new El(t):new Cl[t.type](t)},t.cross=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=r*u-a*s,t[1]=a*o-i*u,t[2]=i*s-r*o,t},t.deepEqual=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!t(e[i],n[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var r in e)if(!t(e[r],n[r]))return!1;return!0}return e===n},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=l,t.emitValidationErrors=Ri,t.endsWith=y,t.enforceCacheSizeLimit=function(t){lt(),tt&&tt.then((function(e){e.keys().then((function(n){for(var i=0;i<n.length-t;i++)e.delete(n[i])}))}))},t.evaluateSizeForFeature=Nu,t.evaluateSizeForZoom=Bu,t.evaluateVariableOffset=ol,t.evented=rr,t.extend=p,t.featureFilter=si,t.filterObject=b,t.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Ru,t.getAnchorJustification=sl,t.getArrayBuffer=xt,t.getImage=kt,t.getJSON=function(t,e){return bt(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=ar,t.getReferrer=mt,t.getVideo=function(t,e){var n,i,r=o.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(var a=0;a<t.length;a++){var s=o.document.createElement("source");n=t[a],i=void 0,(i=o.document.createElement("a")).href=n,(i.protocol!==o.document.location.protocol||i.host!==o.document.location.host)&&(r.crossOrigin="Anonymous"),s.src=t[a],r.appendChild(s)}return{cancel:function(){}}},t.identity=so,t.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*s-i*o,_=n*u-r*o,b=n*l-a*o,x=i*u-r*s,w=i*l-a*s,S=r*l-a*u,k=c*v-h*d,M=c*m-p*d,T=c*g-f*d,E=h*m-p*v,C=h*g-f*v,I=p*g-f*m,P=y*I-_*C+b*E+x*T-w*M+S*k;return P?(t[0]=(s*I-u*C+l*E)*(P=1/P),t[1]=(r*C-i*I-a*E)*P,t[2]=(v*S-m*w+g*x)*P,t[3]=(p*w-h*S-f*x)*P,t[4]=(u*T-o*I-l*M)*P,t[5]=(n*I-r*T+a*M)*P,t[6]=(m*b-d*S-g*_)*P,t[7]=(c*S-p*b+f*_)*P,t[8]=(o*C-s*T+l*k)*P,t[9]=(i*T-n*C-a*k)*P,t[10]=(d*w-v*b+g*y)*P,t[11]=(h*b-c*w-f*y)*P,t[12]=(s*M-o*E-u*k)*P,t[13]=(n*E-i*M+r*k)*P,t[14]=(v*_-d*x-m*y)*P,t[15]=(c*x-h*_+p*y)*P,t):null},t.isChar=Wi,t.isMapboxURL=W,t.keysDifference=function(t,e){var n=[];for(var i in t)i in e||n.push(i);return n},t.makeRequest=bt,t.mapObject=_,t.mercatorXfromLng=Ul,t.mercatorYfromLat=$l,t.mercatorZfromAltitude=Hl,t.mul=co,t.multiply=uo,t.mvt=xs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t},t.number=qe,t.offscreenCanvasSupported=ft,t.ortho=function(t,e,n,i,r,a,o){var s=1/(e-n),u=1/(i-r),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(o+a)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ks(t).readFields(vu,[])},t.pbf=Ks,t.performSymbolLayout=function(t,e,n,i,r,a,o){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new ur(c.minZoom),o),u["text-size"].possiblyEvaluate(new ur(h),o)]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,f=p.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new ur(p.minZoom),o),u["icon-size"].possiblyEvaluate(new ur(f),o)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new ur(t.zoom+1),o),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new ur(t.zoom+1),o),l.textMaxSize=u["text-size"].possiblyEvaluate(new ur(18));for(var d=24*s.get("text-line-height"),v="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),g=s.get("text-size"),y=function(){var a=b[_],u=s.get("text-font").evaluate(a,{},o).join(","),c=g.evaluate(a,{},o),h=l.layoutTextSize.evaluate(a,{},o),p=l.layoutIconSize.evaluate(a,{},o),f={horizontal:{},vertical:void 0},y=a.text,x=[0,0];if(y){var w=y.toString(),k=24*s.get("text-letter-spacing").evaluate(a,{},o),M=function(t){for(var e=0,n=t;e<n.length;e+=1)if(i=n[e].charCodeAt(0),Wi.Arabic(i)||Wi["Arabic Supplement"](i)||Wi["Arabic Extended-A"](i)||Wi["Arabic Presentation Forms-A"](i)||Wi["Arabic Presentation Forms-B"](i))return!1;var i;return!0}(w)?k:0,T=s.get("text-anchor").evaluate(a,{},o),E=s.get("text-variable-anchor");if(!E){var C=s.get("text-radial-offset").evaluate(a,{},o);x=C?ol(T,[24*C,al]):s.get("text-offset").evaluate(a,{},o).map((function(t){return 24*t}))}var I=v?"center":s.get("text-justify").evaluate(a,{},o),P=s.get("symbol-placement"),A="point"===P?24*s.get("text-max-width").evaluate(a,{},o):0,L=function(){t.allowVerticalPlacement&&Gi(w)&&(f.vertical=Mu(y,e,n,r,u,A,d,T,"left",M,x,wu.vertical,!0,P,h,c))};if(!v&&E){for(var R="auto"===I?E.map((function(t){return sl(t)})):[I],D=!1,z=0;z<R.length;z++){var O=R[z];if(!f.horizontal[O])if(D)f.horizontal[O]=f.horizontal[0];else{var F=Mu(y,e,n,r,u,A,d,"center",O,M,x,wu.horizontal,!1,P,h,c);F&&(f.horizontal[O]=F,D=1===F.positionedLines.length)}}L()}else{"auto"===I&&(I=sl(T));var N=Mu(y,e,n,r,u,A,d,T,I,M,x,wu.horizontal,!1,P,h,c);N&&(f.horizontal[I]=N),L(),Gi(w)&&v&&m&&(f.vertical=Mu(y,e,n,r,u,A,d,T,I,M,x,wu.vertical,!1,P,h,c))}}var B=void 0,j=!1;if(a.icon&&a.icon.name){var V=i[a.icon.name];V&&(B=function(t,e,n){var i=Ru(n),r=e[0]-t.displaySize[0]*i.horizontalAlign,a=e[1]-t.displaySize[1]*i.verticalAlign;return{image:t,top:a,bottom:a+t.displaySize[1],left:r,right:r+t.displaySize[0]}}(r[a.icon.name],s.get("icon-offset").evaluate(a,{},o),s.get("icon-anchor").evaluate(a,{},o)),j=V.sdf,void 0===t.sdfIcons?t.sdfIcons=V.sdf:t.sdfIcons!==V.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(V.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var U=ll(f.horizontal)||f.vertical;t.iconsInText=!!U&&U.iconsInText,(U||B)&&function(t,e,n,i,r,a,o,s,u,l,c){var h=a.textMaxSize.evaluate(e,{});void 0===h&&(h=o);var p,f=t.layers[0].layout,d=f.get("icon-offset").evaluate(e,{},c),v=ll(n.horizontal),m=o/24,g=t.tilePixelRatio*m,y=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,b=t.tilePixelRatio*f.get("symbol-spacing"),x=f.get("text-padding")*t.tilePixelRatio,w=f.get("icon-padding")*t.tilePixelRatio,k=f.get("text-max-angle")/180*Math.PI,M="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),T="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),E=f.get("symbol-placement"),C=b/2,I=f.get("icon-text-fit");i&&"none"!==I&&(t.allowVerticalPlacement&&n.vertical&&(p=zu(i,n.vertical,I,f.get("icon-text-fit-padding"),d,m)),v&&(i=zu(i,v,I,f.get("icon-text-fit-padding"),d,m)));var P=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,k,M){var T,E,C,I,P,A=t.addToLineVertexArray(e,n),L=0,R=0,D=0,z=0,O=-1,F=-1,N={},B=fa(""),j=0,V=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(j=(T=s.layout.get("text-offset").evaluate(b,{},k).map((function(t){return 24*t})))[0],V=T[1]):(j=24*s.layout.get("text-radial-offset").evaluate(b,{},k),V=al),t.allowVerticalPlacement&&i.vertical){var U=s.layout.get("text-rotate").evaluate(b,{},k)+90;I=new Qu(u,e,l,c,h,i.vertical,p,f,d,U),o&&(P=new Qu(u,e,l,c,h,o,m,g,d,U))}if(r){var $=s.layout.get("icon-rotate").evaluate(b,{}),H="none"!==s.layout.get("icon-text-fit"),q=Zu(r,$,w,H),W=o?Zu(o,$,w,H):void 0;C=new Qu(u,e,l,c,h,r,m,g,!1,$),L=4*q.length;var G=t.iconSizeData,Z=null;"source"===G.kind?(Z=[128*s.layout.get("icon-size").evaluate(b,{})])[0]>32640&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===G.kind&&((Z=[128*x.compositeIconSizes[0].evaluate(b,{},k),128*x.compositeIconSizes[1].evaluate(b,{},k)])[0]>32640||Z[1]>32640)&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,q,Z,_,y,b,!1,e,A.lineStartIndex,A.lineLength,-1,k),O=t.icon.placedSymbolArray.length-1,W&&(R=4*W.length,t.addSymbols(t.icon,W,Z,_,y,b,wu.vertical,e,A.lineStartIndex,A.lineLength,-1,k),F=t.icon.placedSymbolArray.length-1)}for(var X in i.horizontal){var Y=i.horizontal[X];if(!E){B=fa(Y.text);var K=s.layout.get("text-rotate").evaluate(b,{},k);E=new Qu(u,e,l,c,h,Y,p,f,d,K)}var J=1===Y.positionedLines.length;if(D+=ul(t,e,Y,a,s,d,b,v,A,i.vertical?wu.horizontal:wu.horizontalOnly,J?Object.keys(i.horizontal):[X],N,O,x,k),J)break}i.vertical&&(z+=ul(t,e,i.vertical,a,s,d,b,v,A,wu.vertical,["vertical"],N,F,x,k));var Q=E?E.boxStartIndex:t.collisionBoxArray.length,tt=E?E.boxEndIndex:t.collisionBoxArray.length,et=I?I.boxStartIndex:t.collisionBoxArray.length,nt=I?I.boxEndIndex:t.collisionBoxArray.length,it=C?C.boxStartIndex:t.collisionBoxArray.length,rt=C?C.boxEndIndex:t.collisionBoxArray.length,at=P?P.boxStartIndex:t.collisionBoxArray.length,ot=P?P.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(E,st),st=ut(I,st),st=ut(C,st);var lt=(st=ut(P,st))>-1?1:0;lt&&(st*=M/24),t.glyphOffsetArray.length>=yl.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical||-1,O,F,B,Q,tt,et,nt,it,rt,at,ot,l,D,z,L,R,lt,0,p,j,V,st)}(t,h,s,n,i,r,p,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,g,x,M,u,_,w,T,d,e,a,l,c,o)};if("line"===E)for(var A=0,L=Gu(e.geometry,0,0,8192,8192);A<L.length;A+=1)for(var R=L[A],D=0,z=Wu(R,b,k,n.vertical||v,i,24,y,t.overscaling,8192);D<z.length;D+=1){var O=z[D];v&&cl(t,v.text,C,O)||P(R,O)}else if("line-center"===E)for(var F=0,N=e.geometry;F<N.length;F+=1){var B=N[F];if(B.length>1){var j=qu(B,k,n.vertical||v,i,24,y);j&&P(B,j)}}else if("Polygon"===e.type)for(var V=0,U=rs(e.geometry,0);V<U.length;V+=1){var $=U[V],H=nl($,16);P($[0],new Ou(H.x,H.y,0))}else if("LineString"===e.type)for(var q=0,W=e.geometry;q<W.length;q+=1){var G=W[q];P(G,new Ou(G[0].x,G[0].y,0))}else if("Point"===e.type)for(var Z=0,X=e.geometry;Z<X.length;Z+=1)for(var Y=0,K=X[Z];Y<K.length;Y+=1){var J=K[Y];P([J],new Ou(J.x,J.y,0))}}(t,a,f,B,i,l,h,p,x,j,o)},_=0,b=t.features;_<b.length;_+=1)y();a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+i)*(a=1/(i-r)),t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){for(var n={},i=0;i<e.length;i++){var r=e[i];r in t&&(n[r]=t[r])}return n},t.plugin=sr,t.polygonIntersectsPolygon=Ha,t.postMapLoadEvent=ot,t.postTurnstileEvent=rt,t.potpack=yu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Bi,t.registerForPluginStateChange=function(t){return t({pluginStatus:tr,pluginURL:er}),rr.on("pluginStateChange",t),t},t.renderColorRamp=wo,t.rotate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=i*u+a*s,t[1]=r*u+o*s,t[2]=i*-s+a*u,t[3]=r*-s+o*u,t},t.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+l*i,t[5]=o*r+c*i,t[6]=s*r+h*i,t[7]=u*r+p*i,t[8]=l*r-a*i,t[9]=c*r-o*i,t[10]=h*r-s*i,t[11]=p*r-u*i,t},t.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+l*i,t[1]=o*r+c*i,t[2]=s*r+h*i,t[3]=u*r+p*i,t[4]=l*r-a*i,t[5]=c*r-o*i,t[6]=h*r-s*i,t[7]=p*r-u*i,t},t.scale=function(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.setCacheLimits=function(t,e){st=t,ut=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),"deferred"===tr||"loading"===tr||"loaded"===tr)throw new Error("setRTLTextPlugin cannot be called multiple times.");er=N.resolveURL(t),tr="deferred",Qi=e,ir(),n||or()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],i=t[2];return n+=90,n*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i)}},t.sqrLen=function(t){var e=t[0],n=t[1];return e*e+n*n},t.styleSpec=Pt,t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.symbolSize=ju,t.transformMat3=function(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t},t.transformMat4=ho,t.translate=function(t,e,n){var i,r,a,o,s,u,l,c,h,p,f,d,v=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i=e[0],t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*v+s*m+h*g+e[12],t[13]=r*v+u*m+p*g+e[13],t[14]=a*v+l*m+f*g+e[14],t[15]=o*v+c*m+d*g+e[15]),t},t.triggerPluginCompletionEvent=nr,t.uniqueId=d,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Pi,t.validateStyle=Ii,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=xs,t.version="1.15.2",t.warnOnce=S,t.webpSupported=j,t.window=o,t.wrap=h})),i(["./shared"],(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",r=0,a=t;r<a.length;r+=1)i+=e(a[r])+",";return i+"]"}for(var o=Object.keys(t).sort(),s="{",u=0;u<o.length;u++)s+=JSON.stringify(o[u])+":"+e(t[o[u]])+",";return s+"}"}function n(n){for(var i="",r=0,a=t.refProperties;r<a.length;r+=1)i+="/"+e(n[a[r]]);return i}var i=function(t){this.keyCache={},t&&this.replace(t)};i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},i.prototype.update=function(e,i){for(var r=this,a=0,o=e;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=i;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t,e){for(var i={},r=0;r<t.length;r++){var a=e&&e[t[r].id]||n(t[r]);e&&(e[t[r].id]=a);var o=i[a];o||(o=i[a]=[]),o.push(t[r])}var s=[];for(var u in i)s.push(i[u]);return s}(t.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map((function(t){return r._layers[t.id]})),v=d[0];if("none"!==v.visibility){var m=v.source||"",g=this.familiesBySource[m];g||(g=this.familiesBySource[m]={});var y=v.sourceLayer||"_geojsonTileLayer",_=g[y];_||(_=g[y]=[]),_.push(d)}}};var r=function(e){var n={},i=[];for(var r in e){var a=e[r],o=n[r]={};for(var s in a){var u=a[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};i.push(l),o[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(i),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var f=e[p];for(var d in f){var v=f[+d];if(v&&0!==v.bitmap.width&&0!==v.bitmap.height){var m=n[p][d].rect;t.AlphaImage.copy(v.bitmap,h,{x:0,y:0},{x:m.x+1,y:m.y+1},v.bitmap)}}}this.image=h,this.positions=n};t.register("GlyphAtlas",r);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function o(e,n,i){for(var r=new t.EvaluationParameters(n),a=0,o=e;a<o.length;a+=1)o[a].recalculate(r,i)}function s(e,n){var i=t.getArrayBuffer(e.request,(function(e,i,r,a){e?n(e):i&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(i)),rawData:i,cacheControl:r,expires:a})}));return function(){i.cancel(),n()}}a.prototype.parse=function(e,n,i,a,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,p,f,d,v={},m={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},g=n.familiesBySource[this.source];for(var y in g){var _=e.layers[y];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var b=l.encode(y),x=[],w=0;w<_.length;w++){var S=_.feature(w),k=c.getId(S,y);x.push({feature:S,id:k,index:w,sourceLayerIndex:b})}for(var M=0,T=g[y];M<T.length;M+=1){var E=T[M],C=E[0];C.minzoom&&this.zoom<Math.floor(C.minzoom)||C.maxzoom&&this.zoom>=C.maxzoom||"none"!==C.visibility&&(o(E,this.zoom,i),(v[C.id]=C.createBucket({index:c.bucketLayerIDs.length,layers:E,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:b,sourceID:this.source})).populate(x,m,this.tileID.canonical),c.bucketLayerIDs.push(E.map((function(t){return t.id}))))}}}var I=t.mapObject(m.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(I).length?a.send("getGlyphs",{uid:this.uid,stacks:I},(function(t,e){h||(h=t,p=e,L.call(u))})):p={};var P=Object.keys(m.iconDependencies);P.length?a.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,f=e,L.call(u))})):f={};var A=Object.keys(m.patternDependencies);function L(){if(h)return s(h);if(p&&f&&d){var e=new r(p),n=new t.ImageAtlas(f,d);for(var a in v){var u=v[a];u instanceof t.SymbolBucket?(o(u.layers,this.zoom,i),t.performSymbolLayout(u,p,e.positions,f,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(o(u.layers,this.zoom,i),u.addFeatures(m,this.tileID.canonical,n.patternPositions))}this.status="done",s(null,{buckets:t.values(v).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}A.length?a.send("getImages",{icons:A,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,L.call(u))})):d={},L.call(this)};var u=function(t,e,n,i){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=i||s,this.loading={},this.loaded={}};u.prototype.loadTile=function(e,n){var i=this,r=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[r]=new a(e);s.abort=this.loadVectorData(e,(function(e,a){if(delete i.loading[r],e||!a)return s.status="done",i.loaded[r]=s,n(e);var u=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var c={};if(o){var h=o.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,i.layerIndex,i.availableImages,i.actor,(function(e,i){if(e||!i)return n(e);n(null,t.extend({rawTileData:u.slice(0)},i,l,c))})),i.loaded=i.loaded||{},i.loaded[r]=s}))},u.prototype.reloadTile=function(t,e){var n=this,i=this.loaded,r=t.uid,a=this;if(i&&i[r]){var o=i[r];o.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,i){var r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,n.availableImages,a.actor,r)),e(t,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},u.prototype.abortTile=function(t,e){var n=this.loading,i=t.uid;n&&n[i]&&n[i].abort&&(n[i].abort(),delete n[i]),e()},u.prototype.removeTile=function(t,e){var n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()};var l=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){p(t[0],e);for(var n=1;n<t.length;n++)p(t[n],!e)}}function p(t,e){for(var n=0,i=0,r=t.length,a=r-1;i<r;a=i++)n+=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]);n>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,n){var i=e.uid,r=e.encoding,a=e.rawImageData,o=l&&a instanceof l?this.getImageData(a):a,s=new t.DEMData(i,o,r);this.loaded=this.loaded||{},this.loaded[i]=s,n(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)},c.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var f=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};d.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,i=this._feature.geometry;n<i.length;n+=1){var r=i[n];e.push([new t.Point$1(r[0],r[1])])}return e}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var u=[],l=0,c=s[o];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}a.push(u)}return a},d.prototype.toGeoJSON=function(t,e,n){return f.call(this,t,e,n)};var v=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};v.prototype.feature=function(t){return new d(this._features[t])};var m=t.vectorTile.VectorTileFeature,g=y;function y(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}y.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var i=e[n],r=[],a=0;a<i.length;a++)r.push(new t.Point$1(i[a][0],i[a][1]));this.geometry.push(r)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var u=o[s];e=Math.min(e,u.x),n=Math.max(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.y)}return[e,i,n,r]},_.prototype.toGeoJSON=m.prototype.toGeoJSON;var b=w,x=g;function w(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,S,t.layers[n])}(e,n),n.finish()}function S(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,k,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(3,r[n]);var a=i.values;for(n=0;n<a.length;n++)e.writeMessage(4,I,a[n])}function k(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,M,t),e.writeVarintField(3,n.type),e.writeMessage(4,C,n)}function M(t,e){var n=t.feature,i=t.keys,r=t.values,a=t.keycache,o=t.valuecache;for(var s in n.properties){var u=a[s];void 0===u&&(i.push(s),a[s]=u=i.length-1),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=o[h];void 0===p&&(r.push(l),o[h]=p=r.length-1),e.writeVarint(p)}}function T(t,e){return(e<<3)+(7&t)}function E(t){return t<<1^t>>31}function C(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,a=0,o=n.length,s=0;s<o;s++){var u=n[s],l=1;1===i&&(l=u.length),e.writeVarint(T(1,l));for(var c=3===i?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==i&&e.writeVarint(T(2,c-1));var p=u[h].x-r,f=u[h].y-a;e.writeVarint(E(p)),e.writeVarint(E(f)),r+=p,a+=f}3===i&&e.writeVarint(T(7,1))}}function I(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function P(t,e,n,i){A(t,n,i),A(e,2*n,2*i),A(e,2*n+1,2*i+1)}function A(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function L(t,e,n,i){var r=t-n,a=e-i;return r*r+a*a}b.fromVectorTileJs=w,b.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var i in t)n[i]=new g(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return w({layers:n})},b.GeoJSONWrapper=x;var R=function(t){return t[0]},D=function(t){return t[1]},z=function(t,e,n,i,r){void 0===e&&(e=R),void 0===n&&(n=D),void 0===i&&(i=64),void 0===r&&(r=Float64Array),this.nodeSize=i,this.points=t;for(var a=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(t.length),s=this.coords=new r(2*t.length),u=0;u<t.length;u++)o[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,i,r,a,o){if(!(a-r<=i)){var s=r+a>>1;!function t(e,n,i,r,a,o){for(;a>r;){if(a-r>600){var s=a-r+1,u=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,i,Math.max(r,Math.floor(i-u*c/s+h)),Math.min(a,Math.floor(i+(s-u)*c/s+h)),o)}var p=n[2*i+o],f=r,d=a;for(P(e,n,r,i),n[2*a+o]>p&&P(e,n,r,a);f<d;){for(P(e,n,f,d),f++,d--;n[2*f+o]<p;)f++;for(;n[2*d+o]>p;)d--}n[2*r+o]===p?P(e,n,r,d):P(e,n,++d,a),d<=i&&(r=d+1),i<=d&&(a=d-1)}}(e,n,s,r,a,o%2),t(e,n,i,r,s-1,o+1),t(e,n,i,s+1,a,o+1)}}(o,s,i,0,o.length-1,0)};z.prototype.range=function(t,e,n,i){return function(t,e,n,i,r,a,o){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=o)for(var d=f;d<=p;d++)u=e[2*d+1],(s=e[2*d])>=n&&s<=r&&u>=i&&u<=a&&c.push(t[d]);else{var v=Math.floor((f+p)/2);u=e[2*v+1],(s=e[2*v])>=n&&s<=r&&u>=i&&u<=a&&c.push(t[v]);var m=(h+1)%2;(0===h?n<=s:i<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===h?r>=s:a>=u)&&(l.push(v+1),l.push(p),l.push(m))}}return c}(this.ids,this.coords,t,e,n,i,this.nodeSize)},z.prototype.within=function(t,e,n){return function(t,e,n,i,r,a){for(var o=[0,t.length-1,0],s=[],u=r*r;o.length;){var l=o.pop(),c=o.pop(),h=o.pop();if(c-h<=a)for(var p=h;p<=c;p++)L(e[2*p],e[2*p+1],n,i)<=u&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],v=e[2*f+1];L(d,v,n,i)<=u&&s.push(t[f]);var m=(l+1)%2;(0===l?n-r<=d:i-r<=v)&&(o.push(h),o.push(f-1),o.push(m)),(0===l?n+r>=d:i+r>=v)&&(o.push(f+1),o.push(c),o.push(m))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var O={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},F=function(t){this.options=H(Object.create(O),t),this.trees=new Array(this.options.maxZoom+1)};function N(t,e,n,i,r){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function B(t,e){var n=t.geometry.coordinates,i=n[1];return{x:U(n[0]),y:$(i),zoom:1/0,index:e,parentId:-1}}function j(t){return{type:"Feature",id:t.id,properties:V(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,i}function V(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return H(H({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function U(t){return t/360+.5}function $(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function H(t,e){for(var n in e)t[n]=e[n];return t}function q(t){return t.x}function W(t){return t.y}function G(t,e,n,i,r,a){var o=r-n,s=a-i;if(0!==o||0!==s){var u=((t-n)*o+(e-i)*s)/(o*o+s*s);u>1?(n=r,i=a):u>0&&(n+=o*u,i+=s*u)}return(o=t-n)*o+(s=e-i)*s}function Z(t,e,n,i){var r={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)X(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)X(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)X(t,e[i][r])}(r),r}function X(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Y(t,e,n,i){if(e.geometry){var r=e.geometry.coordinates,a=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=i||0),"Point"===a)K(r,s);else if("MultiPoint"===a)for(var l=0;l<r.length;l++)K(r[l],s);else if("LineString"===a)J(r,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(l=0;l<r.length;l++)J(r[l],s=[],o,!1),t.push(Z(u,"LineString",s,e.properties));return}Q(r,s,o,!1)}else if("Polygon"===a)Q(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(l=0;l<e.geometry.geometries.length;l++)Y(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<r.length;l++){var c=[];Q(r[l],c,o,!0),s.push(c)}}t.push(Z(u,a,s,e.properties))}}function K(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function J(t,e,n,i){for(var r,a,o=0,s=0;s<t.length;s++){var u=tt(t[s][0]),l=et(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(o+=i?(r*l-u*a)/2:Math.sqrt(Math.pow(u-r,2)+Math.pow(l-a,2))),r=u,a=l}var c=e.length-3;e[2]=1,function t(e,n,i,r){for(var a,o=r,s=i-n>>1,u=i-n,l=e[n],c=e[n+1],h=e[i],p=e[i+1],f=n+3;f<i;f+=3){var d=G(e[f],e[f+1],l,c,h,p);if(d>o)a=f,o=d;else if(d===o){var v=Math.abs(f-s);v<u&&(a=f,u=v)}}o>r&&(a-n>3&&t(e,n,a,r),e[a+2]=o,i-a>3&&t(e,a,i,r))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function Q(t,e,n,i){for(var r=0;r<t.length;r++){var a=[];J(t[r],a,n,i),e.push(a)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function nt(t,e,n,i,r,a,o,s){if(i/=e,a>=(n/=e)&&o<i)return t;if(o<n||a>=i)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===r?c.minX:c.minY,d=0===r?c.maxX:c.maxY;if(f>=n&&d<i)u.push(c);else if(!(d<n||f>=i)){var v=[];if("Point"===p||"MultiPoint"===p)it(h,v,n,i,r);else if("LineString"===p)rt(h,v,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===p)ot(h,v,n,i,r,!1);else if("Polygon"===p)ot(h,v,n,i,r,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var g=[];ot(h[m],g,n,i,r,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<v.length;m++)u.push(Z(c.id,p,v[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push(Z(c.id,p,v,c.tags))}}}return u.length?u:null}function it(t,e,n,i,r){for(var a=0;a<t.length;a+=3){var o=t[a+r];o>=n&&o<=i&&(e.push(t[a]),e.push(t[a+1]),e.push(t[a+2]))}}function rt(t,e,n,i,r,a,o){for(var s,u,l=at(t),c=0===r?ut:lt,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],v=t[p+2],m=t[p+3],g=t[p+4],y=0===r?f:d,_=0===r?m:g,b=!1;o&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-g,2))),y<n?_>n&&(u=c(l,f,d,m,g,n),o&&(l.start=h+s*u)):y>i?_<i&&(u=c(l,f,d,m,g,i),o&&(l.start=h+s*u)):st(l,f,d,v),_<n&&y>=n&&(u=c(l,f,d,m,g,n),b=!0),_>i&&y<=i&&(u=c(l,f,d,m,g,i),b=!0),!a&&b&&(o&&(l.end=h+s*u),e.push(l),l=at(t)),o&&(h+=s)}var x=t.length-3;f=t[x],d=t[x+1],v=t[x+2],(y=0===r?f:d)>=n&&y<=i&&st(l,f,d,v),x=l.length-3,a&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&st(l,l[0],l[1],l[2]),l.length&&e.push(l)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function ot(t,e,n,i,r,a){for(var o=0;o<t.length;o++)rt(t[o],e,n,i,r,a,!1)}function st(t,e,n,i){t.push(e),t.push(n),t.push(i)}function ut(t,e,n,i,r,a){var o=(a-e)/(i-e);return t.push(a),t.push(n+(r-n)*o),t.push(1),o}function lt(t,e,n,i,r,a){var o=(a-n)/(r-n);return t.push(e+(i-e)*o),t.push(a),t.push(1),o}function ct(t,e){for(var n=[],i=0;i<t.length;i++){var r,a=t[i],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=ht(a.geometry,e);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var s=0;s<a.geometry.length;s++)r.push(ht(a.geometry[s],e))}else if("MultiPolygon"===o)for(r=[],s=0;s<a.geometry.length;s++){for(var u=[],l=0;l<a.geometry[s].length;l++)u.push(ht(a.geometry[s][l],e));r.push(u)}n.push(Z(a.id,o,r,a.tags))}return n}function ht(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function pt(t,e){if(t.transformed)return t;var n,i,r,a=1<<t.z,o=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(i=0;i<l.length;i+=2)u.geometry.push(ft(l[i],l[i+1],e,a,o,s));else for(i=0;i<l.length;i++){var h=[];for(r=0;r<l[i].length;r+=2)h.push(ft(l[i][r],l[i][r+1],e,a,o,s));u.geometry.push(h)}}return t.transformed=!0,t}function ft(t,e,n,i,r,a){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-a))]}function dt(t,e,n,i,r){for(var a=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){o.numFeatures++,vt(o,t[s],a,r);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function vt(t,e,n,i){var r=e.geometry,a=e.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<r.length;s+=3)o.push(r[s]),o.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)mt(o,r,t,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<r.length;s++)mt(o,r[s],t,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var u=0;u<r.length;u++){var l=r[u];for(s=0;s<l.length;s++)mt(o,l[s],t,n,!0,0===s)}if(o.length){var c=e.tags||null;if("LineString"===a&&i.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=r.start/r.size,c.mapbox_clip_end=r.end/r.size}var p={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function mt(t,e,n,i,r,a){var o=i*i;if(i>0&&e.size<(r?o:i))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===i||e[u+2]>o)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,a=r-2;i<r;a=i,i+=2)n+=(t[i]-t[a])*(t[i+1]+t[a+1]);if(n>0===e)for(i=0,r=t.length;i<r/2;i+=2){var o=t[i],s=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=o,t[r-1-i]=s}}(s,a),t.push(s)}}function gt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)Y(n,t.features[i],e,i);else Y(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,i=t,r=nt(t,1,-1-n,n,0,-1,2,e),a=nt(t,1,1-n,2+n,0,-1,2,e);return(r||a)&&(i=nt(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=ct(r,1).concat(i)),a&&(i=i.concat(ct(a,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yt(t,e,n){return 32*((1<<t)*n+e)+t}function _t(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);var r=new v(i.features),a=b(r);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:r,rawData:a.buffer})}F.prototype.load=function(t){var e=this.options,n=e.log,i=e.minZoom,r=e.maxZoom,a=e.nodeSize;n&&console.time("total time");var o="prepare "+t.length+" points";n&&console.time(o),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(B(t[u],u));this.trees[r+1]=new z(s,q,W,a,Float32Array),n&&console.timeEnd(o);for(var l=r;l>=i;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new z(s,q,W,a,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},F.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){var o=this.getClusters([n,i,180,a],e),s=this.getClusters([-180,i,r,a],e);return o.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(U(n),$(a),U(r),$(i));c<h.length;c+=1){var p=u.points[h[c]];l.push(p.numPoints?j(p):this.points[p.index])}return l},F.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);var a=r.points[e];if(!a)throw new Error(i);for(var o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=r.within(a.x,a.y,o);u<l.length;u+=1){var c=r.points[l[u]];c.parentId===t&&s.push(c.numPoints?j(c):this.points[c.index])}if(0===s.length)throw new Error(i);return s},F.prototype.getLeaves=function(t,e,n){var i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i},F.prototype.getTile=function(t,e,n){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),a=this.options,o=a.radius/a.extent,s=(n-o)/r,u=(n+1+o)/r,l={features:[]};return this._addTileFeatures(i.range((e-o)/r,s,(e+1+o)/r,u),i.points,e,n,r,l),0===e&&this._addTileFeatures(i.range(1-o/r,s,1,u),i.points,r,n,r,l),e===r-1&&this._addTileFeatures(i.range(0,s,o/r,u),i.points,-1,n,r,l),l.features.length?l:null},F.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},F.prototype._appendLeaves=function(t,e,n,i,r){for(var a=0,o=this.getChildren(e);a<o.length;a+=1){var s=o[a],u=s.properties;if(u&&u.cluster?r+u.point_count<=i?r+=u.point_count:r=this._appendLeaves(t,u.cluster_id,n,i,r):r<i?r++:t.push(s),t.length===n)break}return r},F.prototype._addTileFeatures=function(t,e,n,i,r,a){for(var o=0,s=t;o<s.length;o+=1){var u=e[s[o]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*r-n)),Math.round(this.options.extent*(u.y*r-i))]],tags:l?V(u):this.points[u.index].properties},h=void 0;l?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(c.id=h),a.features.push(c)}},F.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},F.prototype._cluster=function(t,e){for(var n=[],i=this.options,r=i.reduce,a=i.minPoints,o=i.radius/(i.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var l=this.trees[e+1],c=l.within(u.x,u.y,o),h=u.numPoints||1,p=h,f=0,d=c;f<d.length;f+=1){var v=l.points[d[f]];v.zoom>e&&(p+=v.numPoints||1)}if(p>=a){for(var m=u.x*h,g=u.y*h,y=r&&h>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,b=0,x=c;b<x.length;b+=1){var w=l.points[x[b]];if(!(w.zoom<=e)){w.zoom=e;var S=w.numPoints||1;m+=w.x*S,g+=w.y*S,w.parentId=_,r&&(y||(y=this._map(u,!0)),r(y,this._map(w)))}}u.parentId=_,n.push(N(m/p,g/p,_,p,y))}else if(n.push(u),p>1)for(var k=0,M=c;k<M.length;k+=1){var T=l.points[M[k]];T.zoom<=e||(T.zoom=e,n.push(T))}}}return n},F.prototype._getOriginId=function(t){return t-this.points.length>>5},F.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},F.prototype._map=function(t,e){if(t.numPoints)return e?H({},t.properties):t.properties;var n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?H({},i):i},gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(t,e,n,i,r,a,o){for(var s=[t,e,n,i],u=this.options,l=u.debug;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=yt(e,n,i),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=dt(t,e,n,i,u),this.tileCoords.push({z:e,x:n,y:i}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,r){if(e===u.maxZoom||e===r)continue;var d=1<<r-e;if(n!==Math.floor(a/d)||i!==Math.floor(o/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var v,m,g,y,_,b,x=.5*u.buffer/u.extent,w=.5-x,S=.5+x,k=1+x;v=m=g=y=null,_=nt(t,c,n-x,n+S,0,p.minX,p.maxX,u),b=nt(t,c,n+w,n+k,0,p.minX,p.maxX,u),t=null,_&&(v=nt(_,c,i-x,i+S,1,p.minY,p.maxY,u),m=nt(_,c,i+w,i+k,1,p.minY,p.maxY,u),_=null),b&&(g=nt(b,c,i-x,i+S,1,p.minY,p.maxY,u),y=nt(b,c,i+w,i+k,1,p.minY,p.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*n,2*i),s.push(m||[],e+1,2*n,2*i+1),s.push(g||[],e+1,2*n+1,2*i),s.push(y||[],e+1,2*n+1,2*i+1)}}},gt.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,a=i.debug;if(t<0||t>24)return null;var o=1<<t,s=yt(t,e=(e%o+o)%o,n);if(this.tiles[s])return pt(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[yt(l,c,h)];return u&&u.source?(a>1&&console.log("found parent tile z%d-%d-%d",l,c,h),a>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?pt(this.tiles[s],r):null):null};var bt=function(e){function n(t,n,i,r){e.call(this,t,n,i,_t),r&&(this.loadGeoJSON=r)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var r=!!(i&&i.request&&i.request.collectResourceTiming)&&new t.RequestPerformance(i.request);this.loadGeoJSON(i,(function(a,o){if(a||!o)return n(a);if("object"!=typeof o)return n(new Error("Input data given to '"+i.source+"' is not a valid GeoJSON object."));!function t(e,n){var i,r=e&&e.type;if("FeatureCollection"===r)for(i=0;i<e.features.length;i++)t(e.features[i],n);else if("GeometryCollection"===r)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],n);else if("Feature"===r)t(e.geometry,n);else if("Polygon"===r)h(e.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<e.coordinates.length;i++)h(e.coordinates[i],n);return e}(o,!0);try{if(i.filter){var s=t.createExpression(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var u=o.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));o={type:"FeatureCollection",features:u}}e._geoJSONIndex=i.cluster?new F(function(e){var n=e.superclusterOptions,i=e.clusterProperties;if(!i||!n)return n;for(var r={},a={},o={accumulated:null,zoom:0},s={properties:null},u=Object.keys(i),l=0,c=u;l<c.length;l+=1){var h=c[l],p=i[h],f=p[0],d=t.createExpression(p[1]),v=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);r[h]=d.value,a[h]=v.value}return n.map=function(t){s.properties=t;for(var e={},n=0,i=u;n<i.length;n+=1){var a=i[n];e[a]=r[a].evaluate(o,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,i=u;n<i.length;n+=1){var r=i[n];o.accumulated=t[r],t[r]=a[r].evaluate(o,s)}},n}(i)).load(o.features):function(t,e){return new gt(t,e)}(o,i.geojsonVtOptions)}catch(a){return n(a)}e.loaded={};var l={};if(r){var c=r.finish();c&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(c)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var i=this.loaded;return i&&i[t.uid]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},n}(u),xt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:u,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return xt.prototype.setReferrer=function(t,e){this.referrer=e},xt.prototype.setImages=function(t,e,n){for(var i in this.availableImages[t]=e,this.workerSources[t]){var r=this.workerSources[t][i];for(var a in r)r[a].availableImages=e}n()},xt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},xt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},xt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},xt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},xt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},xt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},xt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},xt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},xt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}},xt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},xt.prototype.syncRTLPluginState=function(e,n,i){try{t.plugin.setState(n);var r=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=r){this.self.importScripts(r);var a=t.plugin.isParsed();i(a?void 0:new Error("RTL Text Plugin failed to import scripts from "+r),a)}}catch(t){i(t.toString())}},xt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},xt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},xt.prototype.getWorkerSource=function(t,e,n){var i=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:function(e,n,r){i.actor.send(e,n,r,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]},xt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},xt.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt})),i(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!n(t)}function n(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===i[n=t&&t.failIfMajorPerformanceCaveat]&&(i[n]=function(t){var n=function(t){var n=document.createElement("canvas"),i=Object.create(e.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",i)||n.probablySupportsContext("experimental-webgl",i):n.supportsContext?n.supportsContext("webgl",i)||n.supportsContext("experimental-webgl",i):n.getContext("webgl",i)||n.getContext("experimental-webgl",i)}(t);if(!n)return!1;var i=n.createShader(n.VERTEX_SHADER);return!(!i||n.isContextLost())&&(n.shaderSource(i,"void main() {}"),n.compileShader(i),!0===n.getShaderParameter(i,n.COMPILE_STATUS))}(n)),i[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=n);var i={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,i){var r=t.window.document.createElement(e);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},i=t.window.document&&t.window.document.documentElement.style;function r(t){if(!i)return t[0];for(var e=0;e<t.length;e++)if(t[e]in i)return t[e];return t[0]}var a,o=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){i&&o&&(a=i[o],i[o]="none")},n.enableDrag=function(){i&&o&&(i[o]=a)};var s=r(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}n.addEventListener=function(t,e,n,i){void 0===i&&(i={}),t.addEventListener(e,n,"passive"in i&&u?i:i.capture)},n.removeEventListener=function(t,e,n,i){void 0===i&&(i={}),t.removeEventListener(e,n,"passive"in i&&u?i:i.capture)};var c=function e(n){n.preventDefault(),n.stopPropagation(),t.window.removeEventListener("click",e,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(e,n){var i=e.getBoundingClientRect();return new t.Point(n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop)},n.touchPos=function(e,n){for(var i=e.getBoundingClientRect(),r=[],a=0;a<n.length;a++)r.push(new t.Point(n[a].clientX-i.left-e.clientLeft,n[a].clientY-i.top-e.clientTop));return r},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var i=n[e];this._notify(i.ids,i.callback)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),i=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),i=!1),i},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,i=0,r=t;i<r.length;i+=1){var a=r[i];if(a[0]<n||a[1]<a[0]||e<a[1])return!1;n=a[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var i=0,r=t;i<r.length;i+=1)this.images[r[i]]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var i={},r=0,a=e;r<a.length;r+=1){var o=a[r];this.images[o]||this.fire(new t.Event("styleimagemissing",{id:o}));var s=this.images[o];s?i[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,i)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{var r={w:i.data.width+2,h:i.data.height+2,x:0,y:0},a=new t.ImagePosition(r,i);this.patterns[e]={bin:r,position:a}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var i=t.potpack(e),r=i.w,a=i.h,o=this.atlasImage;for(var s in o.resize({width:r||1,height:a||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c},{width:p,height:f}),t.RGBAImage.copy(h,o,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),t.RGBAImage.copy(h,o,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(!this.callbackDispatchedThisFrame[i]){this.callbackDispatchedThisFrame[i]=!0;var r=this.images[i];h(r)&&this.updateImage(i,r)}}},n}(t.Evented),f=m,d=m,v=1e20;function m(t,e,n,i,r,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(t,e,n,i,r,a,o){for(var s=0;s<e;s++){for(var u=0;u<n;u++)i[u]=t[u*e+s];for(y(i,r,a,o,n),u=0;u<n;u++)t[u*e+s]=r[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)i[s]=t[u*e+s];for(y(i,r,a,o,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(r[s])}}function y(t,e,n,i,r){n[0]=0,i[0]=-v,i[1]=+v;for(var a=1,o=0;a<r;a++){for(var s=(t[a]+a*a-(t[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);s<=i[o];)o--,s=(t[a]+a*a-(t[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);n[++o]=a,i[o]=s,i[o+1]=+v}for(a=0,o=0;a<r;a++){for(;i[o+1]<a;)o++;e[a]=(a-n[o])*(a-n[o])+t[n[o]]}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var r=e.data[4*i+3]/255;this.gridOuter[i]=1===r?0:0===r?v:Math.pow(Math.max(0,.5-r),2),this.gridInner[i]=1===r?v:0===r?0:Math.pow(Math.max(0,r-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++)n[i]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[i]-this.gridInner[i])/this.radius+this.cutoff))));return n},f.default=d;var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,n){var i=this,r=[];for(var a in e)for(var o=0,s=e[a];o<s.length;o+=1)r.push({stack:a,id:s[o]});t.asyncAll(r,(function(t,e){var n=t.stack,r=t.id,a=i.entries[n];a||(a=i.entries[n]={glyphs:{},requests:{},ranges:{}});var o=a.glyphs[r];if(void 0===o){if(o=i._tinySDF(a,n,r))return a.glyphs[r]=o,void e(null,{stack:n,id:r,glyph:o});var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(a.ranges[s])e(null,{stack:n,id:r,glyph:o});else{var u=a.requests[s];u||(u=a.requests[s]=[],_.loadGlyphRange(n,s,i.url,i.requestManager,(function(t,e){if(e){for(var n in e)i._doesCharSupportLocalGlyph(+n)||(a.glyphs[+n]=e[+n]);a.ranges[s]=!0}for(var r=0,o=u;r<o.length;r+=1)(0,o[r])(t,e);delete a.requests[s]}))),u.push((function(t,i){t?e(t):i&&e(null,{stack:n,id:r,glyph:i[r]||null})}))}}else e(null,{stack:n,id:r,glyph:o})}),(function(t,e){if(t)n(t);else if(e){for(var i={},r=0,a=e;r<a.length;r+=1){var o=a[r],s=o.stack,u=o.id,l=o.glyph;(i[s]||(i[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,i)}}))},_.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},_.prototype._tinySDF=function(e,n,i){var r=this.localIdeographFontFamily;if(r&&this._doesCharSupportLocalGlyph(i)){var a=e.tinySDF;if(!a){var o="400";/bold/i.test(n)?o="900":/medium/i.test(n)?o="500":/light/i.test(n)&&(o="200"),a=e.tinySDF=new _.TinySDF(24,3,8,.25,r,o)}return{id:i,bitmap:new t.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,n,i,r,a){var o=256*n,s=o+255,u=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",o+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)a(e);else if(n){for(var i={},r=0,o=t.parseGlyphPBF(n);r<o.length;r+=1){var s=o[r];i[s.id]=s}a(null,i)}}))},_.TinySDF=f;var b=function(){this.specification=t.styleSpec.light.position};b.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},b.prototype.interpolate=function(e,n,i){return{x:t.number(e.x,n.x,i),y:t.number(e.y,n.y,i),z:t.number(e.z,n.z,i)}};var x=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new b,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(x),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var i in e){var r=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),r):this._transitionable.setValue(i,r)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),S=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};S.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]},S.prototype.getDashRanges=function(t,e,n){var i=[],r=t.length%2==1?-t[t.length-1]*n:0,a=t[0]*n,o=!0;i.push({left:r,right:a,isDash:o,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var l=t[u];i.push({left:r=s*n,right:a=(s+=l)*n,isDash:o=!o,zeroLength:0===l})}return i},S.prototype.addRoundDash=function(t,e,n){for(var i=e/2,r=-n;r<=n;r++)for(var a=this.width*(this.nextRow+n+r),o=0,s=t[o],u=0;u<this.width;u++){u/s.right>1&&(s=t[++o]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),p=void 0,f=r/n*(i+1);if(s.isDash){var d=i-Math.abs(f);p=Math.sqrt(h*h+d*d)}else p=i-Math.sqrt(h*h+f*f);this.data[a+u]=Math.max(0,Math.min(255,p+128))}},S.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var n=t[e],i=t[e+1];n.zeroLength?t.splice(e,1):i&&i.isDash===n.isDash&&(i.left=n.left,t.splice(e,1))}var r=t[0],a=t[t.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);for(var o=this.width*this.nextRow,s=0,u=t[s],l=0;l<this.width;l++){l/u.right>1&&(u=t[++s]);var c=Math.abs(l-u.left),h=Math.abs(l-u.right),p=Math.min(c,h);this.data[o+l]=Math.max(0,Math.min(255,(u.isDash?p:-p)+128))}},S.prototype.addDash=function(e,n){var i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var a=0,o=0;o<e.length;o++)a+=e[o];if(0!==a){var s=this.width/a,u=this.getDashRanges(e,this.width,s);n?this.addRoundDash(u,s,i):this.addRegularDash(u)}var l={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:a};return this.nextRow+=r,this.dirty=!0,l},S.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var k=function e(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var r=this.workerPool.acquire(this.id),a=0;a<r.length;a++){var o=new e.Actor(r[a],i,this.id);o.name="Worker "+a,this.actors.push(o)}};function M(e,n,i){var r=function(r,a){if(r)return i(r);if(a){var o=t.pick(t.extend(a,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(t){return t.id}))),o.tiles=n.canonicalizeTileset(o,e.url),i(null,o)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.browser.frame((function(){return r(null,e)}))}k.prototype.broadcast=function(e,n,i){t.asyncAll(this.actors,(function(t,i){t.send(e,n,i)}),i=i||function(){})},k.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},k.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},k.Actor=t.Actor;var T=function(e,n,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24};T.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},T.prototype.contains=function(e){var n=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=i&&e.x<a&&e.y>=r&&e.y<o};var E=function(e){function n(n,i,r,a){if(e.call(this),this.id=n,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(i,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=M(this._options,this.map._requestManager,(function(n,i){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new T(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},n.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(i,r){return delete e.request,e.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",r,a.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,a.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),C=function(e){function n(n,i,r,a){e.call(this),this.id=n,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=M(this._options,this.map._requestManager,(function(n,i){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new T(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var i=this,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(function(r,a){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(a){i.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=i.map.painter.context,s=o.gl;e.texture=i.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.Texture(o,a,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(i.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),I=function(e){function n(n,i,r,a){e.call(this,n,i,r,a),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function r(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,a){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(a){this.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=t.window.ImageBitmap&&a instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?a:t.browser.getImageData(a,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,r.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,a=0===n.x?e.wrap-1:e.wrap,o=(n.x+1+i)%i,s=n.x+1===i?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,a,n.z,r,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,a,n.z,r,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(u[new t.OverscaledTileID(e.overscaledZ,a,n.z,r,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(C),P=function(e){function n(n,i,r,a){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(a),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;var o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.EXTENT,radius:(i.clusterRadius||50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var i={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",i))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var i={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(i.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",i))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},i),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var i=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(t.browser.resolveURL(r),t.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.actor.send(this.type+".loadData",i,(function(t,r){n._removed||r&&r.abandoned||(n._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[n.id]&&(n._resourceTiming=r.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:i.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var i=this,r=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(r,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,a){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(a,i.map.painter,"reloadTile"===r),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),A=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),L=function(e){function n(t,n,i,r){e.call(this),this.id=t,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(e,n){var i=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(r,a){i._loaded=!0,r?i.fire(new t.ErrorEvent(r)):a&&(i.image=a,e&&(i.coordinates=e),n&&n(),i._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var i=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,i=1/0,r=-1/0,a=-1/0,o=0,s=e;o<s.length;o+=1){var u=s[o];n=Math.min(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.x),a=Math.max(a,u.y)}var l=Math.max(r-n,a-i),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((n+r)/2*h),Math.floor((i+a)/2*h))}(i),this.minzoom=this.maxzoom=this.tileID.z;var r=i.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,A.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),R=function(e){function n(t,n,i,r){e.call(this,t,n,i,r),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var i=0,r=n.urls;i<r.length;i+=1)this.urls.push(this.map._requestManager.transformRequest(r[i],t.ResourceType.Source).url);t.getVideo(this.urls,(function(n,i){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):i&&(e.video=i,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,A.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(L),D=function(e){function n(n,i,r,a){e.call(this,n,i,r,a),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,i=n.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,A.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,i.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[r];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(L),z={vector:E,raster:C,"raster-dem":I,geojson:P,video:R,image:L,canvas:D};function O(e,n){var i=t.identity([]);return t.translate(i,i,[1,1,0]),t.scale(i,i,[.5*e.width,.5*e.height,1]),t.multiply(i,i,e.calculatePosMatrix(n.toUnwrapped()))}function F(t,e,n,i,r,a){var o=function(t,e,n){if(t)for(var i=0,r=t;i<r.length;i+=1){var a=e[r[i]];if(a&&a.source===n&&"fill-extrusion"===a.type)return!0}else for(var o in e){var s=e[o];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(r&&r.layers,e,t.id),s=a.maxPitchScaleFactor(),u=t.tilesIn(i,s,o);u.sort(N);for(var l=[],c=0,h=u;c<h.length;c+=1){var p=h[c];l.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,n,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,r,a,s,O(t.transform,p.tileID))})}var f=function(t){for(var e={},n={},i=0,r=t;i<r.length;i+=1){var a=r[i],o=a.queryResults,s=a.wrappedTileID,u=n[s]=n[s]||{};for(var l in o)for(var c=o[l],h=u[l]=u[l]||{},p=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var v=d[f];h[v.featureIndex]||(h[v.featureIndex]=!0,p.push(v))}}return e}(l);for(var d in f)f[d].forEach((function(e){var n=e.feature,i=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}));return f}function N(t,e){var n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}var B=function(t,e){this.max=t,this.onRemove=e,this.reset()};B.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var i=n[e];i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value)}return this.data={},this.order=[],this},B.prototype.add=function(t,e,n){var i=this,r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);var a={value:e,timeout:void 0};if(void 0!==n&&(a.timeout=setTimeout((function(){i.remove(t,a)}),n)),this.data[r].push(a),this.order.push(r),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},B.prototype.has=function(t){return t.wrapped().key in this.data},B.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},B.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},B.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},B.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},B.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this},B.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},B.prototype.filter=function(t){var e=[];for(var n in this.data)for(var i=0,r=this.data[n];i<r.length;i+=1){var a=r[i];t(a.value)||e.push(a)}for(var o=0,s=e;o<s.length;o+=1){var u=s[o];this.remove(u.value.tileID,u)}};var j=function(t,e,n){this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},U=function(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var i=e.attributes[this.attributes[n].name];void 0!==i&&t.enableVertexAttribArray(i)}},U.prototype.setVertexAttribPointers=function(t,e,n){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],a=e.attributes[r.name];void 0!==a&&t.vertexAttribPointer(a,r.components,t[V[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}},U.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var $=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};$.prototype.get=function(){return this.current},$.prototype.set=function(t){},$.prototype.getDefault=function(){return this.default},$.prototype.setDefault=function(){this.set(this.default)};var H=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}($),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}($),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}($),G=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}($),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}($),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}($),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}($),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}($),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}($),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}($),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}($),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}($),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}($),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}($),rt=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}($),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}($),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}($),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}($),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}($),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}($),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}($),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}($),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}($),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}($),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}($),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}($),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}($),gt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}($),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}($),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}($),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}($),xt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}($),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(xt),St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(xt),kt=function(t,e,n,i){this.context=t,this.width=e,this.height=n;var r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,r),i&&(this.depthAttachment=new St(t,r))};kt.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}t.deleteFramebuffer(this.framebuffer)};var Mt=function(t,e,n){this.func=t,this.mask=e,this.range=n};Mt.ReadOnly=!1,Mt.ReadWrite=!0,Mt.disabled=new Mt(519,Mt.ReadOnly,[0,1]);var Tt=function(t,e,n,i,r,a){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=a};Tt.disabled=new Tt({func:519,mask:0},0,0,7680,7680,7680);var Et=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Et.disabled=new Et(Et.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Et.unblended=new Et(Et.Replace,t.Color.transparent,[!0,!0,!0,!0]),Et.alphaBlended=new Et([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Ct=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};Ct.disabled=new Ct(!1,1029,2305),Ct.backCCW=new Ct(!0,1029,2305);var It=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new H(this),this.clearDepth=new q(this),this.clearStencil=new W(this),this.colorMask=new G(this),this.depthMask=new Z(this),this.stencilMask=new X(this),this.stencilFunc=new Y(this),this.stencilOp=new K(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new nt(this),this.blendFunc=new it(this),this.blendColor=new rt(this),this.blendEquation=new at(this),this.cullFace=new ot(this),this.cullFaceSide=new st(this),this.frontFace=new ut(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new ft(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new vt(this),this.bindElementBuffer=new mt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gt(this),this.pixelStoreUnpack=new yt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};It.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},It.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},It.prototype.createIndexBuffer=function(t,e){return new j(this,t,e)},It.prototype.createVertexBuffer=function(t,e,n){return new U(this,t,e,n)},It.prototype.createRenderbuffer=function(t,e,n){var i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r},It.prototype.createFramebuffer=function(t,e,n){return new kt(this,t,e,n)},It.prototype.clear=function(t){var e=t.color,n=t.depth,i=this.gl,r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),i.clear(r)},It.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},It.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},It.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},It.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Et.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},It.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Pt=function(e){function n(n,i,r){var a=this;e.call(this),this.id=n,this.dispatcher=r,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform))})),this.on("error",(function(){a._sourceErrored=!0})),this._source=function(e,n,i,r){var a=new z[n.type](e,n,i,r);if(a.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+a.id);return t.bindAll(["load","abort","unload","serialize","prepare"],a),a}(n,i,r,this),this._tiles={},this._cache=new B(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(At).map((function(t){return t.key}))},n.prototype.getRenderableIds=function(e){var n=this,i=[];for(var r in this._tiles)this._isIdRenderable(r,e)&&i.push(this._tiles[r]);return e?i.sort((function(e,i){var r=e.tileID,a=i.tileID,o=new t.Point(r.canonical.x,r.canonical.y)._rotate(n.transform.angle),s=new t.Point(a.canonical.x,a.canonical.y)._rotate(n.transform.angle);return r.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x})).map((function(t){return t.tileID.key})):i.map((function(t){return t.tileID})).sort(At).map((function(t){return t.key}))},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,i,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new t.ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var i=e[n];if(t.neighboringTiles&&t.neighboringTiles[i]){var r=this.getTileByID(i);a(t,r),a(r,t)}}function a(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,i){for(var r in this._tiles){var a=this._tiles[r];if(!(i[r]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>n)){for(var o=a.tileID;a&&a.tileID.overscaledZ>e+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var u=o;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){i[o.key]=o;break}}}},n.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(var i=t.overscaledZ-1;i>=e;i--){var r=t.scaledTo(i),a=this._getLoadedTile(r);if(a)return a}},n.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},n.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,i=Math.floor(e*n*5),r="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(r)},n.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var n={};for(var i in this._tiles){var r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),n[r.tileID.key]=r}for(var a in this._tiles=n,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}},n.prototype.update=function(e){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter((function(t){return i._source.hasTile(t)})))):r=[];var a=e.coveringZoomLevel(this._source),o=Math.max(a-n.maxOverzooming,this._source.minzoom),s=Math.max(a+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(r,a);if(Lt(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],v=this._tiles[f];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(d,o);m&&(this._addTile(m.tileID),l[m.tileID.key]=m.tileID),c[f]=d}}for(var g in this._retainLoadedChildren(c,a,s,u),l)u[g]||(this._coveredTiles[g]=!0,u[g]=l[g])}for(var y in u)this._tiles[y].clearFadeHold();for(var _=0,b=t.keysDifference(this._tiles,u);_<b.length;_+=1){var x=b[_],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var i={},r={},a=Math.max(e-n.maxOverzooming,this._source.minzoom),o=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);i[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,o,i);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],v=this._tiles[d.key];if(!v.hasData()){if(e+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){i[m.key]=m;continue}}else{var y=d.children(this._source.maxzoom);if(i[y[0].key]&&i[y[1].key]&&i[y[2].key]&&i[y[3].key])continue}for(var _=v.wasRequested(),b=d.overscaledZ-1;b>=a;--b){var x=d.scaledTo(b);if(r[x.key])break;if(r[x.key]=!0,!(v=this.getTile(x))&&_&&(v=this._addTile(x)),v&&(i[x.key]=x,_=v.wasRequested(),v.hasData()))break}}}return i},n.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],n=void 0,i=this._tiles[t].tileID;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}e.push(i.key);var r=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(r))break;i=r}for(var a=0,o=e;a<o.length;a+=1)this._loadedParentTiles[o[a]]=n}},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var i=Boolean(n);return i||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),i))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,i){var r=this,a=[],o=this.transform;if(!o)return a;for(var s=i?o.getCameraQueryGeometry(e):e,u=e.map((function(t){return o.pointCoordinate(t)})),l=s.map((function(t){return o.pointCoordinate(t)})),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,v=0,m=l;v<m.length;v+=1){var g=m[v];h=Math.min(h,g.x),p=Math.min(p,g.y),f=Math.max(f,g.x),d=Math.max(d,g.y)}for(var y=function(e){var i=r._tiles[c[e]];if(!i.holdingForFade()){var s=i.tileID,v=Math.pow(2,o.zoom-i.tileID.overscaledZ),m=n*i.queryPadding*t.EXTENT/i.tileSize/v,g=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(g[0].x-m<t.EXTENT&&g[0].y-m<t.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){var y=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));a.push({tile:i,tileID:s,queryGeometry:y,cameraQueryGeometry:_,scale:v})}}},_=0;_<c.length;_++)y(_);return a},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),i=0,r=n;i<r.length;i+=1){var a=r[i];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Lt(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)},n.prototype.removeFeatureState=function(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)},n.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},n.prototype.setDependencies=function(t,e,n){var i=this._tiles[t];i&&i.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function At(t,e){var n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Lt(t){return"raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(Xr.workerUrl)}Pt.maxOverzooming=10,Pt.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",zt=function(){this.active={}};zt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<zt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},zt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},zt.prototype.isPreloaded=function(){return!!this.active[Dt]},zt.prototype.numActive=function(){return Object.keys(this.active).length};var Ot,Ft=Math.floor(t.browser.hardwareConcurrency/2);function Nt(){return Ot||(Ot=new zt),Ot}function Bt(e,n){var i={};for(var r in e)"ref"!==r&&(i[r]=e[r]);return t.refProperties.forEach((function(t){t in n&&(i[t]=n[t])})),i}function jt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Bt(t[i],e[t[i].ref]));return t}zt.workerCount=Math.max(Math.min(Ft,6),1);var Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ut(t,e,n){n.push({command:Vt.addSource,args:[t,e[t]]})}function $t(t,e,n){e.push({command:Vt.removeSource,args:[t]}),n[t]=!0}function Ht(t,e,n,i){$t(t,n,i),Ut(t,e,n)}function qt(e,n,i){var r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[i][r],n[i][r]))return!1;return!0}function Wt(e,n,i,r,a,o){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||i.push({command:o,args:[r,s,n[s],a]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||i.push({command:o,args:[r,s,n[s],a]}))}function Gt(t){return t.id}function Zt(t,e){return t[e.id]=e,t}var Xt=function(t,e){this.reset(t,e)};Xt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Xt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var n=1,i=this._distances[n],r=e*this.paddedLength+this.padding;i<r&&n<this._distances.length;)i=this._distances[++n];var a=n-1,o=this._distances[a],s=i-o,u=s>0?(r-o)/s:0;return this.points[a].mult(1-u).add(this.points[n].mult(u))};var Yt=function(t,e,n){var i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Kt(e,n,i,r,a){var o=t.create();return n?(t.scale(o,o,[1/a,1/a,1]),i||t.rotateZ(o,o,r.angle)):t.multiply(o,r.labelPlaneMatrix,e),o}function Jt(e,n,i,r,a){if(n){var o=t.clone(e);return t.scale(o,o,[a,a,1]),i||t.rotateZ(o,o,-r.angle),o}return r.glCoordMatrix}function Qt(e,n){var i=[e.x,e.y,0,1];ce(i,i,n);var r=i[3];return{point:new t.Point(i[0]/r,i[1]/r),signedDistanceFromCamera:r}}function te(t,e){return.5+t/e*.5}function ee(t,e){var n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function ne(e,n,i,r,a,o,s,u){var l=r?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,i.transform.zoom),h=[256/i.width*2+1,256/i.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=i.transform.width/i.transform.height,m=!1,g=0;g<d.length;g++){var y=d.get(g);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!m)le(y.numGlyphs,p);else{m=!1;var _=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(_,_,n),ee(_,h)){var b=te(i.transform.cameraToCenterDistance,_[3]),x=t.evaluateSizeForFeature(l,c,y),w=s?x/b:x*b,S=new t.Point(y.anchorX,y.anchorY),k=Qt(S,a).point,M={},T=ae(y,w,!1,u,n,a,o,e.glyphOffsetArray,f,p,k,S,M,v);m=T.useVertical,(T.notEnoughRoom||m||T.needsFlipping&&ae(y,w,!0,u,n,a,o,e.glyphOffsetArray,f,p,k,S,M,v).notEnoughRoom)&&le(y.numGlyphs,p)}else le(y.numGlyphs,p)}}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function ie(t,e,n,i,r,a,o,s,u,l,c){var h=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),v=e.getoffsetX(h-1),m=se(t*d,n,i,r,a,o,s.segment,p,f,u,l,c);if(!m)return null;var g=se(t*v,n,i,r,a,o,s.segment,p,f,u,l,c);return g?{first:m,last:g}:null}function re(e,n,i,r){return e===t.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function ae(e,n,i,r,a,o,s,u,l,c,h,p,f,d){var v,m=n/24,g=e.lineOffsetX*m,y=e.lineOffsetY*m;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=ie(m,u,g,y,i,h,p,e,l,o,f);if(!w)return{notEnoughRoom:!0};var S=Qt(w.first.point,s).point,k=Qt(w.last.point,s).point;if(r&&!i){var M=re(e.writingMode,S,k,d);if(M)return M}v=[w.first];for(var T=e.glyphStartIndex+1;T<_-1;T++)v.push(se(m*u.getoffsetX(T),g,y,i,h,p,e.segment,b,x,l,o,f));v.push(w.last)}else{if(r&&!i){var E=Qt(p,a).point,C=e.lineStartIndex+e.segment+1,I=new t.Point(l.getx(C),l.gety(C)),P=Qt(I,a),A=P.signedDistanceFromCamera>0?P.point:oe(p,I,E,1,a),L=re(e.writingMode,E,A,d);if(L)return L}var R=se(m*u.getoffsetX(e.glyphStartIndex),g,y,i,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,o,f);if(!R)return{notEnoughRoom:!0};v=[R]}for(var D=0,z=v;D<z.length;D+=1){var O=z[D];t.addDynamicAttributes(c,O.point,O.angle)}return{}}function oe(t,e,n,i,r){var a=Qt(t.add(t.sub(e)._unit()),r).point,o=n.sub(a);return n.add(o._mult(i/o.mag()))}function se(e,n,i,r,a,o,s,u,l,c,h,p){var f=r?e-n:e+n,d=f>0?1:-1,v=0;r&&(d*=-1,v=Math.PI),d<0&&(v+=Math.PI);for(var m=d>0?u+s:u+s+1,g=a,y=a,_=0,b=0,x=Math.abs(f),w=[];_+b<=x;){if((m+=d)<u||m>=l)return null;if(y=g,w.push(g),void 0===(g=p[m])){var S=new t.Point(c.getx(m),c.gety(m)),k=Qt(S,h);if(k.signedDistanceFromCamera>0)g=p[m]=k.point;else{var M=m-d;g=oe(0===_?o:new t.Point(c.getx(M),c.gety(M)),S,y,x-_+1,h)}}_+=b,b=y.dist(g)}var T=(x-_)/b,E=g.sub(y),C=E.mult(T)._add(y);C._add(E._unit()._perp()._mult(i*d));var I=v+Math.atan2(g.y-y.y,g.x-y.x);return w.push(C),{point:C,angle:I,path:w}}Yt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Yt.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},Yt.prototype.insertCircle=function(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)},Yt.prototype._insertBoxCell=function(t,e,n,i,r,a){this.boxCells[r].push(a)},Yt.prototype._insertCircleCell=function(t,e,n,i,r,a){this.circleCells[r].push(a)},Yt.prototype._query=function(t,e,n,i,r,a){if(n<0||t>this.width||i<0||e>this.height)return!r&&[];var o=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];o.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return a?o.filter(a):o}return this._forEachCell(t,e,n,i,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},a),r?o.length>0:o},Yt.prototype._queryCircle=function(t,e,n,i,r){var a=t-n,o=t+n,s=e-n,u=e+n;if(o<0||a>this.width||u<0||s>this.height)return!i&&[];var l=[];return this._forEachCell(a,s,o,u,this._queryCellCircle,l,{hitTest:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},r),i?l.length>0:l},Yt.prototype.query=function(t,e,n,i,r){return this._query(t,e,n,i,!1,r)},Yt.prototype.hitTest=function(t,e,n,i,r){return this._query(t,e,n,i,!0,r)},Yt.prototype.hitTestCircle=function(t,e,n,i){return this._queryCircle(t,e,n,!0,i)},Yt.prototype._queryCell=function(t,e,n,i,r,a,o,s){var u=o.seenUids,l=this.boxCells[r];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&n>=c[d+0]&&i>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var v=this.circleCells[r];if(null!==v)for(var m=this.circles,g=0,y=v;g<y.length;g+=1){var _=y[g];if(!u.circle[_]){u.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(m[b],m[b+1],m[b+2],t,e,n,i)&&(!s||s(this.circleKeys[_]))){if(o.hitTest)return a.push(!0),!0;var x=m[b],w=m[b+1],S=m[b+2];a.push({key:this.circleKeys[_],x1:x-S,y1:w-S,x2:x+S,y2:w+S})}}}},Yt.prototype._queryCellCircle=function(t,e,n,i,r,a,o,s){var u=o.circle,l=o.seenUids,c=this.boxCells[r];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[v+0],h[v+1],h[v+2],h[v+3])&&(!s||s(this.boxKeys[d])))return a.push(!0),!0}}var m=this.circleCells[r];if(null!==m)for(var g=this.circles,y=0,_=m;y<_.length;y+=1){var b=_[y];if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circlesCollide(g[x],g[x+1],g[x+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[b])))return a.push(!0),!0}}},Yt.prototype._forEachCell=function(t,e,n,i,r,a,o,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i),p=u;p<=c;p++)for(var f=l;f<=h;f++)if(r.call(this,t,e,n,i,this.xCellCount*f+p,a,o,s))return},Yt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Yt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Yt.prototype._circlesCollide=function(t,e,n,i,r,a){var o=i-t,s=r-e,u=n+a;return u*u>o*o+s*s},Yt.prototype._circleAndRectCollide=function(t,e,n,i,r,a,o){var s=(a-i)/2,u=Math.abs(t-(i+s));if(u>s+n)return!1;var l=(o-r)/2,c=Math.abs(e-(r+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=n*n};var ue=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(t,e){for(var n=0;n<t;n++){var i=e.length;e.resize(i+4),e.float32.set(ue,3*i)}}function ce(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}var he=function(t,e,n){void 0===e&&(e=new Yt(t.width+200,t.height+200,25)),void 0===n&&(n=new Yt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,n,i){return n*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}he.prototype.placeCollisionBox=function(t,e,n,i,r){var a=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),o=n*a.perspectiveRatio,s=t.x1*o+a.point.x,u=t.y1*o+a.point.y,l=t.x2*o+a.point.x,c=t.y2*o+a.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,r)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},he.prototype.placeCollisionCircles=function(e,n,i,r,a,o,s,u,l,c,h,p,f){var d=[],v=new t.Point(n.anchorX,n.anchorY),m=Qt(v,o),g=te(this.transform.cameraToCenterDistance,m.signedDistanceFromCamera),y=(c?a/g:a*g)/t.ONE_EM,_=Qt(v,s).point,b=ie(y,r,n.lineOffsetX*y,n.lineOffsetY*y,!1,_,v,n,i,s,{}),x=!1,w=!1,S=!0;if(b){for(var k=.5*p*g+f,M=new t.Point(-100,-100),T=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),E=new Xt,C=b.first,I=b.last,P=[],A=C.path.length-1;A>=1;A--)P.push(C.path[A]);for(var L=1;L<I.path.length;L++)P.push(I.path[L]);var R=2.5*k;if(u){var D=P.map((function(t){return Qt(t,u)}));P=D.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:D.map((function(t){return t.point}))}var z=[];if(P.length>0){for(var O=P[0].clone(),F=P[0].clone(),N=1;N<P.length;N++)O.x=Math.min(O.x,P[N].x),O.y=Math.min(O.y,P[N].y),F.x=Math.max(F.x,P[N].x),F.y=Math.max(F.y,P[N].y);z=O.x>=M.x&&F.x<=T.x&&O.y>=M.y&&F.y<=T.y?[P]:F.x<M.x||O.x>T.x||F.y<M.y||O.y>T.y?[]:t.clipLine([P],M.x,M.y,T.x,T.y)}for(var B=0,j=z;B<j.length;B+=1){var V;E.reset(j[B],.25*k),V=E.length<=.5*k?1:Math.ceil(E.paddedLength/R)+1;for(var U=0;U<V;U++){var $=U/Math.max(V-1,1),H=E.lerp($),q=H.x+100,W=H.y+100;d.push(q,W,k,0);var G=q-k,Z=W-k,X=q+k,Y=W+k;if(S=S&&this.isOffscreen(G,Z,X,Y),w=w||this.isInsideGrid(G,Z,X,Y),!e&&this.grid.hitTestCircle(q,W,k,h)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!w?[]:d,offscreen:S,collisionDetected:x}},he.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],i=1/0,r=1/0,a=-1/0,o=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);i=Math.min(i,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y),n.push(c)}for(var h={},p={},f=0,d=this.grid.query(i,r,a,o).concat(this.ignoredGrid.query(i,r,a,o));f<d.length;f+=1){var v=d[f],m=v.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var g=[new t.Point(v.x1,v.y1),new t.Point(v.x2,v.y1),new t.Point(v.x2,v.y2),new t.Point(v.x1,v.y2)];t.polygonIntersectsPolygon(n,g)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===p[m.bucketInstanceId]&&(p[m.bucketInstanceId]=[]),p[m.bucketInstanceId].push(m.featureIndex))}}return p},he.prototype.insertCollisionBox=function(t,e,n,i,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},t[0],t[1],t[2],t[3])},he.prototype.insertCollisionCircles=function(t,e,n,i,r){for(var a=e?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:i,collisionGroupID:r},s=0;s<t.length;s+=4)a.insertCircle(o,t[s],t[s+1],t[s+2])},he.prototype.projectAndGetPerspectiveRatio=function(e,n,i){var r=[n,i,0,1];return ce(r,r,e),{point:new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}},he.prototype.isOffscreen=function(t,e,n,i){return n<100||t>=this.screenRightBoundary||i<100||e>this.screenBottomBoundary},he.prototype.isInsideGrid=function(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary},he.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var fe=function(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n};fe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var de=function(t,e,n,i,r){this.text=new fe(t?t.text:null,e,n,r),this.icon=new fe(t?t.icon:null,e,i,r)};de.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ve=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},me=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ge=function(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r},ye=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function _e(e,n,i,r,a){var o=t.getAnchorAlignment(e),s=-(o.horizontalAlign-.5)*n,u=-(o.verticalAlign-.5)*i,l=t.evaluateVariableOffset(e,r);return new t.Point(s+l[0]*a,u+l[1]*a)}function be(e,n,i,r,a,o){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(n,i);return r&&f._rotate(a?o:-o),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}ye.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var xe=function(t,e,n,i){this.transform=t.clone(),this.collisionIndex=new he(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new ye(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}};function we(t,e,n,i,r){t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0)}xe.prototype.getBucketParts=function(e,n,i,r){var a=i.getBucket(n),o=i.latestFeatureIndex;if(a&&o&&n.id===a.layerIds[0]){var s=i.collisionBoxArray,u=a.layers[0].layout,l=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),c=i.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),p="map"===u.get("text-pitch-alignment"),f="map"===u.get("text-rotation-alignment"),d=pe(i,1,this.transform.zoom),v=Kt(h,p,f,this.transform,d),m=null;if(p){var g=Jt(h,p,f,this.transform,d);m=t.multiply([],this.transform.labelPlaneMatrix,g)}this.retainedQueryData[a.bucketInstanceId]=new ge(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,i.tileID);var y={bucket:a,layout:u,posMatrix:h,textLabelPlaneMatrix:v,labelToScreenMatrix:m,scale:l,textPixelRatio:c,holdingForFade:i.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r)for(var _=0,b=a.sortKeyRanges;_<b.length;_+=1){var x=b[_];e.push({sortKey:x.sortKey,symbolInstanceStart:x.symbolInstanceStart,symbolInstanceEnd:x.symbolInstanceEnd,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:y})}},xe.prototype.attemptAnchorPlacement=function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d){var v,m=[h.textOffset0,h.textOffset1],g=_e(t,n,i,m,r),y=this.collisionIndex.placeCollisionBox(be(e,g.x,g.y,a,o,this.transform.angle),c,s,u,l.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(be(d,g.x,g.y,a,o,this.transform.angle),c,s,u,l.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(v=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:n,height:i,anchor:t,textBoxScale:r,prevAnchor:v},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:g,placedGlyphBoxes:y}):void 0},xe.prototype.placeLayerBucketPart=function(e,n,i){var r=this,a=e.parameters,o=a.bucket,s=a.layout,u=a.posMatrix,l=a.textLabelPlaneMatrix,c=a.labelToScreenMatrix,h=a.textPixelRatio,p=a.holdingForFade,f=a.collisionBoxArray,d=a.partiallyEvaluatedTextSize,v=a.collisionGroup,m=s.get("text-optional"),g=s.get("icon-optional"),y=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),x="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order"),k=y&&(_||!o.hasIconData()||g),M=_&&(y||!o.hasTextData()||m);!o.collisionArrays&&f&&o.deserializeCollisionBoxes(f);var T=function(e,a){if(!n[e.crossTileID])if(p)r.placements[e.crossTileID]=new ve(!1,!1,!1);else{var f,S=!1,T=!1,E=!0,C=null,I={box:null,offscreen:null},P={box:null,offscreen:null},A=null,L=null,R=0,D=0,z=0;a.textFeatureIndex?R=a.textFeatureIndex:e.useRuntimeCollisionCircles&&(R=e.featureIndex),a.verticalTextFeatureIndex&&(D=a.verticalTextFeatureIndex);var O=a.textBox;if(O){var F=function(n){var i=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!n&&r.prevPlacement){var a=r.prevPlacement.placedOrientations[e.crossTileID];a&&(r.placedOrientations[e.crossTileID]=a,r.markUsedOrientation(o,i=a,e))}return i},N=function(n,i){if(o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&a.verticalTextBox)for(var r=0,s=o.writingModes;r<s.length&&(s[r]===t.WritingMode.vertical?(I=i(),P=I):I=n(),!(I&&I.box&&I.box.length));r+=1);else I=n()};if(s.get("text-variable-anchor")){var B=s.get("text-variable-anchor");if(r.prevPlacement&&r.prevPlacement.variableOffsets[e.crossTileID]){var j=r.prevPlacement.variableOffsets[e.crossTileID];B.indexOf(j.anchor)>0&&(B=B.filter((function(t){return t!==j.anchor}))).unshift(j.anchor)}var V=function(t,n,i){for(var a=t.x2-t.x1,s=t.y2-t.y1,l=e.textBoxScale,c=w&&!_?n:null,p={box:[],offscreen:!1},f=y?2*B.length:B.length,d=0;d<f;++d){var m=r.attemptAnchorPlacement(B[d%B.length],t,a,s,l,b,x,h,u,v,d>=B.length,e,o,i,c);if(m&&(p=m.placedGlyphBoxes)&&p.box&&p.box.length){S=!0,C=m.shift;break}}return p};N((function(){return V(O,a.iconBox,t.WritingMode.horizontal)}),(function(){var n=a.verticalTextBox;return o.allowVerticalPlacement&&!(I&&I.box&&I.box.length)&&e.numVerticalGlyphVertices>0&&n?V(n,a.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),I&&(S=I.box,E=I.offscreen);var U=F(I&&I.box);if(!S&&r.prevPlacement){var $=r.prevPlacement.variableOffsets[e.crossTileID];$&&(r.variableOffsets[e.crossTileID]=$,r.markUsedJustification(o,$.anchor,e,U))}}else{var H=function(t,n){var i=r.collisionIndex.placeCollisionBox(t,y,h,u,v.predicate);return i&&i.box&&i.box.length&&(r.markUsedOrientation(o,n,e),r.placedOrientations[e.crossTileID]=n),i};N((function(){return H(O,t.WritingMode.horizontal)}),(function(){var n=a.verticalTextBox;return o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?H(n,t.WritingMode.vertical):{box:null,offscreen:null}})),F(I&&I.box&&I.box.length)}}if(S=(f=I)&&f.box&&f.box.length>0,E=f&&f.offscreen,e.useRuntimeCollisionCircles){var q=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),W=t.evaluateSizeForFeature(o.textSizeData,d,q),G=s.get("text-padding");A=r.collisionIndex.placeCollisionCircles(y,q,o.lineVertexArray,o.glyphOffsetArray,W,u,l,c,i,x,v.predicate,e.collisionCircleDiameter,G),S=y||A.circles.length>0&&!A.collisionDetected,E=E&&A.offscreen}if(a.iconFeatureIndex&&(z=a.iconFeatureIndex),a.iconBox){var Z=function(t){var e=w&&C?be(t,C.x,C.y,b,x,r.transform.angle):t;return r.collisionIndex.placeCollisionBox(e,_,h,u,v.predicate)};T=P&&P.box&&P.box.length&&a.verticalIconBox?(L=Z(a.verticalIconBox)).box.length>0:(L=Z(a.iconBox)).box.length>0,E=E&&L.offscreen}var X=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,Y=g||0===e.numIconVertices;if(X||Y?Y?X||(T=T&&S):S=T&&S:T=S=T&&S,S&&f&&f.box&&r.collisionIndex.insertCollisionBox(f.box,s.get("text-ignore-placement"),o.bucketInstanceId,P&&P.box&&D?D:R,v.ID),T&&L&&r.collisionIndex.insertCollisionBox(L.box,s.get("icon-ignore-placement"),o.bucketInstanceId,z,v.ID),A&&(S&&r.collisionIndex.insertCollisionCircles(A.circles,s.get("text-ignore-placement"),o.bucketInstanceId,R,v.ID),i)){var K=o.bucketInstanceId,J=r.collisionCircleArrays[K];void 0===J&&(J=r.collisionCircleArrays[K]=new me);for(var Q=0;Q<A.circles.length;Q+=4)J.circles.push(A.circles[Q+0]),J.circles.push(A.circles[Q+1]),J.circles.push(A.circles[Q+2]),J.circles.push(A.collisionDetected?1:0)}r.placements[e.crossTileID]=new ve(S||k,T||M,E||o.justReloaded),n[e.crossTileID]=!0}};if(S)for(var E=o.getSortedSymbolIndexes(this.transform.angle),C=E.length-1;C>=0;--C){var I=E[C];T(o.symbolInstances.get(I),o.collisionArrays[I])}else for(var P=e.symbolInstanceStart;P<e.symbolInstanceEnd;P++)T(o.symbolInstances.get(P),o.collisionArrays[P]);if(i&&o.bucketInstanceId in this.collisionCircleArrays){var A=this.collisionCircleArrays[o.bucketInstanceId];t.invert(A.invProjMatrix,u),A.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1},xe.prototype.markUsedJustification=function(e,n,i,r){var a;a=r===t.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];for(var o=0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];o<s.length;o+=1){var u=s[o];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=a>=0&&u!==a?0:i.crossTileID)}},xe.prototype.markUsedOrientation=function(e,n,i){for(var r=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,a=n===t.WritingMode.vertical?n:0,o=0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];o<s.length;o+=1)e.text.placedSymbolArray.get(s[o]).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=a)},xe.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var i=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},a=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=r[s];l?(this.opacities[s]=new de(l,i,u.text,u.icon),n=n||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new de(null,i,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var c in r){var h=r[c];if(!this.opacities[c]){var p=new de(h,i,!1,!1);p.isHidden()||(this.opacities[c]=p,n=n||h.text.placed||h.icon.placed)}}for(var f in a)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=a[f]);for(var d in o)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=o[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},xe.prototype.updateLayerOpacities=function(t,e){for(var n={},i=0,r=e;i<r.length;i+=1){var a=r[i],o=a.getBucket(t);o&&a.latestFeatureIndex&&t.id===o.layerIds[0]&&this.updateBucketOpacities(o,n,a.collisionBoxArray)}},xe.prototype.updateBucketOpacities=function(e,n,i){var r=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var a=e.layers[0].layout,o=new de(null,0,!1,!1,!0),s=a.get("text-allow-overlap"),u=a.get("icon-allow-overlap"),l=a.get("text-variable-anchor"),c="map"===a.get("text-rotation-alignment"),h="map"===a.get("text-pitch-alignment"),p="none"!==a.get("icon-text-fit"),f=new de(null,0,s&&(u||!e.hasIconData()||a.get("icon-optional")),u&&(s||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);for(var d=function(t,e,n){for(var i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(n)},v=function(i){var a=e.symbolInstances.get(i),s=a.numHorizontalGlyphVertices,u=a.numVerticalGlyphVertices,v=a.crossTileID,m=r.opacities[v];n[v]?m=o:m||(r.opacities[v]=m=f),n[v]=!0;var g=a.numIconVertices>0,y=r.placedOrientations[a.crossTileID],_=y===t.WritingMode.vertical,b=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(s>0||u>0){var x=Pe(m.text);d(e.text,s,_?Ae:x),d(e.text,u,b?Ae:x);var w=m.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),a.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=w||b?1:0);var S=r.variableOffsets[a.crossTileID];S&&r.markUsedJustification(e,S.anchor,a,y);var k=r.placedOrientations[a.crossTileID];k&&(r.markUsedJustification(e,"left",a,k),r.markUsedOrientation(e,k,a))}if(g){var M=Pe(m.icon),T=!(p&&a.verticalPlacedIconSymbolIndex&&_);a.placedIconSymbolIndex>=0&&(d(e.icon,a.numIconVertices,T?M:Ae),e.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=m.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,a.numVerticalIconVertices,T?Ae:M),e.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var E=e.collisionArrays[i];if(E){var C=new t.Point(0,0);if(E.textBox||E.verticalTextBox){var I=!0;if(l){var P=r.variableOffsets[v];P?(C=_e(P.anchor,P.width,P.height,P.textOffset,P.textBoxScale),c&&C._rotate(h?r.transform.angle:-r.transform.angle)):I=!1}E.textBox&&we(e.textCollisionBox.collisionVertexArray,m.text.placed,!I||_,C.x,C.y),E.verticalTextBox&&we(e.textCollisionBox.collisionVertexArray,m.text.placed,!I||b,C.x,C.y)}var A=Boolean(!b&&E.verticalIconBox);E.iconBox&&we(e.iconCollisionBox.collisionVertexArray,m.icon.placed,A,p?C.x:0,p?C.y:0),E.verticalIconBox&&we(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!A,p?C.x:0,p?C.y:0)}}},m=0;m<e.symbolInstances.length;m++)v(m);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var g=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=g.invProjMatrix,e.placementViewportMatrix=g.viewportMatrix,e.collisionCircleArray=g.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},xe.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},xe.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},xe.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},xe.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},xe.prototype.setStale=function(){this.stale=!0};var Se=Math.pow(2,25),ke=Math.pow(2,24),Me=Math.pow(2,17),Te=Math.pow(2,16),Ee=Math.pow(2,9),Ce=Math.pow(2,8),Ie=Math.pow(2,1);function Pe(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Se+e*ke+n*Me+e*Te+n*Ee+e*Ce+n*Ie+e}var Ae=0,Le=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Le.prototype.continuePlacement=function(t,e,n,i,r){for(var a=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(a,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<a.length;)if(e.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1};var Re=function(t,e,n,i,r,a,o){this.placement=new xe(t,r,a,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1};Re.prototype.isDone=function(){return this._done},Re.prototype.continuePlacement=function(e,n,i){for(var r=this,a=t.browser.now(),o=function(){var e=t.browser.now()-a;return!r._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Le(s)),this._inProgressLayer.continuePlacement(i[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Re.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,ze=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var i=0;i<e.length;i++){var r=e.get(i),a=r.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)})}};ze.prototype.getScaledCoordinates=function(e,n){var i=De/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*i),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*i)}},ze.prototype.findMatches=function(t,e,n){for(var i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0;r<t.length;r++){var a=t.get(r);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,e),u=0,l=o;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=i&&Math.abs(c.coord.y-s.y)<=i&&!n[c.crossTileID]){n[c.crossTileID]=!0,a.crossTileID=c.crossTileID;break}}}}};var Oe=function(){this.maxCrossTileID=0};Oe.prototype.generate=function(){return++this.maxCrossTileID};var Fe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var i=this.indexes[n],r={};for(var a in i){var o=i[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),r[o.tileID.key]=o}this.indexes[n]=r}this.lng=t},Fe.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var r=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>t.overscaledZ)for(var s in o){var u=o[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,r)}else{var l=o[t.scaledTo(Number(a)).key];l&&l.findMatches(e.symbolInstances,t,r)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),r[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ze(t,e.symbolInstances,e.bucketInstanceId),!0},Fe.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var i=0,r=e.indexedSymbolInstances[n];i<r.length;i+=1)delete this.usedCrossTileIDs[t][r[i].crossTileID]},Fe.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var i=this.indexes[n];for(var r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e};var Ne=function(){this.layerIndexes={},this.crossTileIDs=new Oe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ne.prototype.addLayer=function(t,e,n){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Fe);var r=!1,a={};i.handleWrapJump(n);for(var o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(u.tileID,l,this.crossTileIDs)&&(r=!0),a[l.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(r=!0),r},Ne.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Be=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},je=t.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ve=t.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),Ue=function(){var e={},n=t.styleSpec.$version;for(var i in t.styleSpec.$root){var r,a=t.styleSpec.$root[i];a.required&&null!=(r="version"===i?n:"array"===a.type?[]:{})&&(e[i]=r)}return e}(),$e=function(e){function n(i,r){var a=this;void 0===r&&(r={}),e.call(this),this.map=i,this.dispatcher=new k(Nt(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new _(i._requestManager,r.localIdeographFontFamily),this.lineAtlas=new S(256,512),this.crossTileSymbolIndex=new Ne,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var o=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var i in o.sourceCaches)o.sourceCaches[i].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var i in a._layers){var r=a._layers[i];r.source===n.id&&a._validateLayer(r)}}}}))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadURL=function(e,n){var i=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var a=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(a,(function(e,n){i._request=null,e?i.fire(new t.ErrorEvent(e)):n&&i._load(n,r)}))},n.prototype.loadJSON=function(e,n){var i=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){i._request=null,i._load(e,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ue,!1)},n.prototype._load=function(e,n){if(!n||!Be(this,t.validateStyle(e))){for(var i in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(i,e.sources[i],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var r=jt(this.stylesheet.layers);this._order=r.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var a=0,o=r;a<o.length;a+=1){var s=o[a];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._loadSprite=function(e){var n=this;this._spriteRequest=function(e,n,i){var r,a,o,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,o||(o=t,r=e,c())})),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,o||(o=t,a=e,c())}));function c(){if(o)i(o);else if(r&&a){var e=t.browser.getImageData(a),n={};for(var s in r){var u=r[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,v=u.stretchX,m=u.stretchY,g=u.content,y=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,y,{x:h,y:p},{x:0,y:0},{width:l,height:c}),n[s]={data:y,pixelRatio:d,sdf:f,stretchX:v,stretchY:m,content:g}}i(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(function(e,i){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(i)for(var r in i)n.imageManager.addImage(r,i[r]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new t.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var i=e.sourceLayer;if(i){var r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+i+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,i=t;n<i.length;n+=1){var r=this._layers[i[n]];"custom"!==r.type&&e.push(r.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var i=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var a in(i.length||r.length)&&this._updateWorkerLayers(i,r),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var h=0,p=this._order;h<p.length;h+=1){var f=this._layers[p[h]];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(var d in u){var v=this.sourceCaches[d];u[d]!==v.used&&v.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Be(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=jt(e.layers);var i=function(e,n){if(!e)return[{command:Vt.setStyle,args:[n]}];var i=[];try{if(!t.deepEqual(e.version,n.version))return[{command:Vt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||i.push({command:Vt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||i.push({command:Vt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||i.push({command:Vt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||i.push({command:Vt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||i.push({command:Vt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||i.push({command:Vt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||i.push({command:Vt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||i.push({command:Vt.setLight,args:[n.light]});var r={},a=[];!function(e,n,i,r){var a;for(a in n=n||{},e=e||{})e.hasOwnProperty(a)&&(n.hasOwnProperty(a)||$t(a,i,r));for(a in n)n.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.deepEqual(e[a],n[a])||("geojson"===e[a].type&&"geojson"===n[a].type&&qt(e,n,a)?i.push({command:Vt.setGeoJSONSourceData,args:[a,n[a].data]}):Ht(a,n,i,r)):Ut(a,n,i))}(e.sources,n.sources,a,r);var o=[];e.layers&&e.layers.forEach((function(t){r[t.source]?i.push({command:Vt.removeLayer,args:[t.id]}):o.push(t)})),i=i.concat(a),function(e,n,i){n=n||[];var r,a,o,s,u,l,c,h=(e=e||[]).map(Gt),p=n.map(Gt),f=e.reduce(Zt,{}),d=n.reduce(Zt,{}),v=h.slice(),m=Object.create(null);for(r=0,a=0;r<h.length;r++)d.hasOwnProperty(o=h[r])?a++:(i.push({command:Vt.removeLayer,args:[o]}),v.splice(v.indexOf(o,a),1));for(r=0,a=0;r<p.length;r++)v[v.length-1-r]!==(o=p[p.length-1-r])&&(f.hasOwnProperty(o)?(i.push({command:Vt.removeLayer,args:[o]}),v.splice(v.lastIndexOf(o,v.length-a),1)):a++,i.push({command:Vt.addLayer,args:[d[o],l=v[v.length-r]]}),v.splice(v.length-r,0,o),m[o]=!0);for(r=0;r<p.length;r++)if(s=f[o=p[r]],u=d[o],!m[o]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Wt(s.layout,u.layout,i,o,null,Vt.setLayoutProperty),Wt(s.paint,u.paint,i,o,null,Vt.setPaintProperty),t.deepEqual(s.filter,u.filter)||i.push({command:Vt.setFilter,args:[o,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||i.push({command:Vt.setLayerZoomRange,args:[o,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Wt(s[c],u[c],i,o,c.slice(6),Vt.setPaintProperty):t.deepEqual(s[c],u[c])||i.push({command:Vt.setLayerProperty,args:[o,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Wt(s[c],u[c],i,o,c.slice(6),Vt.setPaintProperty):t.deepEqual(s[c],u[c])||i.push({command:Vt.setLayerProperty,args:[o,c,u[c]]}))}else i.push({command:Vt.removeLayer,args:[o]}),l=v[v.lastIndexOf(o)+1],i.push({command:Vt.addLayer,args:[u,l]})}(o,n.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Vt.setStyle,args:[n]}]}return i}(this.serialize(),e).filter((function(t){return!(t.command in Ve)}));if(0===i.length)return!1;var r=i.filter((function(t){return!(t.command in je)}));if(r.length>0)throw new Error("Unimplemented: "+r.map((function(t){return t.command})).join(", ")+".");return i.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},n.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,i){var r=this;if(void 0===i&&(i={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,i))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var a=this.sourceCaches[e]=new Pt(e,n,this.dispatcher);a.style=this,a.setEventedParent(this,(function(){return{isSourceLoaded:r.loaded(),source:a.serialize(),sourceId:e}})),a.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,i){void 0===i&&(i={}),this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" already exists on this map')));else{var a;if("custom"===e.type){if(Be(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,"layers."+r,e,{arrayIndex:-1},i))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[a.id]=a.serialize()}var o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a,this._removedLayers[r]&&a.source&&"custom"!==a.type){var s=this._removedLayers[r];delete this._removedLayers[r],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var i=this._order.indexOf(e);this._order.splice(i,1);var r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.hasLayer=function(t){return t in this._layers},n.prototype.setLayerZoomRange=function(e,n,i){this._checkLoaded();var r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,i){void 0===i&&(i={}),this._checkLoaded();var r=this.getLayer(e);if(r){if(!t.deepEqual(r.filter,n))return null==n?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(t.validateStyle.filter,"layers."+r.id+".filter",n,null,i)||(r.filter=t.clone$1(n),this._updateLayer(r)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,i,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getLayoutProperty(n),i)||(a.setLayoutProperty(n,i,r),this._updateLayer(a)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,i,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getPaintProperty(n),i)||(a.setPaintProperty(n,i,r)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var i=e.source,r=e.sourceLayer,a=this.sourceCaches[i];if(void 0!==a){var o=a.getSource().type;"geojson"===o&&r?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),a.setFeatureState(r,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var i=e.source,r=this.sourceCaches[i];if(void 0!==r){var a=r.getSource().type,o="vector"===a?e.sourceLayer:void 0;"vector"!==a||o?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(o,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,i=e.sourceLayer,r=this.sourceCaches[n];if(void 0!==r){if("vector"!==r.getSource().type||i)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),r.getFeatureState(i,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},i={},r=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(n(o)){i[o]=a;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][o];if(l)for(var c=0,h=l;c<h.length;c+=1)r.push(h[c])}}}r.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],f=this._order.length-1;f>=0;f--){var d=this._order[f];if(n(d))for(var v=r.length-1;v>=0;v--){var m=r[v].feature;if(i[m.layer.id]<f)break;p.push(m),r.pop()}else for(var g=0,y=t;g<y.length;g+=1){var _=y[g][d];if(_)for(var b=0,x=_;b<x.length;b+=1)p.push(x[b].feature)}}return p},n.prototype.queryRenderedFeatures=function(e,n,i){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,o=n.layers;a<o.length;a+=1){var s=o[a],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];r[u.source]=!0}}var l=[];for(var c in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!r[c]||l.push(F(this.sourceCaches[c],this._layers,this._serializedLayers,e,n,i));return this.placement&&l.push(function(t,e,n,i,r,a,o){for(var s={},u=a.queryRenderedSymbols(i),l=[],c=0,h=Object.keys(u).map(Number);c<h.length;c+=1)l.push(o[h[c]]);l.sort(N);for(var p=function(){var n=d[f],i=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],e,n.bucketIndex,n.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(var a in i){var o=s[a]=s[a]||[],l=i[a];l.sort((function(t,e){var i=n.featureSortOrder;if(i){var r=i.indexOf(t.featureIndex);return i.indexOf(e.featureIndex)-r}return e.featureIndex-t.featureIndex}));for(var c=0,h=l;c<h.length;c+=1)o.push(h[c])}},f=0,d=l;f<d.length;f+=1)p();var v=function(e){s[e].forEach((function(i){var r=i.feature,a=n[t[e].source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=a}))};for(var m in s)v(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var i=this.sourceCaches[e];return i?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),i=[],r={},a=0;a<n.length;a++){var o=n[a],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(i,e))}return i}(i,n):[]},n.prototype.addSourceType=function(t,e,i){return n.getSourceType(t)?i(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var i=this.light.getLight(),r=!1;for(var a in e)if(!t.deepEqual(e[a],i[a])){r=!0;break}if(r){var o={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(o)}},n.prototype._validate=function(e,n,i,r,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Be(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:i,styleSpec:t.styleSpec},r)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,i,r,a){void 0===a&&(a=!1);for(var o=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];if("symbol"===h.type){if(!u[h.source]){var p=this.sourceCaches[h.source];u[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(h,u[h.source],e.center.lng);o=o||f}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Re(e,this._order,a,n,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(var d=0,v=this._order;d<v.length;d+=1){var m=this._layers[v[d]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,u[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var i=this.sourceCaches[e.source];i&&i.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,i){return t.makeRequest(n,i)},n}(t.Evented);$e.getSourceType=function(t){return z[t]},$e.setSourceType=function(t,e){z[t]=e},$e.registerForPluginStateChange=t.registerForPluginStateChange;var He=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),qe=yn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),We=yn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ge=yn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ze=yn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Xe=yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ye=yn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Ke=yn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Je=yn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qe=yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),tn=yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),en=yn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),nn=yn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),rn=yn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),an=yn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),on=yn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),sn=yn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),un=yn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ln=yn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cn=yn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),hn=yn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),pn=yn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),fn=yn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),dn=yn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),vn=yn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),mn=yn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),gn=yn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function yn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=e.match(/attribute ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(r):r,s={};return{fragmentSource:t=t.replace(n,(function(t,e,n,i,r){return s[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nvarying "+n+" "+i+" "+r+";\n#else\nuniform "+n+" "+i+" u_"+r+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+r+"\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,i,r){var a="float"===i?"vec2":"vec4",o=r.match(/color/)?"color":a;return s[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float u_"+r+"_t;\nattribute "+n+" "+a+" a_"+r+";\nvarying "+n+" "+i+" "+r+";\n#else\nuniform "+n+" "+i+" u_"+r+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = a_"+r+";\n#else\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = unpack_mix_"+o+"(a_"+r+", u_"+r+"_t);\n#else\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float u_"+r+"_t;\nattribute "+n+" "+a+" a_"+r+";\n#else\nuniform "+n+" "+i+" u_"+r+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+n+" "+i+" "+r+" = a_"+r+";\n#else\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+n+" "+i+" "+r+" = unpack_mix_"+o+"(a_"+r+", u_"+r+"_t);\n#else\n    "+n+" "+i+" "+r+" = u_"+r+";\n#endif\n"})),staticAttributes:i,staticUniforms:o}}var _n=Object.freeze({__proto__:null,prelude:qe,background:We,backgroundPattern:Ge,circle:Ze,clippingMask:Xe,heatmap:Ye,heatmapTexture:Ke,collisionBox:Je,collisionCircle:Qe,debug:tn,fill:en,fillOutline:nn,fillOutlinePattern:rn,fillPattern:an,fillExtrusion:on,fillExtrusionPattern:sn,hillshadePrepare:un,hillshade:ln,line:cn,lineGradient:hn,linePattern:pn,lineSDF:fn,raster:dn,symbolIcon:vn,symbolSDF:mn,symbolTextAndIcon:gn}),bn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function xn(t){for(var e=[],n=0;n<t.length;n++)if(null!==t[n]){var i=t[n].split(" ");e.push(i.pop())}return e}bn.prototype.bind=function(t,e,n,i,r,a,o,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==i.length,l=0;!u&&l<i.length;l++)this.boundPaintVertexBuffers[l]!==i[l]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===r&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind()):this.freshBind(e,n,i,r,a,o,s)},bn.prototype.freshBind=function(t,e,n,i,r,a,o){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=n;p<f.length;p+=1)f[p].enableAttributes(c,t);a&&a.enableAttributes(c,t),o&&o.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(var d=0,v=n;d<v.length;d+=1){var m=v[d];m.bind(),m.setVertexAttribPointers(c,t,r)}a&&(a.bind(),a.setVertexAttribPointers(c,t,r)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(c,t,r)),l.currentNumAttributes=u},bn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var wn=function(t,e,n,i,r,a){var o=t.gl;this.program=o.createProgram();for(var s=xn(n.staticAttributes),u=i?i.getBinderAttributes():[],l=s.concat(u),c=n.staticUniforms?xn(n.staticUniforms):[],h=i?i.getBinderUniforms():[],p=[],f=0,d=c.concat(h);f<d.length;f+=1){var v=d[f];p.indexOf(v)<0&&p.push(v)}var m=i?i.defines():[];a&&m.push("#define OVERDRAW_INSPECTOR;");var g=m.concat(qe.fragmentSource,n.fragmentSource).join("\n"),y=m.concat(qe.vertexSource,n.vertexSource).join("\n"),_=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(_,g),o.compileShader(_),o.attachShader(this.program,_);var b=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(b,y),o.compileShader(b),o.attachShader(this.program,b),this.attributes={};var x={};this.numAttributes=l.length;for(var w=0;w<this.numAttributes;w++)l[w]&&(o.bindAttribLocation(this.program,w,l[w]),this.attributes[l[w]]=w);o.linkProgram(this.program),o.deleteShader(b),o.deleteShader(_);for(var S=0;S<p.length;S++){var k=p[S];if(k&&!x[k]){var M=o.getUniformLocation(this.program,k);M&&(x[k]=M)}}this.fixedUniforms=r(t,x),this.binderUniforms=i?i.getUniforms(t,x):[]}}};function Sn(t,e,n){var i=1/pe(n,1,e.transform.tileZoom),r=Math.pow(2,n.tileID.overscaledZ),a=n.tileSize*Math.pow(2,e.transform.tileZoom)/r,o=a*(n.tileID.canonical.x+n.tileID.wrap*r),s=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[i,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}wn.prototype.draw=function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v){var m,g=t.gl;if(!this.failedToCreate){for(var y in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(a),this.fixedUniforms)this.fixedUniforms[y].set(o[y]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=(m={},m[g.LINES]=2,m[g.TRIANGLES]=3,m[g.LINE_STRIP]=1,m)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new bn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,v),g.drawElements(e,w.primitiveLength*_,g.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var kn=function(e,n,i,r){var a=n.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],u=t.create$1();"viewport"===a.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=a.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+i,u_opacity:r}},Mn=function(e,n,i,r,a,o,s){return t.extend(kn(e,n,i,r),Sn(o,n,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},Tn=function(t){return{u_matrix:t}},En=function(e,n,i,r){return t.extend(Tn(e),Sn(i,n,r))},Cn=function(t,e){return{u_matrix:t,u_world:e}},In=function(e,n,i,r,a){return t.extend(En(e,n,i,r),{u_world:a})},Pn=function(e,n,i,r){var a,o,s=e.transform;if("map"===r.paint.get("circle-pitch-alignment")){var u=pe(i,1,s.zoom);a=!0,o=[u,u]}else a=!1,o=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+a,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:o}},An=function(t,e,n){var i=pe(n,1,e.zoom),r=Math.pow(2,e.zoom-n.tileID.overscaledZ),a=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[e.pixelsToGLUnits[0]/(i*r),e.pixelsToGLUnits[1]/(i*r)],u_overscale_factor:a}},Ln=function(t,e,n){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},Rn=function(t,e,n){return void 0===n&&(n=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}},Dn=function(t){return{u_matrix:t}},zn=function(t,e,n,i){return{u_matrix:t,u_extrude_scale:pe(e,1,n),u_intensity:i}},On=function(e,n,i){var r=e.transform;return{u_matrix:Vn(e,n,i),u_ratio:1/pe(n,1,r.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},Fn=function(e,n,i,r){return t.extend(On(e,n,i),{u_image:0,u_image_height:r})},Nn=function(e,n,i,r){var a=e.transform,o=jn(n,a);return{u_matrix:Vn(e,n,i),u_texsize:n.imageAtlasTexture.size,u_ratio:1/pe(n,1,a.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[o,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Bn=function(e,n,i,r,a){var o=e.lineAtlas,s=jn(n,e.transform),u="round"===i.layout.get("line-cap"),l=o.getDash(r.from,u),c=o.getDash(r.to,u),h=l.width*a.fromScale,p=c.width*a.toScale;return t.extend(On(e,n,i),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:o.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:a.t})};function jn(t,e){return 1/pe(t,1,e.tileZoom)}function Vn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Un=function(t,e,n,i,r){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(o=r.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:$n(r.paint.get("raster-hue-rotate"))};var a,o};function $n(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Hn,qn=function(t,e,n,i,r,a,o,s,u,l){var c=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+i,u_texsize:l,u_texture:0}},Wn=function(e,n,i,r,a,o,s,u,l,c,h){var p=a.transform;return t.extend(qn(e,n,i,r,a,o,s,u,l,c),{u_gamma_scale:r?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Gn=function(e,n,i,r,a,o,s,u,l,c){return t.extend(Wn(e,n,i,r,a,o,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},Zn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Xn=function(e,n,i,r,a,o){return t.extend(function(t,e,n,i){var r=n.imageManager.getPattern(t.from.toString()),a=n.imageManager.getPattern(t.to.toString()),o=n.imageManager.getPixelSize(),s=o.width,u=o.height,l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(i.tileID.canonical.x+i.tileID.wrap*l),p=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(i,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(r,o,i,a),{u_matrix:e,u_opacity:n})},Yn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},collisionCircle:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}},debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Kn(e,n,i,r,a,o,s){for(var u=e.context,l=u.gl,c=e.useProgram("collisionBox"),h=[],p=0,f=0,d=0;d<r.length;d++){var v=r[d],m=n.getTile(v),g=m.getBucket(i);if(g){var y=v.posMatrix;0===a[0]&&0===a[1]||(y=e.translatePosMatrix(v.posMatrix,m,a,o));var _=s?g.textCollisionBox:g.iconCollisionBox,b=g.collisionCircleArray;if(b.length>0){var x=t.create(),w=y;t.mul(x,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(x,x,g.placementViewportMatrix),h.push({circleArray:b,circleOffset:f,transform:w,invTransform:x}),f=p+=b.length/4}_&&c.draw(u,l.LINES,Mt.disabled,Tt.disabled,e.colorModeForRenderPass(),Ct.disabled,An(y,e.transform,m),i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var S=e.useProgram("collisionCircle"),k=new t.StructArrayLayout2f1f2i16;k.resize(4*p),k._trim();for(var M=0,T=0,E=h;T<E.length;T+=1)for(var C=E[T],I=0;I<C.circleArray.length/4;I++){var P=4*I,A=C.circleArray[P+0],L=C.circleArray[P+1],R=C.circleArray[P+2],D=C.circleArray[P+3];k.emplace(M++,A,L,R,D,0),k.emplace(M++,A,L,R,D,1),k.emplace(M++,A,L,R,D,2),k.emplace(M++,A,L,R,D,3)}(!Hn||Hn.length<2*p)&&(Hn=function(e){var n=2*e,i=new t.StructArrayLayout3ui6;i.resize(n),i._trim();for(var r=0;r<n;r++){var a=6*r;i.uint16[a+0]=4*r+0,i.uint16[a+1]=4*r+1,i.uint16[a+2]=4*r+2,i.uint16[a+3]=4*r+2,i.uint16[a+4]=4*r+3,i.uint16[a+5]=4*r+0}return i}(p));for(var z=u.createIndexBuffer(Hn,!0),O=u.createVertexBuffer(k,t.collisionCircleLayout.members,!0),F=0,N=h;F<N.length;F+=1){var B=N[F],j=Ln(B.transform,B.invTransform,e.transform);S.draw(u,l.TRIANGLES,Mt.disabled,Tt.disabled,e.colorModeForRenderPass(),Ct.disabled,j,i.id,O,z,t.SegmentVector.simpleSegment(0,2*B.circleOffset,B.circleArray.length,B.circleArray.length/2),null,e.transform.zoom,null,null,null)}O.destroy(),z.destroy()}}var Jn=t.identity(new Float32Array(16));function Qn(e,n,i,r,a,o){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*i,c=t.evaluateVariableOffset(e,r);return new t.Point((u/a+c[0])*o,(l/a+c[1])*o)}function ti(e,n,i,r,a,o,s,u,l,c,h){var p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,v={};f.clear();for(var m=0;m<p.length;m++){var g=p.get(m),y=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:r[g.crossTileID];if(y){var _=new t.Point(g.anchorX,g.anchorY),b=Qt(_,i?u:s),x=te(o.cameraToCenterDistance,b.signedDistanceFromCamera),w=a.evaluateSizeForFeature(e.textSizeData,c,g)*x/t.ONE_EM;i&&(w*=e.tilePixelRatio/l);for(var S=Qn(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,w),k=i?Qt(_.add(S),s).point:b.point.add(n?S.rotate(-o.angle):S),M=e.allowVerticalPlacement&&g.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,T=0;T<g.numGlyphs;T++)t.addDynamicAttributes(f,k,M);h&&g.associatedIconIndex>=0&&(v[g.associatedIconIndex]={shiftedAnchor:k,angle:M})}else le(g.numGlyphs,f)}if(h){d.clear();for(var E=e.icon.placedSymbolArray,C=0;C<E.length;C++){var I=E.get(C);if(I.hidden)le(I.numGlyphs,d);else{var P=v[C];if(P)for(var A=0;A<I.numGlyphs;A++)t.addDynamicAttributes(d,P.shiftedAnchor,P.angle);else le(I.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function ei(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function ni(e,n,i,r,a,o,s,u,l,c,h,p){for(var f=e.context,d=f.gl,v=e.transform,m="map"===u,g="map"===l,y=m&&"point"!==i.layout.get("symbol-placement"),_=m&&!g&&!y,b=!i.layout.get("symbol-sort-key").isConstant(),x=!1,w=e.depthModeForSublayer(0,Mt.ReadOnly),S=i.layout.get("text-variable-anchor"),k=[],M=0,T=r;M<T.length;M+=1){var E=T[M],C=n.getTile(E),I=C.getBucket(i);if(I){var P=a?I.text:I.icon;if(P&&P.segments.get().length){var A=P.programConfigurations.get(i.id),L=a||I.sdfIcons,R=a?I.textSizeData:I.iconSizeData,D=g||0!==v.pitch,z=e.useProgram(ei(L,a,I),A),O=t.evaluateSizeForZoom(R,v.zoom),F=void 0,N=[0,0],B=void 0,j=void 0,V=null,U=void 0;if(a)B=C.glyphAtlasTexture,j=d.LINEAR,F=C.glyphAtlasTexture.size,I.iconsInText&&(N=C.imageAtlasTexture.size,V=C.imageAtlasTexture,U=D||e.options.rotating||e.options.zooming||"composite"===R.kind||"camera"===R.kind?d.LINEAR:d.NEAREST);else{var $=1!==i.layout.get("icon-size").constantOr(0)||I.iconsNeedLinear;B=C.imageAtlasTexture,j=L||e.options.rotating||e.options.zooming||$||D?d.LINEAR:d.NEAREST,F=C.imageAtlasTexture.size}var H=pe(C,1,e.transform.zoom),q=Kt(E.posMatrix,g,m,e.transform,H),W=Jt(E.posMatrix,g,m,e.transform,H),G=S&&I.hasTextData(),Z="none"!==i.layout.get("icon-text-fit")&&G&&I.hasIconData();y&&ne(I,E.posMatrix,e,a,q,W,g,c);var X=e.translatePosMatrix(E.posMatrix,C,o,s),Y=y||a&&S||Z?Jn:q,K=e.translatePosMatrix(W,C,o,s,!0),J=L&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:z,buffers:P,uniformValues:L?I.iconsInText?Gn(R.kind,O,_,g,e,X,Y,K,F,N):Wn(R.kind,O,_,g,e,X,Y,K,a,F,!0):qn(R.kind,O,_,g,e,X,Y,K,a,F),atlasTexture:B,atlasTextureIcon:V,atlasInterpolation:j,atlasInterpolationIcon:U,isSDF:L,hasHalo:J};if(b&&I.canOverlap){x=!0;for(var tt=0,et=P.segments.get();tt<et.length;tt+=1){var nt=et[tt];k.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:Q})}}else k.push({segments:P.segments,sortKey:0,state:Q})}}}x&&k.sort((function(t,e){return t.sortKey-e.sortKey}));for(var it=0,rt=k;it<rt.length;it+=1){var at=rt[it],ot=at.state;if(f.activeTexture.set(d.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,d.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(f.activeTexture.set(d.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),ot.isSDF){var st=ot.uniformValues;ot.hasHalo&&(st.u_is_halo=1,ii(ot.buffers,at.segments,i,e,ot.program,w,h,p,st)),st.u_is_halo=0}ii(ot.buffers,at.segments,i,e,ot.program,w,h,p,ot.uniformValues)}}function ii(t,e,n,i,r,a,o,s,u){var l=i.context;r.draw(l,l.gl.TRIANGLES,a,o,s,Ct.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function ri(t,e,n,i,r,a,o){var s,u,l,c,h,p=t.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),v=n.getCrossfadeParameters();o?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var m=0,g=i;m<g.length;m+=1){var y=g[m],_=e.getTile(y);if(!d||_.patternsLoaded()){var b=_.getBucket(n);if(b){var x=b.programConfigurations.get(n.id),w=t.useProgram(u,x);d&&(t.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),x.updatePaintBuffers(v));var S=f.constantOr(null);if(S&&_.imageAtlas){var k=_.imageAtlas,M=k.patternPositions[S.to.toString()],T=k.patternPositions[S.from.toString()];M&&T&&x.setConstantPatternPositions(M,T)}var E=t.translatePosMatrix(y.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(o){c=b.indexBuffer2,h=b.segments2;var C=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?In(E,t,v,_,C):Cn(E,C)}else c=b.indexBuffer,h=b.segments,l=d?En(E,t,v,_):Tn(E);w.draw(t.context,s,r,t.stencilModeForClipping(y),a,Ct.disabled,l,n.id,b.layoutVertexBuffer,c,h,n.paint,t.transform.zoom,x)}}}}function ai(t,e,n,i,r,a,o){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=0,d=i;f<d.length;f+=1){var v=d[f],m=e.getTile(v),g=m.getBucket(n);if(g){var y=g.programConfigurations.get(n.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",y);c&&(t.context.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var b=l.constantOr(null);if(b&&m.imageAtlas){var x=m.imageAtlas,w=x.patternPositions[b.to.toString()],S=x.patternPositions[b.from.toString()];w&&S&&y.setConstantPatternPositions(w,S)}var k=t.translatePosMatrix(v.posMatrix,m,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),M=n.paint.get("fill-extrusion-vertical-gradient"),T=c?Mn(k,t,M,p,v,h,m):kn(k,t,M,p);_.draw(s,s.gl.TRIANGLES,r,a,o,Ct.backCCW,T,n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,y)}}}function oi(e,n,i,r,a,o){var s=e.context,u=s.gl,l=n.fbo;if(l){var c=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var h=function(e,n,i){var r=i.paint.get("hillshade-shadow-color"),a=i.paint.get("hillshade-highlight-color"),o=i.paint.get("hillshade-accent-color"),s=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,l,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(n.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=n.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new t.MercatorCoordinate(0,c/l).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[i.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:a,u_accent:o}}(e,n,i);c.draw(s,u.TRIANGLES,r,a,o,Ct.disabled,h,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function si(e,n,i,r,a,o){var s=e.context,u=s.gl,l=n.dem;if(l&&l.data){var c=l.dim,h=l.stride,p=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var f=n.demTexture;f.update(p,{premultiply:!1}),f.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(s,p,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var v=new t.Texture(s,{width:c,height:c,data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(v.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,r,a,o,Ct.disabled,function(e,n){var i=n.stride,r=t.create();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,l),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ui(e,n,i,r,a){var o=r.paint.get("raster-fade-duration");if(o>0){var s=t.browser.now(),u=(s-e.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,c=i.getSource(),h=a.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}var li=new t.Color(1,0,0,1),ci=new t.Color(0,1,0,1),hi=new t.Color(0,0,1,1),pi=new t.Color(1,0,1,1),fi=new t.Color(0,1,1,1);function di(t,e,n,i){mi(t,0,e+n/2,t.transform.width,n,i)}function vi(t,e,n,i){mi(t,e-n/2,0,n,t.transform.height,i)}function mi(e,n,i,r,a,o){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,a*t.browser.devicePixelRatio),s.clear({color:o}),u.disable(u.SCISSOR_TEST)}function gi(e,n,i){var r=e.context,a=r.gl,o=i.posMatrix,s=e.useProgram("debug"),u=Mt.disabled,l=Tt.disabled,c=e.colorModeForRenderPass();r.activeTexture.set(a.TEXTURE0),e.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(r,a.LINE_STRIP,u,l,c,Ct.disabled,Rn(o,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=n.getTileByID(i.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),f=n.getTile(i).tileSize,d=512/Math.min(f,512)*(i.overscaledZ/e.transform.zoom)*.5,v=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(v+=" => "+i.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var n=t.debugOverlayCanvas,i=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,v+" "+p+"kb"),s.draw(r,a.TRIANGLES,u,l,Et.alphaBlended,Ct.disabled,Rn(o,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var yi={symbol:function(e,n,i,r,a){if("translucent"===e.renderPass){var o=Tt.disabled,s=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(e,n,i,r,a,o,s){for(var u=n.transform,l="map"===a,c="map"===o,h=0,p=e;h<p.length;h+=1){var f=p[h],d=r.getTile(f),v=d.getBucket(i);if(v&&v.text&&v.text.segments.get().length){var m=t.evaluateSizeForZoom(v.textSizeData,u.zoom),g=pe(d,1,n.transform.zoom),y=Kt(f.posMatrix,c,l,n.transform,g),_="none"!==i.layout.get("icon-text-fit")&&v.hasIconData();if(m){var b=Math.pow(2,u.zoom-d.tileID.overscaledZ);ti(v,l,c,s,t.symbolSize,u,y,f.posMatrix,b,m,_)}}}}(r,e,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),a),0!==i.paint.get("icon-opacity").constantOr(1)&&ni(e,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),o,s),0!==i.paint.get("text-opacity").constantOr(1)&&ni(e,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),o,s),n.map.showCollisionBoxes&&(Kn(e,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Kn(e,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,i,r){if("translucent"===e.renderPass){var a=i.paint.get("circle-opacity"),o=i.paint.get("circle-stroke-width"),s=i.paint.get("circle-stroke-opacity"),u=!i.layout.get("circle-sort-key").isConstant();if(0!==a.constantOr(1)||0!==o.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,h=e.depthModeForSublayer(0,Mt.ReadOnly),p=Tt.disabled,f=e.colorModeForRenderPass(),d=[],v=0;v<r.length;v++){var m=r[v],g=n.getTile(m),y=g.getBucket(i);if(y){var _=y.programConfigurations.get(i.id),b={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:Pn(e,m,g,i)};if(u)for(var x=0,w=y.segments.get();x<w.length;x+=1){var S=w[x];d.push({segments:new t.SegmentVector([S]),sortKey:S.sortKey,state:b})}else d.push({segments:y.segments,sortKey:0,state:b})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var k=0,M=d;k<M.length;k+=1){var T=M[k],E=T.state;E.program.draw(l,c.TRIANGLES,h,p,f,Ct.disabled,E.uniformValues,i.id,E.layoutVertexBuffer,E.indexBuffer,T.segments,i.paint,e.transform.zoom,E.programConfiguration)}}}},heatmap:function(e,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var a=e.context,o=a.gl,s=Tt.disabled,u=new Et([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,i){var r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width/4,e.height/4,0,r.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(t,e,a,r)}}(a,e,i),a.clear({color:t.Color.transparent});for(var l=0;l<r.length;l++){var c=r[l];if(!n.hasRenderableParent(c)){var h=n.getTile(c),p=h.getBucket(i);if(p){var f=p.programConfigurations.get(i.id);e.useProgram("heatmap",f).draw(a,o.TRIANGLES,Mt.disabled,s,u,Ct.disabled,zn(c.posMatrix,h,e.transform.zoom,i.paint.get("heatmap-intensity")),i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,i.paint,e.transform.zoom,f)}}}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var i=e.context,r=i.gl,a=n.heatmapFbo;if(a){i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);var o=n.colorRampTexture;o||(o=n.colorRampTexture=new t.Texture(i,n.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,Mt.disabled,Tt.disabled,e.colorModeForRenderPass(),Ct.disabled,function(e,n,i,r){var a=t.create();t.ortho(a,0,e.width,e.height,0,0,1);var o=e.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,i))},line:function(e,n,i,r){if("translucent"===e.renderPass){var a=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1))for(var s=e.depthModeForSublayer(0,Mt.ReadOnly),u=e.colorModeForRenderPass(),l=i.paint.get("line-dasharray"),c=i.paint.get("line-pattern"),h=c.constantOr(1),p=i.paint.get("line-gradient"),f=i.getCrossfadeParameters(),d=h?"linePattern":l?"lineSDF":p?"lineGradient":"line",v=e.context,m=v.gl,g=!0,y=0,_=r;y<_.length;y+=1){var b=_[y],x=n.getTile(b);if(!h||x.patternsLoaded()){var w=x.getBucket(i);if(w){var S=w.programConfigurations.get(i.id),k=e.context.program.get(),M=e.useProgram(d,S),T=g||M.program!==k,E=c.constantOr(null);if(E&&x.imageAtlas){var C=x.imageAtlas,I=C.patternPositions[E.to.toString()],P=C.patternPositions[E.from.toString()];I&&P&&S.setConstantPatternPositions(I,P)}var A=h?Nn(e,x,i,f):l?Bn(e,x,i,l,f):p?Fn(e,x,i,w.lineClipsArray.length):On(e,x,i);if(h)v.activeTexture.set(m.TEXTURE0),x.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),S.updatePaintBuffers(f);else if(l&&(T||e.lineAtlas.dirty))v.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(v);else if(p){var L=w.gradients[i.id],R=L.texture;if(i.gradientVersion!==L.version){var D=256;if(i.stepInterpolant){var z=n.getSource().maxzoom,O=b.canonical.z===z?Math.ceil(1<<e.transform.maxZoom-b.canonical.z):1;D=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*O),256,v.maxTextureSize)}L.gradient=t.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:L.gradient||void 0,clips:w.lineClipsArray}),L.texture?L.texture.update(L.gradient):L.texture=new t.Texture(v,L.gradient,m.RGBA),L.version=i.gradientVersion,R=L.texture}v.activeTexture.set(m.TEXTURE0),R.bind(i.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}M.draw(v,m.TRIANGLES,s,e.stencilModeForClipping(b),u,Ct.disabled,A,i.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,i.paint,e.transform.zoom,S,w.layoutVertexBuffer2),g=!1}}}}},fill:function(e,n,i,r){var a=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=e.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===a.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Mt.ReadWrite:Mt.ReadOnly);ri(e,n,i,r,c,s,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){var h=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Mt.ReadOnly);ri(e,n,i,r,h,s,!0)}}},"fill-extrusion":function(t,e,n,i){var r=n.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){var a=new Mt(t.context.gl.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D);if(1!==r||n.paint.get("fill-extrusion-pattern").constantOr(1))ai(t,e,n,i,a,Tt.disabled,Et.disabled),ai(t,e,n,i,a,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var o=t.colorModeForRenderPass();ai(t,e,n,i,a,Tt.disabled,o)}}},hillshade:function(t,e,n,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var r=t.context,a=t.depthModeForSublayer(0,Mt.ReadOnly),o=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(i):[{},i],u=s[0],l=0,c=s[1];l<c.length;l+=1){var h=c[l],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?si(t,p,n,a,Tt.disabled,o):"translucent"===t.renderPass&&oi(t,p,n,a,u[h.overscaledZ],o)}r.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,i){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")&&i.length)for(var r=t.context,a=r.gl,o=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),l=o instanceof L?[{},i]:t.stencilConfigForOverlap(i),c=l[0],h=l[1],p=h[h.length-1].overscaledZ,f=!t.options.moving,d=0,v=h;d<v.length;d+=1){var m=v[d],g=t.depthModeForSublayer(m.overscaledZ-p,1===n.paint.get("raster-opacity")?Mt.ReadWrite:Mt.ReadOnly,a.LESS),y=e.getTile(m),_=t.transform.calculatePosMatrix(m.toUnwrapped(),f);y.registerFadeDuration(n.paint.get("raster-fade-duration"));var b=e.findLoadedParent(m,0),x=ui(y,b,e,n,t.transform),w=void 0,S=void 0,k="nearest"===n.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;r.activeTexture.set(a.TEXTURE0),y.texture.bind(k,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(a.TEXTURE1),b?(b.texture.bind(k,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),S=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(k,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var M=Un(_,S||[0,0],w||1,x,n);o instanceof L?s.draw(r,a.TRIANGLES,g,Tt.disabled,u,Ct.disabled,M,n.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):s.draw(r,a.TRIANGLES,g,c[m.overscaledZ],u,Ct.disabled,M,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var i=n.paint.get("background-color"),r=n.paint.get("background-opacity");if(0!==r){var a=t.context,o=a.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===i.a&&1===r&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=Tt.disabled,p=t.depthModeForSublayer(0,"opaque"===c?Mt.ReadWrite:Mt.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});l&&(a.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context));for(var m=n.getCrossfadeParameters(),g=0,y=v;g<y.length;g+=1){var _=y[g],b=t.transform.calculatePosMatrix(_.toUnwrapped()),x=l?Xn(b,r,t,l,{tileID:_,tileSize:u},m):Zn(b,r,i);d.draw(a,o.TRIANGLES,p,h,f,Ct.disabled,x,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var i=0;i<n.length;i++)gi(t,e,n[i])},custom:function(t,e,n){var i=t.context,r=n.implementation;if("offscreen"===t.renderPass){var a=r.prerender;a&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),a.call(r,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(Tt.disabled);var o="3d"===r.renderingMode?new Mt(t.context.gl.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Mt.ReadOnly);i.setDepthMode(o),r.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}},_i=function(t,e){this.context=new It(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Pt.maxUnderzooming+Pt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ne,this.gpuTimers={}};_i.prototype.resize=function(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,r=this.style._order;i<r.length;i+=1)this.style._layers[r[i]].resize()},_i.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,He.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,He.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,A.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,He.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new Tt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},_i.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=t.create();t.ortho(i,0,this.width,this.height,0,0,1),t.scale(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Mt.disabled,this.stencilClearMode,Et.disabled,Ct.disabled,Dn(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_i.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,i=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Et.disabled),n.setDepthMode(Mt.disabled);var r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,o=e;a<o.length;a+=1){var s=o[a],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;r.draw(n,i.TRIANGLES,Mt.disabled,new Tt({func:i.ALWAYS,mask:0},u,255,i.KEEP,i.KEEP,i.REPLACE),Et.disabled,Ct.disabled,Dn(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_i.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Tt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},_i.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Tt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},_i.prototype.stencilConfigForOverlap=function(t){var e,n=this.context.gl,i=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),r=i[i.length-1].overscaledZ,a=i[0].overscaledZ-r+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();for(var o={},s=0;s<a;s++)o[s+r]=new Tt({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=a,[o,i]}return[(e={},e[r]=Tt.disabled,e),i]},_i.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Et([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Et.unblended:Et.alphaBlended},_i.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return Mt.disabled;var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Mt(n||this.context.gl.LEQUAL,e,[i,i])},_i.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_i.prototype.render=function(e,n){var i=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var r=this.style._order,a=this.style.sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var u,l,c={},h={},p={};for(var f in a){var d=a[f];c[f]=d.getVisibleCoordinates(),h[f]=c[f].slice().reverse(),p[f]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var v=0;v<r.length;v++)if(this.style._layers[r[v]].is3D()){this.opaquePassCutoff=v;break}this.renderPass="offscreen";for(var m=0,g=r;m<g.length;m+=1){var y=this.style._layers[g[m]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var _=h[y.source];("custom"===y.type||_.length)&&this.renderLayer(this,a[y.source],y,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){var b=this.style._layers[r[this.currentLayer]],x=a[b.source],w=c[b.source];this._renderTileClippingMasks(b,w),this.renderLayer(this,x,b,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){var S=this.style._layers[r[this.currentLayer]],k=a[S.source],M=("symbol"===S.type?p:h)[S.source];this._renderTileClippingMasks(S,c[S.source]),this.renderLayer(this,k,S,M)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(i.transform.zoom)&&(t.source!==(l&&l.id)&&(l=i.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&yi.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;di(t,t.transform.height-(e.top||0),3,li),di(t,e.bottom||0,3,ci),vi(t,e.left||0,3,hi),vi(t,t.transform.width-(e.right||0),3,pi);var n=t.transform.centerPoint;!function(t,e,n,i){mi(t,e-1,n-10,2,20,i),mi(t,e-10,n-1,20,2,i)}(t,n.x,t.transform.height-n.y,fi)}(this),this.context.setDefault()},_i.prototype.renderLayer=function(t,e,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||i.length)&&(this.id=n.id,this.gpuTimingStart(n),yi[n.type](t,e,n,i,this.style.placement.variableOffsets),this.gpuTimingEnd())},_i.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},_i.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},_i.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},_i.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var i=t[n],r=this.context.extTimerQuery,a=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),e[n]=a}return e},_i.prototype.translatePosMatrix=function(e,n,i,r,a){if(!i[0]&&!i[1])return e;var o=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){var s=Math.sin(o),u=Math.cos(o);i=[i[0]*u-i[1]*s,i[0]*s+i[1]*u]}var l=[a?i[0]:pe(n,i[0],this.transform.zoom),a?i[1]:pe(n,i[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},_i.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},_i.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},_i.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},_i.prototype.useProgram=function(t,e){this.cache=this.cache||{};var n=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new wn(this.context,t,_n[t],e,Yn[t],this._showOverdrawInspector)),this.cache[n]},_i.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_i.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},_i.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_i.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var bi=function(t,e){this.points=t,this.planes=e};bi.fromInvProjectionMatrix=function(e,n,i){var r=Math.pow(2,i),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return t.transformMat4([],n,e)})).map((function(e){return t.scale$1([],e,1/e[3]/n*r)})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var n=t.sub([],a[e[0]],a[e[1]]),i=t.sub([],a[e[2]],a[e[1]]),r=t.normalize([],t.cross([],n,i)),o=-t.dot(r,a[e[1]]);return r.concat(o)}));return new bi(a,o)};var xi=function(e,n){this.min=e,this.max=n,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};xi.prototype.quadrant=function(e){for(var n=[e%2==0,e<2],i=t.clone$2(this.min),r=t.clone$2(this.max),a=0;a<n.length;a++)i[a]=n[a]?this.min[a]:this.center[a],r[a]=n[a]?this.center[a]:this.max[a];return r[2]=this.max[2],new xi(i,r)},xi.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},xi.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},xi.prototype.intersects=function(e){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],i=!0,r=0;r<e.planes.length;r++){for(var a=e.planes[r],o=0,s=0;s<n.length;s++)o+=t.dot$1(a,n[s])>=0;if(0===o)return 0;o!==n.length&&(i=!1)}if(i)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][u]-this.min[u];l=Math.min(l,p),c=Math.max(c,p)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var wi=function(t,e,n,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=i};wi.prototype.interpolate=function(e,n,i){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,i)),this},wi.prototype.getCenter=function(e,n){var i=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(i,r)},wi.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},wi.prototype.clone=function(){return new wi(this.top,this.bottom,this.left,this.right)},wi.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Si=function(e,n,i,r,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wi,this._posMatrixCache={},this._alignedPosMatrixCache={}},ki={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Si.prototype.clone=function(){var t=new Si(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},ki.minZoom.get=function(){return this._minZoom},ki.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},ki.maxZoom.get=function(){return this._maxZoom},ki.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},ki.minPitch.get=function(){return this._minPitch},ki.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},ki.maxPitch.get=function(){return this._maxPitch},ki.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},ki.renderWorldCopies.get=function(){return this._renderWorldCopies},ki.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},ki.worldSize.get=function(){return this.tileSize*this.scale},ki.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ki.size.get=function(){return new t.Point(this.width,this.height)},ki.bearing.get=function(){return-this.angle/Math.PI*180},ki.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ki.pitch.get=function(){return this._pitch/Math.PI*180},ki.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},ki.fov.get=function(){return this._fov/Math.PI*180},ki.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},ki.zoom.get=function(){return this._zoom},ki.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},ki.center.get=function(){return this._center},ki.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},ki.padding.get=function(){return this._edgeInsets.toJSON()},ki.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},ki.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Si.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Si.prototype.interpolatePadding=function(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()},Si.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Si.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new t.Point(0,0)),r=this.pointCoordinate(new t.Point(this.width,0)),a=this.pointCoordinate(new t.Point(this.width,this.height)),o=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(i.x,r.x,a.x,o.x)),u=Math.floor(Math.max(i.x,r.x,a.x,o.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},Si.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),i=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var r=t.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,n),o=[a*r.x,a*r.y,0],s=bi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var l=function(t){return{aabb:new xi([t*a,0,0],[(t+1)*a,a,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},c=[],h=[],p=n,f=e.reparseOverscaled?i:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)c.push(l(-d)),c.push(l(d));for(c.push(l(0));c.length>0;){var v=c.pop(),m=v.x,g=v.y,y=v.fullyVisible;if(!y){var _=v.aabb.intersects(s);if(0===_)continue;y=2===_}var b=v.aabb.distanceX(o),x=v.aabb.distanceY(o),w=Math.max(Math.abs(b),Math.abs(x));if(v.zoom===p||w>3+(1<<p-v.zoom)-2&&v.zoom>=u)h.push({tileID:new t.OverscaledTileID(v.zoom===p?f:v.zoom,v.wrap,v.zoom,m,g),distanceSq:t.sqrLen([o[0]-.5-m,o[1]-.5-g])});else for(var S=0;S<4;S++){var k=(m<<1)+S%2,M=(g<<1)+(S>>1);c.push({aabb:v.aabb.quadrant(S),zoom:v.zoom+1,x:k,y:M,wrap:v.wrap,fullyVisible:y})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Si.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},ki.unmodified.get=function(){return this._unmodified},Si.prototype.zoomScale=function(t){return Math.pow(2,t)},Si.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Si.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},Si.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},ki.point.get=function(){return this.project(this.center)},Si.prototype.setLocationAtPoint=function(e,n){var i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(e),o=new t.MercatorCoordinate(a.x-(i.x-r.x),a.y-(i.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},Si.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Si.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Si.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Si.prototype.coordinateLocation=function(t){return t.toLngLat()},Si.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse);var r=n[3],a=i[3],o=n[1]/r,s=i[1]/a,u=n[2]/r,l=i[2]/a,c=u===l?0:(0-u)/(l-u);return new t.MercatorCoordinate(t.number(n[0]/r,i[0]/a,c)/this.worldSize,t.number(o,s,c)/this.worldSize)},Si.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},Si.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Si.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Si.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Si.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var i=e.key,r=n?this._alignedPosMatrixCache:this._posMatrixCache;if(r[i])return r[i];var a=e.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*o,a.y*o,0]),t.scale(u,u,[o/t.EXTENT,o/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),r[i]=new Float32Array(u),r[i]},Si.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Si.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,i,r,a=-90,o=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;a=t.mercatorYfromLat(h[1])*this.worldSize,e=(o=t.mercatorYfromLat(h[0])*this.worldSize)-a<l.y?l.y/(o-a):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,n=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:f.x,e?(o+a)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var v=f.y,m=l.y/2;v-m<a&&(r=a+m),v+m>o&&(r=o-m)}if(this.lngRange){var g=f.x,y=l.x/2;g-y<s&&(i=s+y),g+y>u&&(i=u-y)}void 0===i&&void 0===r||(this.center=this.unproject(new t.Point(void 0!==i?i:f.x,void 0!==r?r:f.y))),this._unmodified=c,this._constraining=!1}},Si.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,i=this._fov*(.5+e.y/this.height),r=Math.sin(i)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-i,.01,Math.PI-.01)),a=this.point,o=a.x,s=a.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*r+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);t.perspective(c,this._fov,this.width/this.height,l,u),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,t.scale(c,c,[1,-1,1]),t.translate(c,c,[0,0,-this.cameraToCenterDistance]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle),t.translate(c,c,[-o,-s,0]),this.mercatorMatrix=t.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),t.scale(c,c,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,f=Math.cos(this.angle),d=Math.sin(this.angle),v=o-Math.round(o)+f*h+d*p,m=s-Math.round(s)+f*p+d*h,g=new Float64Array(c);if(t.translate(g,g,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=g,c=t.create(),t.scale(c,c,[this.width/2,-this.height/2,1]),t.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=t.create(),t.scale(c,c,[1,-1,1]),t.translate(c,c,[-1,-1,0]),t.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Si.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},Si.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Si.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var i=n.x,r=n.y,a=n.x,o=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];i=Math.min(i,l.x),r=Math.min(r,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}return[new t.Point(i,r),new t.Point(a,r),new t.Point(a,o),new t.Point(i,o),new t.Point(i,r)]},Object.defineProperties(Si.prototype,ki);var Mi=function(e){var n,i,r,a;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),i=!1,r=null,a=function(){r=null,i&&(n(),r=setTimeout(a,300),i=!1)},function(){return i=!0,r||a(),r})};Mi.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Mi.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Mi.prototype.getHashString=function(e){var n=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),o=Math.round(n.lng*a)/a,s=Math.round(n.lat*a)/a,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=e?"/"+o+"/"+s+"/"+i:i+"/"+s+"/"+o,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var h=this._hashName,p=!1,f=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+c):t})).filter((function(t){return t}));return p||f.push(h+"="+c),"#"+f.join("&")}return"#"+c},Mi.prototype._getCurrentHash=function(){var e,n=this,i=t.window.location.hash.replace("#","");return this._hashName?(i.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):i.split("/")},Mi.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Mi.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Ti={linearity:.3,easing:t.bezier(0,0,.3,1)},Ei=t.extend({deceleration:2500,maxSpeed:1400},Ti),Ci=t.extend({deceleration:20,maxSpeed:1400},Ti),Ii=t.extend({deceleration:1e3,maxSpeed:360},Ti),Pi=t.extend({deceleration:1e3,maxSpeed:90},Ti),Ai=function(t){this._map=t,this.clear()};function Li(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Ri(e,n,i){var r=i.maxSpeed,a=i.linearity,o=i.deceleration,s=t.clamp(e*a/(n/1e3),-r,r),u=Math.abs(s)/(o*a);return{easing:i.easing,duration:1e3*u,amount:s*(u/2)}}Ai.prototype.clear=function(){this._inertiaBuffer=[]},Ai.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Ai.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,n=t.browser.now();e.length>0&&n-e[0].time>160;)e.shift()},Ai.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},i=0,r=this._inertiaBuffer;i<r.length;i+=1){var a=r[i].settings;n.zoom+=a.zoomDelta||0,n.bearing+=a.bearingDelta||0,n.pitch+=a.pitchDelta||0,a.panDelta&&n.pan._add(a.panDelta),a.around&&(n.around=a.around),a.pinchAround&&(n.pinchAround=a.pinchAround)}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Ri(n.pan.mag(),o,t.extend({},Ei,e||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,Li(s,u)}if(n.zoom){var l=Ri(n.zoom,o,Ci);s.zoom=this._map.transform.zoom+l.amount,Li(s,l)}if(n.bearing){var c=Ri(n.bearing,o,Ii);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),Li(s,c)}if(n.pitch){var h=Ri(n.pitch,o,Pi);s.pitch=this._map.transform.pitch+h.amount,Li(s,h)}if(s.zoom||s.bearing){var p=void 0===n.pinchAround?n.around:n.pinchAround;s.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Di=function(e){function i(i,r,a,o){void 0===o&&(o={});var s=n.mousePos(r.getCanvasContainer(),a),u=r.unproject(s);e.call(this,i,t.extend({point:s,lngLat:u,originalEvent:a},o)),this._defaultPrevented=!1,this.target=r}e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i;var r={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,r),i}(t.Event),zi=function(e){function i(i,r,a){var o="touchend"===i?a.changedTouches:a.touches,s=n.touchPos(r.getCanvasContainer(),o),u=s.map((function(t){return r.unproject(t)})),l=s.reduce((function(t,e,n,i){return t.add(e.div(i.length))}),new t.Point(0,0)),c=r.unproject(l);e.call(this,i,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:a}),this._defaultPrevented=!1}e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i;var r={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,r),i}(t.Event),Oi=function(t){function e(e,n,i){t.call(this,e,{originalEvent:i}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),Fi=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};Fi.prototype.reset=function(){delete this._mousedownPos},Fi.prototype.wheel=function(t){return this._firePreventable(new Oi(t.type,this._map,t))},Fi.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Di(t.type,this._map,t))},Fi.prototype.mouseup=function(t){this._map.fire(new Di(t.type,this._map,t))},Fi.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Di(t.type,this._map,t))},Fi.prototype.dblclick=function(t){return this._firePreventable(new Di(t.type,this._map,t))},Fi.prototype.mouseover=function(t){this._map.fire(new Di(t.type,this._map,t))},Fi.prototype.mouseout=function(t){this._map.fire(new Di(t.type,this._map,t))},Fi.prototype.touchstart=function(t){return this._firePreventable(new zi(t.type,this._map,t))},Fi.prototype.touchmove=function(t){this._map.fire(new zi(t.type,this._map,t))},Fi.prototype.touchend=function(t){this._map.fire(new zi(t.type,this._map,t))},Fi.prototype.touchcancel=function(t){this._map.fire(new zi(t.type,this._map,t))},Fi.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},Fi.prototype.isEnabled=function(){return!0},Fi.prototype.isActive=function(){return!1},Fi.prototype.enable=function(){},Fi.prototype.disable=function(){};var Ni=function(t){this._map=t};Ni.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ni.prototype.mousemove=function(t){this._map.fire(new Di(t.type,this._map,t))},Ni.prototype.mousedown=function(){this._delayContextMenu=!0},Ni.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ni.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Di(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Ni.prototype.isEnabled=function(){return!0},Ni.prototype.isActive=function(){return!1},Ni.prototype.enable=function(){},Ni.prototype.disable=function(){};var Bi=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function ji(t,e){for(var n={},i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}Bi.prototype.isEnabled=function(){return!!this._enabled},Bi.prototype.isActive=function(){return!!this._active},Bi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Bi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Bi.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(n.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Bi.prototype.mousemoveWindow=function(t,e){if(this._active){var i=e;if(!(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)){var r=this._startPos;this._lastPos=i,this._box||(this._box=n.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var a=Math.min(r.x,i.x),o=Math.max(r.x,i.x),s=Math.min(r.y,i.y),u=Math.max(r.y,i.y);n.setTransform(this._box,"translate("+a+"px,"+s+"px)"),this._box.style.width=o-a+"px",this._box.style.height=u-s+"px"}}},Bi.prototype.mouseupWindow=function(e,i){var r=this;if(this._active&&0===e.button){var a=this._startPos,o=i;if(this.reset(),n.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(a,o,r._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Bi.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Bi.prototype.reset=function(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},Bi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var Vi=function(t){this.reset(),this.numTouches=t.numTouches};Vi.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Vi.prototype.touchstart=function(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){for(var n=new t.Point(0,0),i=0,r=e;i<r.length;i+=1)n._add(r[i]);return n.div(e.length)}(n),this.touches=ji(i,n)))},Vi.prototype.touchmove=function(t,e,n){if(!this.aborted&&this.centroid){var i=ji(n,e);for(var r in this.touches){var a=i[r];(!a||a.dist(this.touches[r])>30)&&(this.aborted=!0)}}},Vi.prototype.touchend=function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var i=!this.aborted&&this.centroid;if(this.reset(),i)return i}};var Ui=function(t){this.singleTap=new Vi(t),this.numTaps=t.numTaps,this.reset()};Ui.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ui.prototype.touchstart=function(t,e,n){this.singleTap.touchstart(t,e,n)},Ui.prototype.touchmove=function(t,e,n){this.singleTap.touchmove(t,e,n)},Ui.prototype.touchend=function(t,e,n){var i=this.singleTap.touchend(t,e,n);if(i){var r=t.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(i)<30;if(r&&a||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}};var $i=function(){this._zoomIn=new Ui({numTouches:1,numTaps:2}),this._zoomOut=new Ui({numTouches:2,numTaps:1}),this.reset()};$i.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},$i.prototype.touchstart=function(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)},$i.prototype.touchmove=function(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)},$i.prototype.touchend=function(t,e,n){var i=this,r=this._zoomIn.touchend(t,e,n),a=this._zoomOut.touchend(t,e,n);return r?(this._active=!0,t.preventDefault(),setTimeout((function(){return i.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}}):a?(this._active=!0,t.preventDefault(),setTimeout((function(){return i.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(a)},{originalEvent:t})}}):void 0},$i.prototype.touchcancel=function(){this.reset()},$i.prototype.enable=function(){this._enabled=!0},$i.prototype.disable=function(){this._enabled=!1,this.reset()},$i.prototype.isEnabled=function(){return this._enabled},$i.prototype.isActive=function(){return this._active};var Hi={0:1,2:2},qi=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};qi.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qi.prototype._correctButton=function(t,e){return!1},qi.prototype._move=function(t,e){return{}},qi.prototype.mousedown=function(t,e){if(!this._lastPoint){var i=n.mouseButton(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}},qi.prototype.mousemoveWindow=function(t,e){var n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Hi[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)},qi.prototype.mouseupWindow=function(t){this._lastPoint&&n.mouseButton(t)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},qi.prototype.enable=function(){this._enabled=!0},qi.prototype.disable=function(){this._enabled=!1,this.reset()},qi.prototype.isEnabled=function(){return this._enabled},qi.prototype.isActive=function(){return this._active};var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,n){t.prototype.mousedown.call(this,e,n),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(qi),Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(qi),Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(qi),Xi=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Xi.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Xi.prototype.touchstart=function(t,e,n){return this._calculateTransform(t,e,n)},Xi.prototype.touchmove=function(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)},Xi.prototype.touchend=function(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()},Xi.prototype.touchcancel=function(){this.reset()},Xi.prototype._calculateTransform=function(e,n,i){i.length>0&&(this._active=!0);var r=ji(i,n),a=new t.Point(0,0),o=new t.Point(0,0),s=0;for(var u in r){var l=r[u],c=this._touches[u];c&&(a._add(l),o._add(l.sub(c)),s++,r[u]=l)}if(this._touches=r,!(s<this._minTouches)&&o.mag()){var h=o.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:a.div(s),panDelta:h}}},Xi.prototype.enable=function(){this._enabled=!0},Xi.prototype.disable=function(){this._enabled=!1,this.reset()},Xi.prototype.isEnabled=function(){return this._enabled},Xi.prototype.isActive=function(){return this._active};var Yi=function(){this.reset()};function Ki(t,e,n){for(var i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function Ji(t,e){return Math.log(t/e)/Math.LN2}Yi.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Yi.prototype._start=function(t){},Yi.prototype._move=function(t,e,n){return{}},Yi.prototype.touchstart=function(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))},Yi.prototype.touchmove=function(t,e,n){if(this._firstTwoTouches){t.preventDefault();var i=this._firstTwoTouches,r=i[1],a=Ki(n,e,i[0]),o=Ki(n,e,r);if(a&&o){var s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,t)}}},Yi.prototype.touchend=function(t,e,i){if(this._firstTwoTouches){var r=this._firstTwoTouches,a=r[1],o=Ki(i,e,r[0]),s=Ki(i,e,a);o&&s||(this._active&&n.suppressClick(),this.reset())}},Yi.prototype.touchcancel=function(){this.reset()},Yi.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Yi.prototype.disable=function(){this._enabled=!1,this.reset()},Yi.prototype.isEnabled=function(){return this._enabled},Yi.prototype.isActive=function(){return this._active};var Qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ji(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ji(this._distance,n),pinchAround:e}},e}(Yi);function tr(t,e){return 180*t.angleWith(e)/Math.PI}var er=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,n),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,n=tr(t,this._startVector);return Math.abs(n)<e},e}(Yi);function nr(t){return Math.abs(t.y)>Math.abs(t.x)}var ir=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,nr(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,n){var i=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,n){if(void 0!==this._valid)return this._valid;var i=t.mag()>=2,r=e.mag()>=2;if(i||r){if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var a=t.y>0==e.y>0;return nr(t)&&nr(e)&&a}},e}(Yi),rr={panStep:100,bearingStep:15,pitchStep:10},ar=function(){var t=rr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function or(t){return t*(2-t)}ar.prototype.reset=function(){this._active=!1},ar.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,i=0,r=0,a=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),a=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),a=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:or,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+i*e._bearingStep,pitch:s.getPitch()+r*e._pitchStep,offset:[-a*e._panStep,-o*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},ar.prototype.enable=function(){this._enabled=!0},ar.prototype.disable=function(){this._enabled=!1,this.reset()},ar.prototype.isEnabled=function(){return this._enabled},ar.prototype.isActive=function(){return this._active},ar.prototype.disableRotation=function(){this._rotationDisabled=!0},ar.prototype.enableRotation=function(){this._rotationDisabled=!1};var sr=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};sr.prototype.setZoomRate=function(t){this._defaultZoomRate=t},sr.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},sr.prototype.isEnabled=function(){return!!this._enabled},sr.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},sr.prototype.isZooming=function(){return!!this._zooming},sr.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},sr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},sr.prototype.wheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,i=t.browser.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}},sr.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},sr.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var i=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},sr.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,r=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==r&&(r=1/r);var a="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(a*r))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),p=l(h);o=t.number(u,s,p),h<1?this._frameId||(this._frameId=!0):c=!0}else o=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:o-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},sr.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var i=this._prevEase,r=(t.browser.now()-i.start)/i.duration,a=i.easing(r+.01)-i.easing(r),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=t.bezier(o,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n},sr.prototype.reset=function(){this._active=!1};var ur=function(t,e){this._clickZoom=t,this._tapZoom=e};ur.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ur.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ur.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ur.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var lr=function(){this.reset()};lr.prototype.reset=function(){this._active=!1},lr.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}},lr.prototype.enable=function(){this._enabled=!0},lr.prototype.disable=function(){this._enabled=!1,this.reset()},lr.prototype.isEnabled=function(){return this._enabled},lr.prototype.isActive=function(){return this._active};var cr=function(){this._tap=new Ui({numTouches:1,numTaps:1}),this.reset()};cr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},cr.prototype.touchstart=function(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))},cr.prototype.touchmove=function(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var i=e[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,n)},cr.prototype.touchend=function(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)},cr.prototype.touchcancel=function(){this.reset()},cr.prototype.enable=function(){this._enabled=!0},cr.prototype.disable=function(){this._enabled=!1,this.reset()},cr.prototype.isEnabled=function(){return this._enabled},cr.prototype.isActive=function(){return this._active};var hr=function(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n};hr.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},hr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},hr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},hr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pr=function(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n};pr.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pr.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pr.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pr.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fr=function(t,e,n,i){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0};fr.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},fr.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},fr.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fr.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fr.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fr.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var dr=function(t){return t.zoom||t.drag||t.pitch||t.rotate},vr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function mr(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var gr=function(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ai(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i),t.bindAll(["handleEvent","handleWindowEvent"],this);var r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[t.window,"blur",void 0]];for(var a=0,o=this._listeners;a<o.length;a+=1){var s=o[a],u=s[0];n.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};gr.prototype.destroy=function(){for(var e=0,i=this._listeners;e<i.length;e+=1){var r=i[e],a=r[0];n.removeEventListener(a,r[1],a===t.window.document?this.handleWindowEvent:this.handleEvent,r[2])}},gr.prototype._addDefaultHandlers=function(t){var e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new Fi(e,t));var i=e.boxZoom=new Bi(e,t);this._add("boxZoom",i);var r=new $i,a=new lr;e.doubleClickZoom=new ur(a,r),this._add("tapZoom",r),this._add("clickZoom",a);var o=new cr;this._add("tapDragZoom",o);var s=e.touchPitch=new ir;this._add("touchPitch",s);var u=new Gi(t),l=new Zi(t);e.dragRotate=new pr(t,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new Wi(t),h=new Xi(t);e.dragPan=new hr(n,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var p=new er,f=new Qi;e.touchZoomRotate=new fr(n,f,p,o),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]);var d=e.scrollZoom=new sr(e,this);this._add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new ar;this._add("keyboard",v),this._add("blockableMapEvent",new Ni(e));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m+=1){var y=g[m];t.interactive&&t[y]&&e[y].enable(t[y])}},gr.prototype._add=function(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e},gr.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,n=this._handlers;e<n.length;e+=1)n[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},gr.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},gr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},gr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},gr.prototype.isMoving=function(){return Boolean(dr(this._eventsInProgress))||this.isZooming()},gr.prototype._blockedByActive=function(t,e,n){for(var i in t)if(i!==n&&(!e||e.indexOf(i)<0))return!0;return!1},gr.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},gr.prototype._getMapTouches=function(t){for(var e=[],n=0,i=t;n<i.length;n+=1){var r=i[n];this._el.contains(r.target)&&e.push(r)}return e},gr.prototype.handleEvent=function(t,e){if("blur"!==t.type){this._updatingCamera=!0;for(var i="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},a={},o={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,t),l=0,c=this._handlers;l<c.length;l+=1){var h=c[l],p=h.handlerName,f=h.handler,d=h.allowed;if(f.isEnabled()){var v=void 0;this._blockedByActive(o,d,p)?f.reset():f[e||t.type]&&(v=f[e||t.type](t,u,s),this.mergeHandlerResult(r,a,v,p,i),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||f.isActive())&&(o[p]=f)}}var m={};for(var g in this._previousActiveHandlers)o[g]||(m[g]=i);this._previousActiveHandlers=o,(Object.keys(m).length||mr(r))&&(this._changes.push([r,a,m]),this._triggerRenderFrame()),(Object.keys(o).length||mr(r))&&this._map._stop(!0),this._updatingCamera=!1;var y=r.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}else this.stop(!0)},gr.prototype.mergeHandlerResult=function(e,n,i,r,a){if(i){t.extend(e,i);var o={handlerName:r,originalEvent:i.originalEvent||a};void 0!==i.zoomDelta&&(n.zoom=o),void 0!==i.panDelta&&(n.drag=o),void 0!==i.pitchDelta&&(n.pitch=o),void 0!==i.bearingDelta&&(n.rotate=o)}},gr.prototype._applyChanges=function(){for(var e={},n={},i={},r=0,a=this._changes;r<a.length;r+=1){var o=a[r],s=o[0],u=o[1],l=o[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(n,u),t.extend(i,l)}this._updateMapTransform(e,n,i),this._changes=[]},gr.prototype._updateMapTransform=function(t,e,n){var i=this._map,r=i.transform;if(!mr(t))return this._fireEvents(e,n,!0);var a=t.panDelta,o=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,l=t.around,c=t.pinchAround;void 0!==c&&(l=c),i._stop(!0),l=l||i.transform.centerPoint;var h=r.pointLocation(a?l.sub(a):l);s&&(r.bearing+=s),u&&(r.pitch+=u),o&&(r.zoom+=o),r.setLocationAtPoint(h,l),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)},gr.prototype._fireEvents=function(e,n,i){var r=this,a=dr(this._eventsInProgress),o=dr(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var l in!a&&o&&this._fireEvent("movestart",o.originalEvent),s)this._fireEvent(l,s[l]);for(var c in o&&this._fireEvent("move",o.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,p={};for(var f in this._eventsInProgress){var d=this._eventsInProgress[f],v=d.handlerName,m=d.originalEvent;this._handlersById[v].isActive()||(delete this._eventsInProgress[f],p[f+"end"]=h=n[v]||m)}for(var g in p)this._fireEvent(g,p[g]);var y=dr(this._eventsInProgress);if(i&&(a||o)&&!y){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=function(t){return 0!==t&&-r._bearingSnap<t&&t<r._bearingSnap};_?(b(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),b(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},gr.prototype._fireEvent=function(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},gr.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new vr("renderFrame",{timeStamp:e})),t._applyChanges()}))},gr.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var yr=function(e){function n(n,i){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,i){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),i)},n.prototype.panTo=function(e,n,i){return this.easeTo(t.extend({center:e},n),i)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,i){return this.easeTo(t.extend({zoom:e},n),i)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},n.prototype.rotateTo=function(e,n,i){return this.easeTo(t.extend({bearing:e},n),i)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){e=t.LngLatBounds.convert(e);var i=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),i,n)},n.prototype._cameraForBoxAndBearing=function(e,n,i,r){var a={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=t.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=t.extend(a,r.padding);var s=this.transform,u=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(n)),h=l.rotate(-i*Math.PI/180),p=c.rotate(-i*Math.PI/180),f=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),d=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),v=f.sub(d),m=(s.width-(u.left+u.right+r.padding.left+r.padding.right))/v.x,g=(s.height-(u.top+u.bottom+r.padding.top+r.padding.bottom))/v.y;if(!(g<0||m<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),r.maxZoom),_="number"==typeof r.offset.x?new t.Point(r.offset.x,r.offset.y):t.Point.convert(r.offset),b=new t.Point((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(i*Math.PI/180),x=_.add(b).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:i}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,i,r,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),i,r),r,a)},n.prototype._fitInternal=function(e,n,i){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this},n.prototype.jumpTo=function(e,n){this.stop();var i=this.transform,r=!1,a=!1,o=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(a=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(o=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),r&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),a&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),o&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var i=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var r=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in e?+e.zoom:a,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:r.padding,f=t.Point.convert(e.offset),d=r.centerPoint.add(f),v=r.pointLocation(d),m=t.LngLat.convert(e.center||v);this._normalizeCenter(m);var g,y,_=r.project(v),b=r.project(m).sub(_),x=r.zoomScale(l-a);e.around&&(g=t.LngLat.convert(e.around),y=r.locationPoint(g));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==a,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||h!==s,this._padding=!r.isPaddingEqual(p),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,w),this._ease((function(e){if(i._zooming&&(r.zoom=t.number(a,l,e)),i._rotating&&(r.bearing=t.number(o,c,e)),i._pitching&&(r.pitch=t.number(s,h,e)),i._padding&&(r.interpolatePadding(u,p,e),d=r.centerPoint.add(f)),g)r.setLocationAtPoint(g,y);else{var v=r.zoomScale(r.zoom-a),m=l>a?Math.min(2,x):Math.max(.5,x),w=Math.pow(m,1-e),S=r.unproject(_.add(b.mult(e*w)).mult(v));r.setLocationAtPoint(r.renderWorldCopies?S.wrap():S,d)}i._fireMoveEvents(n)}),(function(t){i._afterEase(n,t)}),e),this},n.prototype._prepareEase=function(e,n,i){void 0===i&&(i={}),this._moving=!0,n||i.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var i=this._zooming,r=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),a&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},n.prototype.flyTo=function(e,n){var i=this;if(!e.essential&&t.browser.prefersReducedMotion){var r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var a=this.transform,o=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,a.minZoom,a.maxZoom):o,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:u,f="padding"in e?e.padding:a.padding,d=a.zoomScale(c-o),v=t.Point.convert(e.offset),m=a.centerPoint.add(v),g=a.pointLocation(m),y=t.LngLat.convert(e.center||g);this._normalizeCenter(y);var _=a.project(g),b=a.project(y).sub(_),x=e.curve,w=Math.max(a.width,a.height),S=w/d,k=b.mag();if("minZoom"in e){var M=t.clamp(Math.min(e.minZoom,o,c),a.minZoom,a.maxZoom),T=w/a.zoomScale(M-o);x=Math.sqrt(T/k*2)}var E=x*x;function C(t){var e=(S*S-w*w+(t?-1:1)*E*E*k*k)/(2*(t?S:w)*E*k);return Math.log(Math.sqrt(e*e+1)-e)}function I(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}var A=C(0),L=function(t){return P(A)/P(A+x*t)},R=function(t){return w*((P(A)*(I(e=A+x*t)/P(e))-I(A))/E)/k;var e},D=(C(1)-A)/x;if(Math.abs(k)<1e-6||!isFinite(D)){if(Math.abs(w-S)<1e-6)return this.easeTo(e,n);var z=S<w?-1:1;D=Math.abs(Math.log(S/w))/x,R=function(){return 0},L=function(t){return Math.exp(z*x*t)}}return e.duration="duration"in e?+e.duration:1e3*D/("screenSpeed"in e?+e.screenSpeed/x:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==u,this._padding=!a.isPaddingEqual(f),this._prepareEase(n,!1),this._ease((function(e){var r=e*D,d=1/L(r);a.zoom=1===e?c:o+a.scaleZoom(d),i._rotating&&(a.bearing=t.number(s,h,e)),i._pitching&&(a.pitch=t.number(u,p,e)),i._padding&&(a.interpolatePadding(l,f,e),m=a.centerPoint.add(v));var g=1===e?y:a.unproject(_.add(b.mult(R(r))).mult(d));a.setLocationAtPoint(a.renderWorldCopies?g.wrap():g,m),i._fireMoveEvents(n)}),(function(){return i._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var i=this.handlers;i&&i.stop(!1)}return this},n.prototype._ease=function(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),_r=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};_r.prototype.getDefaultPosition=function(){return"bottom-right"},_r.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.type="button",this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("maplibregl-compact","mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},_r.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},_r.prototype._setElementTitle=function(t,e){var n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)},_r.prototype._toggleAttribution=function(){this._container.classList.contains("maplibregl-compact-show")||this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},_r.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var i=n.reduce((function(t,e,i){return e.value&&(t+=e.key+"="+e.value+(i<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},_r.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},_r.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var i in n){var r=n[i];if(r.used){var a=r.getSource();a.attribution&&t.indexOf(a.attribution)<0&&t.push(a.attribution)}}t.sort((function(t,e){return t.length-e.length}));var o=(t=t.filter((function(e,n){for(var i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0}))).join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._editLink=null)}},_r.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("maplibregl-compact","mapboxgl-compact"):this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show")};var br=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};br.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","maplibregl-ctrl mapboxgl-ctrl");var e=n.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},br.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},br.prototype.getDefaultPosition=function(){return"bottom-left"},br.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},br.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},br.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("maplibregl-compact","mapboxgl-compact"):e.classList.remove("maplibregl-compact","mapboxgl-compact")}};var xr=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};xr.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},xr.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,i=e?this._queue.concat(e):this._queue;n<i.length;n+=1){var r=i[n];if(r.id===t)return void(r.cancelled=!0)}},xr.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,i=e;n<i.length;n+=1){var r=i[n];if(!r.cancelled&&(r.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},xr.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Sr=t.window.HTMLImageElement,kr=t.window.HTMLElement,Mr=t.window.ImageBitmap,Tr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Er=function(i){function r(e){var n=this;if(null!=(e=t.extend({},Tr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var r=new Si(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(i.call(this,r,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new xr,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},wr,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof kr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new gr(this,e),this._hash=e.hash&&new Mi("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _r({customAttribution:e.customAttribution})),this.addControl(new br,e.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){n.fire(new t.Event(e.dataType+"dataloading",e))}))}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return r.prototype._getMapId=function(){return this._mapId},r.prototype.addControl=function(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=e.onAdd(this);this._controls.push(e);var r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this},r.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},r.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},r.prototype.resize=function(e){var n=this._containerDimensions(),i=n[0],r=n[1];this._resizeCanvas(i,r),this.transform.resize(i,r),this.painter.resize(i,r);var a=!this._moving;return a&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),a&&this.fire(new t.Event("moveend",e)),this},r.prototype.getBounds=function(){return this.transform.getBounds()},r.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},r.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},r.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},r.prototype.getMinZoom=function(){return this.transform.minZoom},r.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},r.prototype.getMaxZoom=function(){return this.transform.maxZoom},r.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},r.prototype.getMinPitch=function(){return this.transform.minPitch},r.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},r.prototype.getMaxPitch=function(){return this.transform.maxPitch},r.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},r.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},r.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},r.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},r.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},r.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},r.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},r.prototype._createDelegatedListener=function(t,e,n){var i,r=this;if("mouseenter"===t||"mouseover"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){var o=r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[];o.length?a||(a=!0,n.call(r,new Di(t,r,i.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"===t||"mouseout"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){(r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?o=!0:o&&(o=!1,n.call(r,new Di(t,r,i.originalEvent)))},mouseout:function(e){o&&(o=!1,n.call(r,new Di(t,r,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(i={},i[t]=function(t){var i=r.getLayer(e)?r.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,n.call(r,t),delete t.features)},i)}},r.prototype.on=function(t,e,n){if(void 0===n)return i.prototype.on.call(this,t,e);var r=this._createDelegatedListener(t,e,n);for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r),r.delegates)this.on(a,r.delegates[a]);return this},r.prototype.once=function(t,e,n){if(void 0===n)return i.prototype.once.call(this,t,e);var r=this._createDelegatedListener(t,e,n);for(var a in r.delegates)this.once(a,r.delegates[a]);return this},r.prototype.off=function(t,e,n){var r=this;return void 0===n?i.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(i){for(var a=i[t],o=0;o<a.length;o++){var s=a[o];if(s.layer===e&&s.listener===n){for(var u in s.delegates)r.off(u,s.delegates[u]);return a.splice(o,1),r}}}(this._delegatedListeners),this)},r.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var i;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])i=[t.Point.convert(e)];else{var r=t.Point.convert(e[0]),a=t.Point.convert(e[1]);i=[r,new t.Point(a.x,r.y),a,new t.Point(r.x,a.y),r]}return this.style.queryRenderedFeatures(i,n,this.transform)},r.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},r.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},r.prototype.setTransformRequest=function(t){return this._requestManager.setTransformRequest(t),this},r.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},r.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new $e(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},r.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new $e(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},r.prototype._diffStyle=function(e,n){var i=this;if("string"==typeof e){var r=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(a,(function(e,r){e?i.fire(new t.ErrorEvent(e)):r&&i._updateDiff(r,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},r.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce("Unable to perform style diff: "+(i.message||i.error||i)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},r.prototype.getStyle=function(){if(this.style)return this.style.serialize()},r.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},r.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},r.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},r.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var i in n){var r=n[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},r.prototype.addSourceType=function(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)},r.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},r.prototype.getSource=function(t){return this.style.getSource(t)},r.prototype.addImage=function(e,n,i){void 0===i&&(i={});var r=i.pixelRatio;void 0===r&&(r=1);var a=i.sdf;void 0===a&&(a=!1);var o=i.stretchX,s=i.stretchY,u=i.content;if(this._lazyInitEmptyStyle(),n instanceof Sr||Mr&&n instanceof Mr){var l=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:r,stretchX:o,stretchY:s,content:u,sdf:a,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n;this.style.addImage(e,{data:new t.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:r,stretchX:o,stretchY:s,content:u,sdf:a,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},r.prototype.updateImage=function(e,n){var i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var r=n instanceof Sr||Mr&&n instanceof Mr?t.browser.getImageData(n):n,a=r.width,o=r.height,s=r.data;return void 0===a||void 0===o?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==i.data.width||o!==i.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(i.data.replace(s,!(n instanceof Sr||Mr&&n instanceof Mr)),void this.style.updateImage(e,i))},r.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},r.prototype.removeImage=function(t){this.style.removeImage(t)},r.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},r.prototype.listImages=function(){return this.style.listImages()},r.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},r.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},r.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},r.prototype.getLayer=function(t){return this.style.getLayer(t)},r.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},r.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},r.prototype.getFilter=function(t){return this.style.getFilter(t)},r.prototype.setPaintProperty=function(t,e,n,i){return void 0===i&&(i={}),this.style.setPaintProperty(t,e,n,i),this._update(!0)},r.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},r.prototype.setLayoutProperty=function(t,e,n,i){return void 0===i&&(i={}),this.style.setLayoutProperty(t,e,n,i),this._update(!0)},r.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},r.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},r.prototype.getLight=function(){return this.style.getLight()},r.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},r.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},r.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},r.prototype._setupContainer=function(){var t=this._container;t.classList.add("maplibregl-map","mapboxgl-map");var e=this._canvasContainer=n.create("div","maplibregl-canvas-container mapboxgl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=n.create("canvas","maplibregl-canvas mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var r=this._controlContainer=n.create("div","maplibregl-control-container mapboxgl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){a[t]=n.create("div","maplibregl-ctrl-"+t+" mapboxgl-ctrl-"+t,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},r.prototype._resizeCanvas=function(e,n){var i=t.browser.devicePixelRatio||1;this._canvas.width=i*e,this._canvas.height=i*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},r.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(this.painter=new _i(i,this.transform),t.webpSupported.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},r.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},r.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},r.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},r.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},r.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},r.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},r.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},r.prototype._render=function(e){var n,i=this,r=0,a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n),r=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var l=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(o=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-r;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout((function(){var e=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),i.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var p=this.painter.collectGpuTimers();setTimeout((function(){var e=i.painter.queryGpuTimers(p);i.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0),this}},r.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),Cr(this._canvasContainer),Cr(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},r.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},r.prototype._onWindowOnline=function(){this._update()},r.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update()},r.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},a.version.get=function(){return t.version},Object.defineProperties(r.prototype,a),r}(yr);function Cr(t){t.parentNode&&t.parentNode.removeChild(t)}var Ir={showCompass:!0,showZoom:!0,visualizePitch:!1},Pr=function(e){var i=this;this.options=t.extend({},Ir,e),this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",(function(t){return i._map.zoomIn({},{originalEvent:t})})),n.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",(function(t){return i._map.zoomOut({},{originalEvent:t})})),n.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",(function(t){i.options.visualizePitch?i._map.resetNorthPitch({},{originalEvent:t}):i._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Pr.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Pr.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Pr.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ar(this._map,this._compass,this.options.visualizePitch)),this._container},Pr.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Pr.prototype._createButton=function(t,e){var i=n.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i},Pr.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Ar=function(e,i,r){void 0===r&&(r=!1),this._clickTolerance=10,this.element=i,this.mouseRotate=new Gi({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new Zi({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(i,"mousedown",this.mousedown),n.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(i,"touchmove",this.touchmove),n.addEventListener(i,"touchend",this.touchend),n.addEventListener(i,"touchcancel",this.reset)};function Lr(e,n,i){if(e=new t.LngLat(e.lng,e.lat),n){var r=new t.LngLat(e.lng-360,e.lat),a=new t.LngLat(e.lng+360,e.lat),o=i.locationPoint(e).distSqr(n);i.locationPoint(r).distSqr(n)<o?e=r:i.locationPoint(a).distSqr(n)<o&&(e=a)}for(;Math.abs(e.lng-i.center.lng)>180;){var s=i.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=i.width&&s.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}Ar.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),n.disableDrag()},Ar.prototype.move=function(t,e){var n=this.map,i=this.mouseRotate.mousemoveWindow(t,e);if(i&&i.bearingDelta&&n.setBearing(n.getBearing()+i.bearingDelta),this.mousePitch){var r=this.mousePitch.mousemoveWindow(t,e);r&&r.pitchDelta&&n.setPitch(n.getPitch()+r.pitchDelta)}},Ar.prototype.off=function(){var t=this.element;n.removeEventListener(t,"mousedown",this.mousedown),n.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(t,"touchmove",this.touchmove),n.removeEventListener(t,"touchend",this.touchend),n.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Ar.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(t.window,"mousemove",this.mousemove),n.removeEventListener(t.window,"mouseup",this.mouseup)},Ar.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),n.mousePos(this.element,e)),n.addEventListener(t.window,"mousemove",this.mousemove),n.addEventListener(t.window,"mouseup",this.mouseup)},Ar.prototype.mousemove=function(t){this.move(t,n.mousePos(this.element,t))},Ar.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Ar.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Ar.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Ar.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ar.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Rr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dr(t,e,n){var i=t.classList;for(var r in Rr)i.remove("maplibregl-"+n+"-anchor-"+r,"mapboxgl-"+n+"-anchor-"+r);i.add("maplibregl-"+n+"-anchor-"+e,"mapboxgl-"+n+"-anchor-"+e)}var zr,Or=function(e){function i(i,r){if(e.call(this),(i instanceof t.window.HTMLElement||r)&&(i=t.extend({element:i},r)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=t.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var a=n.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=n.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=n.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var m=n.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(m);var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var b=n.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),y.appendChild(_),y.appendChild(b),s.appendChild(u),s.appendChild(f),s.appendChild(v),s.appendChild(g),s.appendChild(y),a.appendChild(s),a.setAttributeNS(null,"height",41*this._scale+"px"),a.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(a),this._offset=t.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Dr(this._element,this._anchor,"marker"),this._popup=null}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},i.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},i.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},i.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Lr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Rr[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+i+" "+e)}},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},i.prototype._onMove=function(e){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},i.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},i.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.isDraggable=function(){return this._draggable},i.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},i.prototype.getRotation=function(){return this._rotation},i.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},i.prototype.getRotationAlignment=function(){return this._rotationAlignment},i.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},i.prototype.getPitchAlignment=function(){return this._pitchAlignment},i}(t.Evented),Fr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Nr=0,Br=!1,jr=function(e){function i(n){e.call(this),this.options=t.extend({},Fr,n),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==zr?i(zr):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){i(zr="denied"!==t.state)})):i(zr=!!t.window.navigator.geolocation),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Nr=0,Br=!1},i.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},i.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}},i.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},i.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),a=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),a,{geolocateSource:!0})},i.prototype._updateMarker=function(e){if(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},i.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),i=e.distanceTo(n),r=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=r+"px",this._circleElement.style.height=r+"px"},i.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},i.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Br)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},i.prototype._setupUI=function(e){var i=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),n.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{var a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Or(this._dotElement),this._circleElement=n.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Or({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),i._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")))}))},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Nr--,Br=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Nr>1?(e={maximumAge:6e5,timeout:0},Br=!0):(e=this.options.positionOptions,Br=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},i}(t.Evented),Vr={maxWidth:100,unit:"metric"},Ur=function(e){this.options=t.extend({},Vr,e),t.bindAll(["_onMove","setUnit"],this)};function $r(t,e,n){var i=n&&n.maxWidth||100,r=t._container.clientHeight/2,a=t.unproject([0,r]),o=t.unproject([i,r]),s=a.distanceTo(o);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Hr(e,i,u/5280,t._getUIString("ScaleControl.Miles")):Hr(e,i,u,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Hr(e,i,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Hr(e,i,s/1e3,t._getUIString("ScaleControl.Kilometers")):Hr(e,i,s,t._getUIString("ScaleControl.Meters"))}function Hr(t,e,n,i){var r,a,o,s=(r=n,(a=Math.pow(10,(""+Math.floor(r)).length-1))*(o=(o=r/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(o)));t.style.width=e*(s/n)+"px",t.innerHTML=s+"&nbsp;"+i}Ur.prototype.getDefaultPosition=function(){return"bottom-left"},Ur.prototype._onMove=function(){$r(this._map,this._container,this.options)},Ur.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ur.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ur.prototype.setUnit=function(t){this.options.unit=t,$r(this._map,this._container,this.options)};var qr=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};qr.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},qr.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},qr.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},qr.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},qr.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},qr.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},qr.prototype._isFullscreen=function(){return this._fullscreen},qr.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},qr.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Wr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zr=function(e){function i(n){e.call(this),this.options=t.extend(Object.create(Wr),n),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this},i.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this},i.prototype.getElement=function(){return this._container},i.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},i.prototype.setHTML=function(e){var n,i=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");for(r.innerHTML=e;n=r.firstChild;)i.appendChild(n);return this.setDOMContent(i)},i.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},i.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},i.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},i.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},i.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},i.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},i.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},i.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},i.prototype._onMouseUp=function(t){this._update(t.point)},i.prototype._onMouseMove=function(t){this._update(t.point)},i.prototype._onDrag=function(t){this._update(t.point)},i.prototype._update=function(e){var i=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return i._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lr(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var r=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),a=this.options.anchor,o=function e(n){if(n){if("number"==typeof n){var i=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(i,i),"top-right":new t.Point(-i,i),bottom:new t.Point(0,-n),"bottom-left":new t.Point(i,-i),"bottom-right":new t.Point(-i,-i),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var r=t.Point.convert(n);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!a){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=r.y+o.bottom.y<l?["top"]:r.y>this._map.transform.height-l?["bottom"]:[],r.x<u/2?s.push("left"):r.x>this._map.transform.width-u/2&&s.push("right"),a=0===s.length?"bottom":s.join("-")}var c=r.add(o[a]).round();n.setTransform(this._container,Rr[a]+" translate("+c.x+"px,"+c.y+"px)"),Dr(this._container,a,"popup")}},i.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Gr);t&&t.focus()}},i.prototype._onClose=function(){this.remove()},i}(t.Evented),Xr={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Er,NavigationControl:Pr,GeolocateControl:jr,AttributionControl:_r,ScaleControl:Ur,FullscreenControl:qr,Popup:Zr,Marker:Or,Style:$e,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Nt().acquire(Dt)},clearPrewarmedResources:function(){var t=Ot;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return zt.workerCount},set workerCount(t){zt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:"",addProtocol:function(e,n){t.config.REGISTERED_PROTOCOLS[e]=n},removeProtocol:function(e){delete t.config.REGISTERED_PROTOCOLS[e]}};return Xr})),n}()},725:function(t){"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function r(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(t){i[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(r){return!1}}()?Object.assign:function(t,a){for(var o,s,u=r(t),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))n.call(o,c)&&(u[c]=o[c]);if(e){s=e(o);for(var h=0;h<s.length;h++)i.call(o,s[h])&&(u[s[h]]=o[s[h]])}}return u}},151:function(t,e,n){var i=n(571);t.exports=f,t.exports.parse=a,t.exports.compile=function(t,e){return s(a(t,e),e)},t.exports.tokensToFunction=s,t.exports.tokensToRegExp=p;var r=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function a(t,e){for(var n,i=[],a=0,o=0,s="",c=e&&e.delimiter||"/";null!=(n=r.exec(t));){var h=n[0],p=n[1],f=n.index;if(s+=t.slice(o,f),o=f+h.length,p)s+=p[1];else{var d=t[o],v=n[2],m=n[3],g=n[4],y=n[5],_=n[6],b=n[7];s&&(i.push(s),s="");var x=null!=v&&null!=d&&d!==v,w="+"===_||"*"===_,S="?"===_||"*"===_,k=n[2]||c,M=g||y;i.push({name:m||a++,prefix:v||"",delimiter:k,optional:S,repeat:w,partial:x,asterisk:!!b,pattern:M?l(M):b?".*":"[^"+u(k)+"]+?"})}}return o<t.length&&(s+=t.substr(o)),s&&i.push(s),i}function o(t){return encodeURI(t).replace(/[\/?#]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}))}function s(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)"object"===typeof t[r]&&(n[r]=new RegExp("^(?:"+t[r].pattern+")$",h(e)));return function(e,r){for(var a="",s=e||{},u=(r||{}).pretty?o:encodeURIComponent,l=0;l<t.length;l++){var c=t[l];if("string"!==typeof c){var h,p=s[c.name];if(null==p){if(c.optional){c.partial&&(a+=c.prefix);continue}throw new TypeError('Expected "'+c.name+'" to be defined')}if(i(p)){if(!c.repeat)throw new TypeError('Expected "'+c.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(c.optional)continue;throw new TypeError('Expected "'+c.name+'" to not be empty')}for(var f=0;f<p.length;f++){if(h=u(p[f]),!n[l].test(h))throw new TypeError('Expected all "'+c.name+'" to match "'+c.pattern+'", but received `'+JSON.stringify(h)+"`");a+=(0===f?c.prefix:c.delimiter)+h}}else{if(h=c.asterisk?encodeURI(p).replace(/[?#]/g,(function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})):u(p),!n[l].test(h))throw new TypeError('Expected "'+c.name+'" to match "'+c.pattern+'", but received "'+h+'"');a+=c.prefix+h}}else a+=c}return a}}function u(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function l(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function c(t,e){return t.keys=e,t}function h(t){return t&&t.sensitive?"":"i"}function p(t,e,n){i(e)||(n=e||n,e=[]);for(var r=(n=n||{}).strict,a=!1!==n.end,o="",s=0;s<t.length;s++){var l=t[s];if("string"===typeof l)o+=u(l);else{var p=u(l.prefix),f="(?:"+l.pattern+")";e.push(l),l.repeat&&(f+="(?:"+p+f+")*"),o+=f=l.optional?l.partial?p+"("+f+")?":"(?:"+p+"("+f+"))?":p+"("+f+")"}}var d=u(n.delimiter||"/"),v=o.slice(-d.length)===d;return r||(o=(v?o.slice(0,-d.length):o)+"(?:"+d+"(?=$))?"),o+=a?"$":r&&v?"":"(?="+d+"|$)",c(new RegExp("^"+o,h(n)),e)}function f(t,e,n){return i(e)||(n=e||n,e=[]),n=n||{},t instanceof RegExp?function(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)e.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return c(t,e)}(t,e):i(t)?function(t,e,n){for(var i=[],r=0;r<t.length;r++)i.push(f(t[r],e,n).source);return c(new RegExp("(?:"+i.join("|")+")",h(n)),e)}(t,e,n):function(t,e,n){return p(a(t,n),e,n)}(t,e,n)}},386:function(t,e,n){"use strict";t.exports=r;var i=n(38);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var a=4294967296,o=1/a,s="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function u(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function h(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function y(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function _(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function x(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,t(r,e,this),this.pos===a&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=b(this.buf,this.pos)+b(this.buf,this.pos+4)*a;return this.pos+=8,t},readSFixed64:function(){var t=b(this.buf,this.pos)+w(this.buf,this.pos+4)*a;return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,a=n.buf;if(r=a[n.pos++],i=(112&r)>>4,r<128)return l(t,i,e);if(r=a[n.pos++],i|=(127&r)<<3,r<128)return l(t,i,e);if(r=a[n.pos++],i|=(127&r)<<10,r<128)return l(t,i,e);if(r=a[n.pos++],i|=(127&r)<<17,r<128)return l(t,i,e);if(r=a[n.pos++],i|=(127&r)<<24,r<128)return l(t,i,e);if(r=a[n.pos++],i|=(1&r)<<31,r<128)return l(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&s?function(t,e,n){return s.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){var i="",r=e;for(;r<n;){var a,o,s,u=t[r],l=null,c=u>239?4:u>223?3:u>191?2:1;if(r+c>n)break;1===c?u<128&&(l=u):2===c?128===(192&(a=t[r+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(a=t[r+1],o=t[r+2],128===(192&a)&&128===(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[r+1],o=t[r+2],s=t[r+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==r.Bytes)return t.push(this.readVarint(e));var n=u(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==r.Bytes)return t.push(this.readSVarint());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==r.Bytes)return t.push(this.readBoolean());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==r.Bytes)return t.push(this.readFloat());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==r.Bytes)return t.push(this.readDouble());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*o),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,a=0;a<e.length;a++){if((i=e.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&c(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&c(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,r.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,_,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},888:function(t,e,n){"use strict";var i=n(47);function r(){}function a(){}a.resetWarningCache=r,t.exports=function(){function t(t,e,n,r,a,o){if(o!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},7:function(t,e,n){t.exports=n(888)()},47:function(t){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},463:function(t,e,n){"use strict";var i=n(791),r=n(725),a=n(296);function o(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(o(227));var s=new Set,u={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(u[t]=e,t=0;t<e.length;t++)s.add(e[t])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f=Object.prototype.hasOwnProperty,d={},v={};function m(t,e,n,i,r,a,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(t){g[t]=new m(t,0,!1,t,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(t){var e=t[0];g[e]=new m(e,1,!1,t[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(t){g[t]=new m(t,2,!1,t.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(t){g[t]=new m(t,2,!1,t,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(t){g[t]=new m(t,3,!1,t.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(t){g[t]=new m(t,3,!0,t,null,!1,!1)})),["capture","download"].forEach((function(t){g[t]=new m(t,4,!1,t,null,!1,!1)})),["cols","rows","size","span"].forEach((function(t){g[t]=new m(t,6,!1,t,null,!1,!1)})),["rowSpan","start"].forEach((function(t){g[t]=new m(t,5,!1,t.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function _(t){return t[1].toUpperCase()}function b(t,e,n,i){var r=g.hasOwnProperty(e)?g[e]:null;(null!==r?0===r.type:!i&&(2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])))||(function(t,e,n,i){if(null===e||"undefined"===typeof e||function(t,e,n,i){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,r,i)&&(n=null),i||null===r?function(t){return!!f.call(v,t)||!f.call(d,t)&&(p.test(t)?v[t]=!0:(d[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=null===n?3!==r.type&&"":n:(e=r.attributeName,i=r.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(t){var e=t.replace(y,_);g[e]=new m(e,1,!1,t,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(t){var e=t.replace(y,_);g[e]=new m(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(t){var e=t.replace(y,_);g[e]=new m(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!0,!0)}));var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=60103,S=60106,k=60107,M=60108,T=60114,E=60109,C=60110,I=60112,P=60113,A=60120,L=60115,R=60116,D=60121,z=60128,O=60129,F=60130,N=60131;if("function"===typeof Symbol&&Symbol.for){var B=Symbol.for;w=B("react.element"),S=B("react.portal"),k=B("react.fragment"),M=B("react.strict_mode"),T=B("react.profiler"),E=B("react.provider"),C=B("react.context"),I=B("react.forward_ref"),P=B("react.suspense"),A=B("react.suspense_list"),L=B("react.memo"),R=B("react.lazy"),D=B("react.block"),B("react.scope"),z=B("react.opaque.id"),O=B("react.debug_trace_mode"),F=B("react.offscreen"),N=B("react.legacy_hidden")}var j,V="function"===typeof Symbol&&Symbol.iterator;function U(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=V&&t[V]||t["@@iterator"])?t:null}function $(t){if(void 0===j)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);j=e&&e[1]||""}return"\n"+j+t}var H=!1;function q(t,e){if(!t||H)return"";H=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){i=u}t.call(e.prototype)}else{try{throw Error()}catch(u){i=u}t()}}catch(u){if(u&&i&&"string"===typeof u.stack){for(var r=u.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s])return"\n"+r[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{H=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?$(t):""}function W(t){switch(t.tag){case 5:return $(t.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return t=q(t.type,!1);case 11:return t=q(t.type.render,!1);case 22:return t=q(t.type._render,!1);case 1:return t=q(t.type,!0);default:return""}}function G(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case k:return"Fragment";case S:return"Portal";case T:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case A:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case C:return(t.displayName||"Context")+".Consumer";case E:return(t._context.displayName||"Context")+".Provider";case I:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case L:return G(t.type);case D:return G(t._render);case R:e=t._payload,t=t._init;try{return G(t(e))}catch(n){}}return null}function Z(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function X(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function Y(t){t._valueTracker||(t._valueTracker=function(t){var e=X(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){i=""+t,a.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function K(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=X(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function J(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Q(t,e){var n=e.checked;return r({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function tt(t,e){var n=null==e.defaultValue?"":e.defaultValue,i=null!=e.checked?e.checked:e.defaultChecked;n=Z(null!=e.value?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function et(t,e){null!=(e=e.checked)&&b(t,"checked",e,!1)}function nt(t,e){et(t,e);var n=Z(e.value),i=e.type;if(null!=n)"number"===i?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===i||"reset"===i)return void t.removeAttribute("value");e.hasOwnProperty("value")?rt(t,e.type,n):e.hasOwnProperty("defaultValue")&&rt(t,e.type,Z(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function it(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!("submit"!==i&&"reset"!==i||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function rt(t,e,n){"number"===e&&J(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function at(t,e){return t=r({children:void 0},e),(e=function(t){var e="";return i.Children.forEach(t,(function(t){null!=t&&(e+=t)})),e}(e.children))&&(t.children=e),t}function ot(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Z(n),e=null,r=0;r<t.length;r++){if(t[r].value===n)return t[r].selected=!0,void(i&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function st(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(o(91));return r({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ut(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:Z(n)}}function lt(t,e){var n=Z(e.value),i=Z(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=i&&(t.defaultValue=""+i)}function ct(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}var ht="http://www.w3.org/1999/xhtml",pt="http://www.w3.org/2000/svg";function ft(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?ft(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var vt,mt,gt=(mt=function(t,e){if(t.namespaceURI!==pt||"innerHTML"in t)t.innerHTML=e;else{for((vt=vt||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,i){MSApp.execUnsafeLocalFunction((function(){return mt(t,e)}))}:mt);function yt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var _t={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bt=["Webkit","ms","Moz","O"];function xt(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||_t.hasOwnProperty(t)&&_t[t]?(""+e).trim():e+"px"}function wt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=xt(n,e[n],i);"float"===n&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}Object.keys(_t).forEach((function(t){bt.forEach((function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),_t[e]=_t[t]}))}));var St=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kt(t,e){if(e){if(St[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(o(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(o(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(o(62))}}function Mt(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Tt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Et=null,Ct=null,It=null;function Pt(t){if(t=ir(t)){if("function"!==typeof Et)throw Error(o(280));var e=t.stateNode;e&&(e=ar(e),Et(t.stateNode,t.type,e))}}function At(t){Ct?It?It.push(t):It=[t]:Ct=t}function Lt(){if(Ct){var t=Ct,e=It;if(It=Ct=null,Pt(t),e)for(t=0;t<e.length;t++)Pt(e[t])}}function Rt(t,e){return t(e)}function Dt(t,e,n,i,r){return t(e,n,i,r)}function zt(){}var Ot=Rt,Ft=!1,Nt=!1;function Bt(){null===Ct&&null===It||(zt(),Lt())}function jt(t,e){var n=t.stateNode;if(null===n)return null;var i=ar(n);if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(o(231,e,typeof n));return n}var Vt=!1;if(h)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){Vt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(mt){Vt=!1}function $t(t,e,n,i,r,a,o,s,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(c){this.onError(c)}}var Ht=!1,qt=null,Wt=!1,Gt=null,Zt={onError:function(t){Ht=!0,qt=t}};function Xt(t,e,n,i,r,a,o,s,u){Ht=!1,qt=null,$t.apply(Zt,arguments)}function Yt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(1026&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Kt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function Jt(t){if(Yt(t)!==t)throw Error(o(188))}function Qt(t){if(t=function(t){var e=t.alternate;if(!e){if(null===(e=Yt(t)))throw Error(o(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Jt(r),t;if(a===i)return Jt(r),e;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,u=r.child;u;){if(u===n){s=!0,n=r,i=a;break}if(u===i){s=!0,i=r,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,i=r;break}if(u===i){s=!0,i=a,n=r;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?t:e}(t),!t)return null;for(var e=t;;){if(5===e.tag||6===e.tag)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function te(t,e){for(var n=t.alternate;null!==e;){if(e===t||e===n)return!0;e=e.return}return!1}var ee,ne,ie,re,ae=!1,oe=[],se=null,ue=null,le=null,ce=new Map,he=new Map,pe=[],fe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function de(t,e,n,i,r){return{blockedOn:t,domEventName:e,eventSystemFlags:16|n,nativeEvent:r,targetContainers:[i]}}function ve(t,e){switch(t){case"focusin":case"focusout":se=null;break;case"dragenter":case"dragleave":ue=null;break;case"mouseover":case"mouseout":le=null;break;case"pointerover":case"pointerout":ce.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":he.delete(e.pointerId)}}function me(t,e,n,i,r,a){return null===t||t.nativeEvent!==a?(t=de(e,n,i,r,a),null!==e&&(null!==(e=ir(e))&&ne(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function ge(t){var e=nr(t.target);if(null!==e){var n=Yt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Kt(n)))return t.blockedOn=e,void re(t.lanePriority,(function(){a.unstable_runWithPriority(t.priority,(function(){ie(n)}))}))}else if(3===e&&n.stateNode.hydrate)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function ye(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Qe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=ir(n))&&ne(e),t.blockedOn=n,!1;e.shift()}return!0}function _e(t,e,n){ye(t)&&n.delete(e)}function be(){for(ae=!1;0<oe.length;){var t=oe[0];if(null!==t.blockedOn){null!==(t=ir(t.blockedOn))&&ee(t);break}for(var e=t.targetContainers;0<e.length;){var n=Qe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n){t.blockedOn=n;break}e.shift()}null===t.blockedOn&&oe.shift()}null!==se&&ye(se)&&(se=null),null!==ue&&ye(ue)&&(ue=null),null!==le&&ye(le)&&(le=null),ce.forEach(_e),he.forEach(_e)}function xe(t,e){t.blockedOn===e&&(t.blockedOn=null,ae||(ae=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,be)))}function we(t){function e(e){return xe(e,t)}if(0<oe.length){xe(oe[0],t);for(var n=1;n<oe.length;n++){var i=oe[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==se&&xe(se,t),null!==ue&&xe(ue,t),null!==le&&xe(le,t),ce.forEach(e),he.forEach(e),n=0;n<pe.length;n++)(i=pe[n]).blockedOn===t&&(i.blockedOn=null);for(;0<pe.length&&null===(n=pe[0]).blockedOn;)ge(n),null===n.blockedOn&&pe.shift()}function Se(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ke={animationend:Se("Animation","AnimationEnd"),animationiteration:Se("Animation","AnimationIteration"),animationstart:Se("Animation","AnimationStart"),transitionend:Se("Transition","TransitionEnd")},Me={},Te={};function Ee(t){if(Me[t])return Me[t];if(!ke[t])return t;var e,n=ke[t];for(e in n)if(n.hasOwnProperty(e)&&e in Te)return Me[t]=n[e];return t}h&&(Te=document.createElement("div").style,"AnimationEvent"in window||(delete ke.animationend.animation,delete ke.animationiteration.animation,delete ke.animationstart.animation),"TransitionEvent"in window||delete ke.transitionend.transition);var Ce=Ee("animationend"),Ie=Ee("animationiteration"),Pe=Ee("animationstart"),Ae=Ee("transitionend"),Le=new Map,Re=new Map,De=["abort","abort",Ce,"animationEnd",Ie,"animationIteration",Pe,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ae,"transitionEnd","waiting","waiting"];function ze(t,e){for(var n=0;n<t.length;n+=2){var i=t[n],r=t[n+1];r="on"+(r[0].toUpperCase()+r.slice(1)),Re.set(i,e),Le.set(i,r),l(r,[i])}}(0,a.unstable_now)();var Oe=8;function Fe(t){if(0!==(1&t))return Oe=15,1;if(0!==(2&t))return Oe=14,2;if(0!==(4&t))return Oe=13,4;var e=24&t;return 0!==e?(Oe=12,e):0!==(32&t)?(Oe=11,32):0!==(e=192&t)?(Oe=10,e):0!==(256&t)?(Oe=9,256):0!==(e=3584&t)?(Oe=8,e):0!==(4096&t)?(Oe=7,4096):0!==(e=4186112&t)?(Oe=6,e):0!==(e=62914560&t)?(Oe=5,e):67108864&t?(Oe=4,67108864):0!==(134217728&t)?(Oe=3,134217728):0!==(e=805306368&t)?(Oe=2,e):0!==(1073741824&t)?(Oe=1,1073741824):(Oe=8,t)}function Ne(t,e){var n=t.pendingLanes;if(0===n)return Oe=0;var i=0,r=0,a=t.expiredLanes,o=t.suspendedLanes,s=t.pingedLanes;if(0!==a)i=a,r=Oe=15;else if(0!==(a=134217727&n)){var u=a&~o;0!==u?(i=Fe(u),r=Oe):0!==(s&=a)&&(i=Fe(s),r=Oe)}else 0!==(a=n&~o)?(i=Fe(a),r=Oe):0!==s&&(i=Fe(s),r=Oe);if(0===i)return 0;if(i=n&((0>(i=31-He(i))?0:1<<i)<<1)-1,0!==e&&e!==i&&0===(e&o)){if(Fe(e),r<=Oe)return e;Oe=r}if(0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-He(e)),i|=t[n],e&=~r;return i}function Be(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function je(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return 0===(t=Ve(24&~e))?je(10,e):t;case 10:return 0===(t=Ve(192&~e))?je(8,e):t;case 8:return 0===(t=Ve(3584&~e))&&(0===(t=Ve(4186112&~e))&&(t=512)),t;case 2:return 0===(e=Ve(805306368&~e))&&(e=268435456),e}throw Error(o(358,t))}function Ve(t){return t&-t}function Ue(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function $e(t,e,n){t.pendingLanes|=e;var i=e-1;t.suspendedLanes&=i,t.pingedLanes&=i,(t=t.eventTimes)[e=31-He(e)]=n}var He=Math.clz32?Math.clz32:function(t){return 0===t?32:31-(qe(t)/We|0)|0},qe=Math.log,We=Math.LN2;var Ge=a.unstable_UserBlockingPriority,Ze=a.unstable_runWithPriority,Xe=!0;function Ye(t,e,n,i){Ft||zt();var r=Je,a=Ft;Ft=!0;try{Dt(r,t,e,n,i)}finally{(Ft=a)||Bt()}}function Ke(t,e,n,i){Ze(Ge,Je.bind(null,t,e,n,i))}function Je(t,e,n,i){var r;if(Xe)if((r=0===(4&e))&&0<oe.length&&-1<fe.indexOf(t))t=de(null,t,e,n,i),oe.push(t);else{var a=Qe(t,e,n,i);if(null===a)r&&ve(t,i);else{if(r){if(-1<fe.indexOf(t))return t=de(a,t,e,n,i),void oe.push(t);if(function(t,e,n,i,r){switch(e){case"focusin":return se=me(se,t,e,n,i,r),!0;case"dragenter":return ue=me(ue,t,e,n,i,r),!0;case"mouseover":return le=me(le,t,e,n,i,r),!0;case"pointerover":var a=r.pointerId;return ce.set(a,me(ce.get(a)||null,t,e,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,he.set(a,me(he.get(a)||null,t,e,n,i,r)),!0}return!1}(a,t,e,n,i))return;ve(t,i)}zi(t,e,i,null,n)}}}function Qe(t,e,n,i){var r=Tt(i);if(null!==(r=nr(r))){var a=Yt(r);if(null===a)r=null;else{var o=a.tag;if(13===o){if(null!==(r=Kt(a)))return r;r=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return zi(t,e,i,r,n),null}var tn=null,en=null,nn=null;function rn(){if(nn)return nn;var t,e,n=en,i=n.length,r="value"in tn?tn.value:tn.textContent,a=r.length;for(t=0;t<i&&n[t]===r[t];t++);var o=i-t;for(e=1;e<=o&&n[i-e]===r[a-e];e++);return nn=r.slice(t,1<e?1-e:void 0)}function an(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function on(){return!0}function sn(){return!1}function un(t){function e(e,n,i,r,a){for(var o in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?on:sn,this.isPropagationStopped=sn,this}return r(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=on)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=on)},persist:function(){},isPersistent:on}),e}var ln,cn,hn,pn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fn=un(pn),dn=r({},pn,{view:0,detail:0}),vn=un(dn),mn=r({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==hn&&(hn&&"mousemove"===t.type?(ln=t.screenX-hn.screenX,cn=t.screenY-hn.screenY):cn=ln=0,hn=t),ln)},movementY:function(t){return"movementY"in t?t.movementY:cn}}),gn=un(mn),yn=un(r({},mn,{dataTransfer:0})),_n=un(r({},dn,{relatedTarget:0})),bn=un(r({},pn,{animationName:0,elapsedTime:0,pseudoElement:0})),xn=r({},pn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),wn=un(xn),Sn=un(r({},pn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Tn[t])&&!!e[t]}function Cn(){return En}var In=r({},dn,{key:function(t){if(t.key){var e=kn[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=an(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?Mn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(t){return"keypress"===t.type?an(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?an(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),Pn=un(In),An=un(r({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ln=un(r({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Rn=un(r({},pn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dn=r({},mn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zn=un(Dn),On=[9,13,27,32],Fn=h&&"CompositionEvent"in window,Nn=null;h&&"documentMode"in document&&(Nn=document.documentMode);var Bn=h&&"TextEvent"in window&&!Nn,jn=h&&(!Fn||Nn&&8<Nn&&11>=Nn),Vn=String.fromCharCode(32),Un=!1;function $n(t,e){switch(t){case"keyup":return-1!==On.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hn(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var qn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Wn[t.type]:"textarea"===e}function Zn(t,e,n,i){At(i),0<(e=Fi(e,"onChange")).length&&(n=new fn("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Xn=null,Yn=null;function Kn(t){Ii(t,0)}function Jn(t){if(K(rr(t)))return t}function Qn(t,e){if("change"===t)return e}var ti=!1;if(h){var ei;if(h){var ni="oninput"in document;if(!ni){var ii=document.createElement("div");ii.setAttribute("oninput","return;"),ni="function"===typeof ii.oninput}ei=ni}else ei=!1;ti=ei&&(!document.documentMode||9<document.documentMode)}function ri(){Xn&&(Xn.detachEvent("onpropertychange",ai),Yn=Xn=null)}function ai(t){if("value"===t.propertyName&&Jn(Yn)){var e=[];if(Zn(e,Yn,t,Tt(t)),t=Kn,Ft)t(e);else{Ft=!0;try{Rt(t,e)}finally{Ft=!1,Bt()}}}}function oi(t,e,n){"focusin"===t?(ri(),Yn=n,(Xn=e).attachEvent("onpropertychange",ai)):"focusout"===t&&ri()}function si(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Jn(Yn)}function ui(t,e){if("click"===t)return Jn(e)}function li(t,e){if("input"===t||"change"===t)return Jn(e)}var ci="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e},hi=Object.prototype.hasOwnProperty;function pi(t,e){if(ci(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!hi.call(e,n[i])||!ci(t[n[i]],e[n[i]]))return!1;return!0}function fi(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function di(t,e){var n,i=fi(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=fi(i)}}function vi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?vi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function mi(){for(var t=window,e=J();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(i){n=!1}if(!n)break;e=J((t=e.contentWindow).document)}return e}function gi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}var yi=h&&"documentMode"in document&&11>=document.documentMode,_i=null,bi=null,xi=null,wi=!1;function Si(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;wi||null==_i||_i!==J(i)||("selectionStart"in(i=_i)&&gi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},xi&&pi(xi,i)||(xi=i,0<(i=Fi(bi,"onSelect")).length&&(e=new fn("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=_i)))}ze("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),ze("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),ze(De,2);for(var ki="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Mi=0;Mi<ki.length;Mi++)Re.set(ki[Mi],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ti="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ei=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ti));function Ci(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,i,r,a,s,u,l){if(Xt.apply(this,arguments),Ht){if(!Ht)throw Error(o(198));var c=qt;Ht=!1,qt=null,Wt||(Wt=!0,Gt=c)}}(i,e,void 0,t),t.currentTarget=null}function Ii(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;t:{var a=void 0;if(e)for(var o=i.length-1;0<=o;o--){var s=i[o],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&r.isPropagationStopped())break t;Ci(r,s,l),a=u}else for(o=0;o<i.length;o++){if(u=(s=i[o]).instance,l=s.currentTarget,s=s.listener,u!==a&&r.isPropagationStopped())break t;Ci(r,s,l),a=u}}}if(Wt)throw t=Gt,Wt=!1,Gt=null,t}function Pi(t,e){var n=or(e),i=t+"__bubble";n.has(i)||(Di(e,t,2,!1),n.add(i))}var Ai="_reactListening"+Math.random().toString(36).slice(2);function Li(t){t[Ai]||(t[Ai]=!0,s.forEach((function(e){Ei.has(e)||Ri(e,!1,t,null),Ri(e,!0,t,null)})))}function Ri(t,e,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===t&&9!==n.nodeType&&(a=n.ownerDocument),null!==i&&!e&&Ei.has(t)){if("scroll"!==t)return;r|=2,a=i}var o=or(a),s=t+"__"+(e?"capture":"bubble");o.has(s)||(e&&(r|=4),Di(a,t,r,e),o.add(s))}function Di(t,e,n,i){var r=Re.get(e);switch(void 0===r?2:r){case 0:r=Ye;break;case 1:r=Ke;break;default:r=Je}n=r.bind(null,e,n,t),r=void 0,!Vt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),i?void 0!==r?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):void 0!==r?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function zi(t,e,n,i,r){var a=i;if(0===(1&e)&&0===(2&e)&&null!==i)t:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===r||8===u.nodeType&&u.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=nr(s)))return;if(5===(u=o.tag)||6===u){i=a=o;continue t}s=s.parentNode}}i=i.return}!function(t,e,n){if(Nt)return t(e,n);Nt=!0;try{Ot(t,e,n)}finally{Nt=!1,Bt()}}((function(){var i=a,r=Tt(n),o=[];t:{var s=Le.get(t);if(void 0!==s){var u=fn,l=t;switch(t){case"keypress":if(0===an(n))break t;case"keydown":case"keyup":u=Pn;break;case"focusin":l="focus",u=_n;break;case"focusout":l="blur",u=_n;break;case"beforeblur":case"afterblur":u=_n;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=yn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Ln;break;case Ce:case Ie:case Pe:u=bn;break;case Ae:u=Rn;break;case"scroll":u=vn;break;case"wheel":u=zn;break;case"copy":case"cut":case"paste":u=wn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=An}var c=0!==(4&e),h=!c&&"scroll"===t,p=c?null!==s?s+"Capture":null:s;c=[];for(var f,d=i;null!==d;){var v=(f=d).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==p&&(null!=(v=jt(d,p))&&c.push(Oi(d,v,f)))),h)break;d=d.return}0<c.length&&(s=new u(s,l,null,n,r),o.push({event:s,listeners:c}))}}if(0===(7&e)){if(u="mouseout"===t||"pointerout"===t,(!(s="mouseover"===t||"pointerover"===t)||0!==(16&e)||!(l=n.relatedTarget||n.fromElement)||!nr(l)&&!l[tr])&&(u||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=i,null!==(l=(l=n.relatedTarget||n.toElement)?nr(l):null)&&(l!==(h=Yt(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=i),u!==l)){if(c=gn,v="onMouseLeave",p="onMouseEnter",d="mouse","pointerout"!==t&&"pointerover"!==t||(c=An,v="onPointerLeave",p="onPointerEnter",d="pointer"),h=null==u?s:rr(u),f=null==l?s:rr(l),(s=new c(v,d+"leave",u,n,r)).target=h,s.relatedTarget=f,v=null,nr(r)===i&&((c=new c(p,d+"enter",l,n,r)).target=f,c.relatedTarget=h,v=c),h=v,u&&l)t:{for(p=l,d=0,f=c=u;f;f=Ni(f))d++;for(f=0,v=p;v;v=Ni(v))f++;for(;0<d-f;)c=Ni(c),d--;for(;0<f-d;)p=Ni(p),f--;for(;d--;){if(c===p||null!==p&&c===p.alternate)break t;c=Ni(c),p=Ni(p)}c=null}else c=null;null!==u&&Bi(o,s,u,c,!1),null!==l&&null!==h&&Bi(o,h,l,c,!0)}if("select"===(u=(s=i?rr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Qn;else if(Gn(s))if(ti)m=li;else{m=si;var g=oi}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ui);switch(m&&(m=m(t,i))?Zn(o,m,n,r):(g&&g(t,s,i),"focusout"===t&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&rt(s,"number",s.value)),g=i?rr(i):window,t){case"focusin":(Gn(g)||"true"===g.contentEditable)&&(_i=g,bi=i,xi=null);break;case"focusout":xi=bi=_i=null;break;case"mousedown":wi=!0;break;case"contextmenu":case"mouseup":case"dragend":wi=!1,Si(o,n,r);break;case"selectionchange":if(yi)break;case"keydown":case"keyup":Si(o,n,r)}var y;if(Fn)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else qn?$n(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(jn&&"ko"!==n.locale&&(qn||"onCompositionStart"!==_?"onCompositionEnd"===_&&qn&&(y=rn()):(en="value"in(tn=r)?tn.value:tn.textContent,qn=!0)),0<(g=Fi(i,_)).length&&(_=new Sn(_,t,null,n,r),o.push({event:_,listeners:g}),y?_.data=y:null!==(y=Hn(n))&&(_.data=y))),(y=Bn?function(t,e){switch(t){case"compositionend":return Hn(e);case"keypress":return 32!==e.which?null:(Un=!0,Vn);case"textInput":return(t=e.data)===Vn&&Un?null:t;default:return null}}(t,n):function(t,e){if(qn)return"compositionend"===t||!Fn&&$n(t,e)?(t=rn(),nn=en=tn=null,qn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return jn&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(i=Fi(i,"onBeforeInput")).length&&(r=new Sn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=y))}Ii(o,e)}))}function Oi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fi(t,e){for(var n=e+"Capture",i=[];null!==t;){var r=t,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=jt(t,n))&&i.unshift(Oi(t,a,r)),null!=(a=jt(t,e))&&i.push(Oi(t,a,r))),t=t.return}return i}function Ni(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Bi(t,e,n,i,r){for(var a=e._reactName,o=[];null!==n&&n!==i;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(u=jt(n,a))&&o.unshift(Oi(n,u,s)):r||null!=(u=jt(n,a))&&o.push(Oi(n,u,s))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}function ji(){}var Vi=null,Ui=null;function $i(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function Hi(t,e){return"textarea"===t||"option"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var qi="function"===typeof setTimeout?setTimeout:void 0,Wi="function"===typeof clearTimeout?clearTimeout:void 0;function Gi(t){1===t.nodeType?t.textContent="":9===t.nodeType&&(null!=(t=t.body)&&(t.textContent=""))}function Zi(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break}return t}function Xi(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var Yi=0;var Ki=Math.random().toString(36).slice(2),Ji="__reactFiber$"+Ki,Qi="__reactProps$"+Ki,tr="__reactContainer$"+Ki,er="__reactEvents$"+Ki;function nr(t){var e=t[Ji];if(e)return e;for(var n=t.parentNode;n;){if(e=n[tr]||n[Ji]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=Xi(t);null!==t;){if(n=t[Ji])return n;t=Xi(t)}return e}n=(t=n).parentNode}return null}function ir(t){return!(t=t[Ji]||t[tr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function rr(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(o(33))}function ar(t){return t[Qi]||null}function or(t){var e=t[er];return void 0===e&&(e=t[er]=new Set),e}var sr=[],ur=-1;function lr(t){return{current:t}}function cr(t){0>ur||(t.current=sr[ur],sr[ur]=null,ur--)}function hr(t,e){ur++,sr[ur]=t.current,t.current=e}var pr={},fr=lr(pr),dr=lr(!1),vr=pr;function mr(t,e){var n=t.type.contextTypes;if(!n)return pr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function gr(t){return null!==(t=t.childContextTypes)&&void 0!==t}function yr(){cr(dr),cr(fr)}function _r(t,e,n){if(fr.current!==pr)throw Error(o(168));hr(fr,e),hr(dr,n)}function br(t,e,n){var i=t.stateNode;if(t=e.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var a in i=i.getChildContext())if(!(a in t))throw Error(o(108,G(e)||"Unknown",a));return r({},n,i)}function xr(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pr,vr=fr.current,hr(fr,t),hr(dr,dr.current),!0}function wr(t,e,n){var i=t.stateNode;if(!i)throw Error(o(169));n?(t=br(t,e,vr),i.__reactInternalMemoizedMergedChildContext=t,cr(dr),cr(fr),hr(fr,t)):cr(dr),hr(dr,n)}var Sr=null,kr=null,Mr=a.unstable_runWithPriority,Tr=a.unstable_scheduleCallback,Er=a.unstable_cancelCallback,Cr=a.unstable_shouldYield,Ir=a.unstable_requestPaint,Pr=a.unstable_now,Ar=a.unstable_getCurrentPriorityLevel,Lr=a.unstable_ImmediatePriority,Rr=a.unstable_UserBlockingPriority,Dr=a.unstable_NormalPriority,zr=a.unstable_LowPriority,Or=a.unstable_IdlePriority,Fr={},Nr=void 0!==Ir?Ir:function(){},Br=null,jr=null,Vr=!1,Ur=Pr(),$r=1e4>Ur?Pr:function(){return Pr()-Ur};function Hr(){switch(Ar()){case Lr:return 99;case Rr:return 98;case Dr:return 97;case zr:return 96;case Or:return 95;default:throw Error(o(332))}}function qr(t){switch(t){case 99:return Lr;case 98:return Rr;case 97:return Dr;case 96:return zr;case 95:return Or;default:throw Error(o(332))}}function Wr(t,e){return t=qr(t),Mr(t,e)}function Gr(t,e,n){return t=qr(t),Tr(t,e,n)}function Zr(){if(null!==jr){var t=jr;jr=null,Er(t)}Xr()}function Xr(){if(!Vr&&null!==Br){Vr=!0;var t=0;try{var e=Br;Wr(99,(function(){for(;t<e.length;t++){var n=e[t];do{n=n(!0)}while(null!==n)}})),Br=null}catch(n){throw null!==Br&&(Br=Br.slice(t+1)),Tr(Lr,Zr),n}finally{Vr=!1}}}var Yr=x.ReactCurrentBatchConfig;function Kr(t,e){if(t&&t.defaultProps){for(var n in e=r({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}var Jr=lr(null),Qr=null,ta=null,ea=null;function na(){ea=ta=Qr=null}function ia(t){var e=Jr.current;cr(Jr),t.type._context._currentValue=e}function ra(t,e){for(;null!==t;){var n=t.alternate;if((t.childLanes&e)===e){if(null===n||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,null!==n&&(n.childLanes|=e);t=t.return}}function aa(t,e){Qr=t,ea=ta=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(Fo=!0),t.firstContext=null)}function oa(t,e){if(ea!==t&&!1!==e&&0!==e)if("number"===typeof e&&1073741823!==e||(ea=t,e=1073741823),e={context:t,observedBits:e,next:null},null===ta){if(null===Qr)throw Error(o(308));ta=e,Qr.dependencies={lanes:0,firstContext:e,responders:null}}else ta=ta.next=e;return t._currentValue}var sa=!1;function ua(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function la(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ca(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ha(t,e){if(null!==(t=t.updateQueue)){var n=(t=t.shared).pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function pa(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=e:a=a.next=e}else r=a=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function fa(t,e,n,i){var a=t.updateQueue;sa=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,u=a.shared.pending;if(null!==u){a.shared.pending=null;var l=u,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var h=t.alternate;if(null!==h){var p=(h=h.updateQueue).lastBaseUpdate;p!==s&&(null===p?h.firstBaseUpdate=c:p.next=c,h.lastBaseUpdate=l)}}if(null!==o){for(p=a.baseState,s=0,h=c=l=null;;){u=o.lane;var f=o.eventTime;if((i&u)===u){null!==h&&(h=h.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});t:{var d=t,v=o;switch(u=e,f=n,v.tag){case 1:if("function"===typeof(d=v.payload)){p=d.call(f,p,u);break t}p=d;break t;case 3:d.flags=-4097&d.flags|64;case 0:if(null===(u="function"===typeof(d=v.payload)?d.call(f,p,u):d)||void 0===u)break t;p=r({},p,u);break t;case 2:sa=!0}}null!==o.callback&&(t.flags|=32,null===(u=a.effects)?a.effects=[o]:u.push(o))}else f={eventTime:f,lane:u,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=f,l=p):h=h.next=f,s|=u;if(null===(o=o.next)){if(null===(u=a.shared.pending))break;o=u.next,u.next=null,a.lastBaseUpdate=u,a.shared.pending=null}}null===h&&(l=p),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=h,Vs|=s,t.lanes=s,t.memoizedState=p}}function da(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var va=(new i.Component).refs;function ma(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:r({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var ga={isMounted:function(t){return!!(t=t._reactInternals)&&Yt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=pu(),r=fu(t),a=ca(i,r);a.payload=e,void 0!==n&&null!==n&&(a.callback=n),ha(t,a),du(t,r,i)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=pu(),r=fu(t),a=ca(i,r);a.tag=1,a.payload=e,void 0!==n&&null!==n&&(a.callback=n),ha(t,a),du(t,r,i)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=pu(),i=fu(t),r=ca(n,i);r.tag=2,void 0!==e&&null!==e&&(r.callback=e),ha(t,r),du(t,i,n)}};function ya(t,e,n,i,r,a,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,a,o):!e.prototype||!e.prototype.isPureReactComponent||(!pi(n,i)||!pi(r,a))}function _a(t,e,n){var i=!1,r=pr,a=e.contextType;return"object"===typeof a&&null!==a?a=oa(a):(r=gr(e)?vr:fr.current,a=(i=null!==(i=e.contextTypes)&&void 0!==i)?mr(t,r):pr),e=new e(n,a),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=ga,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function ba(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ga.enqueueReplaceState(e,e.state,null)}function xa(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=va,ua(t);var a=e.contextType;"object"===typeof a&&null!==a?r.context=oa(a):(a=gr(e)?vr:fr.current,r.context=mr(t,a)),fa(t,n,r,i),r.state=t.memoizedState,"function"===typeof(a=e.getDerivedStateFromProps)&&(ma(t,e,a,n),r.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(e=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&ga.enqueueReplaceState(r,r.state,null),fa(t,n,r,i),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4)}var wa=Array.isArray;function Sa(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,t));var r=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===r?e.ref:(e=function(t){var e=i.refs;e===va&&(e=i.refs={}),null===t?delete e[r]:e[r]=t},e._stringRef=r,e)}if("string"!==typeof t)throw Error(o(284));if(!n._owner)throw Error(o(290,t))}return t}function ka(t,e){if("textarea"!==t.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(e)?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function Ma(t){function e(e,n){if(t){var i=e.lastEffect;null!==i?(i.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=Wu(t,e)).index=0,t.sibling=null,t}function a(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags=2,n):i:(e.flags=2,n):n}function s(e){return t&&null===e.alternate&&(e.flags=2),e}function u(t,e,n,i){return null===e||6!==e.tag?((e=Yu(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function l(t,e,n,i){return null!==e&&e.elementType===n.type?((i=r(e,n.props)).ref=Sa(t,e,n),i.return=t,i):((i=Gu(n.type,n.key,n.props,null,t.mode,i)).ref=Sa(t,e,n),i.return=t,i)}function c(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Ku(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function h(t,e,n,i,a){return null===e||7!==e.tag?((e=Zu(n,t.mode,i,a)).return=t,e):((e=r(e,n)).return=t,e)}function p(t,e,n){if("string"===typeof e||"number"===typeof e)return(e=Yu(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case w:return(n=Gu(e.type,e.key,e.props,null,t.mode,n)).ref=Sa(t,null,e),n.return=t,n;case S:return(e=Ku(e,t.mode,n)).return=t,e}if(wa(e)||U(e))return(e=Zu(e,t.mode,n,null)).return=t,e;ka(t,e)}return null}function f(t,e,n,i){var r=null!==e?e.key:null;if("string"===typeof n||"number"===typeof n)return null!==r?null:u(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===r?n.type===k?h(t,e,n.props.children,i,r):l(t,e,n,i):null;case S:return n.key===r?c(t,e,n,i):null}if(wa(n)||U(n))return null!==r?null:h(t,e,n,i,null);ka(t,n)}return null}function d(t,e,n,i,r){if("string"===typeof i||"number"===typeof i)return u(e,t=t.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case w:return t=t.get(null===i.key?n:i.key)||null,i.type===k?h(e,t,i.props.children,r,i.key):l(e,t,i,r);case S:return c(e,t=t.get(null===i.key?n:i.key)||null,i,r)}if(wa(i)||U(i))return h(e,t=t.get(n)||null,i,r,null);ka(e,i)}return null}function v(r,o,s,u){for(var l=null,c=null,h=o,v=o=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=f(r,h,s[v],u);if(null===g){null===h&&(h=m);break}t&&h&&null===g.alternate&&e(r,h),o=a(g,o,v),null===c?l=g:c.sibling=g,c=g,h=m}if(v===s.length)return n(r,h),l;if(null===h){for(;v<s.length;v++)null!==(h=p(r,s[v],u))&&(o=a(h,o,v),null===c?l=h:c.sibling=h,c=h);return l}for(h=i(r,h);v<s.length;v++)null!==(m=d(h,r,v,s[v],u))&&(t&&null!==m.alternate&&h.delete(null===m.key?v:m.key),o=a(m,o,v),null===c?l=m:c.sibling=m,c=m);return t&&h.forEach((function(t){return e(r,t)})),l}function m(r,s,u,l){var c=U(u);if("function"!==typeof c)throw Error(o(150));if(null==(u=c.call(u)))throw Error(o(151));for(var h=c=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var _=f(r,v,y.value,l);if(null===_){null===v&&(v=g);break}t&&v&&null===_.alternate&&e(r,v),s=a(_,s,m),null===h?c=_:h.sibling=_,h=_,v=g}if(y.done)return n(r,v),c;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=p(r,y.value,l))&&(s=a(y,s,m),null===h?c=y:h.sibling=y,h=y);return c}for(v=i(r,v);!y.done;m++,y=u.next())null!==(y=d(v,r,m,y.value,l))&&(t&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=a(y,s,m),null===h?c=y:h.sibling=y,h=y);return t&&v.forEach((function(t){return e(r,t)})),c}return function(t,i,a,u){var l="object"===typeof a&&null!==a&&a.type===k&&null===a.key;l&&(a=a.props.children);var c="object"===typeof a&&null!==a;if(c)switch(a.$$typeof){case w:t:{for(c=a.key,l=i;null!==l;){if(l.key===c){if(7===l.tag){if(a.type===k){n(t,l.sibling),(i=r(l,a.props.children)).return=t,t=i;break t}}else if(l.elementType===a.type){n(t,l.sibling),(i=r(l,a.props)).ref=Sa(t,l,a),i.return=t,t=i;break t}n(t,l);break}e(t,l),l=l.sibling}a.type===k?((i=Zu(a.props.children,t.mode,u,a.key)).return=t,t=i):((u=Gu(a.type,a.key,a.props,null,t.mode,u)).ref=Sa(t,i,a),u.return=t,t=u)}return s(t);case S:t:{for(l=a.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(t,i.sibling),(i=r(i,a.children||[])).return=t,t=i;break t}n(t,i);break}e(t,i),i=i.sibling}(i=Ku(a,t.mode,u)).return=t,t=i}return s(t)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==i&&6===i.tag?(n(t,i.sibling),(i=r(i,a)).return=t,t=i):(n(t,i),(i=Yu(a,t.mode,u)).return=t,t=i),s(t);if(wa(a))return v(t,i,a,u);if(U(a))return m(t,i,a,u);if(c&&ka(t,a),"undefined"===typeof a&&!l)switch(t.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,G(t.type)||"Component"))}return n(t,i)}}var Ta=Ma(!0),Ea=Ma(!1),Ca={},Ia=lr(Ca),Pa=lr(Ca),Aa=lr(Ca);function La(t){if(t===Ca)throw Error(o(174));return t}function Ra(t,e){switch(hr(Aa,e),hr(Pa,t),hr(Ia,Ca),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:dt(null,"");break;default:e=dt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}cr(Ia),hr(Ia,e)}function Da(){cr(Ia),cr(Pa),cr(Aa)}function za(t){La(Aa.current);var e=La(Ia.current),n=dt(e,t.type);e!==n&&(hr(Pa,t),hr(Ia,n))}function Oa(t){Pa.current===t&&(cr(Ia),cr(Pa))}var Fa=lr(0);function Na(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(64&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ba=null,ja=null,Va=!1;function Ua(t,e){var n=Hu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,null!==t.lastEffect?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function $a(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,!0);default:return!1}}function Ha(t){if(Va){var e=ja;if(e){var n=e;if(!$a(t,e)){if(!(e=Zi(n.nextSibling))||!$a(t,e))return t.flags=-1025&t.flags|2,Va=!1,void(Ba=t);Ua(Ba,n)}Ba=t,ja=Zi(e.firstChild)}else t.flags=-1025&t.flags|2,Va=!1,Ba=t}}function qa(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Ba=t}function Wa(t){if(t!==Ba)return!1;if(!Va)return qa(t),Va=!0,!1;var e=t.type;if(5!==t.tag||"head"!==e&&"body"!==e&&!Hi(e,t.memoizedProps))for(e=ja;e;)Ua(t,e),e=Zi(e.nextSibling);if(qa(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(o(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){ja=Zi(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}ja=null}}else ja=Ba?Zi(t.stateNode.nextSibling):null;return!0}function Ga(){ja=Ba=null,Va=!1}var Za=[];function Xa(){for(var t=0;t<Za.length;t++)Za[t]._workInProgressVersionPrimary=null;Za.length=0}var Ya=x.ReactCurrentDispatcher,Ka=x.ReactCurrentBatchConfig,Ja=0,Qa=null,to=null,eo=null,no=!1,io=!1;function ro(){throw Error(o(321))}function ao(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ci(t[n],e[n]))return!1;return!0}function oo(t,e,n,i,r,a){if(Ja=a,Qa=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ya.current=null===t||null===t.memoizedState?Ro:Do,t=n(i,r),io){a=0;do{if(io=!1,!(25>a))throw Error(o(301));a+=1,eo=to=null,e.updateQueue=null,Ya.current=zo,t=n(i,r)}while(io)}if(Ya.current=Lo,e=null!==to&&null!==to.next,Ja=0,eo=to=Qa=null,no=!1,e)throw Error(o(300));return t}function so(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===eo?Qa.memoizedState=eo=t:eo=eo.next=t,eo}function uo(){if(null===to){var t=Qa.alternate;t=null!==t?t.memoizedState:null}else t=to.next;var e=null===eo?Qa.memoizedState:eo.next;if(null!==e)eo=e,to=t;else{if(null===t)throw Error(o(310));t={memoizedState:(to=t).memoizedState,baseState:to.baseState,baseQueue:to.baseQueue,queue:to.queue,next:null},null===eo?Qa.memoizedState=eo=t:eo=eo.next=t}return eo}function lo(t,e){return"function"===typeof e?e(t):e}function co(t){var e=uo(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=to,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){r=r.next,i=i.baseState;var u=s=a=null,l=r;do{var c=l.lane;if((Ja&c)===c)null!==u&&(u=u.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),i=l.eagerReducer===t?l.eagerState:t(i,l.action);else{var h={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===u?(s=u=h,a=i):u=u.next=h,Qa.lanes|=c,Vs|=c}l=l.next}while(null!==l&&l!==r);null===u?a=i:u.next=s,ci(i,e.memoizedState)||(Fo=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=u,n.lastRenderedState=i}return[e.memoizedState,n.dispatch]}function ho(t){var e=uo(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,a=e.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=t(a,s.action),s=s.next}while(s!==r);ci(a,e.memoizedState)||(Fo=!0),e.memoizedState=a,null===e.baseQueue&&(e.baseState=a),n.lastRenderedState=a}return[a,i]}function po(t,e,n){var i=e._getVersion;i=i(e._source);var r=e._workInProgressVersionPrimary;if(null!==r?t=r===i:(t=t.mutableReadLanes,(t=(Ja&t)===t)&&(e._workInProgressVersionPrimary=i,Za.push(e))),t)return n(e._source);throw Za.push(e),Error(o(350))}function fo(t,e,n,i){var r=Rs;if(null===r)throw Error(o(349));var a=e._getVersion,s=a(e._source),u=Ya.current,l=u.useState((function(){return po(r,e,n)})),c=l[1],h=l[0];l=eo;var p=t.memoizedState,f=p.refs,d=f.getSnapshot,v=p.source;p=p.subscribe;var m=Qa;return t.memoizedState={refs:f,source:e,subscribe:i},u.useEffect((function(){f.getSnapshot=n,f.setSnapshot=c;var t=a(e._source);if(!ci(s,t)){t=n(e._source),ci(h,t)||(c(t),t=fu(m),r.mutableReadLanes|=t&r.pendingLanes),t=r.mutableReadLanes,r.entangledLanes|=t;for(var i=r.entanglements,o=t;0<o;){var u=31-He(o),l=1<<u;i[u]|=t,o&=~l}}}),[n,e,i]),u.useEffect((function(){return i(e._source,(function(){var t=f.getSnapshot,n=f.setSnapshot;try{n(t(e._source));var i=fu(m);r.mutableReadLanes|=i&r.pendingLanes}catch(a){n((function(){throw a}))}}))}),[e,i]),ci(d,n)&&ci(v,e)&&ci(p,i)||((t={pending:null,dispatch:null,lastRenderedReducer:lo,lastRenderedState:h}).dispatch=c=Ao.bind(null,Qa,t),l.queue=t,l.baseQueue=null,h=po(r,e,n),l.memoizedState=l.baseState=h),h}function vo(t,e,n){return fo(uo(),t,e,n)}function mo(t){var e=so();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t=(t=e.queue={pending:null,dispatch:null,lastRenderedReducer:lo,lastRenderedState:t}).dispatch=Ao.bind(null,Qa,t),[e.memoizedState,t]}function go(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=Qa.updateQueue)?(e={lastEffect:null},Qa.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function yo(t){return t={current:t},so().memoizedState=t}function _o(){return uo().memoizedState}function bo(t,e,n,i){var r=so();Qa.flags|=t,r.memoizedState=go(1|e,n,void 0,void 0===i?null:i)}function xo(t,e,n,i){var r=uo();i=void 0===i?null:i;var a=void 0;if(null!==to){var o=to.memoizedState;if(a=o.destroy,null!==i&&ao(i,o.deps))return void go(e,n,a,i)}Qa.flags|=t,r.memoizedState=go(1|e,n,a,i)}function wo(t,e){return bo(516,4,t,e)}function So(t,e){return xo(516,4,t,e)}function ko(t,e){return xo(4,2,t,e)}function Mo(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function To(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,xo(4,2,Mo.bind(null,e,t),n)}function Eo(){}function Co(t,e){var n=uo();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&ao(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Io(t,e){var n=uo();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&ao(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Po(t,e){var n=Hr();Wr(98>n?98:n,(function(){t(!0)})),Wr(97<n?97:n,(function(){var n=Ka.transition;Ka.transition=1;try{t(!1),e()}finally{Ka.transition=n}}))}function Ao(t,e,n){var i=pu(),r=fu(t),a={lane:r,action:n,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),e.pending=a,o=t.alternate,t===Qa||null!==o&&o===Qa)io=no=!0;else{if(0===t.lanes&&(null===o||0===o.lanes)&&null!==(o=e.lastRenderedReducer))try{var s=e.lastRenderedState,u=o(s,n);if(a.eagerReducer=o,a.eagerState=u,ci(u,s))return}catch(l){}du(t,r,i)}}var Lo={readContext:oa,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useOpaqueIdentifier:ro,unstable_isNewReconciler:!1},Ro={readContext:oa,useCallback:function(t,e){return so().memoizedState=[t,void 0===e?null:e],t},useContext:oa,useEffect:wo,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,bo(4,2,Mo.bind(null,e,t),n)},useLayoutEffect:function(t,e){return bo(4,2,t,e)},useMemo:function(t,e){var n=so();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=so();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t=(t=i.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e}).dispatch=Ao.bind(null,Qa,t),[i.memoizedState,t]},useRef:yo,useState:mo,useDebugValue:Eo,useDeferredValue:function(t){var e=mo(t),n=e[0],i=e[1];return wo((function(){var e=Ka.transition;Ka.transition=1;try{i(t)}finally{Ka.transition=e}}),[t]),n},useTransition:function(){var t=mo(!1),e=t[0];return yo(t=Po.bind(null,t[1])),[t,e]},useMutableSource:function(t,e,n){var i=so();return i.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},fo(i,t,e,n)},useOpaqueIdentifier:function(){if(Va){var t=!1,e=function(t){return{$$typeof:z,toString:t,valueOf:t}}((function(){throw t||(t=!0,n("r:"+(Yi++).toString(36))),Error(o(355))})),n=mo(e)[1];return 0===(2&Qa.mode)&&(Qa.flags|=516,go(5,(function(){n("r:"+(Yi++).toString(36))}),void 0,null)),e}return mo(e="r:"+(Yi++).toString(36)),e},unstable_isNewReconciler:!1},Do={readContext:oa,useCallback:Co,useContext:oa,useEffect:So,useImperativeHandle:To,useLayoutEffect:ko,useMemo:Io,useReducer:co,useRef:_o,useState:function(){return co(lo)},useDebugValue:Eo,useDeferredValue:function(t){var e=co(lo),n=e[0],i=e[1];return So((function(){var e=Ka.transition;Ka.transition=1;try{i(t)}finally{Ka.transition=e}}),[t]),n},useTransition:function(){var t=co(lo)[0];return[_o().current,t]},useMutableSource:vo,useOpaqueIdentifier:function(){return co(lo)[0]},unstable_isNewReconciler:!1},zo={readContext:oa,useCallback:Co,useContext:oa,useEffect:So,useImperativeHandle:To,useLayoutEffect:ko,useMemo:Io,useReducer:ho,useRef:_o,useState:function(){return ho(lo)},useDebugValue:Eo,useDeferredValue:function(t){var e=ho(lo),n=e[0],i=e[1];return So((function(){var e=Ka.transition;Ka.transition=1;try{i(t)}finally{Ka.transition=e}}),[t]),n},useTransition:function(){var t=ho(lo)[0];return[_o().current,t]},useMutableSource:vo,useOpaqueIdentifier:function(){return ho(lo)[0]},unstable_isNewReconciler:!1},Oo=x.ReactCurrentOwner,Fo=!1;function No(t,e,n,i){e.child=null===t?Ea(e,null,n,i):Ta(e,t.child,n,i)}function Bo(t,e,n,i,r){n=n.render;var a=e.ref;return aa(e,r),i=oo(t,e,n,i,a,r),null===t||Fo?(e.flags|=1,No(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~r,as(t,e,r))}function jo(t,e,n,i,r,a){if(null===t){var o=n.type;return"function"!==typeof o||qu(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Gu(n.type,null,i,e,e.mode,a)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=o,Vo(t,e,o,i,r,a))}return o=t.child,0===(r&a)&&(r=o.memoizedProps,(n=null!==(n=n.compare)?n:pi)(r,i)&&t.ref===e.ref)?as(t,e,a):(e.flags|=1,(t=Wu(o,i)).ref=e.ref,t.return=e,e.child=t)}function Vo(t,e,n,i,r,a){if(null!==t&&pi(t.memoizedProps,i)&&t.ref===e.ref){if(Fo=!1,0===(a&r))return e.lanes=t.lanes,as(t,e,a);0!==(16384&t.flags)&&(Fo=!0)}return Ho(t,e,n,i,a)}function Uo(t,e,n){var i=e.pendingProps,r=i.children,a=null!==t?t.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0===(4&e.mode))e.memoizedState={baseLanes:0},wu(e,n);else{if(0===(1073741824&n))return t=null!==a?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},wu(e,t),null;e.memoizedState={baseLanes:0},wu(e,null!==a?a.baseLanes:n)}else null!==a?(i=a.baseLanes|n,e.memoizedState=null):i=n,wu(e,i);return No(t,e,r,n),e.child}function $o(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=128)}function Ho(t,e,n,i,r){var a=gr(n)?vr:fr.current;return a=mr(e,a),aa(e,r),n=oo(t,e,n,i,a,r),null===t||Fo?(e.flags|=1,No(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~r,as(t,e,r))}function qo(t,e,n,i,r){if(gr(n)){var a=!0;xr(e)}else a=!1;if(aa(e,r),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),_a(e,n,i),xa(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,s=e.memoizedProps;o.props=s;var u=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=oa(l):l=mr(e,l=gr(n)?vr:fr.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||u!==l)&&ba(e,o,i,l),sa=!1;var p=e.memoizedState;o.state=p,fa(e,i,o,r),u=e.memoizedState,s!==i||p!==u||dr.current||sa?("function"===typeof c&&(ma(e,n,c,i),u=e.memoizedState),(s=sa||ya(e,n,s,i,p,u,l))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4)):("function"===typeof o.componentDidMount&&(e.flags|=4),e.memoizedProps=i,e.memoizedState=u),o.props=i,o.state=u,o.context=l,i=s):("function"===typeof o.componentDidMount&&(e.flags|=4),i=!1)}else{o=e.stateNode,la(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:Kr(e.type,s),o.props=l,h=e.pendingProps,p=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=oa(u):u=mr(e,u=gr(n)?vr:fr.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||p!==u)&&ba(e,o,i,u),sa=!1,p=e.memoizedState,o.state=p,fa(e,i,o,r);var d=e.memoizedState;s!==h||p!==d||dr.current||sa?("function"===typeof f&&(ma(e,n,f,i),d=e.memoizedState),(l=sa||ya(e,n,l,i,p,d,u))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,d,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,d,u)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=256)):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&p===t.memoizedState||(e.flags|=256),e.memoizedProps=i,e.memoizedState=d),o.props=i,o.state=d,o.context=u,i=l):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&p===t.memoizedState||(e.flags|=256),i=!1)}return Wo(t,e,n,i,a,r)}function Wo(t,e,n,i,r,a){$o(t,e);var o=0!==(64&e.flags);if(!i&&!o)return r&&wr(e,n,!1),as(t,e,a);i=e.stateNode,Oo.current=e;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=Ta(e,t.child,null,a),e.child=Ta(e,null,s,a)):No(t,e,s,a),e.memoizedState=i.state,r&&wr(e,n,!0),e.child}function Go(t){var e=t.stateNode;e.pendingContext?_r(0,e.pendingContext,e.pendingContext!==e.context):e.context&&_r(0,e.context,!1),Ra(t,e.containerInfo)}var Zo,Xo,Yo,Ko={dehydrated:null,retryLane:0};function Jo(t,e,n){var i,r=e.pendingProps,a=Fa.current,o=!1;return(i=0!==(64&e.flags))||(i=(null===t||null!==t.memoizedState)&&0!==(2&a)),i?(o=!0,e.flags&=-65):null!==t&&null===t.memoizedState||void 0===r.fallback||!0===r.unstable_avoidThisFallback||(a|=1),hr(Fa,1&a),null===t?(void 0!==r.fallback&&Ha(e),t=r.children,a=r.fallback,o?(t=Qo(e,t,a,n),e.child.memoizedState={baseLanes:n},e.memoizedState=Ko,t):"number"===typeof r.unstable_expectedLoadTime?(t=Qo(e,t,a,n),e.child.memoizedState={baseLanes:n},e.memoizedState=Ko,e.lanes=33554432,t):((n=Xu({mode:"visible",children:t},e.mode,n,null)).return=e,e.child=n)):(t.memoizedState,o?(r=es(t,e,r.children,r.fallback,n),o=e.child,a=t.child.memoizedState,o.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},o.childLanes=t.childLanes&~n,e.memoizedState=Ko,r):(n=ts(t,e,r.children,n),e.memoizedState=null,n))}function Qo(t,e,n,i){var r=t.mode,a=t.child;return e={mode:"hidden",children:e},0===(2&r)&&null!==a?(a.childLanes=0,a.pendingProps=e):a=Xu(e,r,0,null),n=Zu(n,r,i,null),a.return=t,n.return=t,a.sibling=n,t.child=a,n}function ts(t,e,n,i){var r=t.child;return t=r.sibling,n=Wu(r,{mode:"visible",children:n}),0===(2&e.mode)&&(n.lanes=i),n.return=e,n.sibling=null,null!==t&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}function es(t,e,n,i,r){var a=e.mode,o=t.child;t=o.sibling;var s={mode:"hidden",children:n};return 0===(2&a)&&e.child!==o?((n=e.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(e.firstEffect=n.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):n=Wu(o,s),null!==t?i=Wu(t,i):(i=Zu(i,a,r,null)).flags|=2,i.return=e,n.return=e,n.sibling=i,e.child=n,i}function ns(t,e){t.lanes|=e;var n=t.alternate;null!==n&&(n.lanes|=e),ra(t.return,e)}function is(t,e,n,i,r,a){var o=t.memoizedState;null===o?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r,lastEffect:a}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r,o.lastEffect=a)}function rs(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(No(t,e,i.children,n),0!==(2&(i=Fa.current)))i=1&i|2,e.flags|=64;else{if(null!==t&&0!==(64&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&ns(t,n);else if(19===t.tag)ns(t,n);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(hr(Fa,i),0===(2&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===Na(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),is(e,!1,r,n,a,e.lastEffect);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===Na(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}is(e,!0,n,null,a,e.lastEffect);break;case"together":is(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function as(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Vs|=e.lanes,0!==(n&e.childLanes)){if(null!==t&&e.child!==t.child)throw Error(o(153));if(null!==e.child){for(n=Wu(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Wu(t,t.pendingProps)).return=e;n.sibling=null}return e.child}return null}function os(t,e){if(!Va)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ss(t,e,n){var i=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return gr(e.type)&&yr(),null;case 3:return Da(),cr(dr),cr(fr),Xa(),(i=e.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(Wa(e)?e.flags|=4:i.hydrate||(e.flags|=256)),null;case 5:Oa(e);var a=La(Aa.current);if(n=e.type,null!==t&&null!=e.stateNode)Xo(t,e,n,i),t.ref!==e.ref&&(e.flags|=128);else{if(!i){if(null===e.stateNode)throw Error(o(166));return null}if(t=La(Ia.current),Wa(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Ji]=e,i[Qi]=s,n){case"dialog":Pi("cancel",i),Pi("close",i);break;case"iframe":case"object":case"embed":Pi("load",i);break;case"video":case"audio":for(t=0;t<Ti.length;t++)Pi(Ti[t],i);break;case"source":Pi("error",i);break;case"img":case"image":case"link":Pi("error",i),Pi("load",i);break;case"details":Pi("toggle",i);break;case"input":tt(i,s),Pi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Pi("invalid",i);break;case"textarea":ut(i,s),Pi("invalid",i)}for(var l in kt(n,s),t=null,s)s.hasOwnProperty(l)&&(a=s[l],"children"===l?"string"===typeof a?i.textContent!==a&&(t=["children",a]):"number"===typeof a&&i.textContent!==""+a&&(t=["children",""+a]):u.hasOwnProperty(l)&&null!=a&&"onScroll"===l&&Pi("scroll",i));switch(n){case"input":Y(i),it(i,s,!0);break;case"textarea":Y(i),ct(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=ji)}i=t,e.updateQueue=i,null!==i&&(e.flags|=4)}else{switch(l=9===a.nodeType?a:a.ownerDocument,t===ht&&(t=ft(n)),t===ht?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof i.is?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),"select"===n&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[Ji]=e,t[Qi]=i,Zo(t,e),e.stateNode=t,l=Mt(n,i),n){case"dialog":Pi("cancel",t),Pi("close",t),a=i;break;case"iframe":case"object":case"embed":Pi("load",t),a=i;break;case"video":case"audio":for(a=0;a<Ti.length;a++)Pi(Ti[a],t);a=i;break;case"source":Pi("error",t),a=i;break;case"img":case"image":case"link":Pi("error",t),Pi("load",t),a=i;break;case"details":Pi("toggle",t),a=i;break;case"input":tt(t,i),a=Q(t,i),Pi("invalid",t);break;case"option":a=at(t,i);break;case"select":t._wrapperState={wasMultiple:!!i.multiple},a=r({},i,{value:void 0}),Pi("invalid",t);break;case"textarea":ut(t,i),a=st(t,i),Pi("invalid",t);break;default:a=i}kt(n,a);var c=a;for(s in c)if(c.hasOwnProperty(s)){var h=c[s];"style"===s?wt(t,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&gt(t,h):"children"===s?"string"===typeof h?("textarea"!==n||""!==h)&&yt(t,h):"number"===typeof h&&yt(t,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(u.hasOwnProperty(s)?null!=h&&"onScroll"===s&&Pi("scroll",t):null!=h&&b(t,s,h,l))}switch(n){case"input":Y(t),it(t,i,!1);break;case"textarea":Y(t),ct(t);break;case"option":null!=i.value&&t.setAttribute("value",""+Z(i.value));break;case"select":t.multiple=!!i.multiple,null!=(s=i.value)?ot(t,!!i.multiple,s,!1):null!=i.defaultValue&&ot(t,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof a.onClick&&(t.onclick=ji)}$i(n,i)&&(e.flags|=4)}null!==e.ref&&(e.flags|=128)}return null;case 6:if(t&&null!=e.stateNode)Yo(0,e,t.memoizedProps,i);else{if("string"!==typeof i&&null===e.stateNode)throw Error(o(166));n=La(Aa.current),La(Ia.current),Wa(e)?(i=e.stateNode,n=e.memoizedProps,i[Ji]=e,i.nodeValue!==n&&(e.flags|=4)):((i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Ji]=e,e.stateNode=i)}return null;case 13:return cr(Fa),i=e.memoizedState,0!==(64&e.flags)?(e.lanes=n,e):(i=null!==i,n=!1,null===t?void 0!==e.memoizedProps.fallback&&Wa(e):n=null!==t.memoizedState,i&&!n&&0!==(2&e.mode)&&(null===t&&!0!==e.memoizedProps.unstable_avoidThisFallback||0!==(1&Fa.current)?0===Ns&&(Ns=3):(0!==Ns&&3!==Ns||(Ns=4),null===Rs||0===(134217727&Vs)&&0===(134217727&Us)||yu(Rs,zs))),(i||n)&&(e.flags|=4),null);case 4:return Da(),null===t&&Li(e.stateNode.containerInfo),null;case 10:return ia(e),null;case 19:if(cr(Fa),null===(i=e.memoizedState))return null;if(s=0!==(64&e.flags),null===(l=i.rendering))if(s)os(i,!1);else{if(0!==Ns||null!==t&&0!==(64&t.flags))for(t=e.child;null!==t;){if(null!==(l=Na(t))){for(e.flags|=64,os(i,!1),null!==(s=l.updateQueue)&&(e.updateQueue=s,e.flags|=4),null===i.lastEffect&&(e.firstEffect=null),e.lastEffect=i.lastEffect,i=n,n=e.child;null!==n;)t=i,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(l=s.alternate)?(s.childLanes=0,s.lanes=t,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,t=l.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return hr(Fa,1&Fa.current|2),e.child}t=t.sibling}null!==i.tail&&$r()>Ws&&(e.flags|=64,s=!0,os(i,!1),e.lanes=33554432)}else{if(!s)if(null!==(t=Na(l))){if(e.flags|=64,s=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),os(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!Va)return null!==(e=e.lastEffect=i.lastEffect)&&(e.nextEffect=null),null}else 2*$r()-i.renderingStartTime>Ws&&1073741824!==n&&(e.flags|=64,s=!0,os(i,!1),e.lanes=33554432);i.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=i.last)?n.sibling=l:e.child=l,i.last=l)}return null!==i.tail?(n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=e.lastEffect,i.renderingStartTime=$r(),n.sibling=null,e=Fa.current,hr(Fa,s?1&e|2:1&e),n):null;case 23:case 24:return Su(),null!==t&&null!==t.memoizedState!==(null!==e.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(e.flags|=4),null}throw Error(o(156,e.tag))}function us(t){switch(t.tag){case 1:gr(t.type)&&yr();var e=t.flags;return 4096&e?(t.flags=-4097&e|64,t):null;case 3:if(Da(),cr(dr),cr(fr),Xa(),0!==(64&(e=t.flags)))throw Error(o(285));return t.flags=-4097&e|64,t;case 5:return Oa(t),null;case 13:return cr(Fa),4096&(e=t.flags)?(t.flags=-4097&e|64,t):null;case 19:return cr(Fa),null;case 4:return Da(),null;case 10:return ia(t),null;case 23:case 24:return Su(),null;default:return null}}function ls(t,e){try{var n="",i=e;do{n+=W(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:t,source:e,stack:r}}function cs(t,e){try{console.error(e.value)}catch(n){setTimeout((function(){throw n}))}}Zo=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Xo=function(t,e,n,i){var a=t.memoizedProps;if(a!==i){t=e.stateNode,La(Ia.current);var o,s=null;switch(n){case"input":a=Q(t,a),i=Q(t,i),s=[];break;case"option":a=at(t,a),i=at(t,i),s=[];break;case"select":a=r({},a,{value:void 0}),i=r({},i,{value:void 0}),s=[];break;case"textarea":a=st(t,a),i=st(t,i),s=[];break;default:"function"!==typeof a.onClick&&"function"===typeof i.onClick&&(t.onclick=ji)}for(h in kt(n,i),n=null,a)if(!i.hasOwnProperty(h)&&a.hasOwnProperty(h)&&null!=a[h])if("style"===h){var l=a[h];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(u.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in i){var c=i[h];if(l=null!=a?a[h]:void 0,i.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(h,n)),n=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(u.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Pi("scroll",t),s||l===c||(s=[])):"object"===typeof c&&null!==c&&c.$$typeof===z?c.toString():(s=s||[]).push(h,c))}n&&(s=s||[]).push("style",n);var h=s;(e.updateQueue=h)&&(e.flags|=4)}},Yo=function(t,e,n,i){n!==i&&(e.flags|=4)};var hs="function"===typeof WeakMap?WeakMap:Map;function ps(t,e,n){(n=ca(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Ys||(Ys=!0,Ks=i),cs(0,e)},n}function fs(t,e,n){(n=ca(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"===typeof i){var r=e.value;n.payload=function(){return cs(0,e),i(r)}}var a=t.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof i&&(null===Js?Js=new Set([this]):Js.add(this),cs(0,e));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}var ds="function"===typeof WeakSet?WeakSet:Set;function vs(t){var e=t.ref;if(null!==e)if("function"===typeof e)try{e(null)}catch(n){ju(t,n)}else e.current=null}function ms(t,e){switch(e.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&e.flags&&null!==t){var n=t.memoizedProps,i=t.memoizedState;e=(t=e.stateNode).getSnapshotBeforeUpdate(e.elementType===e.type?n:Kr(e.type,n),i),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:return void(256&e.flags&&Gi(e.stateNode.containerInfo))}throw Error(o(163))}function gs(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(e=null!==(e=n.updateQueue)?e.lastEffect:null)){t=e=e.next;do{if(3===(3&t.tag)){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}if(null!==(e=null!==(e=n.updateQueue)?e.lastEffect:null)){t=e=e.next;do{var r=t;i=r.next,0!==(4&(r=r.tag))&&0!==(1&r)&&(Fu(n,t),Ou(n,t)),t=i}while(t!==e)}return;case 1:return t=n.stateNode,4&n.flags&&(null===e?t.componentDidMount():(i=n.elementType===n.type?e.memoizedProps:Kr(n.type,e.memoizedProps),t.componentDidUpdate(i,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),void(null!==(e=n.updateQueue)&&da(n,e,t));case 3:if(null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 5:case 1:t=n.child.stateNode}da(n,e,t)}return;case 5:return t=n.stateNode,void(null===e&&4&n.flags&&$i(n.type,n.memoizedProps)&&t.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&we(n)))))}throw Error(o(163))}function ys(t,e){for(var n=t;;){if(5===n.tag){var i=n.stateNode;if(e)"function"===typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{i=n.stateNode;var r=n.memoizedProps.style;r=void 0!==r&&null!==r&&r.hasOwnProperty("display")?r.display:null,i.style.display=xt("display",r)}}else if(6===n.tag)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===t)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function _s(t,e){if(kr&&"function"===typeof kr.onCommitFiberUnmount)try{kr.onCommitFiberUnmount(Sr,e)}catch(a){}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var n=t=t.next;do{var i=n,r=i.destroy;if(i=i.tag,void 0!==r)if(0!==(4&i))Fu(e,n);else{i=e;try{r()}catch(a){ju(i,a)}}n=n.next}while(n!==t)}break;case 1:if(vs(e),"function"===typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(a){ju(e,a)}break;case 5:vs(e);break;case 4:Ms(t,e)}}function bs(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function xs(t){return 5===t.tag||3===t.tag||4===t.tag}function ws(t){t:{for(var e=t.return;null!==e;){if(xs(e))break t;e=e.return}throw Error(o(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:e=e.containerInfo,i=!0;break;default:throw Error(o(161))}16&n.flags&&(yt(e,""),n.flags&=-17);t:e:for(n=t;;){for(;null===n.sibling;){if(null===n.return||xs(n.return)){n=null;break t}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue e;if(null===n.child||4===n.tag)continue e;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break t}}i?Ss(t,n,e):ks(t,n,e)}function Ss(t,e,n){var i=t.tag,r=5===i||6===i;if(r)t=r?t.stateNode:t.stateNode.instance,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=ji));else if(4!==i&&null!==(t=t.child))for(Ss(t,e,n),t=t.sibling;null!==t;)Ss(t,e,n),t=t.sibling}function ks(t,e,n){var i=t.tag,r=5===i||6===i;if(r)t=r?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&null!==(t=t.child))for(ks(t,e,n),t=t.sibling;null!==t;)ks(t,e,n),t=t.sibling}function Ms(t,e){for(var n,i,r=e,a=!1;;){if(!a){a=r.return;t:for(;;){if(null===a)throw Error(o(160));switch(n=a.stateNode,a.tag){case 5:i=!1;break t;case 3:case 4:n=n.containerInfo,i=!0;break t}a=a.return}a=!0}if(5===r.tag||6===r.tag){t:for(var s=t,u=r,l=u;;)if(_s(s,l),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===u)break t;for(;null===l.sibling;){if(null===l.return||l.return===u)break t;l=l.return}l.sibling.return=l.return,l=l.sibling}i?(s=n,u=r.stateNode,8===s.nodeType?s.parentNode.removeChild(u):s.removeChild(u)):n.removeChild(r.stateNode)}else if(4===r.tag){if(null!==r.child){n=r.stateNode.containerInfo,i=!0,r.child.return=r,r=r.child;continue}}else if(_s(t,r),null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;4===(r=r.return).tag&&(a=!1)}r.sibling.return=r.return,r=r.sibling}}function Ts(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var i=n=n.next;do{3===(3&i.tag)&&(t=i.destroy,i.destroy=void 0,void 0!==t&&t()),i=i.next}while(i!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=e.stateNode)){i=e.memoizedProps;var r=null!==t?t.memoizedProps:i;t=e.type;var a=e.updateQueue;if(e.updateQueue=null,null!==a){for(n[Qi]=i,"input"===t&&"radio"===i.type&&null!=i.name&&et(n,i),Mt(t,r),e=Mt(t,i),r=0;r<a.length;r+=2){var s=a[r],u=a[r+1];"style"===s?wt(n,u):"dangerouslySetInnerHTML"===s?gt(n,u):"children"===s?yt(n,u):b(n,s,u,e)}switch(t){case"input":nt(n,i);break;case"textarea":lt(n,i);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(a=i.value)?ot(n,!!i.multiple,a,!1):t!==!!i.multiple&&(null!=i.defaultValue?ot(n,!!i.multiple,i.defaultValue,!0):ot(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===e.stateNode)throw Error(o(162));return void(e.stateNode.nodeValue=e.memoizedProps);case 3:return void((n=e.stateNode).hydrate&&(n.hydrate=!1,we(n.containerInfo)));case 13:return null!==e.memoizedState&&(qs=$r(),ys(e.child,!0)),void Es(e);case 19:return void Es(e);case 23:case 24:return void ys(e,null!==e.memoizedState)}throw Error(o(163))}function Es(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new ds),e.forEach((function(e){var i=Uu.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))}))}}function Cs(t,e){return null!==t&&(null===(t=t.memoizedState)||null!==t.dehydrated)&&(null!==(e=e.memoizedState)&&null===e.dehydrated)}var Is=Math.ceil,Ps=x.ReactCurrentDispatcher,As=x.ReactCurrentOwner,Ls=0,Rs=null,Ds=null,zs=0,Os=0,Fs=lr(0),Ns=0,Bs=null,js=0,Vs=0,Us=0,$s=0,Hs=null,qs=0,Ws=1/0;function Gs(){Ws=$r()+500}var Zs,Xs=null,Ys=!1,Ks=null,Js=null,Qs=!1,tu=null,eu=90,nu=[],iu=[],ru=null,au=0,ou=null,su=-1,uu=0,lu=0,cu=null,hu=!1;function pu(){return 0!==(48&Ls)?$r():-1!==su?su:su=$r()}function fu(t){if(0===(2&(t=t.mode)))return 1;if(0===(4&t))return 99===Hr()?1:2;if(0===uu&&(uu=js),0!==Yr.transition){0!==lu&&(lu=null!==Hs?Hs.pendingLanes:0),t=uu;var e=4186112&~lu;return 0===(e&=-e)&&(0===(e=(t=4186112&~t)&-t)&&(e=8192)),e}return t=Hr(),0!==(4&Ls)&&98===t?t=je(12,uu):t=je(t=function(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(t),uu),t}function du(t,e,n){if(50<au)throw au=0,ou=null,Error(o(185));if(null===(t=vu(t,e)))return null;$e(t,e,n),t===Rs&&(Us|=e,4===Ns&&yu(t,zs));var i=Hr();1===e?0!==(8&Ls)&&0===(48&Ls)?_u(t):(mu(t,n),0===Ls&&(Gs(),Zr())):(0===(4&Ls)||98!==i&&99!==i||(null===ru?ru=new Set([t]):ru.add(t)),mu(t,n)),Hs=t}function vu(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}function mu(t,e){for(var n=t.callbackNode,i=t.suspendedLanes,r=t.pingedLanes,a=t.expirationTimes,s=t.pendingLanes;0<s;){var u=31-He(s),l=1<<u,c=a[u];if(-1===c){if(0===(l&i)||0!==(l&r)){c=e,Fe(l);var h=Oe;a[u]=10<=h?c+250:6<=h?c+5e3:-1}}else c<=e&&(t.expiredLanes|=l);s&=~l}if(i=Ne(t,t===Rs?zs:0),e=Oe,0===i)null!==n&&(n!==Fr&&Er(n),t.callbackNode=null,t.callbackPriority=0);else{if(null!==n){if(t.callbackPriority===e)return;n!==Fr&&Er(n)}15===e?(n=_u.bind(null,t),null===Br?(Br=[n],jr=Tr(Lr,Xr)):Br.push(n),n=Fr):14===e?n=Gr(99,_u.bind(null,t)):(n=function(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,t))}}(e),n=Gr(n,gu.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function gu(t){if(su=-1,lu=uu=0,0!==(48&Ls))throw Error(o(327));var e=t.callbackNode;if(zu()&&t.callbackNode!==e)return null;var n=Ne(t,t===Rs?zs:0);if(0===n)return null;var i=n,r=Ls;Ls|=16;var a=Tu();for(Rs===t&&zs===i||(Gs(),ku(t,i));;)try{Iu();break}catch(u){Mu(t,u)}if(na(),Ps.current=a,Ls=r,null!==Ds?i=0:(Rs=null,zs=0,i=Ns),0!==(js&Us))ku(t,0);else if(0!==i){if(2===i&&(Ls|=64,t.hydrate&&(t.hydrate=!1,Gi(t.containerInfo)),0!==(n=Be(t))&&(i=Eu(t,n))),1===i)throw e=Bs,ku(t,0),yu(t,n),mu(t,$r()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,i){case 0:case 1:throw Error(o(345));case 2:case 5:Lu(t);break;case 3:if(yu(t,n),(62914560&n)===n&&10<(i=qs+500-$r())){if(0!==Ne(t,0))break;if(((r=t.suspendedLanes)&n)!==n){pu(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=qi(Lu.bind(null,t),i);break}Lu(t);break;case 4:if(yu(t,n),(4186112&n)===n)break;for(i=t.eventTimes,r=-1;0<n;){var s=31-He(n);a=1<<s,(s=i[s])>r&&(r=s),n&=~a}if(n=r,10<(n=(120>(n=$r()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Is(n/1960))-n)){t.timeoutHandle=qi(Lu.bind(null,t),n);break}Lu(t);break;default:throw Error(o(329))}}return mu(t,$r()),t.callbackNode===e?gu.bind(null,t):null}function yu(t,e){for(e&=~$s,e&=~Us,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-He(e),i=1<<n;t[n]=-1,e&=~i}}function _u(t){if(0!==(48&Ls))throw Error(o(327));if(zu(),t===Rs&&0!==(t.expiredLanes&zs)){var e=zs,n=Eu(t,e);0!==(js&Us)&&(n=Eu(t,e=Ne(t,e)))}else n=Eu(t,e=Ne(t,0));if(0!==t.tag&&2===n&&(Ls|=64,t.hydrate&&(t.hydrate=!1,Gi(t.containerInfo)),0!==(e=Be(t))&&(n=Eu(t,e))),1===n)throw n=Bs,ku(t,0),yu(t,e),mu(t,$r()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,Lu(t),mu(t,$r()),null}function bu(t,e){var n=Ls;Ls|=1;try{return t(e)}finally{0===(Ls=n)&&(Gs(),Zr())}}function xu(t,e){var n=Ls;Ls&=-2,Ls|=8;try{return t(e)}finally{0===(Ls=n)&&(Gs(),Zr())}}function wu(t,e){hr(Fs,Os),Os|=e,js|=e}function Su(){Os=Fs.current,cr(Fs)}function ku(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,Wi(n)),null!==Ds)for(n=Ds.return;null!==n;){var i=n;switch(i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&yr();break;case 3:Da(),cr(dr),cr(fr),Xa();break;case 5:Oa(i);break;case 4:Da();break;case 13:case 19:cr(Fa);break;case 10:ia(i);break;case 23:case 24:Su()}n=n.return}Rs=t,Ds=Wu(t.current,null),zs=Os=js=e,Ns=0,Bs=null,$s=Us=Vs=0}function Mu(t,e){for(;;){var n=Ds;try{if(na(),Ya.current=Lo,no){for(var i=Qa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}no=!1}if(Ja=0,eo=to=Qa=null,io=!1,As.current=null,null===n||null===n.return){Ns=1,Bs=e,Ds=null;break}t:{var a=t,o=n.return,s=n,u=e;if(e=zs,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==u&&"object"===typeof u&&"function"===typeof u.then){var l=u;if(0===(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!==(1&Fa.current),p=o;do{var f;if(f=13===p.tag){var d=p.memoizedState;if(null!==d)f=null!==d.dehydrated;else{var v=p.memoizedProps;f=void 0!==v.fallback&&(!0!==v.unstable_avoidThisFallback||!h)}}if(f){var m=p.updateQueue;if(null===m){var g=new Set;g.add(l),p.updateQueue=g}else m.add(l);if(0===(2&p.mode)){if(p.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var y=ca(-1,1);y.tag=2,ha(s,y)}s.lanes|=1;break t}u=void 0,s=e;var _=a.pingCache;if(null===_?(_=a.pingCache=new hs,u=new Set,_.set(l,u)):void 0===(u=_.get(l))&&(u=new Set,_.set(l,u)),!u.has(s)){u.add(s);var b=Vu.bind(null,a,l,s);l.then(b,b)}p.flags|=4096,p.lanes=e;break t}p=p.return}while(null!==p);u=Error((G(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ns&&(Ns=2),u=ls(u,s),p=o;do{switch(p.tag){case 3:a=u,p.flags|=4096,e&=-e,p.lanes|=e,pa(p,ps(0,a,e));break t;case 1:a=u;var x=p.type,w=p.stateNode;if(0===(64&p.flags)&&("function"===typeof x.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Js||!Js.has(w)))){p.flags|=4096,e&=-e,p.lanes|=e,pa(p,fs(p,a,e));break t}}p=p.return}while(null!==p)}Au(n)}catch(S){e=S,Ds===n&&null!==n&&(Ds=n=n.return);continue}break}}function Tu(){var t=Ps.current;return Ps.current=Lo,null===t?Lo:t}function Eu(t,e){var n=Ls;Ls|=16;var i=Tu();for(Rs===t&&zs===e||ku(t,e);;)try{Cu();break}catch(r){Mu(t,r)}if(na(),Ls=n,Ps.current=i,null!==Ds)throw Error(o(261));return Rs=null,zs=0,Ns}function Cu(){for(;null!==Ds;)Pu(Ds)}function Iu(){for(;null!==Ds&&!Cr();)Pu(Ds)}function Pu(t){var e=Zs(t.alternate,t,Os);t.memoizedProps=t.pendingProps,null===e?Au(t):Ds=e,As.current=null}function Au(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(2048&e.flags)){if(null!==(n=ss(n,e,Os)))return void(Ds=n);if(24!==(n=e).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Os)||0===(4&n.mode)){for(var i=0,r=n.child;null!==r;)i|=r.lanes|r.childLanes,r=r.sibling;n.childLanes=i}null!==t&&0===(2048&t.flags)&&(null===t.firstEffect&&(t.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==t.lastEffect&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(null!==t.lastEffect?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(null!==(n=us(e)))return n.flags&=2047,void(Ds=n);null!==t&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(null!==(e=e.sibling))return void(Ds=e);Ds=e=t}while(null!==e);0===Ns&&(Ns=5)}function Lu(t){var e=Hr();return Wr(99,Ru.bind(null,t,e)),null}function Ru(t,e){do{zu()}while(null!==tu);if(0!==(48&Ls))throw Error(o(327));var n=t.finishedWork;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(o(177));t.callbackNode=null;var i=n.lanes|n.childLanes,r=i,a=t.pendingLanes&~r;t.pendingLanes=r,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=r,t.mutableReadLanes&=r,t.entangledLanes&=r,r=t.entanglements;for(var s=t.eventTimes,u=t.expirationTimes;0<a;){var l=31-He(a),c=1<<l;r[l]=0,s[l]=-1,u[l]=-1,a&=~c}if(null!==ru&&0===(24&i)&&ru.has(t)&&ru.delete(t),t===Rs&&(Ds=Rs=null,zs=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){if(r=Ls,Ls|=32,As.current=null,Vi=Xe,gi(s=mi())){if("selectionStart"in s)u={start:s.selectionStart,end:s.selectionEnd};else t:if(u=(u=s.ownerDocument)&&u.defaultView||window,(c=u.getSelection&&u.getSelection())&&0!==c.rangeCount){u=c.anchorNode,a=c.anchorOffset,l=c.focusNode,c=c.focusOffset;try{u.nodeType,l.nodeType}catch(T){u=null;break t}var h=0,p=-1,f=-1,d=0,v=0,m=s,g=null;e:for(;;){for(var y;m!==u||0!==a&&3!==m.nodeType||(p=h+a),m!==l||0!==c&&3!==m.nodeType||(f=h+c),3===m.nodeType&&(h+=m.nodeValue.length),null!==(y=m.firstChild);)g=m,m=y;for(;;){if(m===s)break e;if(g===u&&++d===a&&(p=h),g===l&&++v===c&&(f=h),null!==(y=m.nextSibling))break;g=(m=g).parentNode}m=y}u=-1===p||-1===f?null:{start:p,end:f}}else u=null;u=u||{start:0,end:0}}else u=null;Ui={focusedElem:s,selectionRange:u},Xe=!1,cu=null,hu=!1,Xs=i;do{try{Du()}catch(T){if(null===Xs)throw Error(o(330));ju(Xs,T),Xs=Xs.nextEffect}}while(null!==Xs);cu=null,Xs=i;do{try{for(s=t;null!==Xs;){var _=Xs.flags;if(16&_&&yt(Xs.stateNode,""),128&_){var b=Xs.alternate;if(null!==b){var x=b.ref;null!==x&&("function"===typeof x?x(null):x.current=null)}}switch(1038&_){case 2:ws(Xs),Xs.flags&=-3;break;case 6:ws(Xs),Xs.flags&=-3,Ts(Xs.alternate,Xs);break;case 1024:Xs.flags&=-1025;break;case 1028:Xs.flags&=-1025,Ts(Xs.alternate,Xs);break;case 4:Ts(Xs.alternate,Xs);break;case 8:Ms(s,u=Xs);var w=u.alternate;bs(u),null!==w&&bs(w)}Xs=Xs.nextEffect}}catch(T){if(null===Xs)throw Error(o(330));ju(Xs,T),Xs=Xs.nextEffect}}while(null!==Xs);if(x=Ui,b=mi(),_=x.focusedElem,s=x.selectionRange,b!==_&&_&&_.ownerDocument&&vi(_.ownerDocument.documentElement,_)){null!==s&&gi(_)&&(b=s.start,void 0===(x=s.end)&&(x=b),"selectionStart"in _?(_.selectionStart=b,_.selectionEnd=Math.min(x,_.value.length)):(x=(b=_.ownerDocument||document)&&b.defaultView||window).getSelection&&(x=x.getSelection(),u=_.textContent.length,w=Math.min(s.start,u),s=void 0===s.end?w:Math.min(s.end,u),!x.extend&&w>s&&(u=s,s=w,w=u),u=di(_,w),a=di(_,s),u&&a&&(1!==x.rangeCount||x.anchorNode!==u.node||x.anchorOffset!==u.offset||x.focusNode!==a.node||x.focusOffset!==a.offset)&&((b=b.createRange()).setStart(u.node,u.offset),x.removeAllRanges(),w>s?(x.addRange(b),x.extend(a.node,a.offset)):(b.setEnd(a.node,a.offset),x.addRange(b))))),b=[];for(x=_;x=x.parentNode;)1===x.nodeType&&b.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"===typeof _.focus&&_.focus(),_=0;_<b.length;_++)(x=b[_]).element.scrollLeft=x.left,x.element.scrollTop=x.top}Xe=!!Vi,Ui=Vi=null,t.current=n,Xs=i;do{try{for(_=t;null!==Xs;){var S=Xs.flags;if(36&S&&gs(_,Xs.alternate,Xs),128&S){b=void 0;var k=Xs.ref;if(null!==k){var M=Xs.stateNode;Xs.tag,b=M,"function"===typeof k?k(b):k.current=b}}Xs=Xs.nextEffect}}catch(T){if(null===Xs)throw Error(o(330));ju(Xs,T),Xs=Xs.nextEffect}}while(null!==Xs);Xs=null,Nr(),Ls=r}else t.current=n;if(Qs)Qs=!1,tu=t,eu=e;else for(Xs=i;null!==Xs;)e=Xs.nextEffect,Xs.nextEffect=null,8&Xs.flags&&((S=Xs).sibling=null,S.stateNode=null),Xs=e;if(0===(i=t.pendingLanes)&&(Js=null),1===i?t===ou?au++:(au=0,ou=t):au=0,n=n.stateNode,kr&&"function"===typeof kr.onCommitFiberRoot)try{kr.onCommitFiberRoot(Sr,n,void 0,64===(64&n.current.flags))}catch(T){}if(mu(t,$r()),Ys)throw Ys=!1,t=Ks,Ks=null,t;return 0!==(8&Ls)||Zr(),null}function Du(){for(;null!==Xs;){var t=Xs.alternate;hu||null===cu||(0!==(8&Xs.flags)?te(Xs,cu)&&(hu=!0):13===Xs.tag&&Cs(t,Xs)&&te(Xs,cu)&&(hu=!0));var e=Xs.flags;0!==(256&e)&&ms(t,Xs),0===(512&e)||Qs||(Qs=!0,Gr(97,(function(){return zu(),null}))),Xs=Xs.nextEffect}}function zu(){if(90!==eu){var t=97<eu?97:eu;return eu=90,Wr(t,Nu)}return!1}function Ou(t,e){nu.push(e,t),Qs||(Qs=!0,Gr(97,(function(){return zu(),null})))}function Fu(t,e){iu.push(e,t),Qs||(Qs=!0,Gr(97,(function(){return zu(),null})))}function Nu(){if(null===tu)return!1;var t=tu;if(tu=null,0!==(48&Ls))throw Error(o(331));var e=Ls;Ls|=32;var n=iu;iu=[];for(var i=0;i<n.length;i+=2){var r=n[i],a=n[i+1],s=r.destroy;if(r.destroy=void 0,"function"===typeof s)try{s()}catch(l){if(null===a)throw Error(o(330));ju(a,l)}}for(n=nu,nu=[],i=0;i<n.length;i+=2){r=n[i],a=n[i+1];try{var u=r.create;r.destroy=u()}catch(l){if(null===a)throw Error(o(330));ju(a,l)}}for(u=t.current.firstEffect;null!==u;)t=u.nextEffect,u.nextEffect=null,8&u.flags&&(u.sibling=null,u.stateNode=null),u=t;return Ls=e,Zr(),!0}function Bu(t,e,n){ha(t,e=ps(0,e=ls(n,e),1)),e=pu(),null!==(t=vu(t,1))&&($e(t,1,e),mu(t,e))}function ju(t,e){if(3===t.tag)Bu(t,t,e);else for(var n=t.return;null!==n;){if(3===n.tag){Bu(n,t,e);break}if(1===n.tag){var i=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Js||!Js.has(i))){var r=fs(n,t=ls(e,t),1);if(ha(n,r),r=pu(),null!==(n=vu(n,1)))$e(n,1,r),mu(n,r);else if("function"===typeof i.componentDidCatch&&(null===Js||!Js.has(i)))try{i.componentDidCatch(e,t)}catch(a){}break}}n=n.return}}function Vu(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=pu(),t.pingedLanes|=t.suspendedLanes&n,Rs===t&&(zs&n)===n&&(4===Ns||3===Ns&&(62914560&zs)===zs&&500>$r()-qs?ku(t,0):$s|=n),mu(t,e)}function Uu(t,e){var n=t.stateNode;null!==n&&n.delete(e),0===(e=0)&&(0===(2&(e=t.mode))?e=1:0===(4&e)?e=99===Hr()?1:2:(0===uu&&(uu=js),0===(e=Ve(62914560&~uu))&&(e=4194304))),n=pu(),null!==(t=vu(t,e))&&($e(t,e,n),mu(t,n))}function $u(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Hu(t,e,n,i){return new $u(t,e,n,i)}function qu(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Wu(t,e){var n=t.alternate;return null===n?((n=Hu(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Gu(t,e,n,i,r,a){var s=2;if(i=t,"function"===typeof t)qu(t)&&(s=1);else if("string"===typeof t)s=5;else t:switch(t){case k:return Zu(n.children,r,a,e);case O:s=8,r|=16;break;case M:s=8,r|=1;break;case T:return(t=Hu(12,n,e,8|r)).elementType=T,t.type=T,t.lanes=a,t;case P:return(t=Hu(13,n,e,r)).type=P,t.elementType=P,t.lanes=a,t;case A:return(t=Hu(19,n,e,r)).elementType=A,t.lanes=a,t;case F:return Xu(n,r,a,e);case N:return(t=Hu(24,n,e,r)).elementType=N,t.lanes=a,t;default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case E:s=10;break t;case C:s=9;break t;case I:s=11;break t;case L:s=14;break t;case R:s=16,i=null;break t;case D:s=22;break t}throw Error(o(130,null==t?t:typeof t,""))}return(e=Hu(s,n,e,r)).elementType=t,e.type=i,e.lanes=a,e}function Zu(t,e,n,i){return(t=Hu(7,t,i,e)).lanes=n,t}function Xu(t,e,n,i){return(t=Hu(23,t,i,e)).elementType=F,t.lanes=n,t}function Yu(t,e,n){return(t=Hu(6,t,null,e)).lanes=n,t}function Ku(t,e,n){return(e=Hu(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Ju(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Ue(0),this.expirationTimes=Ue(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ue(0),this.mutableSourceEagerHydrationData=null}function Qu(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:S,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}function tl(t,e,n,i){var r=e.current,a=pu(),s=fu(r);t:if(n){e:{if(Yt(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break e;case 1:if(gr(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break e}}u=u.return}while(null!==u);throw Error(o(171))}if(1===n.tag){var l=n.type;if(gr(l)){n=br(n,l,u);break t}}n=u}else n=pr;return null===e.context?e.context=n:e.pendingContext=n,(e=ca(a,s)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),ha(r,e),du(r,s,a),s}function el(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function nl(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function il(t,e){nl(t,e),(t=t.alternate)&&nl(t,e)}function rl(t,e,n){var i=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Ju(t,e,null!=n&&!0===n.hydrate),e=Hu(3,null,null,2===e?7:1===e?3:0),n.current=e,e.stateNode=n,ua(e),t[tr]=n.current,Li(8===t.nodeType?t.parentNode:t),i)for(t=0;t<i.length;t++){var r=(e=i[t])._getVersion;r=r(e._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[e,r]:n.mutableSourceEagerHydrationData.push(e,r)}this._internalRoot=n}function al(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function ol(t,e,n,i,r){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof r){var s=r;r=function(){var t=el(o);s.call(t)}}tl(e,o,t,r)}else{if(a=n._reactRootContainer=function(t,e){if(e||(e=!(!(e=t?9===t.nodeType?t.documentElement:t.firstChild:null)||1!==e.nodeType||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new rl(t,0,e?{hydrate:!0}:void 0)}(n,i),o=a._internalRoot,"function"===typeof r){var u=r;r=function(){var t=el(o);u.call(t)}}xu((function(){tl(e,o,t,r)}))}return el(o)}function sl(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!al(e))throw Error(o(200));return Qu(t,e,null,n)}Zs=function(t,e,n){var i=e.lanes;if(null!==t)if(t.memoizedProps!==e.pendingProps||dr.current)Fo=!0;else{if(0===(n&i)){switch(Fo=!1,e.tag){case 3:Go(e),Ga();break;case 5:za(e);break;case 1:gr(e.type)&&xr(e);break;case 4:Ra(e,e.stateNode.containerInfo);break;case 10:i=e.memoizedProps.value;var r=e.type._context;hr(Jr,r._currentValue),r._currentValue=i;break;case 13:if(null!==e.memoizedState)return 0!==(n&e.child.childLanes)?Jo(t,e,n):(hr(Fa,1&Fa.current),null!==(e=as(t,e,n))?e.sibling:null);hr(Fa,1&Fa.current);break;case 19:if(i=0!==(n&e.childLanes),0!==(64&t.flags)){if(i)return rs(t,e,n);e.flags|=64}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),hr(Fa,Fa.current),i)break;return null;case 23:case 24:return e.lanes=0,Uo(t,e,n)}return as(t,e,n)}Fo=0!==(16384&t.flags)}else Fo=!1;switch(e.lanes=0,e.tag){case 2:if(i=e.type,null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,r=mr(e,fr.current),aa(e,n),r=oo(null,e,i,t,r,n),e.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,gr(i)){var a=!0;xr(e)}else a=!1;e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,ua(e);var s=i.getDerivedStateFromProps;"function"===typeof s&&ma(e,i,s,t),r.updater=ga,e.stateNode=r,r._reactInternals=e,xa(e,i,t,n),e=Wo(null,e,i,!0,a,n)}else e.tag=0,No(null,e,r,n),e=e.child;return e;case 16:r=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,r=(a=r._init)(r._payload),e.type=r,a=e.tag=function(t){if("function"===typeof t)return qu(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===I)return 11;if(t===L)return 14}return 2}(r),t=Kr(r,t),a){case 0:e=Ho(null,e,r,t,n);break t;case 1:e=qo(null,e,r,t,n);break t;case 11:e=Bo(null,e,r,t,n);break t;case 14:e=jo(null,e,r,Kr(r.type,t),i,n);break t}throw Error(o(306,r,""))}return e;case 0:return i=e.type,r=e.pendingProps,Ho(t,e,i,r=e.elementType===i?r:Kr(i,r),n);case 1:return i=e.type,r=e.pendingProps,qo(t,e,i,r=e.elementType===i?r:Kr(i,r),n);case 3:if(Go(e),i=e.updateQueue,null===t||null===i)throw Error(o(282));if(i=e.pendingProps,r=null!==(r=e.memoizedState)?r.element:null,la(t,e),fa(e,i,null,n),(i=e.memoizedState.element)===r)Ga(),e=as(t,e,n);else{if((a=(r=e.stateNode).hydrate)&&(ja=Zi(e.stateNode.containerInfo.firstChild),Ba=e,a=Va=!0),a){if(null!=(t=r.mutableSourceEagerHydrationData))for(r=0;r<t.length;r+=2)(a=t[r])._workInProgressVersionPrimary=t[r+1],Za.push(a);for(n=Ea(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else No(t,e,i,n),Ga();e=e.child}return e;case 5:return za(e),null===t&&Ha(e),i=e.type,r=e.pendingProps,a=null!==t?t.memoizedProps:null,s=r.children,Hi(i,r)?s=null:null!==a&&Hi(i,a)&&(e.flags|=16),$o(t,e),No(t,e,s,n),e.child;case 6:return null===t&&Ha(e),null;case 13:return Jo(t,e,n);case 4:return Ra(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=Ta(e,null,i,n):No(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,Bo(t,e,i,r=e.elementType===i?r:Kr(i,r),n);case 7:return No(t,e,e.pendingProps,n),e.child;case 8:case 12:return No(t,e,e.pendingProps.children,n),e.child;case 10:t:{i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value;var u=e.type._context;if(hr(Jr,u._currentValue),u._currentValue=a,null!==s)if(u=s.value,0===(a=ci(u,a)?0:0|("function"===typeof i._calculateChangedBits?i._calculateChangedBits(u,a):1073741823))){if(s.children===r.children&&!dr.current){e=as(t,e,n);break t}}else for(null!==(u=e.child)&&(u.return=e);null!==u;){var l=u.dependencies;if(null!==l){s=u.child;for(var c=l.firstContext;null!==c;){if(c.context===i&&0!==(c.observedBits&a)){1===u.tag&&((c=ca(-1,n&-n)).tag=2,ha(u,c)),u.lanes|=n,null!==(c=u.alternate)&&(c.lanes|=n),ra(u.return,n),l.lanes|=n;break}c=c.next}}else s=10===u.tag&&u.type===e.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===e){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}No(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=(a=e.pendingProps).children,aa(e,n),i=i(r=oa(r,a.unstable_observedBits)),e.flags|=1,No(t,e,i,n),e.child;case 14:return a=Kr(r=e.type,e.pendingProps),jo(t,e,r,a=Kr(r.type,a),i,n);case 15:return Vo(t,e,e.type,e.pendingProps,i,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Kr(i,r),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,gr(i)?(t=!0,xr(e)):t=!1,aa(e,n),_a(e,i,r),xa(e,i,r,n),Wo(null,e,i,!0,t,n);case 19:return rs(t,e,n);case 23:case 24:return Uo(t,e,n)}throw Error(o(156,e.tag))},rl.prototype.render=function(t){tl(t,this._internalRoot,null,null)},rl.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;tl(null,t,null,(function(){e[tr]=null}))},ee=function(t){13===t.tag&&(du(t,4,pu()),il(t,4))},ne=function(t){13===t.tag&&(du(t,67108864,pu()),il(t,67108864))},ie=function(t){if(13===t.tag){var e=pu(),n=fu(t);du(t,n,e),il(t,n)}},re=function(t,e){return e()},Et=function(t,e,n){switch(e){case"input":if(nt(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=ar(i);if(!r)throw Error(o(90));K(i),nt(i,r)}}}break;case"textarea":lt(t,n);break;case"select":null!=(e=n.value)&&ot(t,!!n.multiple,e,!1)}},Rt=bu,Dt=function(t,e,n,i,r){var a=Ls;Ls|=4;try{return Wr(98,t.bind(null,e,n,i,r))}finally{0===(Ls=a)&&(Gs(),Zr())}},zt=function(){0===(49&Ls)&&(function(){if(null!==ru){var t=ru;ru=null,t.forEach((function(t){t.expiredLanes|=24&t.pendingLanes,mu(t,$r())}))}Zr()}(),zu())},Ot=function(t,e){var n=Ls;Ls|=2;try{return t(e)}finally{0===(Ls=n)&&(Gs(),Zr())}};var ul={Events:[ir,rr,ar,At,Lt,zu,{current:!1}]},ll={findFiberByHostInstance:nr,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},cl={bundleType:ll.bundleType,version:ll.version,rendererPackageName:ll.rendererPackageName,rendererConfig:ll.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Qt(t))?null:t.stateNode},findFiberByHostInstance:ll.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var hl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hl.isDisabled&&hl.supportsFiber)try{Sr=hl.inject(cl),kr=hl}catch(mt){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ul,e.createPortal=sl,e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(o(188));throw Error(o(268,Object.keys(t)))}return t=null===(t=Qt(e))?null:t.stateNode},e.flushSync=function(t,e){var n=Ls;if(0!==(48&n))return t(e);Ls|=1;try{if(t)return Wr(99,t.bind(null,e))}finally{Ls=n,Zr()}},e.hydrate=function(t,e,n){if(!al(e))throw Error(o(200));return ol(null,t,e,!0,n)},e.render=function(t,e,n){if(!al(e))throw Error(o(200));return ol(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!al(t))throw Error(o(40));return!!t._reactRootContainer&&(xu((function(){ol(null,null,t,!1,(function(){t._reactRootContainer=null,t[tr]=null}))})),!0)},e.unstable_batchedUpdates=bu,e.unstable_createPortal=function(t,e){return sl(t,e,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},e.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!al(n))throw Error(o(200));if(null==t||void 0===t._reactInternals)throw Error(o(38));return ol(t,e,n,!1,i)},e.version="17.0.2"},164:function(t,e,n){"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(463)},372:function(t,e){"use strict";var n="function"===typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,c=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,d=n?Symbol.for("react.suspense_list"):60120,v=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,_=n?Symbol.for("react.responder"):60118,b=n?Symbol.for("react.scope"):60119;function x(t){if("object"===typeof t&&null!==t){var e=t.$$typeof;switch(e){case i:switch(t=t.type){case c:case h:case a:case s:case o:case f:return t;default:switch(t=t&&t.$$typeof){case l:case p:case m:case v:case u:return t;default:return e}}case r:return e}}}function w(t){return x(t)===h}e.AsyncMode=c,e.ConcurrentMode=h,e.ContextConsumer=l,e.ContextProvider=u,e.Element=i,e.ForwardRef=p,e.Fragment=a,e.Lazy=m,e.Memo=v,e.Portal=r,e.Profiler=s,e.StrictMode=o,e.Suspense=f,e.isAsyncMode=function(t){return w(t)||x(t)===c},e.isConcurrentMode=w,e.isContextConsumer=function(t){return x(t)===l},e.isContextProvider=function(t){return x(t)===u},e.isElement=function(t){return"object"===typeof t&&null!==t&&t.$$typeof===i},e.isForwardRef=function(t){return x(t)===p},e.isFragment=function(t){return x(t)===a},e.isLazy=function(t){return x(t)===m},e.isMemo=function(t){return x(t)===v},e.isPortal=function(t){return x(t)===r},e.isProfiler=function(t){return x(t)===s},e.isStrictMode=function(t){return x(t)===o},e.isSuspense=function(t){return x(t)===f},e.isValidElementType=function(t){return"string"===typeof t||"function"===typeof t||t===a||t===h||t===s||t===o||t===f||t===d||"object"===typeof t&&null!==t&&(t.$$typeof===m||t.$$typeof===v||t.$$typeof===u||t.$$typeof===l||t.$$typeof===p||t.$$typeof===y||t.$$typeof===_||t.$$typeof===b||t.$$typeof===g)},e.typeOf=x},441:function(t,e,n){"use strict";t.exports=n(372)},374:function(t,e,n){"use strict";n(725);var i=n(791),r=60103;if(e.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var a=Symbol.for;r=a("react.element"),e.Fragment=a("react.fragment")}var o=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function l(t,e,n){var i,a={},l=null,c=null;for(i in void 0!==n&&(l=""+n),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(c=e.ref),e)s.call(e,i)&&!u.hasOwnProperty(i)&&(a[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps)void 0===a[i]&&(a[i]=e[i]);return{$$typeof:r,type:t,key:l,ref:c,props:a,_owner:o.current}}e.jsx=l,e.jsxs=l},117:function(t,e,n){"use strict";var i=n(725),r=60103,a=60106;e.Fragment=60107,e.StrictMode=60108,e.Profiler=60114;var o=60109,s=60110,u=60112;e.Suspense=60113;var l=60115,c=60116;if("function"===typeof Symbol&&Symbol.for){var h=Symbol.for;r=h("react.element"),a=h("react.portal"),e.Fragment=h("react.fragment"),e.StrictMode=h("react.strict_mode"),e.Profiler=h("react.profiler"),o=h("react.provider"),s=h("react.context"),u=h("react.forward_ref"),e.Suspense=h("react.suspense"),l=h("react.memo"),c=h("react.lazy")}var p="function"===typeof Symbol&&Symbol.iterator;function f(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function m(t,e,n){this.props=t,this.context=e,this.refs=v,this.updater=n||d}function g(){}function y(t,e,n){this.props=t,this.context=e,this.refs=v,this.updater=n||d}m.prototype.isReactComponent={},m.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error(f(85));this.updater.enqueueSetState(this,t,e,"setState")},m.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},g.prototype=m.prototype;var _=y.prototype=new g;_.constructor=y,i(_,m.prototype),_.isPureReactComponent=!0;var b={current:null},x=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function S(t,e,n){var i,a={},o=null,s=null;if(null!=e)for(i in void 0!==e.ref&&(s=e.ref),void 0!==e.key&&(o=""+e.key),e)x.call(e,i)&&!w.hasOwnProperty(i)&&(a[i]=e[i]);var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(t&&t.defaultProps)for(i in u=t.defaultProps)void 0===a[i]&&(a[i]=u[i]);return{$$typeof:r,type:t,key:o,ref:s,props:a,_owner:b.current}}function k(t){return"object"===typeof t&&null!==t&&t.$$typeof===r}var M=/\/+/g;function T(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,(function(t){return e[t]}))}(""+t.key):e.toString(36)}function E(t,e,n,i,o){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var u=!1;if(null===t)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case r:case a:u=!0}}if(u)return o=o(u=t),t=""===i?"."+T(u,0):i,Array.isArray(o)?(n="",null!=t&&(n=t.replace(M,"$&/")+"/"),E(o,e,n,"",(function(t){return t}))):null!=o&&(k(o)&&(o=function(t,e){return{$$typeof:r,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,n+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(M,"$&/")+"/")+t)),e.push(o)),1;if(u=0,i=""===i?".":i+":",Array.isArray(t))for(var l=0;l<t.length;l++){var c=i+T(s=t[l],l);u+=E(s,e,n,c,o)}else if(c=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=p&&t[p]||t["@@iterator"])?t:null}(t),"function"===typeof c)for(t=c.call(t),l=0;!(s=t.next()).done;)u+=E(s=s.value,e,n,c=i+T(s,l++),o);else if("object"===s)throw e=""+t,Error(f(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e));return u}function C(t,e,n){if(null==t)return t;var i=[],r=0;return E(t,i,"","",(function(t){return e.call(n,t,r++)})),i}function I(t){if(-1===t._status){var e=t._result;e=e(),t._status=0,t._result=e,e.then((function(e){0===t._status&&(e=e.default,t._status=1,t._result=e)}),(function(e){0===t._status&&(t._status=2,t._result=e)}))}if(1===t._status)return t._result;throw t._result}var P={current:null};function A(){var t=P.current;if(null===t)throw Error(f(321));return t}var L={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:i};e.Children={map:C,forEach:function(t,e,n){C(t,(function(){e.apply(this,arguments)}),n)},count:function(t){var e=0;return C(t,(function(){e++})),e},toArray:function(t){return C(t,(function(t){return t}))||[]},only:function(t){if(!k(t))throw Error(f(143));return t}},e.Component=m,e.PureComponent=y,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,e.cloneElement=function(t,e,n){if(null===t||void 0===t)throw Error(f(267,t));var a=i({},t.props),o=t.key,s=t.ref,u=t._owner;if(null!=e){if(void 0!==e.ref&&(s=e.ref,u=b.current),void 0!==e.key&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)x.call(e,c)&&!w.hasOwnProperty(c)&&(a[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];a.children=l}return{$$typeof:r,type:t.type,key:o,ref:s,props:a,_owner:u}},e.createContext=function(t,e){return void 0===e&&(e=null),(t={$$typeof:s,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:t},t.Consumer=t},e.createElement=S,e.createFactory=function(t){var e=S.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:u,render:t}},e.isValidElement=k,e.lazy=function(t){return{$$typeof:c,_payload:{_status:-1,_result:t},_init:I}},e.memo=function(t,e){return{$$typeof:l,type:t,compare:void 0===e?null:e}},e.useCallback=function(t,e){return A().useCallback(t,e)},e.useContext=function(t,e){return A().useContext(t,e)},e.useDebugValue=function(){},e.useEffect=function(t,e){return A().useEffect(t,e)},e.useImperativeHandle=function(t,e,n){return A().useImperativeHandle(t,e,n)},e.useLayoutEffect=function(t,e){return A().useLayoutEffect(t,e)},e.useMemo=function(t,e){return A().useMemo(t,e)},e.useReducer=function(t,e,n){return A().useReducer(t,e,n)},e.useRef=function(t){return A().useRef(t)},e.useState=function(t){return A().useState(t)},e.version="17.0.2"},791:function(t,e,n){"use strict";t.exports=n(117)},184:function(t,e,n){"use strict";t.exports=n(374)},727:function(t){var e=function(t){"use strict";var e,n=Object.prototype,i=n.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(A){u=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var r=e&&e.prototype instanceof m?e:m,a=Object.create(r.prototype),o=new C(i||[]);return a._invoke=function(t,e,n){var i=h;return function(r,a){if(i===f)throw new Error("Generator is already running");if(i===d){if("throw"===r)throw a;return P()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=M(o,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var u=c(t,e,n);if("normal"===u.type){if(i=n.done?d:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=d,n.method="throw",n.arg=u.arg)}}}(t,n,o),a}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(A){return{type:"throw",arg:A}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",f="executing",d="completed",v={};function m(){}function g(){}function y(){}var _={};u(_,a,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(I([])));x&&x!==n&&i.call(x,a)&&(_=x);var w=y.prototype=m.prototype=Object.create(_);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function n(r,a,o,s){var u=c(t[r],t,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"===typeof h&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(h).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,s)}))}s(u.arg)}var r;this._invoke=function(t,i){function a(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(a,a):a()}}function M(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,M(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var r=c(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function I(t){if(t){var n=t[a];if(n)return n.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:P}}function P(){return{value:e,done:!0}}return g.prototype=y,u(w,"constructor",y),u(y,"constructor",g),g.displayName=u(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,s,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},S(k.prototype),u(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new k(l(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(w),u(w,s,"Generator"),u(w,a,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=I,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;E(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:I(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(n){"object"===typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},813:function(t,e){"use strict";var n,i,r,a;if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();e.unstable_now=function(){return s.now()-u}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var l=null,c=null,h=function t(){if(null!==l)try{var n=e.unstable_now();l(!0,n),l=null}catch(i){throw setTimeout(t,0),i}};n=function(t){null!==l?setTimeout(n,0,t):(l=t,setTimeout(h,0))},i=function(t,e){c=setTimeout(t,e)},r=function(){clearTimeout(c)},e.unstable_shouldYield=function(){return!1},a=e.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,f=window.clearTimeout;if("undefined"!==typeof console){var d=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof d&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var v=!1,m=null,g=-1,y=5,_=0;e.unstable_shouldYield=function(){return e.unstable_now()>=_},a=function(){},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y=0<t?Math.floor(1e3/t):5};var b=new MessageChannel,x=b.port2;b.port1.onmessage=function(){if(null!==m){var t=e.unstable_now();_=t+y;try{m(!0,t)?x.postMessage(null):(v=!1,m=null)}catch(n){throw x.postMessage(null),n}}else v=!1},n=function(t){m=t,v||(v=!0,x.postMessage(null))},i=function(t,n){g=p((function(){t(e.unstable_now())}),n)},r=function(){f(g),g=-1}}function w(t,e){var n=t.length;t.push(e);t:for(;;){var i=n-1>>>1,r=t[i];if(!(void 0!==r&&0<M(r,e)))break t;t[i]=e,t[n]=r,n=i}}function S(t){return void 0===(t=t[0])?null:t}function k(t){var e=t[0];if(void 0!==e){var n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length;i<r;){var a=2*(i+1)-1,o=t[a],s=a+1,u=t[s];if(void 0!==o&&0>M(o,n))void 0!==u&&0>M(u,o)?(t[i]=u,t[s]=n,i=s):(t[i]=o,t[a]=n,i=a);else{if(!(void 0!==u&&0>M(u,n)))break t;t[i]=u,t[s]=n,i=s}}}return e}return null}function M(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}var T=[],E=[],C=1,I=null,P=3,A=!1,L=!1,R=!1;function D(t){for(var e=S(E);null!==e;){if(null===e.callback)k(E);else{if(!(e.startTime<=t))break;k(E),e.sortIndex=e.expirationTime,w(T,e)}e=S(E)}}function z(t){if(R=!1,D(t),!L)if(null!==S(T))L=!0,n(O);else{var e=S(E);null!==e&&i(z,e.startTime-t)}}function O(t,n){L=!1,R&&(R=!1,r()),A=!0;var a=P;try{for(D(n),I=S(T);null!==I&&(!(I.expirationTime>n)||t&&!e.unstable_shouldYield());){var o=I.callback;if("function"===typeof o){I.callback=null,P=I.priorityLevel;var s=o(I.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?I.callback=s:I===S(T)&&k(T),D(n)}else k(T);I=S(T)}if(null!==I)var u=!0;else{var l=S(E);null!==l&&i(z,l.startTime-n),u=!1}return u}finally{I=null,P=a,A=!1}}var F=a;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){L||A||(L=!0,n(O))},e.unstable_getCurrentPriorityLevel=function(){return P},e.unstable_getFirstCallbackNode=function(){return S(T)},e.unstable_next=function(t){switch(P){case 1:case 2:case 3:var e=3;break;default:e=P}var n=P;P=e;try{return t()}finally{P=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=F,e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=P;P=t;try{return e()}finally{P=n}},e.unstable_scheduleCallback=function(t,a,o){var s=e.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,t){case 1:var u=-1;break;case 2:u=250;break;case 5:u=1073741823;break;case 4:u=1e4;break;default:u=5e3}return t={id:C++,callback:a,priorityLevel:t,startTime:o,expirationTime:u=o+u,sortIndex:-1},o>s?(t.sortIndex=o,w(E,t),null===S(T)&&t===S(E)&&(R?r():R=!0,i(z,o-s))):(t.sortIndex=u,w(T,t),L||A||(L=!0,n(O))),t},e.unstable_wrapCallback=function(t){var e=P;return function(){var n=P;P=e;try{return t.apply(this,arguments)}finally{P=n}}}},296:function(t,e,n){"use strict";t.exports=n(813)}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,n),a.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";var t=n(791),e=n(164);function i(t,e){return i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(t,e)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}var a=n(7),o=n.n(a);function s(){return s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},s.apply(this,arguments)}function u(t){return"/"===t.charAt(0)}function l(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}var c=function(t,e){void 0===e&&(e="");var n,i=t&&t.split("/")||[],r=e&&e.split("/")||[],a=t&&u(t),o=e&&u(e),s=a||o;if(t&&u(t)?r=i:i.length&&(r.pop(),r=r.concat(i)),!r.length)return"/";if(r.length){var c=r[r.length-1];n="."===c||".."===c||""===c}else n=!1;for(var h=0,p=r.length;p>=0;p--){var f=r[p];"."===f?l(r,p):".."===f?(l(r,p),h++):h&&(l(r,p),h--)}if(!s)for(;h--;h)r.unshift("..");!s||""===r[0]||r[0]&&u(r[0])||r.unshift("");var d=r.join("/");return n&&"/"!==d.substr(-1)&&(d+="/"),d},h="Invariant failed";function p(t,e){if(!t)throw new Error(h)}function f(t){return"/"===t.charAt(0)?t:"/"+t}function d(t){return"/"===t.charAt(0)?t.substr(1):t}function v(t,e){return function(t,e){return 0===t.toLowerCase().indexOf(e.toLowerCase())&&-1!=="/?#".indexOf(t.charAt(e.length))}(t,e)?t.substr(e.length):t}function m(t){return"/"===t.charAt(t.length-1)?t.slice(0,-1):t}function g(t){var e=t.pathname,n=t.search,i=t.hash,r=e||"/";return n&&"?"!==n&&(r+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(r+="#"===i.charAt(0)?i:"#"+i),r}function y(t,e,n,i){var r;"string"===typeof t?(r=function(t){var e=t||"/",n="",i="",r=e.indexOf("#");-1!==r&&(i=e.substr(r),e=e.substr(0,r));var a=e.indexOf("?");return-1!==a&&(n=e.substr(a),e=e.substr(0,a)),{pathname:e,search:"?"===n?"":n,hash:"#"===i?"":i}}(t),r.state=e):(void 0===(r=s({},t)).pathname&&(r.pathname=""),r.search?"?"!==r.search.charAt(0)&&(r.search="?"+r.search):r.search="",r.hash?"#"!==r.hash.charAt(0)&&(r.hash="#"+r.hash):r.hash="",void 0!==e&&void 0===r.state&&(r.state=e));try{r.pathname=decodeURI(r.pathname)}catch(a){throw a instanceof URIError?new URIError('Pathname "'+r.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):a}return n&&(r.key=n),i?r.pathname?"/"!==r.pathname.charAt(0)&&(r.pathname=c(r.pathname,i.pathname)):r.pathname=i.pathname:r.pathname||(r.pathname="/"),r}function _(){var t=null;var e=[];return{setPrompt:function(e){return t=e,function(){t===e&&(t=null)}},confirmTransitionTo:function(e,n,i,r){if(null!=t){var a="function"===typeof t?t(e,n):t;"string"===typeof a?"function"===typeof i?i(a,r):r(!0):r(!1!==a)}else r(!0)},appendListener:function(t){var n=!0;function i(){n&&t.apply(void 0,arguments)}return e.push(i),function(){n=!1,e=e.filter((function(t){return t!==i}))}},notifyListeners:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.forEach((function(t){return t.apply(void 0,n)}))}}}var b=!("undefined"===typeof window||!window.document||!window.document.createElement);function x(t,e){e(window.confirm(t))}var w="popstate",S="hashchange";function k(){try{return window.history.state||{}}catch(t){return{}}}function M(t){void 0===t&&{},b||p(!1);var e=window.history,n=function(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history}(),i=!(-1===window.navigator.userAgent.indexOf("Trident")),r=t,a=r.forceRefresh,o=void 0!==a&&a,u=r.getUserConfirmation,l=void 0===u?x:u,c=r.keyLength,h=void 0===c?6:c,d=t.basename?m(f(t.basename)):"";function M(t){var e=t||{},n=e.key,i=e.state,r=window.location,a=r.pathname+r.search+r.hash;return d&&v(a,d),y(a,i,n)}function T(){return Math.random().toString(36).substr(2,h)}var E=_();function C(t){s(j,t),j.length=e.length,E.notifyListeners(j.location,j.action)}function I(t){(function(t){return void 0===t.state&&-1===navigator.userAgent.indexOf("CriOS")})(t)||L(M(t.state))}function P(){L(M(k()))}var A=!1;function L(t){if(A)!1,C();else{E.confirmTransitionTo(t,"POP",l,(function(e){e?C({action:"POP",location:t}):function(t){var e=j.location,n=D.indexOf(e.key);-1===n&&0;var i=D.indexOf(t.key);-1===i&&0;var r=n-i;r&&(!0,O(r))}(t)}))}}var R=M(k()),D=[R.key];function z(t){return d+g(t)}function O(t){e.go(t)}var F=0;function N(t){1===(F+=t)&&1===t?(window.addEventListener(w,I),i&&window.addEventListener(S,P)):0===F&&(window.removeEventListener(w,I),i&&window.removeEventListener(S,P))}var B=!1;var j={length:e.length,action:"POP",location:R,createHref:z,push:function(t,i){var r="PUSH",a=y(t,i,T(),j.location);E.confirmTransitionTo(a,r,l,(function(t){if(t){var i=z(a),s=a.key,u=a.state;if(n)if(e.pushState({key:s,state:u},null,i),o)window.location.href=i;else{var l=D.indexOf(j.location.key),c=D.slice(0,l+1);c.push(a.key),c,C({action:r,location:a})}else window.location.href=i}}))},replace:function(t,i){var r="REPLACE",a=y(t,i,T(),j.location);E.confirmTransitionTo(a,r,l,(function(t){if(t){var i=z(a),s=a.key,u=a.state;if(n)if(e.replaceState({key:s,state:u},null,i),o)window.location.replace(i);else{var l=D.indexOf(j.location.key);-1!==l&&(D[l]=a.key),C({action:r,location:a})}else window.location.replace(i)}}))},go:O,goBack:function(){O(-1)},goForward:function(){O(1)},block:function(t){void 0===t&&!1;var e=E.setPrompt(t);return B||(N(1),!0),function(){return B&&(!1,N(-1)),e()}},listen:function(t){var e=E.appendListener(t);return N(1),function(){N(-1),e()}}};return j}var T="hashchange",E={hashbang:{encodePath:function(t){return"!"===t.charAt(0)?t:"!/"+d(t)},decodePath:function(t){return"!"===t.charAt(0)?t.substr(1):t}},noslash:{encodePath:d,decodePath:f},slash:{encodePath:f,decodePath:f}};function C(t){var e=t.indexOf("#");return-1===e?t:t.slice(0,e)}function I(){var t=window.location.href,e=t.indexOf("#");return-1===e?"":t.substring(e+1)}function P(t){window.location.replace(C(window.location.href)+"#"+t)}function A(t){void 0===t&&(t={}),b||p(!1);var e=window.history,n=(window.navigator.userAgent.indexOf("Firefox"),t),i=n.getUserConfirmation,r=void 0===i?x:i,a=n.hashType,o=void 0===a?"slash":a,u=t.basename?m(f(t.basename)):"",l=E[o],c=l.encodePath,h=l.decodePath;function d(){var t=h(I());return u&&(t=v(t,u)),y(t)}var w=_();function S(t){s(j,t),j.length=e.length,w.notifyListeners(j.location,j.action)}var k=!1,M=null;function A(){var t,e,n=I(),i=c(n);if(n!==i)P(i);else{var a=d(),o=j.location;if(!k&&(e=a,(t=o).pathname===e.pathname&&t.search===e.search&&t.hash===e.hash))return;if(M===g(a))return;M=null,function(t){if(k)k=!1,S();else{var e="POP";w.confirmTransitionTo(t,e,r,(function(n){n?S({action:e,location:t}):function(t){var e=j.location,n=z.lastIndexOf(g(e));-1===n&&(n=0);var i=z.lastIndexOf(g(t));-1===i&&(i=0);var r=n-i;r&&(k=!0,O(r))}(t)}))}}(a)}}var L=I(),R=c(L);L!==R&&P(R);var D=d(),z=[g(D)];function O(t){e.go(t)}var F=0;function N(t){1===(F+=t)&&1===t?window.addEventListener(T,A):0===F&&window.removeEventListener(T,A)}var B=!1;var j={length:e.length,action:"POP",location:D,createHref:function(t){var e=document.querySelector("base"),n="";return e&&e.getAttribute("href")&&(n=C(window.location.href)),n+"#"+c(u+g(t))},push:function(t,e){var n="PUSH",i=y(t,void 0,void 0,j.location);w.confirmTransitionTo(i,n,r,(function(t){if(t){var e=g(i),r=c(u+e);if(I()!==r){M=e,function(t){window.location.hash=t}(r);var a=z.lastIndexOf(g(j.location)),o=z.slice(0,a+1);o.push(e),z=o,S({action:n,location:i})}else S()}}))},replace:function(t,e){var n="REPLACE",i=y(t,void 0,void 0,j.location);w.confirmTransitionTo(i,n,r,(function(t){if(t){var e=g(i),r=c(u+e);I()!==r&&(M=e,P(r));var a=z.indexOf(g(j.location));-1!==a&&(z[a]=e),S({action:n,location:i})}}))},go:O,goBack:function(){O(-1)},goForward:function(){O(1)},block:function(t){void 0===t&&(t=!1);var e=w.setPrompt(t);return B||(N(1),B=!0),function(){return B&&(B=!1,N(-1)),e()}},listen:function(t){var e=w.appendListener(t);return N(1),function(){N(-1),e()}}};return j}function L(t,e,n){return Math.min(Math.max(t,e),n)}function R(t){void 0===t&&{};var e=t,n=e.getUserConfirmation,i=e.initialEntries,r=void 0===i?["/"]:i,a=e.initialIndex,o=void 0===a?0:a,u=e.keyLength,l=void 0===u?6:u,c=_();function h(t){s(b,t),b.length=b.entries.length,c.notifyListeners(b.location,b.action)}function p(){return Math.random().toString(36).substr(2,l)}var f=L(o,0,r.length-1),d=r.map((function(t){return y(t,void 0,"string"===typeof t?p():t.key||p())})),v=g;function m(t){var e=L(b.index+t,0,b.entries.length-1),i=b.entries[e];c.confirmTransitionTo(i,"POP",n,(function(t){t?h({action:"POP",location:i,index:e}):h()}))}var b={length:d.length,action:"POP",location:d[f],index:f,entries:d,createHref:v,push:function(t,e){var i="PUSH",r=y(t,e,p(),b.location);c.confirmTransitionTo(r,i,n,(function(t){if(t){var e=b.index+1,n=b.entries.slice(0);n.length>e?n.splice(e,n.length-e,r):n.push(r),h({action:i,location:r,index:e,entries:n})}}))},replace:function(t,e){var i="REPLACE",r=y(t,e,p(),b.location);c.confirmTransitionTo(r,i,n,(function(t){t&&(b.entries[b.index]=r,h({action:i,location:r}))}))},go:m,goBack:function(){m(-1)},goForward:function(){m(1)},canGo:function(t){var e=b.index+t;return e>=0&&e<b.entries.length},block:function(t){return void 0===t&&!1,c.setPrompt(t)},listen:function(t){return c.appendListener(t)}};return b}var D=1073741823,z="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{};function O(t){var e=[];return{on:function(t){e.push(t)},off:function(t){e=e.filter((function(e){return e!==t}))},get:function(){return t},set:function(n,i){t=n,e.forEach((function(e){return e(t,i)}))}}}var F=t.createContext||function(e,n){var i,a,s="__create-react-context-"+function(){var t="__global_unique_id__";return z[t]=(z[t]||0)+1}()+"__",u=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).emitter=O(e.props.value),e}r(e,t);var i=e.prototype;return i.getChildContext=function(){var t;return(t={})[s]=this.emitter,t},i.componentWillReceiveProps=function(t){if(this.props.value!==t.value){var e,i=this.props.value,r=t.value;((a=i)===(o=r)?0!==a||1/a===1/o:a!==a&&o!==o)?e=0:(e="function"===typeof n?n(i,r):D,0!==(e|=0)&&this.emitter.set(t.value,e))}var a,o},i.render=function(){return this.props.children},e}(t.Component);u.childContextTypes=((i={})[s]=o().object.isRequired,i);var l=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).state={value:e.getValue()},e.onUpdate=function(t,n){0!==((0|e.observedBits)&n)&&e.setState({value:e.getValue()})},e}r(n,t);var i=n.prototype;return i.componentWillReceiveProps=function(t){var e=t.observedBits;this.observedBits=void 0===e||null===e?D:e},i.componentDidMount=function(){this.context[s]&&this.context[s].on(this.onUpdate);var t=this.props.observedBits;this.observedBits=void 0===t||null===t?D:t},i.componentWillUnmount=function(){this.context[s]&&this.context[s].off(this.onUpdate)},i.getValue=function(){return this.context[s]?this.context[s].get():e},i.render=function(){return(t=this.props.children,Array.isArray(t)?t[0]:t)(this.state.value);var t},n}(t.Component);return l.contextTypes=((a={})[s]=o().object,a),{Provider:u,Consumer:l}},N=F,B=n(151),j=n.n(B);n(441);function V(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}n(110);var U=function(t){var e=N();return e.displayName=t,e},$=U("Router-History"),H=U("Router"),q=function(e){function n(t){var n;return(n=e.call(this,t)||this).state={location:t.history.location},n._isMounted=!1,n._pendingLocation=null,t.staticContext||(n.unlisten=t.history.listen((function(t){n._isMounted?n.setState({location:t}):n._pendingLocation=t}))),n}r(n,e),n.computeRootMatch=function(t){return{path:"/",url:"/",params:{},isExact:"/"===t}};var i=n.prototype;return i.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},i.componentWillUnmount=function(){this.unlisten&&(this.unlisten(),this._isMounted=!1,this._pendingLocation=null)},i.render=function(){return t.createElement(H.Provider,{value:{history:this.props.history,location:this.state.location,match:n.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},t.createElement($.Provider,{children:this.props.children||null,value:this.props.history}))},n}(t.Component);t.Component;t.Component;var W={},G=0;function Z(t,e){void 0===e&&(e={}),("string"===typeof e||Array.isArray(e))&&(e={path:e});var n=e,i=n.path,r=n.exact,a=void 0!==r&&r,o=n.strict,s=void 0!==o&&o,u=n.sensitive,l=void 0!==u&&u;return[].concat(i).reduce((function(e,n){if(!n&&""!==n)return null;if(e)return e;var i=function(t,e){var n=""+e.end+e.strict+e.sensitive,i=W[n]||(W[n]={});if(i[t])return i[t];var r=[],a={regexp:j()(t,r,e),keys:r};return G<1e4&&(i[t]=a,G++),a}(n,{end:a,strict:s,sensitive:l}),r=i.regexp,o=i.keys,u=r.exec(t);if(!u)return null;var c=u[0],h=u.slice(1),p=t===c;return a&&!p?null:{path:n,url:"/"===n&&""===c?"/":c,isExact:p,params:o.reduce((function(t,e,n){return t[e.name]=h[n],t}),{})}}),null)}var X=function(e){function n(){return e.apply(this,arguments)||this}return r(n,e),n.prototype.render=function(){var e=this;return t.createElement(H.Consumer,null,(function(n){n||p(!1);var i=e.props.location||n.location,r=s({},n,{location:i,match:e.props.computedMatch?e.props.computedMatch:e.props.path?Z(i.pathname,e.props):n.match}),a=e.props,o=a.children,u=a.component,l=a.render;return Array.isArray(o)&&function(e){return 0===t.Children.count(e)}(o)&&(o=null),t.createElement(H.Provider,{value:r},r.match?o?"function"===typeof o?o(r):o:u?t.createElement(u,r):l?l(r):null:"function"===typeof o?o(r):null)}))},n}(t.Component);function Y(t){return"/"===t.charAt(0)?t:"/"+t}function K(t,e){if(!t)return e;var n=Y(t);return 0!==e.pathname.indexOf(n)?e:s({},e,{pathname:e.pathname.substr(n.length)})}function J(t){return"string"===typeof t?t:g(t)}function Q(t){return function(){p(!1)}}function tt(){}t.Component;var et=function(e){function n(){return e.apply(this,arguments)||this}return r(n,e),n.prototype.render=function(){var e=this;return t.createElement(H.Consumer,null,(function(n){n||p(!1);var i,r,a=e.props.location||n.location;return t.Children.forEach(e.props.children,(function(e){if(null==r&&t.isValidElement(e)){i=e;var o=e.props.path||e.props.from;r=o?Z(a.pathname,s({},e.props,{path:o})):n.match}})),r?t.cloneElement(i,{location:a,computedMatch:r}):null}))},n}(t.Component);t.useContext;function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function it(t,e){if(t){if("string"===typeof t)return nt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nt(t,e):void 0}}function rt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(t);!(o=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);o=!0);}catch(Tx){s=!0,r=Tx}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(t,e)||it(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var at=n(184);function ot(t){return(0,at.jsxs)("p",{children:["Error: ",t.children]})}function st(t,e,n,i,r,a,o){try{var s=t[a](o),u=s.value}catch(l){return void n(l)}s.done?e(u):Promise.resolve(u).then(i,r)}function ut(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){st(a,i,r,o,s,"next",t)}function s(t){st(a,i,r,o,s,"throw",t)}o(void 0)}))}}var lt,ct=n(757),ht=n.n(ct);function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function ft(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dt(t,e){if(e&&("object"===pt(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ft(t)}function vt(t){return function(t){if(Array.isArray(t))return nt(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||it(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t){return mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},mt(t)}function gt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function yt(t,e,n){return yt=gt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&i(a,n.prototype),a},yt.apply(null,arguments)}function _t(t){var e="function"===typeof Map?new Map:void 0;return _t=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return yt(t,arguments,mt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),i(r,t)},_t(t)}function bt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mt(t)););return t}function xt(){return xt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=bt(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}},xt.apply(this,arguments)}function wt(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=it(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function St(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kt(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&i(t,e)}function Mt(t){var e=gt();return function(){var n,i=mt(t);if(e){var r=mt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return dt(this,n)}}function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ct(t,e,n){return e&&Et(t.prototype,e),n&&Et(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var It=function(t,e){return It=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},It(t,e)};function Pt(t,e){function n(){this.constructor=t}It(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function At(t){return"function"===typeof t}var Lt=!1,Rt={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;Lt=t},get useDeprecatedSynchronousErrorHandling(){return Lt}};function Dt(t){setTimeout((function(){throw t}),0)}var zt={closed:!0,next:function(t){},error:function(t){if(Rt.useDeprecatedSynchronousErrorHandling)throw t;Dt(t)},complete:function(){}},Ot=function(){return Array.isArray||function(t){return t&&"number"===typeof t.length}}();function Ft(t){return null!==t&&"object"===typeof t}var Nt=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),Bt=Nt,jt=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,i=n._parentOrParents,r=n._ctorUnsubscribe,a=n._unsubscribe,o=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof t)i.remove(this);else if(null!==i)for(var s=0;s<i.length;++s){i[s].remove(this)}if(At(a)){r&&(this._unsubscribe=void 0);try{a.call(this)}catch(c){e=c instanceof Bt?Vt(c.errors):[c]}}if(Ot(o)){s=-1;for(var u=o.length;++s<u;){var l=o[s];if(Ft(l))try{l.unsubscribe()}catch(c){e=e||[],c instanceof Bt?e=e.concat(Vt(c.errors)):e.push(c)}}}if(e)throw new Bt(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!==typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var i=n;(n=new t)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof t){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function Vt(t){return t.reduce((function(t,e){return t.concat(e instanceof Bt?e.errors:e)}),[])}var Ut=function(){return"function"===typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),$t=function(t){function e(n,i,r){var a=t.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=zt;break;case 1:if(!n){a.destination=zt;break}if("object"===typeof n){n instanceof e?(a.syncErrorThrowable=n.syncErrorThrowable,a.destination=n,n.add(a)):(a.syncErrorThrowable=!0,a.destination=new Ht(a,n));break}default:a.syncErrorThrowable=!0,a.destination=new Ht(a,n,i,r)}return a}return Pt(e,t),e.prototype[Ut]=function(){return this},e.create=function(t,n,i){var r=new e(t,n,i);return r.syncErrorThrowable=!1,r},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(jt),Ht=function(t){function e(e,n,i,r){var a,o=t.call(this)||this;o._parentSubscriber=e;var s=o;return At(n)?a=n:n&&(a=n.next,i=n.error,r=n.complete,n!==zt&&(At((s=Object.create(n)).unsubscribe)&&o.add(s.unsubscribe.bind(s)),s.unsubscribe=o.unsubscribe.bind(o))),o._context=s,o._next=a,o._error=i,o._complete=r,o}return Pt(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;Rt.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=Rt.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Dt(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Dt(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};Rt.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(Tx){if(this.unsubscribe(),Rt.useDeprecatedSynchronousErrorHandling)throw Tx;Dt(Tx)}},e.prototype.__tryOrSetError=function(t,e,n){if(!Rt.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(Tx){return Rt.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=Tx,t.syncErrorThrown=!0,!0):(Dt(Tx),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}($t);var qt=function(){return"function"===typeof Symbol&&Symbol.observable||"@@observable"}();function Wt(t){return t}function Gt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Zt(t)}function Zt(t){return 0===t.length?Wt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var Xt=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i=this.operator,r=function(t,e,n){if(t){if(t instanceof $t)return t;if(t[Ut])return t[Ut]()}return t||e||n?new $t(t,e,n):new $t(zt)}(t,e,n);if(i?r.add(i.call(r,this.source)):r.add(this.source||Rt.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),Rt.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(Tx){Rt.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=Tx),!function(t){for(;t;){var e=t,n=e.closed,i=e.destination,r=e.isStopped;if(n||r)return!1;t=i&&i instanceof $t?i:null}return!0}(t)?console.warn(Tx):t.error(Tx)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Yt(e))((function(e,i){var r;r=n.subscribe((function(e){try{t(e)}catch(Tx){i(Tx),r&&r.unsubscribe()}}),i,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[qt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:Zt(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Yt(t))((function(t,n){var i;e.subscribe((function(t){return i=t}),(function(t){return n(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}();function Yt(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var Kt=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),Jt=function(t){function e(e,n){var i=t.call(this)||this;return i.subject=e,i.subscriber=n,i.closed=!1,i}return Pt(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(jt),Qt=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return Pt(e,t),e}($t),te=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return Pt(e,t),e.prototype[Ut]=function(){return new Qt(this)},e.prototype.lift=function(t){var e=new ee(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new Kt;if(!this.isStopped)for(var e=this.observers,n=e.length,i=e.slice(),r=0;r<n;r++)i[r].next(t)},e.prototype.error=function(t){if(this.closed)throw new Kt;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,i=e.slice(),r=0;r<n;r++)i[r].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new Kt;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),i=0;i<e;i++)n[i].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new Kt;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new Kt;return this.hasError?(t.error(this.thrownError),jt.EMPTY):this.isStopped?(t.complete(),jt.EMPTY):(this.observers.push(t),new Jt(this,t))},e.prototype.asObservable=function(){var t=new Xt;return t.source=this,t},e.create=function(t,e){return new ee(t,e)},e}(Xt),ee=function(t){function e(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return Pt(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):jt.EMPTY},e}(te);function ne(){return function(t){return t.lift(new ie(t))}}var ie=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var i=new re(t,n),r=e.subscribe(i);return i.closed||(i.connection=n.connect()),r},t}(),re=function(t){function e(e,n){var i=t.call(this,e)||this;return i.connectable=n,i}return Pt(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,i=t._connection;this.connection=null,!i||n&&i!==n||i.unsubscribe()}}else this.connection=null},e}($t),ae=function(t){function e(e,n){var i=t.call(this)||this;return i.source=e,i.subjectFactory=n,i._refCount=0,i._isComplete=!1,i}return Pt(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new jt).add(this.source.subscribe(new se(this.getSubject(),this))),t.closed&&(this._connection=null,t=jt.EMPTY)),t},e.prototype.refCount=function(){return ne()(this)},e}(Xt),oe=function(){var t=ae.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),se=function(t){function e(e,n){var i=t.call(this,e)||this;return i.connectable=n,i}return Pt(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(Qt),ue=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return Pt(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Kt;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(te),le=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return Pt(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,i=void 0;try{this.work(t)}catch(r){n=!0,i=!!r&&r||new Error(r)}if(n)return this.unsubscribe(),i},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return Pt(e,t),e.prototype.schedule=function(t,e){return this},e}(jt)),ce=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return Pt(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,i):e.flush(this)},e}(le),he=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),pe=function(t){function e(n,i){void 0===i&&(i=he.now);var r=t.call(this,n,(function(){return e.delegate&&e.delegate!==r?e.delegate.now():i()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return Pt(e,t),e.prototype.schedule=function(n,i,r){return void 0===i&&(i=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,i,r):t.prototype.schedule.call(this,n,i,r)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(he),fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pt(e,t),e}(pe),de=new fe(ce),ve=new Xt((function(t){return t.complete()}));function me(t){return t?function(t){return new Xt((function(e){return t.schedule((function(){return e.complete()}))}))}(t):ve}function ge(t){return t&&"function"===typeof t.schedule}var ye=function(t){return function(e){for(var n=0,i=t.length;n<i&&!e.closed;n++)e.next(t[n]);e.complete()}};function _e(t,e){return new Xt((function(n){var i=new jt,r=0;return i.add(e.schedule((function(){r!==t.length?(n.next(t[r++]),n.closed||i.add(this.schedule())):n.complete()}))),i}))}function be(t,e){return e?_e(t,e):new Xt(ye(t))}function xe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return ge(n)?(t.pop(),_e(t,n)):be(t)}function we(t,e){return new Xt(e?function(n){return e.schedule(Se,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function Se(t){var e=t.error;t.subscriber.error(e)}var ke=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"===typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return xe(this.value);case"E":return we(this.error);case"C":return me()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return"undefined"!==typeof e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}(),Me=function(t){function e(e,n,i){void 0===i&&(i=0);var r=t.call(this,e)||this;return r.scheduler=n,r.delay=i,r}return Pt(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new Te(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(ke.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(ke.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(ke.createComplete()),this.unsubscribe()},e}($t),Te=function(){return function(t,e){this.notification=t,this.destination=e}}(),Ee=function(t){function e(e,n,i){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this)||this;return r.scheduler=i,r._events=[],r._infiniteTimeWindow=!1,r._bufferSize=e<1?1:e,r._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(r._infiniteTimeWindow=!0,r.next=r.nextInfiniteTimeWindow):r.next=r.nextTimeWindow,r}return Pt(e,t),e.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new Ce(this._getNow(),e)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,i=n?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,a=i.length;if(this.closed)throw new Kt;if(this.isStopped||this.hasError?e=jt.EMPTY:(this.observers.push(t),e=new Jt(this,t)),r&&t.add(t=new Me(t,r)),n)for(var o=0;o<a&&!t.closed;o++)t.next(i[o]);else for(o=0;o<a&&!t.closed;o++)t.next(i[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||de).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,i=this._events,r=i.length,a=0;a<r&&!(t-i[a].time<n);)a++;return r>e&&(a=Math.max(a,r-e)),a>0&&i.splice(0,a),i},e}(te),Ce=function(){return function(t,e){this.time=t,this.value=e}}(),Ie=new pe(le);function Pe(){}var Ae=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),Le=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}(),Re=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}();function De(t,e){return function(n){if("function"!==typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new ze(t,e))}}var ze=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Oe(t,this.project,this.thisArg))},t}(),Oe=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.project=n,r.count=0,r.thisArg=i||r,r}return Pt(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(Tx){return void this.destination.error(Tx)}this.destination.next(e)},e}($t),Fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pt(e,t),e.prototype.notifyNext=function(t,e,n,i,r){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}($t),Ne=function(t){function e(e,n,i){var r=t.call(this)||this;return r.parent=e,r.outerValue=n,r.outerIndex=i,r.index=0,r}return Pt(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}($t);function Be(){return"function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var je=Be(),Ve=function(t){return t&&"number"===typeof t.length&&"function"!==typeof t};function Ue(t){return!!t&&"function"!==typeof t.subscribe&&"function"===typeof t.then}var $e=function(t){if(t&&"function"===typeof t[qt])return i=t,function(t){var e=i[qt]();if("function"!==typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(Ve(t))return ye(t);if(Ue(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Dt),t};if(t&&"function"===typeof t[je])return e=t,function(t){for(var n=e[je]();;){var i=void 0;try{i=n.next()}catch(Tx){return t.error(Tx),t}if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"===typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,i,r=Ft(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function He(t,e,n,i,r){if(void 0===r&&(r=new Ne(t,n,i)),!r.closed)return e instanceof Xt?e.subscribe(r):$e(e)(r)}var qe={};function We(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,i=void 0;return ge(t[t.length-1])&&(i=t.pop()),"function"===typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Ot(t[0])&&(t=t[0]),be(t,i).lift(new Ge(n))}var Ge=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Ze(t,this.resultSelector))},t}(),Ze=function(t){function e(e,n){var i=t.call(this,e)||this;return i.resultSelector=n,i.active=0,i.values=[],i.observables=[],i}return Pt(e,t),e.prototype._next=function(t){this.values.push(qe),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var i=t[n];this.add(He(this,i,void 0,n))}}},e.prototype.notifyComplete=function(t){0===(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var i=this.values,r=i[n],a=this.toRespond?r===qe?--this.toRespond:this.toRespond:0;i[n]=e,0===a&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(Tx){return void this.destination.error(Tx)}this.destination.next(e)},e}(Fe);function Xe(t,e){if(null!=t){if(function(t){return t&&"function"===typeof t[qt]}(t))return function(t,e){return new Xt((function(n){var i=new jt;return i.add(e.schedule((function(){var r=t[qt]();i.add(r.subscribe({next:function(t){i.add(e.schedule((function(){return n.next(t)})))},error:function(t){i.add(e.schedule((function(){return n.error(t)})))},complete:function(){i.add(e.schedule((function(){return n.complete()})))}}))}))),i}))}(t,e);if(Ue(t))return function(t,e){return new Xt((function(n){var i=new jt;return i.add(e.schedule((function(){return t.then((function(t){i.add(e.schedule((function(){n.next(t),i.add(e.schedule((function(){return n.complete()})))})))}),(function(t){i.add(e.schedule((function(){return n.error(t)})))}))}))),i}))}(t,e);if(Ve(t))return _e(t,e);if(function(t){return t&&"function"===typeof t[je]}(t)||"string"===typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new Xt((function(n){var i,r=new jt;return r.add((function(){i&&"function"===typeof i.return&&i.return()})),r.add(e.schedule((function(){i=t[je](),r.add(e.schedule((function(){if(!n.closed){var t,e;try{var r=i.next();t=r.value,e=r.done}catch(Tx){return void n.error(Tx)}e?n.complete():(n.next(t),this.schedule())}})))}))),r}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function Ye(t,e){return e?Xe(t,e):t instanceof Xt?t:new Xt($e(t))}var Ke=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return Pt(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}($t),Je=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Pt(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}($t);function Qe(t,e){if(!e.closed)return t instanceof Xt?t.subscribe(e):$e(t)(e)}function tn(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"===typeof e?function(i){return i.pipe(tn((function(n,i){return Ye(t(n,i)).pipe(De((function(t,r){return e(n,t,i,r)})))}),n))}:("number"===typeof e&&(n=e),function(e){return e.lift(new en(t,n))})}var en=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new nn(t,this.project,this.concurrent))},t}(),nn=function(t){function e(e,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var r=t.call(this,e)||this;return r.project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return Pt(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(Tx){return void this.destination.error(Tx)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new Ke(this),n=this.destination;n.add(e);var i=Qe(t,e);i!==e&&n.add(i)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(Je);function rn(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),tn(Wt,t)}function an(){return rn(1)}function on(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return an()(xe.apply(void 0,t))}function sn(t,e,n,i){return At(n)&&(i=n,n=void 0),i?sn(t,e,n).pipe(De((function(t){return Ot(t)?i.apply(void 0,t):i(t)}))):new Xt((function(i){un(t,e,(function(t){arguments.length>1?i.next(Array.prototype.slice.call(arguments)):i.next(t)}),i,n)}))}function un(t,e,n,i,r){var a;if(function(t){return t&&"function"===typeof t.addEventListener&&"function"===typeof t.removeEventListener}(t)){var o=t;t.addEventListener(e,n,r),a=function(){return o.removeEventListener(e,n,r)}}else if(function(t){return t&&"function"===typeof t.on&&"function"===typeof t.off}(t)){var s=t;t.on(e,n),a=function(){return s.off(e,n)}}else if(function(t){return t&&"function"===typeof t.addListener&&"function"===typeof t.removeListener}(t)){var u=t;t.addListener(e,n),a=function(){return u.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var l=0,c=t.length;l<c;l++)un(t[l],e,n,i,r)}i.add(a)}function ln(t){return!Ot(t)&&t-parseFloat(t)+1>=0}function cn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,i=null,r=t[t.length-1];return ge(r)?(i=t.pop(),t.length>1&&"number"===typeof t[t.length-1]&&(n=t.pop())):"number"===typeof r&&(n=t.pop()),null===i&&1===t.length&&t[0]instanceof Xt?t[0]:rn(n)(be(t,i))}function hn(t,e){return function(n){return n.lift(new pn(t,e))}}var pn=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new fn(t,this.predicate,this.thisArg))},t}(),fn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.predicate=n,r.thisArg=i,r.count=0,r}return Pt(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(Tx){return void this.destination.error(Tx)}e&&this.destination.next(t)},e}($t);function dn(t,e,n){void 0===t&&(t=0);var i=-1;return ln(e)?i=Number(e)<1?1:Number(e):ge(e)&&(n=e),ge(n)||(n=Ie),new Xt((function(e){var r=ln(t)?t:+t-n.now();return n.schedule(vn,r,{index:0,period:i,subscriber:e})}))}function vn(t){var e=t.index,n=t.period,i=t.subscriber;if(i.next(e),!i.closed){if(-1===n)return i.complete();t.index=e+1,this.schedule(t,n)}}function mn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return"function"===typeof n&&t.pop(),be(t,void 0).lift(new gn(n))}var gn=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new yn(t,this.resultSelector))},t}(),yn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.resultSelector=n,r.iterators=[],r.active=0,r.resultSelector="function"===typeof n?n:void 0,r}return Pt(e,t),e.prototype._next=function(t){var e=this.iterators;Ot(t)?e.push(new bn(t)):"function"===typeof t[je]?e.push(new _n(t[je]())):e.push(new xn(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var n=0;n<e;n++){var i=t[n];if(i.stillUnsubscribed)this.destination.add(i.subscribe());else this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,i=0;i<e;i++){if("function"===typeof(o=t[i]).hasValue&&!o.hasValue())return}var r=!1,a=[];for(i=0;i<e;i++){var o,s=(o=t[i]).next();if(o.hasCompleted()&&(r=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),r&&n.complete()},e.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(Tx){return void this.destination.error(Tx)}this.destination.next(e)},e}($t),_n=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return Boolean(t&&t.done)},t}(),bn=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[je]=function(){return this},t.prototype.next=function(t){var e=this.index++,n=this.array;return e<this.length?{value:n[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),xn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.parent=n,r.observable=i,r.stillUnsubscribed=!0,r.buffer=[],r.isComplete=!1,r}return Pt(e,t),e.prototype[je]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return Qe(this.observable,new Ke(this))},e}(Je);var wn=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Sn(t,this.durationSelector))},t}(),Sn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.durationSelector=n,i.hasValue=!1,i}return Pt(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(Tx){return this.destination.error(Tx)}var n=Qe(e,new Ke(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},e.prototype.clearThrottle=function(){var t=this,e=t.value,n=t.hasValue,i=t.throttled;i&&(this.remove(i),this.throttled=void 0,i.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))},e.prototype.notifyNext=function(){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}(Je);function kn(t,e){return void 0===e&&(e=Ie),n=function(){return dn(t,e)},function(t){return t.lift(new wn(n))};var n}function Mn(t,e){return void 0===e&&(e=null),function(n){return n.lift(new Tn(t,e))}}var Tn=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?Cn:En}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),En=function(t){function e(e,n){var i=t.call(this,e)||this;return i.bufferSize=n,i.buffer=[],i}return Pt(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)},e}($t),Cn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.bufferSize=n,r.startBufferEvery=i,r.buffers=[],r.count=0,r}return Pt(e,t),e.prototype._next=function(t){var e=this,n=e.bufferSize,i=e.startBufferEvery,r=e.buffers,a=e.count;this.count++,a%i===0&&r.push([]);for(var o=r.length;o--;){var s=r[o];s.push(t),s.length===n&&(r.splice(o,1),this.destination.next(s))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var i=e.shift();i.length>0&&n.next(i)}t.prototype._complete.call(this)},e}($t);var In=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Pn(t,this.closingSelector))},t}(),Pn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.closingSelector=n,i.subscribing=!1,i.openBuffer(),i}return Pt(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},e.prototype.notifyNext=function(){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{e=(0,this.closingSelector)()}catch(Tx){return this.error(Tx)}t=new jt,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(Qe(e,new Ke(this))),this.subscribing=!1},e}(Je);function An(t){return function(e){var n=new Ln(t),i=e.lift(n);return n.caught=i}}var Ln=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new Rn(t,this.selector,this.caught))},t}(),Rn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.selector=n,r.caught=i,r}return Pt(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(a){return void t.prototype.error.call(this,a)}this._unsubscribeAndRecycle();var i=new Ke(this);this.add(i);var r=Qe(n,i);r!==i&&this.add(r)}},e}(Je);function Dn(t,e){return tn(t,e,1)}function zn(t,e){return void 0===e&&(e=Ie),function(n){return n.lift(new On(t,e))}}var On=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new Fn(t,this.dueTime,this.scheduler))},t}(),Fn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.dueTime=n,r.scheduler=i,r.debouncedSubscription=null,r.lastValue=null,r.hasValue=!1,r}return Pt(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Nn,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}($t);function Nn(t){t.debouncedNext()}function Bn(t){return void 0===t&&(t=null),function(e){return e.lift(new jn(t))}}var jn=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new Vn(t,this.defaultValue))},t}(),Vn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.defaultValue=n,i.isEmpty=!0,i}return Pt(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}($t);function Un(t,e){return function(n){return n.lift(new $n(t,e))}}var $n=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Hn(t,this.compare,this.keySelector))},t}(),Hn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.keySelector=i,r.hasKey=!1,"function"===typeof n&&(r.compare=n),r}return Pt(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(Tx){return this.destination.error(Tx)}var i=!1;if(this.hasKey)try{i=(0,this.compare)(this.key,e)}catch(Tx){return this.destination.error(Tx)}else this.hasKey=!0;i||(this.key=e,this.destination.next(t))},e}($t);function qn(t){return void 0===t&&(t=Zn),function(e){return e.lift(new Wn(t))}}var Wn=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new Gn(t,this.errorFactory))},t}(),Gn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.errorFactory=n,i.hasValue=!1,i}return Pt(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}($t);function Zn(){return new Le}function Xn(t){return function(e){return 0===t?me():e.lift(new Yn(t))}}var Yn=function(){function t(t){if(this.total=t,this.total<0)throw new Ae}return t.prototype.call=function(t,e){return e.subscribe(new Kn(t,this.total))},t}(),Kn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.count=0,i}return Pt(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}($t);function Jn(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),e=(e||0)<1?Number.POSITIVE_INFINITY:e,function(i){return i.lift(new Qn(t,e,n))}}var Qn=function(){function t(t,e,n){this.project=t,this.concurrent=e,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new ti(t,this.project,this.concurrent,this.scheduler))},t}(),ti=function(t){function e(e,n,i,r){var a=t.call(this,e)||this;return a.project=n,a.concurrent=i,a.scheduler=r,a.index=0,a.active=0,a.hasCompleted=!1,i<Number.POSITIVE_INFINITY&&(a.buffer=[]),a}return Pt(e,t),e.dispatch=function(t){var e=t.subscriber,n=t.result,i=t.value,r=t.index;e.subscribeToProjection(n,i,r)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var i=this.index++;if(this.active<this.concurrent){n.next(t);try{var r=(0,this.project)(t,i);if(this.scheduler){var a={subscriber:this,result:r,value:t,index:i};this.destination.add(this.scheduler.schedule(e.dispatch,0,a))}else this.subscribeToProjection(r,t,i)}catch(o){n.error(o)}}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.destination.add(Qe(t,new Ke(this)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this._next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}(Je);function ei(t){return function(e){return e.lift(new ni(t))}}var ni=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new ii(t,this.callback))},t}(),ii=function(t){function e(e,n){var i=t.call(this,e)||this;return i.add(new jt(n)),i}return Pt(e,t),e}($t);function ri(t,e){var n=arguments.length>=2;return function(i){return i.pipe(t?hn((function(e,n){return t(e,n,i)})):Wt,Xn(1),n?Bn(e):qn((function(){return new Le})))}}function ai(t){return function(e){return 0===t?me():e.lift(new oi(t))}}var oi=function(){function t(t){if(this.total=t,this.total<0)throw new Ae}return t.prototype.call=function(t,e){return e.subscribe(new si(t,this.total))},t}(),si=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.ring=new Array,i.count=0,i}return Pt(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,i=this.count++;e.length<n?e.push(t):e[i%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,i=this.ring,r=0;r<n;r++){var a=e++%n;t.next(i[a])}t.complete()},e}($t);function ui(t,e){var n=arguments.length>=2;return function(i){return i.pipe(t?hn((function(e,n){return t(e,n,i)})):Wt,ai(1),n?Bn(e):qn((function(){return new Le})))}}function li(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(i){return i.lift(new ci(t,e,n))}}var ci=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new hi(t,this.accumulator,this.seed,this.hasSeed))},t}(),hi=function(t){function e(e,n,i,r){var a=t.call(this,e)||this;return a.accumulator=n,a._seed=i,a.hasSeed=r,a.index=0,a}return Pt(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(Tx){this.destination.error(Tx)}this.seed=e,this.destination.next(e)},e}($t);function pi(t,e){return arguments.length>=2?function(n){return Gt(li(t,e),ai(1),Bn(e))(n)}:function(e){return Gt(li((function(e,n,i){return t(e,n,i+1)})),ai(1))(e)}}function fi(t,e){return function(n){var i;if(i="function"===typeof t?t:function(){return t},"function"===typeof e)return n.lift(new di(i,e));var r=Object.create(n,oe);return r.source=n,r.subjectFactory=i,r}}var di=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,i=this.subjectFactory(),r=n(i).subscribe(t);return r.add(e.subscribe(i)),r},t}();function vi(){return function(t){return t.lift(new mi)}}var mi=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new gi(t))},t}(),gi=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return Pt(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}($t);function yi(t,e){return function(n){for(var i=n,r=0;r<e;r++){var a=null!=i?i[t[r]]:void 0;if(void 0===a)return;i=a}return i}}function _i(t){return t?fi((function(){return new te}),t):fi(new te)}function bi(t,e,n,i){n&&"function"!==typeof n&&(i=n);var r="function"===typeof n?n:void 0,a=new Ee(t,e,i);return function(t){return fi((function(){return a}),r)(t)}}function xi(t){return void 0===t&&(t=-1),function(e){return e.lift(new wi(t,e))}}var wi=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new Si(t,this.count,this.source))},t}(),Si=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.count=n,r.source=i,r}return Pt(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,i=this.count;if(0===i)return t.prototype.error.call(this,e);i>-1&&(this.count=i-1),n.subscribe(this._unsubscribeAndRecycle())}},e}($t);var ki=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new Mi(t),i=e.subscribe(n);return i.add(Qe(this.notifier,new Ke(n))),i},t}(),Mi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasValue=!1,e}return Pt(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},e}(Je);function Ti(){return new te}function Ei(){return function(t){return ne()(fi(Ti)(t))}}function Ci(t){return function(e){return e.lift(new Ii(t))}}var Ii=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new Pi(t,this.total))},t}(),Pi=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.count=0,i}return Pt(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}($t);function Ai(t){return function(e){return e.lift(new Li(t))}}var Li=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new Ri(t,this.predicate))},t}(),Ri=function(t){function e(e,n){var i=t.call(this,e)||this;return i.predicate=n,i.skipping=!0,i.index=0,i}return Pt(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(Tx){this.destination.error(Tx)}},e}($t);function Di(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return ge(n)?(t.pop(),function(e){return on(t,e,n)}):function(e){return on(t,e)}}function zi(t,e){return"function"===typeof e?function(n){return n.pipe(zi((function(n,i){return Ye(t(n,i)).pipe(De((function(t,r){return e(n,t,i,r)})))})))}:function(e){return e.lift(new Oi(t))}}var Oi=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Fi(t,this.project))},t}(),Fi=function(t){function e(e,n){var i=t.call(this,e)||this;return i.project=n,i.index=0,i}return Pt(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(i){return void this.destination.error(i)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new Ke(this),i=this.destination;i.add(n),this.innerSubscription=Qe(t,n),this.innerSubscription!==n&&i.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(Je);function Ni(t){return function(e){return e.lift(new Bi(t))}}var Bi=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new ji(t),i=Qe(this.notifier,new Ke(n));return i&&!n.seenValue?(n.add(i),e.subscribe(n)):n},t}(),ji=function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}return Pt(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(Je);function Vi(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new Ui(t,e))}}var Ui=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new $i(t,this.predicate,this.inclusive))},t}(),$i=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.predicate=n,r.inclusive=i,r.index=0,r}return Pt(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(Tx){return void n.error(Tx)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}($t);function Hi(t,e,n){return function(i){return i.lift(new qi(t,e,n))}}var qi=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new Wi(t,this.nextOrObserver,this.error,this.complete))},t}(),Wi=function(t){function e(e,n,i,r){var a=t.call(this,e)||this;return a._tapNext=Pe,a._tapError=Pe,a._tapComplete=Pe,a._tapError=i||Pe,a._tapComplete=r||Pe,At(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||Pe,a._tapError=n.error||Pe,a._tapComplete=n.complete||Pe),a}return Pt(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(Tx){return void this.destination.error(Tx)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(Tx){return void this.destination.error(Tx)}return this.destination.complete()},e}($t);function Gi(t,e,n){return void 0===n&&(n=Ie),function(i){var r,a=(r=t)instanceof Date&&!isNaN(+r),o=a?+t-n.now():Math.abs(t);return i.lift(new Zi(o,a,e,n))}}var Zi=function(){function t(t,e,n,i){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=i}return t.prototype.call=function(t,e){return e.subscribe(new Xi(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),Xi=function(t){function e(e,n,i,r,a){var o=t.call(this,e)||this;return o.absoluteTimeout=n,o.waitFor=i,o.withObservable=r,o.scheduler=a,o.scheduleTimeout(),o}return Pt(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(Qe(e,new Ke(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},e}(Je);function Yi(t,e){return void 0===e&&(e=Ie),Gi(t,we(new Re),e)}function Ki(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;"function"===typeof t[t.length-1]&&(n=t.pop());var i=t;return e.lift(new Ji(i,n))}}var Ji=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new Qi(t,this.observables,this.project))},t}(),Qi=function(t){function e(e,n,i){var r=t.call(this,e)||this;r.observables=n,r.project=i,r.toRespond=[];var a=n.length;r.values=new Array(a);for(var o=0;o<a;o++)r.toRespond.push(o);for(o=0;o<a;o++){var s=n[o];r.add(He(r,s,void 0,o))}return r}return Pt(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e;var i=this.toRespond;if(i.length>0){var r=i.indexOf(n);-1!==r&&i.splice(r,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(Tx){return void this.destination.error(Tx)}this.destination.next(e)},e}(Fe),tr=function(){function t(){Tt(this,t)}return Ct(t,[{key:"createFilter",value:function(t){return new Function("node","return "+this._compile(t)+";")}},{key:"_compile",value:function(t){if(null==t||t.length<=1)return"true";var e=t[0];return"("+("=="===e?this._compileComparisonOp("===",t[1],t[2],!1):"!="===e?this._compileComparisonOp("!==",t[1],t[2],!1):">"===e||">="===e||"<"===e||"<="===e?this._compileComparisonOp(e,t[1],t[2],!0):"in"===e?this._compileInOp(t[1],t.slice(2)):"!in"===e?this._compileNegation(this._compileInOp(t[1],t.slice(2))):"all"===e?this._compileLogicalOp(t.slice(1),"&&"):"true")+")"}},{key:"_compare",value:function(t,e){return t<e?-1:t>e?1:0}},{key:"_compileComparisonOp",value:function(t,e,n,i){var r=this._compilePropertyReference(e),a=JSON.stringify(n);return(i?"typeof "+r+"===typeof "+a+"&&":"")+r+t+a}},{key:"_compileInOp",value:function(t,e){var n=this._compare;return JSON.stringify(e.sort(n))+".indexOf("+this._compilePropertyReference(t)+")!==-1"}},{key:"_compileLogicalOp",value:function(t,e){var n=this._compile.bind(this);return t.map(n).join(e)}},{key:"_compileNegation",value:function(t){return"!("+t+")"}},{key:"_compilePropertyReference",value:function(t){return"node["+JSON.stringify(t)+"]"}}]),t}(),er=100,nr=1e3,ir=1001,rr=1002,ar=1003,or=1006,sr=1008,ur=1009,lr=1012,cr=1014,hr=1015,pr=1016,fr=1020,dr=1022,vr=1023,mr=1026,gr=1027,yr=2300,_r=2301,br=2302,xr=2400,wr=2401,Sr=2402,kr=2500,Mr=2501,Tr=3e3,Er=7680,Cr=35044,Ir=35048,Pr="300 es";function Ar(){}Object.assign(Ar.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,t)}}}});for(var Lr=[],Rr=0;Rr<256;Rr++)Lr[Rr]=(Rr<16?"0":"")+Rr.toString(16);var Dr,zr=1234567,Or={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Lr[255&t]+Lr[t>>8&255]+Lr[t>>16&255]+Lr[t>>24&255]+"-"+Lr[255&e]+Lr[e>>8&255]+"-"+Lr[e>>16&15|64]+Lr[e>>24&255]+"-"+Lr[63&n|128]+Lr[n>>8&255]+"-"+Lr[n>>16&255]+Lr[n>>24&255]+Lr[255&i]+Lr[i>>8&255]+Lr[i>>16&255]+Lr[i>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},damp:function(t,e,n,i){return Or.lerp(t,e,1-Math.exp(-n*i))},pingpong:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(Or.euclideanModulo(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(zr=t%2147483647),((zr=16807*zr%2147483647)-1)/2147483646},degToRad:function(t){return t*Or.DEG2RAD},radToDeg:function(t){return t*Or.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),l=a((e+i)/2),c=o((e+i)/2),h=a((e-i)/2),p=o((e-i)/2),f=a((i-e)/2),d=o((i-e)/2);switch(r){case"XYX":t.set(s*c,u*h,u*p,s*l);break;case"YZY":t.set(u*p,s*c,u*h,s*l);break;case"ZXZ":t.set(u*h,u*p,s*c,s*l);break;case"XZX":t.set(s*c,u*d,u*f,s*l);break;case"YXY":t.set(u*f,s*c,u*d,s*l);break;case"ZYZ":t.set(u*d,u*f,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}},Fr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Tt(this,t),Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=n}return Ct(t,[{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"add",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"fromBufferAttribute",value:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}},{key:"rotateAround",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*n-a*i+t.x,this.y=r*i+a*n+t.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}}]),t}(),Nr=function(){function t(){Tt(this,t),Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Ct(t,[{key:"set",value:function(t,e,n,i,r,a,o,s,u){var l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=r,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],p=n[5],f=n[8],d=i[0],v=i[3],m=i[6],g=i[1],y=i[4],_=i[7],b=i[2],x=i[5],w=i[8];return r[0]=a*d+o*g+s*b,r[3]=a*v+o*y+s*x,r[6]=a*m+o*_+s*w,r[1]=u*d+l*g+c*b,r[4]=u*v+l*y+c*x,r[7]=u*m+l*_+c*w,r[2]=h*d+p*g+f*b,r[5]=h*v+p*y+f*x,r[8]=h*m+p*_+f*w,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*a*l-e*o*u-n*r*l+n*o*s+i*r*u-i*a*s}},{key:"invert",value:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=l*a-o*u,h=o*s-l*r,p=u*r-a*s,f=e*c+n*h+i*p;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var d=1/f;return t[0]=c*d,t[1]=(i*u-l*n)*d,t[2]=(o*n-i*a)*d,t[3]=h*d,t[4]=(l*e-i*s)*d,t[5]=(i*r-o*e)*d,t[6]=p*d,t[7]=(n*s-u*e)*d,t[8]=(a*e-n*r)*d,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}},{key:"transposeIntoArray",value:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}},{key:"setUvTransform",value:function(t,e,n,i,r,a,o){var s=Math.cos(r),u=Math.sin(r);return this.set(n*s,n*u,-n*(s*a+u*o)+a+t,-i*u,i*s,-i*(-u*a+s*o)+o+e,0,0,1),this}},{key:"scale",value:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}},{key:"rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],u=i[4],l=i[7];return i[0]=e*r+n*s,i[3]=e*a+n*u,i[6]=e*o+n*l,i[1]=-n*r+e*s,i[4]=-n*a+e*u,i[7]=-n*o+e*l,this}},{key:"translate",value:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}},{key:"equals",value:function(t){for(var e=this.elements,n=t.elements,i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}]),t}(),Br={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;var e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Dr&&(Dr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Dr.width=t.width,Dr.height=t.height;var n=Dr.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Dr}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},jr=0;function Vr(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vr.DEFAULT_IMAGE,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vr.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ir,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ir,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:or,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:sr,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:vr,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:ur,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Tr;Object.defineProperty(this,"id",{value:jr++}),this.uuid=Or.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Fr(0,0),this.repeat=new Fr(1,1),this.center=new Fr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.version=0,this.onUpdate=null}function Ur(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?Br.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Vr.DEFAULT_IMAGE=void 0,Vr.DEFAULT_MAPPING=300,Vr.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Vr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=Or.generateUUID()),!e&&void 0===t.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(Ur(i[a].image)):r.push(Ur(i[a]))}else r=Ur(i);t.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case nr:t.x=t.x-Math.floor(t.x);break;case ir:t.x=t.x<0?0:1;break;case rr:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case nr:t.y=t.y-Math.floor(t.y);break;case ir:t.y=t.y<0?0:1;break;case rr:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Vr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});var $r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Tt(this,t),Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=n,this.z=i,this.w=r}return Ct(t,[{key:"width",get:function(){return this.z},set:function(t){this.z=t}},{key:"height",get:function(){return this.w},set:function(t){this.w=t}},{key:"set",value:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setW",value:function(t){return this.w=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}},{key:"add",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}},{key:"sub",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,i=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*e+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*e+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*e+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var e,n,i,r,a=.01,o=.1,s=t.elements,u=s[0],l=s[4],c=s[8],h=s[1],p=s[5],f=s[9],d=s[2],v=s[6],m=s[10];if(Math.abs(l-h)<a&&Math.abs(c-d)<a&&Math.abs(f-v)<a){if(Math.abs(l+h)<o&&Math.abs(c+d)<o&&Math.abs(f+v)<o&&Math.abs(u+p+m-3)<o)return this.set(1,0,0,0),this;e=Math.PI;var g=(u+1)/2,y=(p+1)/2,_=(m+1)/2,b=(l+h)/4,x=(c+d)/4,w=(f+v)/4;return g>y&&g>_?g<a?(n=0,i=.707106781,r=.707106781):(i=b/(n=Math.sqrt(g)),r=x/n):y>_?y<a?(n=.707106781,i=0,r=.707106781):(n=b/(i=Math.sqrt(y)),r=w/i):_<a?(n=.707106781,i=.707106781,r=0):(n=x/(r=Math.sqrt(_)),i=w/r),this.set(n,i,r,e),this}var S=Math.sqrt((v-f)*(v-f)+(c-d)*(c-d)+(h-l)*(h-l));return Math.abs(S)<.001&&(S=1),this.x=(v-f)/S,this.y=(c-d)/S,this.z=(h-l)/S,this.w=Math.acos((u+p+m-1)/2),this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"fromBufferAttribute",value:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}]),t}(),Hr=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),a=e.call(this),Object.defineProperty(ft(a),"isWebGLRenderTarget",{value:!0}),a.width=t,a.height=i,a.scissor=new $r(0,0,t,i),a.scissorTest=!1,a.viewport=new $r(0,0,t,i),r=r||{},a.texture=new Vr(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),a.texture.image={},a.texture.image.width=t,a.texture.image.height=i,a.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,a.texture.minFilter=void 0!==r.minFilter?r.minFilter:or,a.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,a.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,a.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,a}return Ct(n,[{key:"setSize",value:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Ar),qr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Tt(this,t),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=n,this._z=i,this._w=r}return Ct(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}},{key:"set",value:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,i=t._y,r=t._z,a=t._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(i/2),c=o(r/2),h=s(n/2),p=s(i/2),f=s(r/2);switch(a){case"XYZ":this._x=h*l*c+u*p*f,this._y=u*p*c-h*l*f,this._z=u*l*f+h*p*c,this._w=u*l*c-h*p*f;break;case"YXZ":this._x=h*l*c+u*p*f,this._y=u*p*c-h*l*f,this._z=u*l*f-h*p*c,this._w=u*l*c+h*p*f;break;case"ZXY":this._x=h*l*c-u*p*f,this._y=u*p*c+h*l*f,this._z=u*l*f+h*p*c,this._w=u*l*c-h*p*f;break;case"ZYX":this._x=h*l*c-u*p*f,this._y=u*p*c+h*l*f,this._z=u*l*f-h*p*c,this._w=u*l*c+h*p*f;break;case"YZX":this._x=h*l*c+u*p*f,this._y=u*p*c+h*l*f,this._z=u*l*f-h*p*c,this._w=u*l*c-h*p*f;break;case"XZY":this._x=h*l*c-u*p*f,this._y=u*p*c-h*l*f,this._z=u*l*f+h*p*c,this._w=u*l*c+h*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==e&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(t,e){var n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t){var e=t.elements,n=e[0],i=e[4],r=e[8],a=e[1],o=e[5],s=e[9],u=e[2],l=e[6],c=e[10],h=n+o+c;if(h>0){var p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(l-s)*p,this._y=(r-u)*p,this._z=(a-i)*p}else if(n>o&&n>c){var f=2*Math.sqrt(1+n-o-c);this._w=(l-s)/f,this._x=.25*f,this._y=(i+a)/f,this._z=(r+u)/f}else if(o>c){var d=2*Math.sqrt(1+o-n-c);this._w=(r-u)/d,this._x=(i+a)/d,this._y=.25*d,this._z=(s+l)/d}else{var v=2*Math.sqrt(1+c-n-o);this._w=(a-i)/v,this._x=(r+u)/v,this._y=(s+l)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(t){return 2*Math.acos(Math.abs(Or.clamp(this.dot(t),-1,1)))}},{key:"rotateTowards",value:function(t,e){var n=this.angleTo(t);if(0===n)return this;var i=Math.min(1,e/n);return this.slerp(t,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}},{key:"multiply",value:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,e){var n=t._x,i=t._y,r=t._z,a=t._w,o=e._x,s=e._y,u=e._z,l=e._w;return this._x=n*l+a*o+i*u-r*s,this._y=i*l+a*s+r*o-n*u,this._z=r*l+a*u+n*s-i*o,this._w=a*l-n*o-i*s-r*u,this._onChangeCallback(),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-e;return this._w=u*a+e*this._w,this._x=u*n+e*this._x,this._y=u*i+e*this._y,this._z=u*r+e*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,p=Math.sin(e*c)/l;return this._w=a*h+this._w*p,this._x=n*h+this._x*p,this._y=i*h+this._y*p,this._z=r*h+this._z*p,this._onChangeCallback(),this}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}},{key:"fromBufferAttribute",value:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}},{key:"_onChange",value:function(t){return this._onChangeCallback=t,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(t,e,n,i){return n.copy(t).slerp(e,i)}},{key:"slerpFlat",value:function(t,e,n,i,r,a,o){var s=n[i+0],u=n[i+1],l=n[i+2],c=n[i+3],h=r[a+0],p=r[a+1],f=r[a+2],d=r[a+3];if(c!==d||s!==h||u!==p||l!==f){var v=1-o,m=s*h+u*p+l*f+c*d,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,m*g);v=Math.sin(v*b)/_,o=Math.sin(o*b)/_}var x=o*g;if(s=s*v+h*x,u=u*v+p*x,l=l*v+f*x,c=c*v+d*x,v===1-o){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}t[e]=s,t[e+1]=u,t[e+2]=l,t[e+3]=c}},{key:"multiplyQuaternionsFlat",value:function(t,e,n,i,r,a){var o=n[i],s=n[i+1],u=n[i+2],l=n[i+3],c=r[a],h=r[a+1],p=r[a+2],f=r[a+3];return t[e]=o*f+l*c+s*p-u*h,t[e+1]=s*f+l*h+u*c-o*p,t[e+2]=u*f+l*p+o*h-s*c,t[e+3]=l*f-o*c-s*h-u*p,t}}]),t}(),Wr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Tt(this,t),Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=n,this.z=i}return Ct(t,[{key:"set",value:function(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"applyEuler",value:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Zr.setFromEuler(t))}},{key:"applyAxisAngle",value:function(t,e){return this.applyQuaternion(Zr.setFromAxisAngle(t,e))}},{key:"applyMatrix3",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(t){return this.applyMatrix3(t).normalize()}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements,a=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z,s=t.w,u=s*e+a*i-o*n,l=s*n+o*e-r*i,c=s*i+r*n-a*e,h=-r*e-a*n-o*i;return this.x=u*s+h*-r+l*-o-c*-a,this.y=l*s+h*-a+c*-r-u*-o,this.z=c*s+h*-o+u*-a-l*-r,this}},{key:"project",value:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}},{key:"transformDirection",value:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"clampScalar",value:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}},{key:"clampLength",value:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}},{key:"cross",value:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}},{key:"crossVectors",value:function(t,e){var n=t.x,i=t.y,r=t.z,a=e.x,o=e.y,s=e.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}},{key:"projectOnPlane",value:function(t){return Gr.copy(this).projectOnVector(t),this.sub(Gr)}},{key:"reflect",value:function(t){return this.sub(Gr.copy(t).multiplyScalar(2*this.dot(t)))}},{key:"angleTo",value:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(Or.clamp(n,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,e,n){var i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrix3Column",value:function(t,e){return this.fromArray(t.elements,3*e)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}]),t}(),Gr=new Wr,Zr=new qr,Xr=function(){function t(e,n){Tt(this,t),Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new Wr(1/0,1/0,1/0),this.max=void 0!==n?n:new Wr(-1/0,-1/0,-1/0)}return Ct(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"setFromArray",value:function(t){for(var e=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,u=t.length;s<u;s+=3){var l=t[s],c=t[s+1],h=t[s+2];l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,n,i),this.max.set(r,a,o),this}},{key:"setFromBufferAttribute",value:function(t){for(var e=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,u=t.count;s<u;s++){var l=t.getX(s),c=t.getY(s),h=t.getZ(s);l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,n,i),this.max.set(r,a,o),this}},{key:"setFromPoints",value:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var n=Jr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"setFromObject",value:function(t){return this.makeEmpty(),this.expandByObject(t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Wr),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Wr),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"expandByObject",value:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Qr.copy(e.boundingBox),Qr.applyMatrix4(t.matrixWorld),this.union(Qr));for(var n=t.children,i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}},{key:"getParameter",value:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Wr),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,Jr),Jr.distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}},{key:"intersectsTriangle",value:function(t){if(this.isEmpty())return!1;this.getCenter(oa),sa.subVectors(this.max,oa),ta.subVectors(t.a,oa),ea.subVectors(t.b,oa),na.subVectors(t.c,oa),ia.subVectors(ea,ta),ra.subVectors(na,ea),aa.subVectors(ta,na);var e=[0,-ia.z,ia.y,0,-ra.z,ra.y,0,-aa.z,aa.y,ia.z,0,-ia.x,ra.z,0,-ra.x,aa.z,0,-aa.x,-ia.y,ia.x,0,-ra.y,ra.x,0,-aa.y,aa.x,0];return!!Yr(e,ta,ea,na,sa)&&(!!Yr(e=[1,0,0,0,1,0,0,0,1],ta,ea,na,sa)&&(ua.crossVectors(ia,ra),Yr(e=[ua.x,ua.y,ua.z],ta,ea,na,sa)))}},{key:"clampPoint",value:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Wr),e.copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return Jr.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"getBoundingSphere",value:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Jr).length(),t}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(Kr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Kr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Kr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Kr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Kr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Kr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Kr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Kr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Kr)),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}();function Yr(t,e,n,i,r){for(var a=0,o=t.length-3;a<=o;a+=3){la.fromArray(t,a);var s=r.x*Math.abs(la.x)+r.y*Math.abs(la.y)+r.z*Math.abs(la.z),u=e.dot(la),l=n.dot(la),c=i.dot(la);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var Kr=[new Wr,new Wr,new Wr,new Wr,new Wr,new Wr,new Wr,new Wr],Jr=new Wr,Qr=new Xr,ta=new Wr,ea=new Wr,na=new Wr,ia=new Wr,ra=new Wr,aa=new Wr,oa=new Wr,sa=new Wr,ua=new Wr,la=new Wr,ca=new Xr,ha=function(){function t(e,n){Tt(this,t),this.center=void 0!==e?e:new Wr,this.radius=void 0!==n?n:-1}return Ct(t,[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"setFromPoints",value:function(t,e){var n=this.center;void 0!==e?n.copy(e):ca.setFromPoints(t).getCenter(n);for(var i=0,r=0,a=t.length;r<a;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Wr),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}},{key:"getBoundingBox",value:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Xr),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}},{key:"applyMatrix4",value:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),t}(),pa=new Wr,fa=new Wr,da=new Wr,va=new Wr,ma=new Wr,ga=new Wr,ya=new Wr,_a=function(){function t(e,n){Tt(this,t),this.origin=void 0!==e?e:new Wr,this.direction=void 0!==n?n:new Wr(0,0,-1)}return Ct(t,[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"at",value:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Wr),e.copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,pa)),this}},{key:"closestPointToPoint",value:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Wr),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSqToPoint(t))}},{key:"distanceSqToPoint",value:function(t){var e=pa.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pa.copy(this.direction).multiplyScalar(e).add(this.origin),pa.distanceToSquared(t))}},{key:"distanceSqToSegment",value:function(t,e,n,i){fa.copy(t).add(e).multiplyScalar(.5),da.copy(e).sub(t).normalize(),va.copy(this.origin).sub(fa);var r,a,o,s,u=.5*t.distanceTo(e),l=-this.direction.dot(da),c=va.dot(this.direction),h=-va.dot(da),p=va.lengthSq(),f=Math.abs(1-l*l);if(f>0)if(a=l*c-h,s=u*f,(r=l*h-c)>=0)if(a>=-s)if(a<=s){var d=1/f;o=(r*=d)*(r+l*(a*=d)+2*c)+a*(l*r+a+2*h)+p}else a=u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+p;else a=-u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+p;else a<=-s?o=-(r=Math.max(0,-(-l*u+c)))*r+(a=r>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+p:a<=s?(r=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+p):o=-(r=Math.max(0,-(l*u+c)))*r+(a=r>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+p;else a=l>0?-u:u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+p;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(da).multiplyScalar(a).add(fa),o}},{key:"intersectSphere",value:function(t,e){pa.subVectors(t.center,this.origin);var n=pa.dot(this.direction),i=pa.dot(pa)-n*n,r=t.radius*t.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,e):this.at(o,e)}},{key:"intersectsSphere",value:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}},{key:"intersectPlane",value:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t,e){var n,i,r,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(t.min.x-h.x)*u,i=(t.max.x-h.x)*u):(n=(t.max.x-h.x)*u,i=(t.min.x-h.x)*u),l>=0?(r=(t.min.y-h.y)*l,a=(t.max.y-h.y)*l):(r=(t.max.y-h.y)*l,a=(t.min.y-h.y)*l),n>a||r>i?null:((r>n||n!==n)&&(n=r),(a<i||i!==i)&&(i=a),c>=0?(o=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,e)))}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,pa)}},{key:"intersectTriangle",value:function(t,e,n,i,r){ma.subVectors(e,t),ga.subVectors(n,t),ya.crossVectors(ma,ga);var a,o=this.direction.dot(ya);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}va.subVectors(this.origin,t);var s=a*this.direction.dot(ga.crossVectors(va,ga));if(s<0)return null;var u=a*this.direction.dot(ma.cross(va));if(u<0)return null;if(s+u>o)return null;var l=-a*va.dot(ya);return l<0?null:this.at(l/o,r)}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),t}(),ba=function(){function t(){Tt(this,t),Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Ct(t,[{key:"set",value:function(t,e,n,i,r,a,o,s,u,l,c,h,p,f,d,v){var m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=p,m[7]=f,m[11]=d,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new t).fromArray(this.elements)}},{key:"copy",value:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}},{key:"copyPosition",value:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}},{key:"setFromMatrix3",value:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,n=t.elements,i=1/xa.setFromMatrixColumn(t,0).length(),r=1/xa.setFromMatrixColumn(t,1).length(),a=1/xa.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,i=t.y,r=t.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var h=a*l,p=a*c,f=o*l,d=o*c;e[0]=s*l,e[4]=-s*c,e[8]=u,e[1]=p+f*u,e[5]=h-d*u,e[9]=-o*s,e[2]=d-h*u,e[6]=f+p*u,e[10]=a*s}else if("YXZ"===t.order){var v=s*l,m=s*c,g=u*l,y=u*c;e[0]=v+y*o,e[4]=g*o-m,e[8]=a*u,e[1]=a*c,e[5]=a*l,e[9]=-o,e[2]=m*o-g,e[6]=y+v*o,e[10]=a*s}else if("ZXY"===t.order){var _=s*l,b=s*c,x=u*l,w=u*c;e[0]=_-w*o,e[4]=-a*c,e[8]=x+b*o,e[1]=b+x*o,e[5]=a*l,e[9]=w-_*o,e[2]=-a*u,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){var S=a*l,k=a*c,M=o*l,T=o*c;e[0]=s*l,e[4]=M*u-k,e[8]=S*u+T,e[1]=s*c,e[5]=T*u+S,e[9]=k*u-M,e[2]=-u,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){var E=a*s,C=a*u,I=o*s,P=o*u;e[0]=s*l,e[4]=P-E*c,e[8]=I*c+C,e[1]=c,e[5]=a*l,e[9]=-o*l,e[2]=-u*l,e[6]=C*c+I,e[10]=E-P*c}else if("XZY"===t.order){var A=a*s,L=a*u,R=o*s,D=o*u;e[0]=s*l,e[4]=-c,e[8]=u*l,e[1]=A*c+D,e[5]=a*l,e[9]=L*c-R,e[2]=R*c-L,e[6]=o*l,e[10]=D*c+A}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(Sa,t,ka)}},{key:"lookAt",value:function(t,e,n){var i=this.elements;return Ea.subVectors(t,e),0===Ea.lengthSq()&&(Ea.z=1),Ea.normalize(),Ma.crossVectors(n,Ea),0===Ma.lengthSq()&&(1===Math.abs(n.z)?Ea.x+=1e-4:Ea.z+=1e-4,Ea.normalize(),Ma.crossVectors(n,Ea)),Ma.normalize(),Ta.crossVectors(Ea,Ma),i[0]=Ma.x,i[4]=Ta.x,i[8]=Ea.x,i[1]=Ma.y,i[5]=Ta.y,i[9]=Ea.y,i[2]=Ma.z,i[6]=Ta.z,i[10]=Ea.z,this}},{key:"multiply",value:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],p=n[13],f=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],_=n[11],b=n[15],x=i[0],w=i[4],S=i[8],k=i[12],M=i[1],T=i[5],E=i[9],C=i[13],I=i[2],P=i[6],A=i[10],L=i[14],R=i[3],D=i[7],z=i[11],O=i[15];return r[0]=a*x+o*M+s*I+u*R,r[4]=a*w+o*T+s*P+u*D,r[8]=a*S+o*E+s*A+u*z,r[12]=a*k+o*C+s*L+u*O,r[1]=l*x+c*M+h*I+p*R,r[5]=l*w+c*T+h*P+p*D,r[9]=l*S+c*E+h*A+p*z,r[13]=l*k+c*C+h*L+p*O,r[2]=f*x+d*M+v*I+m*R,r[6]=f*w+d*T+v*P+m*D,r[10]=f*S+d*E+v*A+m*z,r[14]=f*k+d*C+v*L+m*O,r[3]=g*x+y*M+_*I+b*R,r[7]=g*w+y*T+_*P+b*D,r[11]=g*S+y*E+_*A+b*z,r[15]=g*k+y*C+_*L+b*O,this}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],a=t[1],o=t[5],s=t[9],u=t[13],l=t[2],c=t[6],h=t[10],p=t[14];return t[3]*(+r*s*c-i*u*c-r*o*h+n*u*h+i*o*p-n*s*p)+t[7]*(+e*s*p-e*u*h+r*a*h-i*a*p+i*u*l-r*s*l)+t[11]*(+e*u*c-e*o*p-r*a*c+n*a*p+r*o*l-n*u*l)+t[15]*(-i*o*l-e*s*c+e*o*h+i*a*c-n*a*h+n*s*l)}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setPosition",value:function(t,e,n){var i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}},{key:"invert",value:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],v=t[14],m=t[15],g=c*v*u-d*h*u+d*s*p-o*v*p-c*s*m+o*h*m,y=f*h*u-l*v*u-f*s*p+a*v*p+l*s*m-a*h*m,_=l*d*u-f*c*u+f*o*p-a*d*p-l*o*m+a*c*m,b=f*c*s-l*d*s-f*o*h+a*d*h+l*o*v-a*c*v,x=e*g+n*y+i*_+r*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/x;return t[0]=g*w,t[1]=(d*h*r-c*v*r-d*i*p+n*v*p+c*i*m-n*h*m)*w,t[2]=(o*v*r-d*s*r+d*i*u-n*v*u-o*i*m+n*s*m)*w,t[3]=(c*s*r-o*h*r-c*i*u+n*h*u+o*i*p-n*s*p)*w,t[4]=y*w,t[5]=(l*v*r-f*h*r+f*i*p-e*v*p-l*i*m+e*h*m)*w,t[6]=(f*s*r-a*v*r-f*i*u+e*v*u+a*i*m-e*s*m)*w,t[7]=(a*h*r-l*s*r+l*i*u-e*h*u-a*i*p+e*s*p)*w,t[8]=_*w,t[9]=(f*c*r-l*d*r-f*n*p+e*d*p+l*n*m-e*c*m)*w,t[10]=(a*d*r-f*o*r+f*n*u-e*d*u-a*n*m+e*o*m)*w,t[11]=(l*o*r-a*c*r-l*n*u+e*c*u+a*n*p-e*o*p)*w,t[12]=b*w,t[13]=(l*d*i-f*c*i+f*n*h-e*d*h-l*n*v+e*c*v)*w,t[14]=(f*o*i-a*d*i-f*n*s+e*d*s+a*n*v-e*o*v)*w,t[15]=(a*c*i-l*o*i+l*n*s-e*c*s-a*n*h+e*o*h)*w,this}},{key:"scale",value:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}},{key:"makeTranslation",value:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=1-n,a=t.x,o=t.y,s=t.z,u=r*a,l=r*o;return this.set(u*a+n,u*o-i*s,u*s+i*o,0,u*o+i*s,l*o+n,l*s-i*a,0,u*s-i*o,l*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,n){var i=this.elements,r=e._x,a=e._y,o=e._z,s=e._w,u=r+r,l=a+a,c=o+o,h=r*u,p=r*l,f=r*c,d=a*l,v=a*c,m=o*c,g=s*u,y=s*l,_=s*c,b=n.x,x=n.y,w=n.z;return i[0]=(1-(d+m))*b,i[1]=(p+_)*b,i[2]=(f-y)*b,i[3]=0,i[4]=(p-_)*x,i[5]=(1-(h+m))*x,i[6]=(v+g)*x,i[7]=0,i[8]=(f+y)*w,i[9]=(v-g)*w,i[10]=(1-(h+d))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}},{key:"decompose",value:function(t,e,n){var i=this.elements,r=xa.set(i[0],i[1],i[2]).length(),a=xa.set(i[4],i[5],i[6]).length(),o=xa.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],wa.copy(this);var s=1/r,u=1/a,l=1/o;return wa.elements[0]*=s,wa.elements[1]*=s,wa.elements[2]*=s,wa.elements[4]*=u,wa.elements[5]*=u,wa.elements[6]*=u,wa.elements[8]*=l,wa.elements[9]*=l,wa.elements[10]*=l,e.setFromRotationMatrix(wa),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(t,e,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(e-t),u=2*r/(n-i),l=(e+t)/(e-t),c=(n+i)/(n-i),h=-(a+r)/(a-r),p=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(t,e,n,i,r,a){var o=this.elements,s=1/(e-t),u=1/(n-i),l=1/(a-r),c=(e+t)*s,h=(n+i)*u,p=(a+r)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(t){for(var e=this.elements,n=t.elements,i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}]),t}(),xa=new Wr,wa=new ba,Sa=new Wr(0,0,0),ka=new Wr(1,1,1),Ma=new Wr,Ta=new Wr,Ea=new Wr,Ca=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;Tt(this,t),Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=n,this._z=i,this._order=r}return Ct(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}},{key:"set",value:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(t,e,n){var i=Or.clamp,r=t.elements,a=r[0],o=r[4],s=r[8],u=r[1],l=r[5],c=r[9],h=r[2],p=r[6],f=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,f),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,a),this._z=0);break;case"ZXY":this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(u,a));break;case"ZYX":this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,f),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(i(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,f));break;case"XZY":this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(t,e,n){return Ia.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ia,e,n)}},{key:"setFromVector3",value:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)}},{key:"reorder",value:function(t){return Pa.setFromEuler(this),this.setFromQuaternion(Pa,t)}},{key:"equals",value:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}},{key:"fromArray",value:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}},{key:"toVector3",value:function(t){return t?t.set(this._x,this._y,this._z):new Wr(this._x,this._y,this._z)}},{key:"_onChange",value:function(t){return this._onChangeCallback=t,this}},{key:"_onChangeCallback",value:function(){}}]),t}();Ca.DefaultOrder="XYZ",Ca.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Ia=new ba,Pa=new qr,Aa=function(){function t(){Tt(this,t),this.mask=1}return Ct(t,[{key:"set",value:function(t){this.mask=1<<t|0}},{key:"enable",value:function(t){this.mask|=1<<t|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(t){this.mask^=1<<t|0}},{key:"disable",value:function(t){this.mask&=~(1<<t|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(t){return 0!==(this.mask&t.mask)}}]),t}(),La=0,Ra=new Wr,Da=new qr,za=new ba,Oa=new Wr,Fa=new Wr,Na=new Wr,Ba=new qr,ja=new Wr(1,0,0),Va=new Wr(0,1,0),Ua=new Wr(0,0,1),$a={type:"added"},Ha={type:"removed"};function qa(){Object.defineProperty(this,"id",{value:La++}),this.uuid=Or.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qa.DefaultUp.clone();var t=new Wr,e=new Ca,n=new qr,i=new Wr(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ba},normalMatrix:{value:new Nr}}),this.matrix=new ba,this.matrixWorld=new ba,this.matrixAutoUpdate=qa.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Aa,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}qa.DefaultUp=new Wr(0,1,0),qa.DefaultMatrixAutoUpdate=!0,qa.prototype=Object.assign(Object.create(Ar.prototype),{constructor:qa,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Da.setFromAxisAngle(t,e),this.quaternion.multiply(Da),this},rotateOnWorldAxis:function(t,e){return Da.setFromAxisAngle(t,e),this.quaternion.premultiply(Da),this},rotateX:function(t){return this.rotateOnAxis(ja,t)},rotateY:function(t){return this.rotateOnAxis(Va,t)},rotateZ:function(t){return this.rotateOnAxis(Ua,t)},translateOnAxis:function(t,e){return Ra.copy(t).applyQuaternion(this.quaternion),this.position.add(Ra.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(ja,t)},translateY:function(t){return this.translateOnAxis(Va,t)},translateZ:function(t){return this.translateOnAxis(Ua,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(za.copy(this.matrixWorld).invert())},lookAt:function(t,e,n){t.isVector3?Oa.copy(t):Oa.set(t,e,n);var i=this.parent;this.updateWorldMatrix(!0,!1),Fa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?za.lookAt(Fa,Oa,this.up):za.lookAt(Oa,Fa,this.up),this.quaternion.setFromRotationMatrix(za),i&&(za.extractRotation(i.matrixWorld),Da.setFromRotationMatrix(za),this.quaternion.premultiply(Da.invert()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent($a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(Ha)),this},clear:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.parent=null,e.dispatchEvent(Ha)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),za.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),za.multiply(t.parent.matrixWorld)),t.applyMatrix4(za),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new qr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fa,t,Na),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fa,Ba,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"===typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var l=o[s];r(t.shapes,l)}else r(t.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,p=this.material.length;h<p;h++)c.push(r(t.materials,this.material[h]));i.material=c}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(var f=0;f<this.children.length;f++)i.children.push(this.children[f].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(var d=0;d<this.animations.length;d++){var v=this.animations[d];i.animations.push(r(t.animations,v))}}if(e){var m=S(t.geometries),g=S(t.materials),y=S(t.textures),_=S(t.images),b=S(t.shapes),x=S(t.skeletons),w=S(t.animations);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),_.length>0&&(n.images=_),b.length>0&&(n.shapes=b),x.length>0&&(n.skeletons=x),w.length>0&&(n.animations=w)}return n.object=i,n;function S(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var i=t.children[n];this.add(i.clone())}return this}});var Wa=new Wr,Ga=new Wr,Za=new Nr,Xa=function(){function t(e,n){Tt(this,t),Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new Wr(1,0,0),this.constant=void 0!==n?n:0}return Ct(t,[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,n){var i=Wa.subVectors(n,e).cross(Ga.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Wr),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"intersectLine",value:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Wr);var n=t.delta(Wa),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;var r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?void 0:e.copy(n).multiplyScalar(r).add(t.start)}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"coplanarPoint",value:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Wr),t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(t,e){var n=e||Za.getNormalMatrix(t),i=this.coplanarPoint(Wa).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),t}(),Ya=new Wr,Ka=new Wr,Ja=new Wr,Qa=new Wr,to=new Wr,eo=new Wr,no=new Wr,io=new Wr,ro=new Wr,ao=new Wr,oo=function(){function t(e,n,i){Tt(this,t),this.a=void 0!==e?e:new Wr,this.b=void 0!==n?n:new Wr,this.c=void 0!==i?i:new Wr}return Ct(t,[{key:"set",value:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}},{key:"getArea",value:function(){return Ya.subVectors(this.c,this.b),Ka.subVectors(this.a,this.b),.5*Ya.cross(Ka).length()}},{key:"getMidpoint",value:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Wr),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(e){return t.getNormal(this.a,this.b,this.c,e)}},{key:"getPlane",value:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Xa),t.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(e,n){return t.getBarycoord(e,this.a,this.b,this.c,n)}},{key:"getUV",value:function(e,n,i,r,a){return t.getUV(e,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(e){return t.containsPoint(e,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(e){return t.isFrontFacing(this.a,this.b,this.c,e)}},{key:"intersectsBox",value:function(t){return t.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Wr);var n,i,r=this.a,a=this.b,o=this.c;to.subVectors(a,r),eo.subVectors(o,r),io.subVectors(t,r);var s=to.dot(io),u=eo.dot(io);if(s<=0&&u<=0)return e.copy(r);ro.subVectors(t,a);var l=to.dot(ro),c=eo.dot(ro);if(l>=0&&c<=l)return e.copy(a);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),e.copy(r).addScaledVector(to,n);ao.subVectors(t,o);var p=to.dot(ao),f=eo.dot(ao);if(f>=0&&p<=f)return e.copy(o);var d=p*u-s*f;if(d<=0&&u>=0&&f<=0)return i=u/(u-f),e.copy(r).addScaledVector(eo,i);var v=l*f-p*c;if(v<=0&&c-l>=0&&p-f>=0)return no.subVectors(o,a),i=(c-l)/(c-l+(p-f)),e.copy(a).addScaledVector(no,i);var m=1/(v+d+h);return n=d*m,i=h*m,e.copy(r).addScaledVector(to,n).addScaledVector(eo,i)}},{key:"equals",value:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}],[{key:"getNormal",value:function(t,e,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Wr),i.subVectors(n,e),Ya.subVectors(t,e),i.cross(Ya);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(t,e,n,i,r){Ya.subVectors(i,e),Ka.subVectors(n,e),Ja.subVectors(t,e);var a=Ya.dot(Ya),o=Ya.dot(Ka),s=Ya.dot(Ja),u=Ka.dot(Ka),l=Ka.dot(Ja),c=a*u-o*o;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Wr),0===c)return r.set(-2,-1,-1);var h=1/c,p=(u*s-o*l)*h,f=(a*l-o*s)*h;return r.set(1-p-f,f,p)}},{key:"containsPoint",value:function(t,e,n,i){return this.getBarycoord(t,e,n,i,Qa),Qa.x>=0&&Qa.y>=0&&Qa.x+Qa.y<=1}},{key:"getUV",value:function(t,e,n,i,r,a,o,s){return this.getBarycoord(t,e,n,i,Qa),s.set(0,0),s.addScaledVector(r,Qa.x),s.addScaledVector(a,Qa.y),s.addScaledVector(o,Qa.z),s}},{key:"isFrontFacing",value:function(t,e,n,i){return Ya.subVectors(n,e),Ka.subVectors(t,e),Ya.cross(Ka).dot(i)<0}}]),t}(),so={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},uo={h:0,s:0,l:0},lo={h:0,s:0,l:0};function co(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function ho(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function po(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var fo=function(){function t(e,n,i){return Tt(this,t),Object.defineProperty(this,"isColor",{value:!0}),void 0===n&&void 0===i?this.set(e):this.setRGB(e,n,i)}return Ct(t,[{key:"set",value:function(t){return t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t),this}},{key:"setScalar",value:function(t){return this.r=t,this.g=t,this.b=t,this}},{key:"setHex",value:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}},{key:"setRGB",value:function(t,e,n){return this.r=t,this.g=e,this.b=n,this}},{key:"setHSL",value:function(t,e,n){if(t=Or.euclideanModulo(t,1),e=Or.clamp(e,0,1),n=Or.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=co(r,i,t+1/3),this.g=co(r,i,t),this.b=co(r,i,t-1/3)}return this}},{key:"setStyle",value:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return e(i[4]),this.setHSL(o,s,u)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}},{key:"setColorName",value:function(t){var e=so[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"copyGammaToLinear",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}},{key:"copyLinearToGamma",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this}},{key:"convertGammaToLinear",value:function(t){return this.copyGammaToLinear(this,t),this}},{key:"convertLinearToGamma",value:function(t){return this.copyLinearToGamma(this,t),this}},{key:"copySRGBToLinear",value:function(t){return this.r=ho(t.r),this.g=ho(t.g),this.b=ho(t.b),this}},{key:"copyLinearToSRGB",value:function(t){return this.r=po(t.r),this.g=po(t.g),this.b=po(t.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n,i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),s=Math.min(i,r,a),u=(s+o)/2;if(s===o)e=0,n=0;else{var l=o-s;switch(n=u<=.5?l/(o+s):l/(2-o-s),o){case i:e=(r-a)/l+(r<a?6:0);break;case r:e=(a-i)/l+2;break;case a:e=(i-r)/l+4}e/=6}return t.h=e,t.s=n,t.l=u,t}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(t,e,n){return this.getHSL(uo),uo.h+=t,uo.s+=e,uo.l+=n,this.setHSL(uo.h,uo.s,uo.l),this}},{key:"add",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}},{key:"addColors",value:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}},{key:"addScalar",value:function(t){return this.r+=t,this.g+=t,this.b+=t,this}},{key:"sub",value:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}},{key:"multiply",value:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}},{key:"multiplyScalar",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this}},{key:"lerp",value:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}},{key:"lerpColors",value:function(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}},{key:"lerpHSL",value:function(t,e){this.getHSL(uo),t.getHSL(lo);var n=Or.lerp(uo.h,lo.h,e),i=Or.lerp(uo.s,lo.s,e),r=Or.lerp(uo.l,lo.l,e);return this.setHSL(n,i,r),this}},{key:"equals",value:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}},{key:"fromBufferAttribute",value:function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),t}();fo.NAMES=so,fo.prototype.r=1,fo.prototype.g=1,fo.prototype.b=1;var vo=function(){function t(e,n,i,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Tt(this,t),this.a=e,this.b=n,this.c=i,this.normal=r&&r.isVector3?r:new Wr,this.vertexNormals=Array.isArray(r)?r:[],this.color=a&&a.isColor?a:new fo,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=o}return Ct(t,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var i=0,r=t.vertexColors.length;i<r;i++)this.vertexColors[i]=t.vertexColors[i].clone();return this}}]),t}(),mo=0;function go(){Object.defineProperty(this,"id",{value:mo++}),this.uuid=Or.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=er,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Er,this.stencilZFail=Er,this.stencilZPass=Er,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function yo(t){go.call(this),this.type="MeshBasicMaterial",this.color=new fo(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}go.prototype=Object.assign(Object.create(Ar.prototype),{constructor:go,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"===typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var r=i(t.textures),a=i(t.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var i=e.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(go.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),yo.prototype=Object.create(go.prototype),yo.prototype.constructor=yo,yo.prototype.isMeshBasicMaterial=!0,yo.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var _o=new Wr,bo=new Fr;function xo(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=Cr,this.updateRange={offset:0,count:-1},this.version=0}function wo(t,e,n){xo.call(this,new Int8Array(t),e,n)}function So(t,e,n){xo.call(this,new Uint8Array(t),e,n)}function ko(t,e,n){xo.call(this,new Uint8ClampedArray(t),e,n)}function Mo(t,e,n){xo.call(this,new Int16Array(t),e,n)}function To(t,e,n){xo.call(this,new Uint16Array(t),e,n)}function Eo(t,e,n){xo.call(this,new Int32Array(t),e,n)}function Co(t,e,n){xo.call(this,new Uint32Array(t),e,n)}function Io(t,e,n){xo.call(this,new Uint16Array(t),e,n)}function Po(t,e,n){xo.call(this,new Float32Array(t),e,n)}function Ao(t,e,n){xo.call(this,new Float64Array(t),e,n)}function Lo(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}Object.defineProperty(xo.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(xo.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new fo),e[n++]=a.r,e[n++]=a.g,e[n++]=a.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Fr),e[n++]=a.x,e[n++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new Wr),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new $r),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z,e[n++]=a.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(var e=0,n=this.count;e<n;e++)bo.fromBufferAttribute(this,e),bo.applyMatrix3(t),this.setXY(e,bo.x,bo.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)_o.fromBufferAttribute(this,i),_o.applyMatrix3(t),this.setXYZ(i,_o.x,_o.y,_o.z);return this},applyMatrix4:function(t){for(var e=0,n=this.count;e<n;e++)_o.x=this.getX(e),_o.y=this.getY(e),_o.z=this.getZ(e),_o.applyMatrix4(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},applyNormalMatrix:function(t){for(var e=0,n=this.count;e<n;e++)_o.x=this.getX(e),_o.y=this.getY(e),_o.z=this.getZ(e),_o.applyNormalMatrix(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},transformDirection:function(t){for(var e=0,n=this.count;e<n;e++)_o.x=this.getX(e),_o.y=this.getY(e),_o.z=this.getZ(e),_o.transformDirection(t),this.setXYZ(e,_o.x,_o.y,_o.z);return this},set:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),wo.prototype=Object.create(xo.prototype),wo.prototype.constructor=wo,So.prototype=Object.create(xo.prototype),So.prototype.constructor=So,ko.prototype=Object.create(xo.prototype),ko.prototype.constructor=ko,Mo.prototype=Object.create(xo.prototype),Mo.prototype.constructor=Mo,To.prototype=Object.create(xo.prototype),To.prototype.constructor=To,Eo.prototype=Object.create(xo.prototype),Eo.prototype.constructor=Eo,Co.prototype=Object.create(xo.prototype),Co.prototype.constructor=Co,Io.prototype=Object.create(xo.prototype),Io.prototype.constructor=Io,Io.prototype.isFloat16BufferAttribute=!0,Po.prototype=Object.create(xo.prototype),Po.prototype.constructor=Po,Ao.prototype=Object.create(xo.prototype),Ao.prototype.constructor=Ao;var Ro={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Do(t,e){return new Ro[t](e)}var zo=0,Oo=new ba,Fo=new qa,No=new Wr,Bo=new Xr,jo=new Xr,Vo=new Wr;function Uo(){Object.defineProperty(this,"id",{value:zo++}),this.uuid=Or.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Uo.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Uo,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(Lo(t)>65535?Co:To)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},hasAttribute:function(t){return void 0!==this.attributes[t]},addGroup:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new Nr).getNormalMatrix(t);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Oo.makeRotationX(t),this.applyMatrix4(Oo),this},rotateY:function(t){return Oo.makeRotationY(t),this.applyMatrix4(Oo),this},rotateZ:function(t){return Oo.makeRotationZ(t),this.applyMatrix4(Oo),this},translate:function(t,e,n){return Oo.makeTranslation(t,e,n),this.applyMatrix4(Oo),this},scale:function(t,e,n){return Oo.makeScale(t,e,n),this.applyMatrix4(Oo),this},lookAt:function(t){return Fo.lookAt(t),Fo.updateMatrix(),this.applyMatrix4(Fo.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(No).negate(),this.translate(No.x,No.y,No.z),this},setFromPoints:function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Po(e,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Xr);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Wr(-1/0,-1/0,-1/0),new Wr(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,i=e.length;n<i;n++){var r=e[n];Bo.setFromBufferAttribute(r),this.morphTargetsRelative?(Vo.addVectors(this.boundingBox.min,Bo.min),this.boundingBox.expandByPoint(Vo),Vo.addVectors(this.boundingBox.max,Bo.max),this.boundingBox.expandByPoint(Vo)):(this.boundingBox.expandByPoint(Bo.min),this.boundingBox.expandByPoint(Bo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ha);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Wr,1/0);if(t){var n=this.boundingSphere.center;if(Bo.setFromBufferAttribute(t),e)for(var i=0,r=e.length;i<r;i++){var a=e[i];jo.setFromBufferAttribute(a),this.morphTargetsRelative?(Vo.addVectors(Bo.min,jo.min),Bo.expandByPoint(Vo),Vo.addVectors(Bo.max,jo.max),Bo.expandByPoint(Vo)):(Bo.expandByPoint(jo.min),Bo.expandByPoint(jo.max))}Bo.getCenter(n);for(var o=0,s=0,u=t.count;s<u;s++)Vo.fromBufferAttribute(t,s),o=Math.max(o,n.distanceToSquared(Vo));if(e)for(var l=0,c=e.length;l<c;l++)for(var h=e[l],p=this.morphTargetsRelative,f=0,d=h.count;f<d;f++)Vo.fromBufferAttribute(h,f),p&&(No.fromBufferAttribute(t,f),Vo.add(No)),o=Math.max(o,n.distanceToSquared(Vo));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){var t=this.index,e=this.attributes;if(null!==t&&void 0!==e.position&&void 0!==e.normal&&void 0!==e.uv){var n=t.array,i=e.position.array,r=e.normal.array,a=e.uv.array,o=i.length/3;void 0===e.tangent&&this.setAttribute("tangent",new xo(new Float32Array(4*o),4));for(var s=e.tangent.array,u=[],l=[],c=0;c<o;c++)u[c]=new Wr,l[c]=new Wr;var h=new Wr,p=new Wr,f=new Wr,d=new Fr,v=new Fr,m=new Fr,g=new Wr,y=new Wr,_=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(var b=0,x=_.length;b<x;++b)for(var w=_[b],S=w.start,k=S,M=S+w.count;k<M;k+=3)O(n[k+0],n[k+1],n[k+2]);for(var T=new Wr,E=new Wr,C=new Wr,I=new Wr,P=0,A=_.length;P<A;++P)for(var L=_[P],R=L.start,D=R,z=R+L.count;D<z;D+=3)F(n[D+0]),F(n[D+1]),F(n[D+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function O(t,e,n){h.fromArray(i,3*t),p.fromArray(i,3*e),f.fromArray(i,3*n),d.fromArray(a,2*t),v.fromArray(a,2*e),m.fromArray(a,2*n),p.sub(h),f.sub(h),v.sub(d),m.sub(d);var r=1/(v.x*m.y-m.x*v.y);isFinite(r)&&(g.copy(p).multiplyScalar(m.y).addScaledVector(f,-v.y).multiplyScalar(r),y.copy(f).multiplyScalar(v.x).addScaledVector(p,-m.x).multiplyScalar(r),u[t].add(g),u[e].add(g),u[n].add(g),l[t].add(y),l[e].add(y),l[n].add(y))}function F(t){C.fromArray(r,3*t),I.copy(C);var e=u[t];T.copy(e),T.sub(C.multiplyScalar(C.dot(e))).normalize(),E.crossVectors(I,e);var n=E.dot(l[t])<0?-1:1;s[4*t]=T.x,s[4*t+1]=T.y,s[4*t+2]=T.z,s[4*t+3]=n}},computeVertexNormals:function(){var t=this.index,e=this.getAttribute("position");if(void 0!==e){var n=this.getAttribute("normal");if(void 0===n)n=new xo(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new Wr,o=new Wr,s=new Wr,u=new Wr,l=new Wr,c=new Wr,h=new Wr,p=new Wr;if(t)for(var f=0,d=t.count;f<d;f+=3){var v=t.getX(f+0),m=t.getX(f+1),g=t.getX(f+2);a.fromBufferAttribute(e,v),o.fromBufferAttribute(e,m),s.fromBufferAttribute(e,g),h.subVectors(s,o),p.subVectors(a,o),h.cross(p),u.fromBufferAttribute(n,v),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.add(h),l.add(h),c.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var y=0,_=e.count;y<_;y+=3)a.fromBufferAttribute(e,y+0),o.fromBufferAttribute(e,y+1),s.fromBufferAttribute(e,y+2),h.subVectors(s,o),p.subVectors(a,o),h.cross(p),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==t.attributes[i])for(var r=n[i].array,a=t.attributes[i],o=a.array,s=a.itemSize*e,u=Math.min(o.length,r.length-s),l=0,c=s;l<u;l++,c++)r[c]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)Vo.fromBufferAttribute(t,e),Vo.normalize(),t.setXYZ(e,Vo.x,Vo.y,Vo.z)},toNonIndexed:function(){function t(t,e){for(var n=t.array,i=t.itemSize,r=t.normalized,a=new n.constructor(e.length*i),o=0,s=0,u=0,l=e.length;u<l;u++){o=e[u]*i;for(var c=0;c<i;c++)a[s++]=n[o++]}return new xo(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var e=new Uo,n=this.index.array,i=this.attributes;for(var r in i){var a=t(i[r],n);e.setAttribute(r,a)}var o=this.morphAttributes;for(var s in o){for(var u=[],l=o[s],c=0,h=l.length;c<h;c++){var p=t(l[c],n);u.push(p)}e.morphAttributes[s]=u}e.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,d=0,v=f.length;d<v;d++){var m=f[d];e.addGroup(m.start,m.count,m.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var i=this.index;null!==i&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a],s=o.toJSON(t.data);""!==o.name&&(s.name=o.name),t.data.attributes[a]=s}var u={},l=!1;for(var c in this.morphAttributes){for(var h=this.morphAttributes[c],p=[],f=0,d=h.length;f<d;f++){var v=h[f],m=v.toJSON(t.data);""!==v.name&&(m.name=v.name),p.push(m)}p.length>0&&(u[c]=p,l=!0)}l&&(t.data.morphAttributes=u,t.data.morphTargetsRelative=this.morphTargetsRelative);var g=this.groups;g.length>0&&(t.data.groups=JSON.parse(JSON.stringify(g)));var y=this.boundingSphere;return null!==y&&(t.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),t},clone:function(){return(new Uo).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var e={};this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone(e));var i=t.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(e))}var o=t.morphAttributes;for(var s in o){for(var u=[],l=o[s],c=0,h=l.length;c<h;c++)u.push(l[c].clone(e));this.morphAttributes[s]=u}this.morphTargetsRelative=t.morphTargetsRelative;for(var p=t.groups,f=0,d=p.length;f<d;f++){var v=p[f];this.addGroup(v.start,v.count,v.materialIndex)}var m=t.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=t.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var $o=new ba,Ho=new _a,qo=new ha,Wo=new Wr,Go=new Wr,Zo=new Wr,Xo=new Wr,Yo=new Wr,Ko=new Wr,Jo=new Wr,Qo=new Wr,ts=new Wr,es=new Fr,ns=new Fr,is=new Fr,rs=new Wr,as=new Wr;function os(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uo,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yo;qa.call(this),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}function ss(t,e,n,i,r,a,o,s,u,l,c,h){Wo.fromBufferAttribute(r,l),Go.fromBufferAttribute(r,c),Zo.fromBufferAttribute(r,h);var p=t.morphTargetInfluences;if(e.morphTargets&&a&&p){Jo.set(0,0,0),Qo.set(0,0,0),ts.set(0,0,0);for(var f=0,d=a.length;f<d;f++){var v=p[f],m=a[f];0!==v&&(Xo.fromBufferAttribute(m,l),Yo.fromBufferAttribute(m,c),Ko.fromBufferAttribute(m,h),o?(Jo.addScaledVector(Xo,v),Qo.addScaledVector(Yo,v),ts.addScaledVector(Ko,v)):(Jo.addScaledVector(Xo.sub(Wo),v),Qo.addScaledVector(Yo.sub(Go),v),ts.addScaledVector(Ko.sub(Zo),v)))}Wo.add(Jo),Go.add(Qo),Zo.add(ts)}t.isSkinnedMesh&&(t.boneTransform(l,Wo),t.boneTransform(c,Go),t.boneTransform(h,Zo));var g=function(t,e,n,i,r,a,o,s){if(null===(1===e.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,2!==e.side,s)))return null;as.copy(s),as.applyMatrix4(t.matrixWorld);var u=n.ray.origin.distanceTo(as);return u<n.near||u>n.far?null:{distance:u,point:as.clone(),object:t}}(t,e,n,i,Wo,Go,Zo,rs);if(g){s&&(es.fromBufferAttribute(s,l),ns.fromBufferAttribute(s,c),is.fromBufferAttribute(s,h),g.uv=oo.getUV(rs,Wo,Go,Zo,es,ns,is,new Fr)),u&&(es.fromBufferAttribute(u,l),ns.fromBufferAttribute(u,c),is.fromBufferAttribute(u,h),g.uv2=oo.getUV(rs,Wo,Go,Zo,es,ns,is,new Fr));var y=new vo(l,c,h);oo.getNormal(Wo,Go,Zo,y.normal),g.face=y}return g}os.prototype=Object.assign(Object.create(qa.prototype),{constructor:os,isMesh:!0,copy:function(t){return qa.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var i=e[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=t.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var n,i=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),qo.copy(i.boundingSphere),qo.applyMatrix4(a),!1!==t.ray.intersectsSphere(qo)&&($o.copy(a).invert(),Ho.copy(t.ray).applyMatrix4($o),null===i.boundingBox||!1!==Ho.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var o=i.index,s=i.attributes.position,u=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,p=i.groups,f=i.drawRange;if(null!==o)if(Array.isArray(r))for(var d=0,v=p.length;d<v;d++)for(var m=p[d],g=r[m.materialIndex],y=Math.max(m.start,f.start),_=Math.min(m.start+m.count,f.start+f.count);y<_;y+=3){var b=o.getX(y),x=o.getX(y+1),w=o.getX(y+2);(n=ss(this,g,t,Ho,s,u,l,c,h,b,x,w))&&(n.faceIndex=Math.floor(y/3),n.face.materialIndex=m.materialIndex,e.push(n))}else for(var S=Math.max(0,f.start),k=Math.min(o.count,f.start+f.count);S<k;S+=3){var M=o.getX(S),T=o.getX(S+1),E=o.getX(S+2);(n=ss(this,r,t,Ho,s,u,l,c,h,M,T,E))&&(n.faceIndex=Math.floor(S/3),e.push(n))}else if(void 0!==s)if(Array.isArray(r))for(var C=0,I=p.length;C<I;C++)for(var P=p[C],A=r[P.materialIndex],L=Math.max(P.start,f.start),R=Math.min(P.start+P.count,f.start+f.count);L<R;L+=3){(n=ss(this,A,t,Ho,s,u,l,c,h,L,L+1,L+2))&&(n.faceIndex=Math.floor(L/3),n.face.materialIndex=P.materialIndex,e.push(n))}else for(var D=Math.max(0,f.start),z=Math.min(s.count,f.start+f.count);D<z;D+=3){(n=ss(this,r,t,Ho,s,u,l,c,h,D,D+1,D+2))&&(n.faceIndex=Math.floor(D/3),e.push(n))}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});var us=function(t){kt(n,t);var e=Mt(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Tt(this,n),(t=e.call(this)).type="BoxGeometry",t.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:u};var l=ft(t);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var c=[],h=[],p=[],f=[],d=0,v=0;function m(t,e,n,i,r,a,o,s,u,m,g){for(var y=a/u,_=o/m,b=a/2,x=o/2,w=s/2,S=u+1,k=m+1,M=0,T=0,E=new Wr,C=0;C<k;C++)for(var I=C*_-x,P=0;P<S;P++){var A=P*y-b;E[t]=A*i,E[e]=I*r,E[n]=w,h.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[n]=s>0?1:-1,p.push(E.x,E.y,E.z),f.push(P/u),f.push(1-C/m),M+=1}for(var L=0;L<m;L++)for(var R=0;R<u;R++){var D=d+R+S*L,z=d+R+S*(L+1),O=d+(R+1)+S*(L+1),F=d+(R+1)+S*L;c.push(D,z,F),c.push(z,O,F),T+=6}l.addGroup(v,T,g),v+=T,d+=M}return m("z","y","x",-1,-1,a,r,i,u,s,0),m("z","y","x",1,-1,a,r,-i,u,s,1),m("x","z","y",1,1,i,a,r,o,u,2),m("x","z","y",1,-1,i,a,-r,o,u,3),m("x","y","z",1,-1,i,r,a,o,s,4),m("x","y","z",-1,-1,i,r,-a,o,s,5),t.setIndex(c),t.setAttribute("position",new Po(h,3)),t.setAttribute("normal",new Po(p,3)),t.setAttribute("uv",new Po(f,2)),t}return Ct(n)}(Uo);function ls(t){var e={};for(var n in t)for(var i in e[n]={},t[n]){var r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}return e}function cs(t){for(var e={},n=0;n<t.length;n++){var i=ls(t[n]);for(var r in i)e[r]=i[r]}return e}var hs={clone:ls,merge:cs};function ps(t){go.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function fs(){qa.call(this),this.type="Camera",this.matrixWorldInverse=new ba,this.projectionMatrix=new ba,this.projectionMatrixInverse=new ba}function ds(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;fs.call(this),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ps.prototype=Object.create(go.prototype),ps.prototype.constructor=ps,ps.prototype.isShaderMaterial=!0,ps.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ls(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},ps.prototype.toJSON=function(t){var e=go.prototype.toJSON.call(this,t);for(var n in e.glslVersion=this.glslVersion,e.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var r={};for(var a in this.extensions)!0===this.extensions[a]&&(r[a]=!0);return Object.keys(r).length>0&&(e.extensions=r),e},fs.prototype=Object.assign(Object.create(qa.prototype),{constructor:fs,isCamera:!0,copy:function(t,e){return qa.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Wr),this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){qa.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(t,e){qa.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),ds.prototype=Object.assign(Object.create(fs.prototype),{constructor:ds,isPerspectiveCamera:!0,copy:function(t,e){return fs.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Or.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Or.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Or.RAD2DEG*Math.atan(Math.tan(.5*Or.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,i,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Or.DEG2RAD*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,e-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(r+=t*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){var e=qa.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var vs=90;function ms(t,e,n){if(qa.call(this),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;var i=new ds(vs,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Wr(1,0,0)),this.add(i);var r=new ds(vs,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Wr(-1,0,0)),this.add(r);var a=new ds(vs,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new Wr(0,1,0)),this.add(a);var o=new ds(vs,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Wr(0,-1,0)),this.add(o);var s=new ds(vs,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Wr(0,0,1)),this.add(s);var u=new ds(vs,1,t,e);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Wr(0,0,-1)),this.add(u),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var l=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,a),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,s),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,u),t.setRenderTarget(c),t.xr.enabled=l}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function gs(t,e,n,i,r,a,o,s,u,l){t=void 0!==t?t:[],e=void 0!==e?e:301,o=void 0!==o?o:dr,Vr.call(this,t,e,n,i,r,a,o,s,u,l),this.flipY=!1,this._needsFlipEnvMap=!0}ms.prototype=Object.create(qa.prototype),ms.prototype.constructor=ms,gs.prototype=Object.create(Vr.prototype),gs.prototype.constructor=gs,gs.prototype.isCubeTexture=!0,Object.defineProperty(gs.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var ys=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),Number.isInteger(i)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),i=r),a=e.call(this,t,t,i),Object.defineProperty(ft(a),"isWebGLCubeRenderTarget",{value:!0}),i=i||{},a.texture=new gs(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),a.texture._needsFlipEnvMap=!1,a}return Ct(n,[{key:"fromEquirectangularTexture",value:function(t,e){this.texture.type=e.type,this.texture.format=vr,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new us(5,5,5),o=new ps({name:"CubemapFromEquirect",uniforms:ls(n),vertexShader:i,fragmentShader:r,side:1,blending:0});o.uniforms.tEquirect.value=e;var s=new os(a,o),u=e.minFilter;return e.minFilter===sr&&(e.minFilter=or),new ms(1,10,this).update(t,s),e.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(t,e,n,i){for(var r=t.getRenderTarget(),a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,i);t.setRenderTarget(r)}}]),n}(Hr);function _s(t,e,n,i,r,a,o,s,u,l,c,h){Vr.call(this,null,a,o,s,u,l,i,r,c,h),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==u?u:ar,this.minFilter=void 0!==l?l:ar,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}_s.prototype=Object.create(Vr.prototype),_s.prototype.constructor=_s,_s.prototype.isDataTexture=!0;var bs=new ha,xs=new Wr,ws=function(){function t(e,n,i,r,a,o){Tt(this,t),this.planes=[void 0!==e?e:new Xa,void 0!==n?n:new Xa,void 0!==i?i:new Xa,void 0!==r?r:new Xa,void 0!==a?a:new Xa,void 0!==o?o:new Xa]}return Ct(t,[{key:"set",value:function(t,e,n,i,r,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(t){var e=this.planes,n=t.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],p=n[9],f=n[10],d=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return e[0].setComponents(o-i,c-s,d-h,y-v).normalize(),e[1].setComponents(o+i,c+s,d+h,y+v).normalize(),e[2].setComponents(o+r,c+u,d+p,y+m).normalize(),e[3].setComponents(o-r,c-u,d-p,y-m).normalize(),e[4].setComponents(o-a,c-l,d-f,y-g).normalize(),e[5].setComponents(o+a,c+l,d+f,y+g).normalize(),this}},{key:"intersectsObject",value:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),bs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(bs)}},{key:"intersectsSprite",value:function(t){return bs.center.set(0,0,0),bs.radius=.7071067811865476,bs.applyMatrix4(t.matrixWorld),this.intersectsSphere(bs)}},{key:"intersectsSphere",value:function(t){for(var e=this.planes,n=t.center,i=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0}},{key:"intersectsBox",value:function(t){for(var e=this.planes,n=0;n<6;n++){var i=e[n];if(xs.x=i.normal.x>0?t.max.x:t.min.x,xs.y=i.normal.y>0?t.max.y:t.min.y,xs.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(xs)<0)return!1}return!0}},{key:"containsPoint",value:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}]),t}();function Ss(){var t=null,e=!1,n=null,i=null;function r(e,a){n(e,a),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function ks(t,e){var n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){var a=i.get(e);(!a||a.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);var o=i.get(e);void 0===o?i.set(e,function(e,i){var r=e.array,a=e.usage,o=t.createBuffer();t.bindBuffer(i,o),t.bufferData(i,r,a),e.onUploadCallback();var s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:r instanceof Uint8Array&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):o.version<e.version&&(!function(e,i,r){var a=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,a):(n?t.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):t.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,e,r),o.version=e.version)}}}}var Ms=function(t){kt(n,t);var e=Mt(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Tt(this,n),(t=e.call(this)).type="PlaneGeometry",t.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,u=r/2,l=Math.floor(a),c=Math.floor(o),h=l+1,p=c+1,f=i/l,d=r/c,v=[],m=[],g=[],y=[],_=0;_<p;_++)for(var b=_*d-u,x=0;x<h;x++){var w=x*f-s;m.push(w,-b,0),g.push(0,0,1),y.push(x/l),y.push(1-_/c)}for(var S=0;S<c;S++)for(var k=0;k<l;k++){var M=k+h*S,T=k+h*(S+1),E=k+1+h*(S+1),C=k+1+h*S;v.push(M,T,C),v.push(T,E,C)}return t.setIndex(v),t.setAttribute("position",new Po(m,3)),t.setAttribute("normal",new Po(g,3)),t.setAttribute("uv",new Po(y,2)),t}return Ct(n)}(Uo),Ts={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Es={common:{diffuse:{value:new fo(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Nr},uv2Transform:{value:new Nr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Fr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fo(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fo(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Nr}},sprite:{diffuse:{value:new fo(15658734)},opacity:{value:1},center:{value:new Fr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Nr}}},Cs={basic:{uniforms:cs([Es.common,Es.specularmap,Es.envmap,Es.aomap,Es.lightmap,Es.fog]),vertexShader:Ts.meshbasic_vert,fragmentShader:Ts.meshbasic_frag},lambert:{uniforms:cs([Es.common,Es.specularmap,Es.envmap,Es.aomap,Es.lightmap,Es.emissivemap,Es.fog,Es.lights,{emissive:{value:new fo(0)}}]),vertexShader:Ts.meshlambert_vert,fragmentShader:Ts.meshlambert_frag},phong:{uniforms:cs([Es.common,Es.specularmap,Es.envmap,Es.aomap,Es.lightmap,Es.emissivemap,Es.bumpmap,Es.normalmap,Es.displacementmap,Es.fog,Es.lights,{emissive:{value:new fo(0)},specular:{value:new fo(1118481)},shininess:{value:30}}]),vertexShader:Ts.meshphong_vert,fragmentShader:Ts.meshphong_frag},standard:{uniforms:cs([Es.common,Es.envmap,Es.aomap,Es.lightmap,Es.emissivemap,Es.bumpmap,Es.normalmap,Es.displacementmap,Es.roughnessmap,Es.metalnessmap,Es.fog,Es.lights,{emissive:{value:new fo(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ts.meshphysical_vert,fragmentShader:Ts.meshphysical_frag},toon:{uniforms:cs([Es.common,Es.aomap,Es.lightmap,Es.emissivemap,Es.bumpmap,Es.normalmap,Es.displacementmap,Es.gradientmap,Es.fog,Es.lights,{emissive:{value:new fo(0)}}]),vertexShader:Ts.meshtoon_vert,fragmentShader:Ts.meshtoon_frag},matcap:{uniforms:cs([Es.common,Es.bumpmap,Es.normalmap,Es.displacementmap,Es.fog,{matcap:{value:null}}]),vertexShader:Ts.meshmatcap_vert,fragmentShader:Ts.meshmatcap_frag},points:{uniforms:cs([Es.points,Es.fog]),vertexShader:Ts.points_vert,fragmentShader:Ts.points_frag},dashed:{uniforms:cs([Es.common,Es.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ts.linedashed_vert,fragmentShader:Ts.linedashed_frag},depth:{uniforms:cs([Es.common,Es.displacementmap]),vertexShader:Ts.depth_vert,fragmentShader:Ts.depth_frag},normal:{uniforms:cs([Es.common,Es.bumpmap,Es.normalmap,Es.displacementmap,{opacity:{value:1}}]),vertexShader:Ts.normal_vert,fragmentShader:Ts.normal_frag},sprite:{uniforms:cs([Es.sprite,Es.fog]),vertexShader:Ts.sprite_vert,fragmentShader:Ts.sprite_frag},background:{uniforms:{uvTransform:{value:new Nr},t2D:{value:null}},vertexShader:Ts.background_vert,fragmentShader:Ts.background_frag},cube:{uniforms:cs([Es.envmap,{opacity:{value:1}}]),vertexShader:Ts.cube_vert,fragmentShader:Ts.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ts.equirect_vert,fragmentShader:Ts.equirect_frag},distanceRGBA:{uniforms:cs([Es.common,Es.displacementmap,{referencePosition:{value:new Wr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ts.distanceRGBA_vert,fragmentShader:Ts.distanceRGBA_frag},shadow:{uniforms:cs([Es.lights,Es.fog,{color:{value:new fo(0)},opacity:{value:1}}]),vertexShader:Ts.shadow_vert,fragmentShader:Ts.shadow_frag}};function Is(t,e,n,i,r){var a,o,s=new fo(0),u=0,l=null,c=0,h=null;function p(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return s},setClearColor:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(t),p(s,u=e)},getClearAlpha:function(){return u},setClearAlpha:function(t){p(s,u=t)},render:function(n,r,f,d){var v=!0===r.isScene?r.background:null;v&&v.isTexture&&(v=e.get(v));var m=t.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(v=null),null===v?p(s,u):v&&v.isColor&&(p(v,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||306===v.mapping)?(void 0===o&&((o=new os(new us(1,1,1),new ps({name:"BackgroundCubeMaterial",uniforms:ls(Cs.cube.uniforms),vertexShader:Cs.cube.vertexShader,fragmentShader:Cs.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),v.isWebGLCubeRenderTarget&&(v=v.texture),o.material.uniforms.envMap.value=v,o.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,l===v&&c===v.version&&h===t.toneMapping||(o.material.needsUpdate=!0,l=v,c=v.version,h=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):v&&v.isTexture&&(void 0===a&&((a=new os(new Ms(2,2),new ps({name:"BackgroundMaterial",uniforms:ls(Cs.background.uniforms),vertexShader:Cs.background.vertexShader,fragmentShader:Cs.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),a.material.uniforms.uvTransform.value.copy(v.matrix),l===v&&c===v.version&&h===t.toneMapping||(a.material.needsUpdate=!0,l=v,c=v.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Ps(t,e,n,i){var r=t.getParameter(34921),a=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},u=p(null),l=u;function c(e){return i.isWebGL2?t.bindVertexArray(e):a.bindVertexArrayOES(e)}function h(e){return i.isWebGL2?t.deleteVertexArray(e):a.deleteVertexArrayOES(e)}function p(t){for(var e=[],n=[],i=[],a=0;a<r;a++)e[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function f(){for(var t=l.newAttributes,e=0,n=t.length;e<n;e++)t[e]=0}function d(t){v(t,0)}function v(n,r){var a=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;(a[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),s[n]!==r)&&((i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function m(){for(var e=l.newAttributes,n=l.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function g(e,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,a,o,s):t.vertexAttribIPointer(e,n,r,o,s)}function y(){_(),l!==u&&c((l=u).object)}function _(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(r,u,h,y,_){var b=!1;if(o){var x=function(e,n,r){var o=!0===r.wireframe,u=s[e.id];void 0===u&&(u={},s[e.id]=u);var l=u[n.id];void 0===l&&(l={},u[n.id]=l);var c=l[o];void 0===c&&(c=p(i.isWebGL2?t.createVertexArray():a.createVertexArrayOES()),l[o]=c);return c}(y,h,u);l!==x&&c((l=x).object),b=function(t,e){var n=l.attributes,i=t.attributes,r=0;for(var a in i){var o=n[a],s=i[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;r++}return l.attributesNum!==r||l.index!==e}(y,_),b&&function(t,e){var n={},i=t.attributes,r=0;for(var a in i){var o=i[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,r++}l.attributes=n,l.attributesNum=r,l.index=e}(y,_)}else{var w=!0===u.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===w||(l.geometry=y.id,l.program=h.id,l.wireframe=w,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==_&&n.update(_,34963),b&&(!function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();var u=s.attributes,l=o.getAttributes(),c=a.defaultAttributeValues;for(var h in l){var p=l[h];if(p>=0){var y=u[h];if(void 0!==y){var _=y.normalized,b=y.itemSize,x=n.get(y);if(void 0===x)continue;var w=x.buffer,S=x.type,k=x.bytesPerElement;if(y.isInterleavedBufferAttribute){var M=y.data,T=M.stride,E=y.offset;M&&M.isInstancedInterleavedBuffer?(v(p,M.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=M.meshPerAttribute*M.count)):d(p),t.bindBuffer(34962,w),g(p,b,S,_,T*k,E*k)}else y.isInstancedBufferAttribute?(v(p,y.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=y.meshPerAttribute*y.count)):d(p),t.bindBuffer(34962,w),g(p,b,S,_,0,0)}else if("instanceMatrix"===h){var C=n.get(r.instanceMatrix);if(void 0===C)continue;var I=C.buffer,P=C.type;v(p+0,1),v(p+1,1),v(p+2,1),v(p+3,1),t.bindBuffer(34962,I),t.vertexAttribPointer(p+0,4,P,!1,64,0),t.vertexAttribPointer(p+1,4,P,!1,64,16),t.vertexAttribPointer(p+2,4,P,!1,64,32),t.vertexAttribPointer(p+3,4,P,!1,64,48)}else if("instanceColor"===h){var A=n.get(r.instanceColor);if(void 0===A)continue;var L=A.buffer,R=A.type;v(p,1),t.bindBuffer(34962,L),t.vertexAttribPointer(p,3,R,!1,12,0)}else if(void 0!==c){var D=c[h];if(void 0!==D)switch(D.length){case 2:t.vertexAttrib2fv(p,D);break;case 3:t.vertexAttrib3fv(p,D);break;case 4:t.vertexAttrib4fv(p,D);break;default:t.vertexAttrib1fv(p,D)}}}}m()}(r,u,h,y),null!==_&&t.bindBuffer(34963,n.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){for(var t in y(),s){var e=s[t];for(var n in e){var i=e[n];for(var r in i)h(i[r].object),delete i[r];delete e[n]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0!==s[t.id]){var e=s[t.id];for(var n in e){var i=e[n];for(var r in i)h(i[r].object),delete i[r];delete e[n]}delete s[t.id]}},releaseStatesOfProgram:function(t){for(var e in s){var n=s[e];if(void 0!==n[t.id]){var i=n[t.id];for(var r in i)h(i[r].object),delete i[r];delete n[t.id]}}},initAttributes:f,enableAttribute:d,disableUnusedAttributes:m}}function As(t,e,n,i){var r,a=i.isWebGL2;this.setMode=function(t){r=t},this.render=function(e,i){t.drawArrays(r,e,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var u,l;if(a)u=t,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](r,i,o,s),n.update(o,r,s)}}}function Ls(t,e,n){var i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=!0===n.logarithmicDepthBuffer,l=t.getParameter(34930),c=t.getParameter(35660),h=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),d=t.getParameter(36347),v=t.getParameter(36348),m=t.getParameter(36349),g=c>0,y=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:d,maxVaryings:v,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:a?t.getParameter(36183):0}}function Rs(t){var e=this,n=null,i=0,r=!1,a=!1,o=new Xa,s=new Nr,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(t,n,i,r){var a=null!==t?t.length:0,l=null;if(0!==a){if(l=u.value,!0!==r||null===l){var c=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var p=0,f=i;p!==a;++p,f+=4)o.copy(t[p]).applyMatrix4(h,s),o.normal.toArray(l,f),l[f+3]=o.constant}u.value=l,u.needsUpdate=!0}return e.numPlanes=a,e.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,a){var o=0!==t.length||e||0!==i||r;return r=e,n=c(t,a,0),i=t.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,l()},this.setState=function(e,o,s){var h=e.clippingPlanes,p=e.clipIntersection,f=e.clipShadows,d=t.get(e);if(!r||null===h||0===h.length||a&&!f)a?c(null):l();else{var v=a?0:i,m=4*v,g=d.clippingState||null;u.value=g,g=c(h,o,m,s);for(var y=0;y!==m;++y)g[y]=n[y];d.clippingState=g,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=v}}}function Ds(t){var e=new WeakMap;function n(t,e){return 303===e?t.mapping=301:304===e&&(t.mapping=302),t}function i(t){var n=t.target;n.removeEventListener("dispose",i);var r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping;if(303===a||304===a){if(e.has(r))return n(e.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=t.getRenderList(),u=t.getRenderTarget(),l=new ys(o.height/2);return l.fromEquirectangularTexture(t,r),e.set(r,l),t.setRenderTarget(u),t.setRenderList(s),r.addEventListener("dispose",i),n(l.texture,r.mapping)}return null}}return r},dispose:function(){e=new WeakMap}}}function zs(t){var e={};function n(n){if(void 0!==e[n])return e[n];var i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){var e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Os(t,e,n,i){var r={},a=new WeakMap;function o(t){var s=t.target;for(var u in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete r[s.id];var l=a.get(s);l&&(e.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){var n=[],i=t.index,r=t.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],p=s[u+2];n.push(c,h,h,p,p,c)}}else{var f=r.array;o=r.version;for(var d=0,v=f.length/3-1;d<v;d+=3){var m=d+0,g=d+1,y=d+2;n.push(m,g,g,y,y,m)}}var _=new(Lo(n)>65535?Co:To)(n,1);_.version=o;var b=a.get(t);b&&e.remove(b),a.set(t,_)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(t){var n=t.attributes;for(var i in n)e.update(n[i],34962);var r=t.morphAttributes;for(var a in r)for(var o=r[a],s=0,u=o.length;s<u;s++)e.update(o[s],34962)},getWireframeAttribute:function(t){var e=a.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return a.get(t)}}}function Fs(t,e,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(t){r=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,i){t.drawElements(r,i,a,e*o),n.update(i,r,1)},this.renderInstances=function(i,u,l){if(0!==l){var c,h;if(s)c=t,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,u,a,i*o,l),n.update(u,r,l)}}}function Ns(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Bs(t,e){return t[0]-e[0]}function js(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Vs(t){for(var e={},n=new Float32Array(8),i=[],r=0;r<8;r++)i[r]=[r,0];return{update:function(r,a,o,s){var u=r.morphTargetInfluences,l=void 0===u?0:u.length,c=e[a.id];if(void 0===c){c=[];for(var h=0;h<l;h++)c[h]=[h,0];e[a.id]=c}for(var p=0;p<l;p++){var f=c[p];f[0]=p,f[1]=u[p]}c.sort(js);for(var d=0;d<8;d++)d<l&&c[d][1]?(i[d][0]=c[d][0],i[d][1]=c[d][1]):(i[d][0]=Number.MAX_SAFE_INTEGER,i[d][1]=0);i.sort(Bs);for(var v=o.morphTargets&&a.morphAttributes.position,m=o.morphNormals&&a.morphAttributes.normal,g=0,y=0;y<8;y++){var _=i[y],b=_[0],x=_[1];b!==Number.MAX_SAFE_INTEGER&&x?(v&&a.getAttribute("morphTarget"+y)!==v[b]&&a.setAttribute("morphTarget"+y,v[b]),m&&a.getAttribute("morphNormal"+y)!==m[b]&&a.setAttribute("morphNormal"+y,m[b]),n[y]=x,g+=x):(v&&!0===a.hasAttribute("morphTarget"+y)&&a.deleteAttribute("morphTarget"+y),m&&!0===a.hasAttribute("morphNormal"+y)&&a.deleteAttribute("morphNormal"+y),n[y]=0)}var w=a.morphTargetsRelative?1:1-g;s.getUniforms().setValue(t,"morphTargetBaseInfluence",w),s.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Us(t,e,n,i){var r=new WeakMap;function a(t){var e=t.target;e.removeEventListener("dispose",a),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){var o=i.render.frame,s=t.geometry,u=e.get(t,s);return r.get(u)!==o&&(e.update(u),r.set(u,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",a)&&t.addEventListener("dispose",a),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),u},dispose:function(){r=new WeakMap}}}function $s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Vr.call(this,null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=ar,this.minFilter=ar,this.wrapR=ir,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Hs(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Vr.call(this,null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=ar,this.minFilter=ar,this.wrapR=ir,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Cs.physical={uniforms:cs([Cs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Fr(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new fo(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Ts.meshphysical_vert,fragmentShader:Ts.meshphysical_frag},$s.prototype=Object.create(Vr.prototype),$s.prototype.constructor=$s,$s.prototype.isDataTexture2DArray=!0,Hs.prototype=Object.create(Vr.prototype),Hs.prototype.constructor=Hs,Hs.prototype.isDataTexture3D=!0;var qs=new Vr,Ws=new $s,Gs=new Hs,Zs=new gs,Xs=[],Ys=[],Ks=new Float32Array(16),Js=new Float32Array(9),Qs=new Float32Array(4);function tu(t,e,n){var i=t[0];if(i<=0||i>0)return t;var r=e*n,a=Xs[r];if(void 0===a&&(a=new Float32Array(r),Xs[r]=a),0!==e){i.toArray(a,0);for(var o=1,s=0;o!==e;++o)s+=n,t[o].toArray(a,s)}return a}function eu(t,e){if(t.length!==e.length)return!1;for(var n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function nu(t,e){for(var n=0,i=e.length;n<i;n++)t[n]=e[n]}function iu(t,e){var n=Ys[e];void 0===n&&(n=new Int32Array(e),Ys[e]=n);for(var i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function ru(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function au(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(eu(n,e))return;t.uniform2fv(this.addr,e),nu(n,e)}}function ou(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(eu(n,e))return;t.uniform3fv(this.addr,e),nu(n,e)}}function su(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(eu(n,e))return;t.uniform4fv(this.addr,e),nu(n,e)}}function uu(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(eu(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),nu(n,e)}else{if(eu(n,i))return;Qs.set(i),t.uniformMatrix2fv(this.addr,!1,Qs),nu(n,i)}}function lu(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(eu(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),nu(n,e)}else{if(eu(n,i))return;Js.set(i),t.uniformMatrix3fv(this.addr,!1,Js),nu(n,i)}}function cu(t,e){var n=this.cache,i=e.elements;if(void 0===i){if(eu(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),nu(n,e)}else{if(eu(n,i))return;Ks.set(i),t.uniformMatrix4fv(this.addr,!1,Ks),nu(n,i)}}function hu(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||qs,r)}function pu(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Ws,r)}function fu(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Gs,r)}function du(t,e,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||Zs,r)}function vu(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function mu(t,e){var n=this.cache;eu(n,e)||(t.uniform2iv(this.addr,e),nu(n,e))}function gu(t,e){var n=this.cache;eu(n,e)||(t.uniform3iv(this.addr,e),nu(n,e))}function yu(t,e){var n=this.cache;eu(n,e)||(t.uniform4iv(this.addr,e),nu(n,e))}function _u(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function bu(t,e){t.uniform1fv(this.addr,e)}function xu(t,e){t.uniform1iv(this.addr,e)}function wu(t,e){t.uniform2iv(this.addr,e)}function Su(t,e){t.uniform3iv(this.addr,e)}function ku(t,e){t.uniform4iv(this.addr,e)}function Mu(t,e){var n=tu(e,this.size,2);t.uniform2fv(this.addr,n)}function Tu(t,e){var n=tu(e,this.size,3);t.uniform3fv(this.addr,n)}function Eu(t,e){var n=tu(e,this.size,4);t.uniform4fv(this.addr,n)}function Cu(t,e){var n=tu(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Iu(t,e){var n=tu(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Pu(t,e){var n=tu(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Au(t,e,n){var i=e.length,r=iu(n,i);t.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTexture2D(e[a]||qs,r[a])}function Lu(t,e,n){var i=e.length,r=iu(n,i);t.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTextureCube(e[a]||Zs,r[a])}function Ru(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return ru;case 35664:return au;case 35665:return ou;case 35666:return su;case 35674:return uu;case 35675:return lu;case 35676:return cu;case 5124:case 35670:return vu;case 35667:case 35671:return mu;case 35668:case 35672:return gu;case 35669:case 35673:return yu;case 5125:return _u;case 35678:case 36198:case 36298:case 36306:case 35682:return hu;case 35679:case 36299:case 36307:return fu;case 35680:case 36300:case 36308:case 36293:return du;case 36289:case 36303:case 36311:case 36292:return pu}}(e.type)}function Du(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return bu;case 35664:return Mu;case 35665:return Tu;case 35666:return Eu;case 35674:return Cu;case 35675:return Iu;case 35676:return Pu;case 5124:case 35670:return xu;case 35667:case 35671:return wu;case 35668:case 35672:return Su;case 35669:case 35673:return ku;case 35678:case 36198:case 36298:case 36306:case 35682:return Au;case 35680:case 36300:case 36308:case 36293:return Lu}}(e.type)}function zu(t){this.id=t,this.seq=[],this.map={}}Du.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),nu(e,t)},zu.prototype.setValue=function(t,e,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(t,e[o.id],n)}};var Ou=/(\w+)(\])?(\[|\.)?/g;function Fu(t,e){t.seq.push(e),t.map[e.id]=e}function Nu(t,e,n){var i=t.name,r=i.length;for(Ou.lastIndex=0;;){var a=Ou.exec(i),o=Ou.lastIndex,s=a[1],u="]"===a[2],l=a[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===r){Fu(n,void 0===l?new Ru(s,t,e):new Du(s,t,e));break}var c=n.map[s];void 0===c&&Fu(n,c=new zu(s)),n=c}}function Bu(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),i=0;i<n;++i){var r=t.getActiveUniform(e,i);Nu(r,t.getUniformLocation(e,r.name),this)}}function ju(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}Bu.prototype.setValue=function(t,e,n,i){var r=this.map[e];void 0!==r&&r.setValue(t,n,i)},Bu.prototype.setOptional=function(t,e,n){var i=e[n];void 0!==i&&this.setValue(t,n,i)},Bu.upload=function(t,e,n,i){for(var r=0,a=e.length;r!==a;++r){var o=e[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,i)}},Bu.seqWithValue=function(t,e){for(var n=[],i=0,r=t.length;i!==r;++i){var a=t[i];a.id in e&&n.push(a)}return n};var Vu=0;function Uu(t){switch(t){case Tr:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function $u(t,e,n){var i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+r+function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(t.getShaderSource(e))}function Hu(t,e){var n=Uu(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function qu(t,e){var n=Uu(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Wu(t,e){var n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Gu(t){return""!==t}function Zu(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Xu(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Yu=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ku(t){return t.replace(Yu,Ju)}function Ju(t,e){var n=Ts[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Ku(n)}var Qu=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,tl=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function el(t){return t.replace(tl,il).replace(Qu,nl)}function nl(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),il(t,e,n,i)}function il(t,e,n,i){for(var r="",a=parseInt(e);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function rl(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function al(t,e,n,i){var r,a,o=t.getContext(),s=n.defines,u=n.vertexShader,l=n.fragmentShader,c=function(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),h=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),p=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(n),f=function(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),d=t.gammaFactor>0?t.gammaFactor:1,v=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Gu).join("\n")}(n),m=function(t){var e=[];for(var n in t){var i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[m].filter(Gu).join("\n")).length>0&&(r+="\n"),(a=[v,m].filter(Gu).join("\n")).length>0&&(a+="\n")):(r=[rl(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Gu).join("\n"),a=[v,rl(n),"#define SHADER_NAME "+n.shaderName,m,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Ts.tonemapping_pars_fragment:"",0!==n.toneMapping?Wu("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Ts.encodings_pars_fragment,n.map?Hu("mapTexelToLinear",n.mapEncoding):"",n.matcap?Hu("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Hu("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Hu("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Hu("lightMapTexelToLinear",n.lightMapEncoding):"",qu("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Gu).join("\n")),u=Xu(u=Zu(u=Ku(u),n),n),l=Xu(l=Zu(l=Ku(l),n),n),u=el(u),l=el(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",r=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",n.glslVersion===Pr?"":"out highp vec4 pc_fragColor;",n.glslVersion===Pr?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var _,b,x=y+a+l,w=ju(o,35633,y+r+u),S=ju(o,35632,x);if(o.attachShader(g,w),o.attachShader(g,S),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),t.debug.checkShaderErrors){var k=o.getProgramInfoLog(g).trim(),M=o.getShaderInfoLog(w).trim(),T=o.getShaderInfoLog(S).trim(),E=!0,C=!0;if(!1===o.getProgramParameter(g,35714)){E=!1;var I=$u(o,w,"vertex"),P=$u(o,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(g,35715),"gl.getProgramInfoLog",k,I,P)}else""!==k?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",k):""!==M&&""!==T||(C=!1);C&&(this.diagnostics={runnable:E,programLog:k,vertexShader:{log:M,prefix:r},fragmentShader:{log:T,prefix:a}})}return o.deleteShader(w),o.deleteShader(S),this.getUniforms=function(){return void 0===_&&(_=new Bu(o,g)),_},this.getAttributes=function(){return void 0===b&&(b=function(t,e){for(var n={},i=t.getProgramParameter(e,35721),r=0;r<i;r++){var a=t.getActiveAttrib(e,r).name;n[a]=t.getAttribLocation(e,a)}return n}(o,g)),b},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=Vu++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=S,this}function ol(t,e,n,i,r,a){var o=[],s=i.isWebGL2,u=i.logarithmicDepthBuffer,l=i.floatVertexTextures,c=i.maxVertexUniforms,h=i.vertexTextures,p=i.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},d=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(t){var e;return t&&t.isTexture?e=t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Tr,e}return{getParameters:function(r,o,d,m,g){var y,_,b=m.fog,x=r.isMeshStandardMaterial?m.environment:null,w=e.get(r.envMap||x),S=f[r.type],k=g.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(l)return 1024;var n=c,i=Math.floor((n-20)/4),r=Math.min(i,e.length);return r<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+r+"."),0):r}(g):0;if(null!==r.precision&&(p=i.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead."),S){var M=Cs[S];y=M.vertexShader,_=M.fragmentShader}else y=r.vertexShader,_=r.fragmentShader;var T=t.getRenderTarget();return{isWebGL2:s,shaderID:S,shaderName:r.type,vertexShader:y,fragmentShader:_,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:h,outputEncoding:null!==T?v(T.texture):t.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:v(w),envMapCubeUV:!!w&&(306===w.mapping||307===w.mapping),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:0===r.normalMapType,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatMap||!!r.clearcoatRoughnessMap||!!r.clearcoatNormalMap||!!r.displacementMap||!!r.transmissionMap,uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap)&&!!r.displacementMap,fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:u,skinning:r.skinning&&k>0,maxBones:k,useVertexTexture:l,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&d.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:2===r.side,flipSided:1===r.side,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);if(!1===e.isRawShaderMaterial){for(var r=0;r<d.length;r++)n.push(e[d[r]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){var e,n=f[t.type];if(n){var i=Cs[n];e=hs.clone(i.uniforms)}else e=t.uniforms;return e},acquireProgram:function(e,n){for(var i,a=0,s=o.length;a<s;a++){var u=o[a];if(u.cacheKey===n){++(i=u).usedTimes;break}}return void 0===i&&(i=new al(t,n,e,r),o.push(i)),i},releaseProgram:function(t){if(0===--t.usedTimes){var e=o.indexOf(t);o[e]=o[o.length-1],o.pop(),t.destroy()}},programs:o}}function sl(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function ul(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ll(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function cl(t){var e=[],n=0,i=[],r=[],a={id:-1};function o(i,r,o,s,u,l){var c=e[n],h=t.get(o);return void 0===c?(c={id:i.id,object:i,geometry:r,material:o,program:h.program||a,groupOrder:s,renderOrder:i.renderOrder,z:u,group:l},e[n]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=o,c.program=h.program||a,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=u,c.group=l),n++,c}return{opaque:i,transparent:r,init:function(){n=0,i.length=0,r.length=0},push:function(t,e,n,a,s,u){var l=o(t,e,n,a,s,u);(!0===n.transparent?r:i).push(l)},unshift:function(t,e,n,a,s,u){var l=o(t,e,n,a,s,u);(!0===n.transparent?r:i).unshift(l)},finish:function(){for(var t=n,i=e.length;t<i;t++){var r=e[t];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(t,e){i.length>1&&i.sort(t||ul),r.length>1&&r.sort(e||ll)}}}function hl(t){var e=new WeakMap;return{get:function(n,i){var r,a=e.get(n);return void 0===a?(r=new cl(t),e.set(n,new WeakMap),e.get(n).set(i,r)):void 0===(r=a.get(i))&&(r=new cl(t),a.set(i,r)),r},dispose:function(){e=new WeakMap}}}function pl(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new Wr,color:new fo};break;case"SpotLight":n={position:new Wr,direction:new Wr,color:new fo,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Wr,color:new fo,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Wr,skyColor:new fo,groundColor:new fo};break;case"RectAreaLight":n={color:new fo,position:new Wr,halfWidth:new Wr,halfHeight:new Wr}}return t[e.id]=n,n}}}var fl=0;function dl(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function vl(t,e){for(var n=new pl,i=function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fr};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fr,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)r.probe.push(new Wr);var o=new Wr,s=new ba,u=new ba;return{setup:function(a){for(var o=0,s=0,u=0,l=0;l<9;l++)r.probe[l].set(0,0,0);var c=0,h=0,p=0,f=0,d=0,v=0,m=0,g=0;a.sort(dl);for(var y=0,_=a.length;y<_;y++){var b=a[y],x=b.color,w=b.intensity,S=b.distance,k=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)o+=x.r*w,s+=x.g*w,u+=x.b*w;else if(b.isLightProbe)for(var M=0;M<9;M++)r.probe[M].addScaledVector(b.sh.coefficients[M],w);else if(b.isDirectionalLight){var T=n.get(b);if(T.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){var E=b.shadow,C=i.get(b);C.shadowBias=E.bias,C.shadowNormalBias=E.normalBias,C.shadowRadius=E.radius,C.shadowMapSize=E.mapSize,r.directionalShadow[c]=C,r.directionalShadowMap[c]=k,r.directionalShadowMatrix[c]=b.shadow.matrix,v++}r.directional[c]=T,c++}else if(b.isSpotLight){var I=n.get(b);if(I.position.setFromMatrixPosition(b.matrixWorld),I.color.copy(x).multiplyScalar(w),I.distance=S,I.coneCos=Math.cos(b.angle),I.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),I.decay=b.decay,b.castShadow){var P=b.shadow,A=i.get(b);A.shadowBias=P.bias,A.shadowNormalBias=P.normalBias,A.shadowRadius=P.radius,A.shadowMapSize=P.mapSize,r.spotShadow[p]=A,r.spotShadowMap[p]=k,r.spotShadowMatrix[p]=b.shadow.matrix,g++}r.spot[p]=I,p++}else if(b.isRectAreaLight){var L=n.get(b);L.color.copy(x).multiplyScalar(w),L.halfWidth.set(.5*b.width,0,0),L.halfHeight.set(0,.5*b.height,0),r.rectArea[f]=L,f++}else if(b.isPointLight){var R=n.get(b);if(R.color.copy(b.color).multiplyScalar(b.intensity),R.distance=b.distance,R.decay=b.decay,b.castShadow){var D=b.shadow,z=i.get(b);z.shadowBias=D.bias,z.shadowNormalBias=D.normalBias,z.shadowRadius=D.radius,z.shadowMapSize=D.mapSize,z.shadowCameraNear=D.camera.near,z.shadowCameraFar=D.camera.far,r.pointShadow[h]=z,r.pointShadowMap[h]=k,r.pointShadowMatrix[h]=b.shadow.matrix,m++}r.point[h]=R,h++}else if(b.isHemisphereLight){var O=n.get(b);O.skyColor.copy(b.color).multiplyScalar(w),O.groundColor.copy(b.groundColor).multiplyScalar(w),r.hemi[d]=O,d++}}f>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Es.LTC_FLOAT_1,r.rectAreaLTC2=Es.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Es.LTC_HALF_1,r.rectAreaLTC2=Es.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=s,r.ambient[2]=u;var F=r.hash;F.directionalLength===c&&F.pointLength===h&&F.spotLength===p&&F.rectAreaLength===f&&F.hemiLength===d&&F.numDirectionalShadows===v&&F.numPointShadows===m&&F.numSpotShadows===g||(r.directional.length=c,r.spot.length=p,r.rectArea.length=f,r.point.length=h,r.hemi.length=d,r.directionalShadow.length=v,r.directionalShadowMap.length=v,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=v,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,F.directionalLength=c,F.pointLength=h,F.spotLength=p,F.rectAreaLength=f,F.hemiLength=d,F.numDirectionalShadows=v,F.numPointShadows=m,F.numSpotShadows=g,r.version=fl++)},setupView:function(t,e){for(var n=0,i=0,a=0,l=0,c=0,h=e.matrixWorldInverse,p=0,f=t.length;p<f;p++){var d=t[p];if(d.isDirectionalLight){var v=r.directional[n];v.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(d.isSpotLight){var m=r.spot[a];m.position.setFromMatrixPosition(d.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),a++}else if(d.isRectAreaLight){var g=r.rectArea[l];g.position.setFromMatrixPosition(d.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(d.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*d.width,0,0),g.halfHeight.set(0,.5*d.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),l++}else if(d.isPointLight){var y=r.point[i];y.position.setFromMatrixPosition(d.matrixWorld),y.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){var _=r.hemi[c];_.direction.setFromMatrixPosition(d.matrixWorld),_.direction.transformDirection(h),_.direction.normalize(),c++}}},state:r}}function ml(t,e){var n=new vl(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function gl(t,e){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(i)?(r=new ml(t,e),n.set(i,[]),n.get(i).push(r)):a>=n.get(i).length?(r=new ml(t,e),n.get(i).push(r)):r=n.get(i)[a],r},dispose:function(){n=new WeakMap}}}function yl(t){go.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function _l(t){go.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Wr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}yl.prototype=Object.create(go.prototype),yl.prototype.constructor=yl,yl.prototype.isMeshDepthMaterial=!0,yl.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},_l.prototype=Object.create(go.prototype),_l.prototype.constructor=_l,_l.prototype.isMeshDistanceMaterial=!0,_l.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function bl(t,e,n){var i=new ws,r=new Fr,a=new Fr,o=new $r,s=[],u=[],l={},c={0:1,1:0,2:2},h=new ps({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Fr},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;var f=new Uo;f.setAttribute("position",new xo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var d=new os(f,h),v=this;function m(n,i){var r=e.update(d);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,h,d,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,p,d,null)}function g(t,e,n){var i=t<<0|e<<1|n<<2,r=s[i];return void 0===r&&(r=new yl({depthPacking:3201,morphTargets:t,skinning:e}),s[i]=r),r}function y(t,e,n){var i=t<<0|e<<1|n<<2,r=u[i];return void 0===r&&(r=new _l({morphTargets:t,skinning:e}),u[i]=r),r}function _(e,n,i,r,a,o,s){var u=null,h=g,p=e.customDepthMaterial;if(!0===r.isPointLight&&(h=y,p=e.customDistanceMaterial),void 0===p){var f=!1;!0===i.morphTargets&&(f=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var d=!1;!0===e.isSkinnedMesh&&(!0===i.skinning?d=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),u=h(f,d,!0===e.isInstancedMesh)}else u=p;if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var v=u.uuid,m=i.uuid,_=l[v];void 0===_&&(_={},l[v]=_);var b=_[m];void 0===b&&(b=u.clone(),_[m]=b),u=b}return u.visible=i.visible,u.wireframe=i.wireframe,u.side=3===s?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:c[i.side],u.clipShadows=i.clipShadows,u.clippingPlanes=i.clippingPlanes,u.clipIntersection=i.clipIntersection,u.wireframeLinewidth=i.wireframeLinewidth,u.linewidth=i.linewidth,!0===r.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(r.matrixWorld),u.nearDistance=a,u.farDistance=o),u}function b(n,r,a,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var u=e.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,h=0,p=c.length;h<p;h++){var f=c[h],d=l[f.materialIndex];if(d&&d.visible){var v=_(n,u,d,o,a.near,a.far,s);t.renderBufferDirect(a,null,u,v,n,f)}}else if(l.visible){var m=_(n,u,l,o,a.near,a.far,s);t.renderBufferDirect(a,null,u,m,n,null)}}for(var g=n.children,y=0,x=g.length;y<x;y++)b(g[y],r,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,s,u){if(!1!==v.enabled&&(!1!==v.autoUpdate||!1!==v.needsUpdate)&&0!==e.length){var l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var f=0,d=e.length;f<d;f++){var g=e[f],y=g.shadow;if(void 0!==y){if(!1!==y.autoUpdate||!1!==y.needsUpdate){r.copy(y.mapSize);var _=y.getFrameExtents();if(r.multiply(_),a.copy(y.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(a.x=Math.floor(n/_.x),r.x=a.x*_.x,y.mapSize.x=a.x),r.y>n&&(a.y=Math.floor(n/_.y),r.y=a.y*_.y,y.mapSize.y=a.y)),null===y.map&&!y.isPointLightShadow&&3===this.type){var x={minFilter:or,magFilter:or,format:vr};y.map=new Hr(r.x,r.y,x),y.map.texture.name=g.name+".shadowMap",y.mapPass=new Hr(r.x,r.y,x),y.camera.updateProjectionMatrix()}if(null===y.map){var w={minFilter:ar,magFilter:ar,format:vr};y.map=new Hr(r.x,r.y,w),y.map.texture.name=g.name+".shadowMap",y.camera.updateProjectionMatrix()}t.setRenderTarget(y.map),t.clear();for(var S=y.getViewportCount(),k=0;k<S;k++){var M=y.getViewport(k);o.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),p.viewport(o),y.updateMatrices(g,k),i=y.getFrustum(),b(s,u,y.camera,g,this.type)}y.isPointLightShadow||3!==this.type||m(y,u),y.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}v.needsUpdate=!1,t.setRenderTarget(l,c,h)}}}function xl(t,e,n){var i,r,a=n.isWebGL2;var o=new function(){var e=!1,n=new $r,i=null,r=new $r(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,a,o,s){!0===s&&(e*=o,i*=o,a*=o),n.set(e,i,a,o),!1===r.equals(n)&&(t.clearColor(e,i,a,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){var e=!1,n=null,i=null,r=null;return{setTest:function(t){t?z(2929):O(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},u=new function(){var e=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(t){e||(t?z(2960):O(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&a===o||(t.stencilFunc(e,n,o),i=e,r=n,a=o)},setOp:function(e,n,i){o===e&&s===n&&u===i||(t.stencilOp(e,n,i),o=e,s=n,u=i)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null}}},l={},c=null,h=null,p=null,f=null,d=null,v=null,m=null,g=null,y=null,_=!1,b=null,x=null,w=null,S=null,k=null,M=t.getParameter(35661),T=!1,E=0,C=t.getParameter(7938);-1!==C.indexOf("WebGL")?(E=parseFloat(/^WebGL (\d)/.exec(C)[1]),T=E>=1):-1!==C.indexOf("OpenGL ES")&&(E=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),T=E>=2);var I=null,P={},A=new $r,L=new $r;function R(e,n,i){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var o=0;o<i;o++)t.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var D={};function z(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function O(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}D[3553]=R(3553,3553,1),D[34067]=R(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),z(2929),s.setFunc(3),V(!1),U(1),z(2884),j(0);var F=(St(i={},er,32774),St(i,101,32778),St(i,102,32779),i);if(a)F[103]=32775,F[104]=32776;else{var N=e.get("EXT_blend_minmax");null!==N&&(F[103]=N.MIN_EXT,F[104]=N.MAX_EXT)}var B=(St(r={},200,0),St(r,201,1),St(r,202,768),St(r,204,770),St(r,210,776),St(r,208,774),St(r,206,772),St(r,203,769),St(r,205,771),St(r,209,775),St(r,207,773),r);function j(e,n,i,r,a,o,s,u){if(0!==e){if(h||(z(3042),h=!0),5===e)a=a||n,o=o||i,s=s||r,n===f&&a===m||(t.blendEquationSeparate(F[n],F[a]),f=n,m=a),i===d&&r===v&&o===g&&s===y||(t.blendFuncSeparate(B[i],B[r],B[o],B[s]),d=i,v=r,g=o,y=s),p=e,_=null;else if(e!==p||u!==_){if(f===er&&m===er||(t.blendEquation(32774),f=er,m=er),u)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}d=null,v=null,g=null,y=null,p=e,_=u}}else h&&(O(3042),h=!1)}function V(e){b!==e&&(e?t.frontFace(2304):t.frontFace(2305),b=e)}function U(e){0!==e?(z(2884),e!==x&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):O(2884),x=e}function $(e,n,i){e?(z(32823),S===n&&k===i||(t.polygonOffset(n,i),S=n,k=i)):O(32823)}function H(e){void 0===e&&(e=33984+M-1),I!==e&&(t.activeTexture(e),I=e)}return{buffers:{color:o,depth:s,stencil:u},enable:z,disable:O,useProgram:function(e){return c!==e&&(t.useProgram(e),c=e,!0)},setBlending:j,setMaterial:function(t,e){2===t.side?O(2884):z(2884);var n=1===t.side;e&&(n=!n),V(n),1===t.blending&&!1===t.transparent?j(0):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),s.setFunc(t.depthFunc),s.setTest(t.depthTest),s.setMask(t.depthWrite),o.setMask(t.colorWrite);var i=t.stencilWrite;u.setTest(i),i&&(u.setMask(t.stencilWriteMask),u.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),u.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),$(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:V,setCullFace:U,setLineWidth:function(e){e!==w&&(T&&t.lineWidth(e),w=e)},setPolygonOffset:$,setScissorTest:function(t){t?z(3089):O(3089)},activeTexture:H,bindTexture:function(e,n){null===I&&H();var i=P[I];void 0===i&&(i={type:void 0,texture:void 0},P[I]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||D[e]),i.type=e,i.texture=n)},unbindTexture:function(){var e=P[I];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===A.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),A.copy(e))},viewport:function(e){!1===L.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),L.copy(e))},reset:function(){l={},I=null,P={},c=null,h=null,p=null,f=null,d=null,v=null,m=null,g=null,y=null,_=!1,b=null,x=null,w=null,S=null,k=null,o.reset(),s.reset(),u.reset()}}}function wl(t,e,n,i,r,a,o){var s,u,l,c=r.isWebGL2,h=r.maxTextures,p=r.maxCubemapSize,f=r.maxTextureSize,d=r.maxSamples,v=new WeakMap,m=!1;try{m="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(Tx){}function g(t,e){return m?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function y(t,e,n,i){var r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){var a=e?Or.floorPowerOfTwo:Math.floor,o=a(r*t.width),s=a(r*t.height);void 0===l&&(l=g(o,s));var u=n?g(o,s):l;return u.width=o,u.height=s,u.getContext("2d").drawImage(t,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),u}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function _(t){return Or.isPowerOfTwo(t.width)&&Or.isPowerOfTwo(t.height)}function b(t,e){return t.generateMipmaps&&e&&t.minFilter!==ar&&t.minFilter!==or}function x(e,n,r,a){t.generateMipmap(e),i.get(n).__maxMipLevel=Math.log(Math.max(r,a))*Math.LOG2E}function w(n,i,r){if(!1===c)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var a=i;return 6403===i&&(5126===r&&(a=33326),5131===r&&(a=33325),5121===r&&(a=33321)),6407===i&&(5126===r&&(a=34837),5131===r&&(a=34843),5121===r&&(a=32849)),6408===i&&(5126===r&&(a=34836),5131===r&&(a=34842),5121===r&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||e.get("EXT_color_buffer_float"),a}function S(t){return t===ar||1004===t||1005===t?9728:9729}function k(e){var n=e.target;n.removeEventListener("dispose",k),function(e){var n=i.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),i.remove(e)}(n),n.isVideoTexture&&v.delete(n),o.memory.textures--}function M(e){var n=e.target;n.removeEventListener("dispose",M),function(e){var n=i.get(e),r=i.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)t.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[a]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);i.remove(e.texture),i.remove(e)}(n),o.memory.textures--}var T=0;function E(t,e){var r=i.get(t);if(t.isVideoTexture&&function(t){var e=o.render.frame;v.get(t)!==e&&(v.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){var a=t.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void R(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}function C(e,r){var o=i.get(e);e.version>0&&o.__version!==e.version?function(e,i,r){if(6!==i.image.length)return;L(e,i),n.activeTexture(33984+r),n.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);for(var o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),s=i.image[0]&&i.image[0].isDataTexture,u=[],l=0;l<6;l++)u[l]=o||s?s?i.image[l].image:i.image[l]:y(i.image[l],!1,!0,p);var h,f=u[0],d=_(f)||c,v=a.convert(i.format),m=a.convert(i.type),g=w(i.internalFormat,v,m);if(A(34067,i,d),o){for(var S=0;S<6;S++){h=u[S].mipmaps;for(var k=0;k<h.length;k++){var M=h[k];i.format!==vr&&i.format!==dr?null!==v?n.compressedTexImage2D(34069+S,k,g,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+S,k,g,M.width,M.height,0,v,m,M.data)}}e.__maxMipLevel=h.length-1}else{h=i.mipmaps;for(var T=0;T<6;T++)if(s){n.texImage2D(34069+T,0,g,u[T].width,u[T].height,0,v,m,u[T].data);for(var E=0;E<h.length;E++){var C=h[E].image[T].image;n.texImage2D(34069+T,E+1,g,C.width,C.height,0,v,m,C.data)}}else{n.texImage2D(34069+T,0,g,v,m,u[T]);for(var I=0;I<h.length;I++){var P=h[I];n.texImage2D(34069+T,I+1,g,v,m,P.image[T])}}e.__maxMipLevel=h.length}b(i,d)&&x(34067,i,f.width,f.height);e.__version=i.version,i.onUpdate&&i.onUpdate(i)}(o,e,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))}var I=(St(s={},nr,10497),St(s,ir,33071),St(s,rr,33648),s),P=(St(u={},ar,9728),St(u,1004,9984),St(u,1005,9986),St(u,or,9729),St(u,1007,9985),St(u,sr,9987),u);function A(n,a,o){o?(t.texParameteri(n,10242,I[a.wrapS]),t.texParameteri(n,10243,I[a.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,I[a.wrapR]),t.texParameteri(n,10240,P[a.magFilter]),t.texParameteri(n,10241,P[a.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),a.wrapS===ir&&a.wrapT===ir||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,S(a.magFilter)),t.texParameteri(n,10241,S(a.minFilter)),a.minFilter!==ar&&a.minFilter!==or&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=e.get("EXT_texture_filter_anisotropic");if(s){if(a.type===hr&&null===e.get("OES_texture_float_linear"))return;if(a.type===pr&&null===(c||e.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(t.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function L(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",k),e.__webglTexture=t.createTexture(),o.memory.textures++)}function R(e,i,r){var o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),L(e,i),n.activeTexture(33984+r),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment);var s,u=function(t){return!c&&(t.wrapS!==ir||t.wrapT!==ir||t.minFilter!==ar&&t.minFilter!==or)}(i)&&!1===_(i.image),l=y(i.image,u,!1,f),h=_(l)||c,p=a.convert(i.format),d=a.convert(i.type),v=w(i.internalFormat,p,d);A(o,i,h);var m=i.mipmaps;if(i.isDepthTexture)v=6402,c?v=i.type===hr?36012:i.type===cr?33190:i.type===fr?35056:33189:i.type===hr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===mr&&6402===v&&i.type!==lr&&i.type!==cr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=lr,d=a.convert(i.type)),i.format===gr&&6402===v&&(v=34041,i.type!==fr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=fr,d=a.convert(i.type))),n.texImage2D(3553,0,v,l.width,l.height,0,p,d,null);else if(i.isDataTexture)if(m.length>0&&h){for(var g=0,S=m.length;g<S;g++)s=m[g],n.texImage2D(3553,g,v,s.width,s.height,0,p,d,s.data);i.generateMipmaps=!1,e.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,l.width,l.height,0,p,d,l.data),e.__maxMipLevel=0;else if(i.isCompressedTexture){for(var k=0,M=m.length;k<M;k++)s=m[k],i.format!==vr&&i.format!==dr?null!==p?n.compressedTexImage2D(3553,k,v,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,k,v,s.width,s.height,0,p,d,s.data);e.__maxMipLevel=m.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,v,l.width,l.height,l.depth,0,p,d,l.data),e.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,v,l.width,l.height,l.depth,0,p,d,l.data),e.__maxMipLevel=0;else if(m.length>0&&h){for(var T=0,E=m.length;T<E;T++)s=m[T],n.texImage2D(3553,T,v,p,d,s);i.generateMipmaps=!1,e.__maxMipLevel=m.length-1}else n.texImage2D(3553,0,v,p,d,l),e.__maxMipLevel=0;b(i,h)&&x(o,i,l.width,l.height),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function D(e,r,o,s){var u=a.convert(r.texture.format),l=a.convert(r.texture.type),c=w(r.texture.internalFormat,u,l);n.texImage2D(s,0,c,r.width,r.height,0,u,l,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,s,i.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function z(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===hr?r=36012:o.type===cr&&(r=33190));var s=F(n);t.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(i){var u=F(n);t.renderbufferStorageMultisample(36161,u,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var l=a.convert(n.texture.format),c=a.convert(n.texture.type),h=w(n.texture.internalFormat,l,c);if(i){var p=F(n);t.renderbufferStorageMultisample(36161,p,h,n.width,n.height)}else t.renderbufferStorage(36161,h,n.width,n.height)}t.bindRenderbuffer(36161,null)}function O(e){var n=i.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),E(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===mr)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==gr)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,e)}else if(r){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(36160,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=t.createRenderbuffer(),z(n.__webglDepthbuffer[a],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),z(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function F(t){return c&&t.isWebGLMultisampleRenderTarget?Math.min(d,t.samples):0}var N=!1,B=!1;this.allocateTextureUnit=function(){var t=T;return t>=h&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+h),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(t,e){var r=i.get(t);t.version>0&&r.__version!==t.version?R(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){var r=i.get(t);t.version>0&&r.__version!==t.version?R(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=C,this.setupRenderTarget=function(e){var r=i.get(e),s=i.get(e.texture);e.addEventListener("dispose",M),s.__webglTexture=t.createTexture(),o.memory.textures++;var u=!0===e.isWebGLCubeRenderTarget,l=!0===e.isWebGLMultisampleRenderTarget,h=_(e)||c;if(!c||e.texture.format!==dr||e.texture.type!==hr&&e.texture.type!==pr||(e.texture.format=vr,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),u){r.__webglFramebuffer=[];for(var p=0;p<6;p++)r.__webglFramebuffer[p]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),l)if(c){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);var f=a.convert(e.texture.format),d=a.convert(e.texture.type),v=w(e.texture.internalFormat,f,d),m=F(e);t.renderbufferStorageMultisample(36161,m,v,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),z(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){n.bindTexture(34067,s.__webglTexture),A(34067,e.texture,h);for(var g=0;g<6;g++)D(r.__webglFramebuffer[g],e,36064,34069+g);b(e.texture,h)&&x(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),A(3553,e.texture,h),D(r.__webglFramebuffer,e,36064,3553),b(e.texture,h)&&x(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(b(e,_(t)||c)){var r=t.isWebGLCubeRenderTarget?34067:3553,a=i.get(e).__webglTexture;n.bindTexture(r,a),x(r,e,t.width,t.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(c){var n=i.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);var r=e.width,a=e.height,o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024),t.blitFramebuffer(0,0,r,a,0,0,r,a,o,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),t=t.texture),E(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),t=t.texture),C(t,e)}}function Sl(t,e,n){var i=n.isWebGL2;return{convert:function(t){var n;if(t===ur)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===lr)return 5123;if(1013===t)return 5124;if(t===cr)return 5125;if(t===hr)return 5126;if(t===pr)return i?5131:null!==(n=e.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===t)return 6406;if(t===dr)return 6407;if(t===vr)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===mr)return 6402;if(t===gr)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(null===(n=e.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(null===(n=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return null!==(n=e.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&null!==(n=e.get("WEBGL_compressed_texture_etc"))){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?null!==(n=e.get("WEBGL_compressed_texture_astc"))?t:null:36492===t?null!==(n=e.get("EXT_texture_compression_bptc"))?t:null:t===fr?i?34042:null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function kl(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];ds.call(this),this.cameras=t}function Ml(){qa.call(this),this.type="Group"}function Tl(){this._targetRay=null,this._grip=null,this._hand=null}function El(t,e){var n=this,i=null,r=1,a=null,o="local-floor",s=null,u=[],l=new Map,c=new ds;c.layers.enable(1),c.viewport=new $r;var h=new ds;h.layers.enable(2),h.viewport=new $r;var p=[c,h],f=new kl;f.layers.enable(1),f.layers.enable(2);var d=null,v=null;function m(t){var e=l.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function g(){l.forEach((function(t,e){t.disconnect(e)})),l.clear(),d=null,v=null,t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(t){for(var e=i.inputSources,n=0;n<u.length;n++)l.set(e[n],u[n]);for(var r=0;r<t.removed.length;r++){var a=t.removed[r],o=l.get(a);o&&(o.dispatchEvent({type:"disconnected",data:a}),l.delete(a))}for(var s=0;s<t.added.length;s++){var c=t.added[s],h=l.get(c);h&&h.dispatchEvent({type:"connected",data:c})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var e=u[t];return void 0===e&&(e=new Tl,u[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){var e=u[t];return void 0===e&&(e=new Tl,u[t]=e),e.getGripSpace()},this.getHand=function(t){var e=u[t];return void 0===e&&(e=new Tl,u[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return i},this.setSession=function(){var t=ut(ct.mark((function t(s){var u,l,c;return ct.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(i=s)){t.next=24;break}if(i.addEventListener("select",m),i.addEventListener("selectstart",m),i.addEventListener("selectend",m),i.addEventListener("squeeze",m),i.addEventListener("squeezestart",m),i.addEventListener("squeezeend",m),i.addEventListener("end",g),i.addEventListener("inputsourceschange",y),!0===(u=e.getContextAttributes()).xrCompatible){t.next=14;break}return t.next=14,e.makeXRCompatible();case 14:return l={antialias:u.antialias,alpha:u.alpha,depth:u.depth,stencil:u.stencil,framebufferScaleFactor:r},c=new XRWebGLLayer(i,e,l),i.updateRenderState({baseLayer:c}),t.next=19,i.requestReferenceSpace(o);case 19:a=t.sent,S.setContext(i),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"});case 24:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var _=new Wr,b=new Wr;function x(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.getCamera=function(t){f.near=h.near=c.near=t.near,f.far=h.far=c.far=t.far,d===f.near&&v===f.far||(i.updateRenderState({depthNear:f.near,depthFar:f.far}),d=f.near,v=f.far);var e=t.parent,n=f.cameras;x(f,e);for(var r=0;r<n.length;r++)x(n[r],e);t.matrixWorld.copy(f.matrixWorld),t.matrix.copy(f.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);for(var a=t.children,o=0,s=a.length;o<s;o++)a[o].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){_.setFromMatrixPosition(e.matrixWorld),b.setFromMatrixPosition(n.matrixWorld);var i=_.distanceTo(b),r=e.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),u=(r[9]+1)/r[5],l=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],p=o*c,f=o*h,d=i/(-c+h),v=d*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(v),t.translateZ(d),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();var m=o+d,g=s+d,y=p-v,x=f+(i-v),w=u*s/g*m,S=l*s/g*m;t.projectionMatrix.makePerspective(y,x,w,S,m,g)}(f,c,h):f.projectionMatrix.copy(c.projectionMatrix),f};var w=null;var S=new Ss;S.setAnimationLoop((function(e,n){if(null!==(s=n.getViewerPose(a))){var r=s.views,o=i.renderState.baseLayer;t.setFramebuffer(o.framebuffer);var l=!1;r.length!==f.cameras.length&&(f.cameras.length=0,l=!0);for(var c=0;c<r.length;c++){var h=r[c],d=o.getViewport(h),v=p[c];v.matrix.fromArray(h.transform.matrix),v.projectionMatrix.fromArray(h.projectionMatrix),v.viewport.set(d.x,d.y,d.width,d.height),0===c&&f.matrix.copy(v.matrix),!0===l&&f.cameras.push(v)}}for(var m=i.inputSources,g=0;g<u.length;g++){var y=u[g],_=m[g];y.update(_,n,a)}w&&w(e,n)})),this.setAnimationLoop=function(t){w=t},this.dispose=function(){}}function Cl(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);var i,r,a=t.get(n).envMap;if(a){e.envMap.value=a,e.flipEnvMap.value=a.isCubeTexture&&a._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;var o=t.get(a).__maxMipLevel;void 0!==o&&(e.maxMipLevel.value=o)}n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(i=n.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uv2Transform.value.copy(r.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,a){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i),i.isMeshPhysicalMaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,i):n(t,i)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,a):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Il(t){var e=void 0!==(t=t||{}).canvas?t.canvas:function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,u=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,h=null,p=null,f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Tr,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d=this,v=!1,m=null,g=0,y=0,_=null,b=null,x=-1,w=null,S=new $r,k=new $r,M=null,T=e.width,E=e.height,C=1,I=null,P=null,A=new $r(0,0,T,E),L=new $r(0,0,T,E),R=!1,D=new ws,z=!1,O=!1,F=new ba,N=new Wr,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===_?C:1}var V,U,$,H,q,W,G,Z,X,Y,K,J,Q,tt,et,nt,it,rt,at,ot,st,ut=n;function lt(t,n){for(var i=0;i<t.length;i++){var r=t[i],a=e.getContext(r,n);if(null!==a)return a}return null}try{var ct={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if(e.addEventListener("webglcontextlost",vt,!1),e.addEventListener("webglcontextrestored",mt,!1),null===ut){var ht=["webgl2","webgl","experimental-webgl"];if(!0===d.isWebGL1Renderer&&ht.shift(),null===(ut=lt(ht,ct)))throw lt(ht)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ut.getShaderPrecisionFormat&&(ut.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Tt){throw console.error("THREE.WebGLRenderer: "+Tt.message),Tt}function pt(){V=new zs(ut),U=new Ls(ut,V,t),V.init(U),ot=new Sl(ut,V,U),($=new xl(ut,V,U)).scissor(k.copy(L).multiplyScalar(C).floor()),$.viewport(S.copy(A).multiplyScalar(C).floor()),H=new Ns(ut),q=new sl,W=new wl(ut,V,$,q,U,ot,H),G=new Ds(d),Z=new ks(ut,U),st=new Ps(ut,V,Z,U),X=new Os(ut,Z,H,st),Y=new Us(ut,X,Z,H),it=new Vs(ut),et=new Rs(q),K=new ol(d,G,V,U,st,et),J=new Cl(q),Q=new hl(q),tt=new gl(V,U),nt=new Is(d,G,$,Y,s),rt=new As(ut,V,H,U),at=new Fs(ut,V,H,U),H.programs=K.programs,d.capabilities=U,d.extensions=V,d.properties=q,d.renderLists=Q,d.state=$,d.info=H}pt();var ft=new El(d,ut);this.xr=ft;var dt=new bl(d,Y,U.maxTextureSize);function vt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function mt(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1,pt()}function gt(t){var e=t.target;e.removeEventListener("dispose",gt),function(t){yt(t),q.remove(t)}(e)}function yt(t){var e=q.get(t).program;void 0!==e&&K.releaseProgram(e)}this.shadowMap=dt,this.getContext=function(){return ut},this.getContextAttributes=function(){return ut.getContextAttributes()},this.forceContextLoss=function(){var t=V.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=V.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(t){void 0!==t&&(C=t,this.setSize(T,E,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Fr),t.set(T,E)},this.setSize=function(t,n,i){ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=t,E=n,e.width=Math.floor(t*C),e.height=Math.floor(n*C),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Fr),t.set(T*C,E*C).floor()},this.setDrawingBufferSize=function(t,n,i){T=t,E=n,C=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new $r),t.copy(S)},this.getViewport=function(t){return t.copy(A)},this.setViewport=function(t,e,n,i){t.isVector4?A.set(t.x,t.y,t.z,t.w):A.set(t,e,n,i),$.viewport(S.copy(A).multiplyScalar(C).floor())},this.getScissor=function(t){return t.copy(L)},this.setScissor=function(t,e,n,i){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,i),$.scissor(k.copy(L).multiplyScalar(C).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(t){$.setScissorTest(R=t)},this.setOpaqueSort=function(t){I=t},this.setTransparentSort=function(t){P=t},this.getClearColor=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),t=new fo),t.copy(nt.getClearColor())},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,n){var i=0;(void 0===t||t)&&(i|=16384),(void 0===e||e)&&(i|=256),(void 0===n||n)&&(i|=1024),ut.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",vt,!1),e.removeEventListener("webglcontextrestored",mt,!1),Q.dispose(),tt.dispose(),q.dispose(),G.dispose(),Y.dispose(),st.dispose(),ft.dispose(),bt.stop()},this.renderBufferImmediate=function(t,e){st.initAttributes();var n=q.get(t);t.hasPositions&&!n.position&&(n.position=ut.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=ut.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=ut.createBuffer()),t.hasColors&&!n.color&&(n.color=ut.createBuffer());var i=e.getAttributes();t.hasPositions&&(ut.bindBuffer(34962,n.position),ut.bufferData(34962,t.positionArray,35048),st.enableAttribute(i.position),ut.vertexAttribPointer(i.position,3,5126,!1,0,0)),t.hasNormals&&(ut.bindBuffer(34962,n.normal),ut.bufferData(34962,t.normalArray,35048),st.enableAttribute(i.normal),ut.vertexAttribPointer(i.normal,3,5126,!1,0,0)),t.hasUvs&&(ut.bindBuffer(34962,n.uv),ut.bufferData(34962,t.uvArray,35048),st.enableAttribute(i.uv),ut.vertexAttribPointer(i.uv,2,5126,!1,0,0)),t.hasColors&&(ut.bindBuffer(34962,n.color),ut.bufferData(34962,t.colorArray,35048),st.enableAttribute(i.color),ut.vertexAttribPointer(i.color,3,5126,!1,0,0)),st.disableUnusedAttributes(),ut.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,i,r,a){null===e&&(e=B);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=Mt(t,e,i,r);$.setMaterial(i,o);var u=n.index,l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;var c,h=1;!0===i.wireframe&&(u=X.getWireframeAttribute(n),h=2),(i.morphTargets||i.morphNormals)&&it.update(r,n,i,s),st.setup(r,i,s,n,u);var p=rt;null!==u&&(c=Z.get(u),(p=at).setIndex(c));var f=null!==u?u.count:l.count,d=n.drawRange.start*h,v=n.drawRange.count*h,m=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,y=Math.max(d,m),_=Math.min(f,d+v,m+g)-1,b=Math.max(0,_-y+1);if(0!==b){if(r.isMesh)!0===i.wireframe?($.setLineWidth(i.wireframeLinewidth*j()),p.setMode(1)):p.setMode(4);else if(r.isLine){var x=i.linewidth;void 0===x&&(x=1),$.setLineWidth(x*j()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(y,b,r.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(y,b,w)}else p.render(y,b)}},this.compile=function(t,e){(p=tt.get(t)).init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights();var n=new WeakMap;t.traverse((function(e){var i=e.material;if(i)if(Array.isArray(i))for(var r=0;r<i.length;r++){var a=i[r];!1===n.has(a)&&(kt(a,t,e),n.set(a))}else!1===n.has(i)&&(kt(i,t,e),n.set(i))}))};var _t=null;var bt=new Ss;function xt(t,e,n,i){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||D.intersectsSprite(t)){i&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);var r=Y.update(t),a=t.material;a.visible&&h.push(t,r,a,n,N.z,null)}}else if(t.isImmediateRenderObject)i&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F),h.push(t,null,t.material,n,N.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==H.render.frame&&(t.skeleton.update(),t.skeleton.frame=H.render.frame),!t.frustumCulled||D.intersectsObject(t))){i&&N.setFromMatrixPosition(t.matrixWorld).applyMatrix4(F);var o=Y.update(t),s=t.material;if(Array.isArray(s))for(var u=o.groups,l=0,c=u.length;l<c;l++){var f=u[l],d=s[f.materialIndex];d&&d.visible&&h.push(t,o,d,n,N.z,f)}else s.visible&&h.push(t,o,s,n,N.z,null)}for(var v=t.children,m=0,g=v.length;m<g;m++)xt(v[m],e,n,i)}}function wt(t,e,n){for(var i=!0===e.isScene?e.overrideMaterial:null,r=0,a=t.length;r<a;r++){var o=t[r],s=o.object,u=o.geometry,l=null===i?o.material:i,c=o.group;if(n.isArrayCamera)for(var h=n.cameras,f=0,d=h.length;f<d;f++){var v=h[f];s.layers.test(v.layers)&&($.viewport(S.copy(v.viewport)),p.setupLightsView(v),St(s,e,v,u,l,c))}else St(s,e,n,u,l,c)}}function St(t,e,n,i,r,a){if(t.onBeforeRender(d,e,n,i,r,a),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var o=Mt(n,e,r,t);$.setMaterial(r),st.reset(),function(t,e){t.render((function(t){d.renderBufferImmediate(t,e)}))}(t,o)}else d.renderBufferDirect(n,e,i,r,t,a);t.onAfterRender(d,e,n,i,r,a)}function kt(t,e,n){!0!==e.isScene&&(e=B);var i=q.get(t),r=p.state.lights,a=p.state.shadowsArray,o=r.state.version,s=K.getParameters(t,r.state,a,e,n),u=K.getProgramCacheKey(s),l=i.program,c=!0;if(i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=G.get(t.envMap||i.environment),void 0===l)t.addEventListener("dispose",gt);else if(l.cacheKey!==u)yt(t);else if(i.lightsStateVersion!==o)c=!1;else{if(void 0!==s.shaderID)return;c=!1}c&&(s.uniforms=K.getUniforms(t),t.onBeforeCompile(s,d),l=K.acquireProgram(s,u),i.program=l,i.uniforms=s.uniforms,i.outputEncoding=s.outputEncoding);var h=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=et.numPlanes,i.numIntersection=et.numIntersection,h.clippingPlanes=et.uniform),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);var f=i.program.getUniforms(),v=Bu.seqWithValue(f.seq,h);i.uniformsList=v}function Mt(t,e,n,i){!0!==e.isScene&&(e=B),W.resetTextureUnits();var r=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===_?d.outputEncoding:_.texture.encoding,s=G.get(n.envMap||a),u=q.get(n),l=p.state.lights;if(!0===z&&(!0===O||t!==w)){var c=t===w&&n.id===x;et.setState(n,t,c)}n.version===u.__version?n.fog&&u.fog!==r||u.environment!==a||u.needsLights&&u.lightsStateVersion!==l.state.version?kt(n,e,i):void 0===u.numClippingPlanes||u.numClippingPlanes===et.numPlanes&&u.numIntersection===et.numIntersection?(u.outputEncoding!==o||u.envMap!==s)&&kt(n,e,i):kt(n,e,i):(kt(n,e,i),u.__version=n.version);var h,f,v=!1,m=!1,g=!1,y=u.program,b=y.getUniforms(),S=u.uniforms;if($.useProgram(y.program)&&(v=!0,m=!0,g=!0),n.id!==x&&(x=n.id,m=!0),v||w!==t){if(b.setValue(ut,"projectionMatrix",t.projectionMatrix),U.logarithmicDepthBuffer&&b.setValue(ut,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,m=!0,g=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var k=b.map.cameraPosition;void 0!==k&&k.setValue(ut,N.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&b.setValue(ut,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&b.setValue(ut,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){b.setOptional(ut,i,"bindMatrix"),b.setOptional(ut,i,"bindMatrixInverse");var M=i.skeleton;if(M){var T=M.bones;if(U.floatVertexTextures){if(null===M.boneTexture){var I=Math.sqrt(4*T.length);I=Or.ceilPowerOfTwo(I),I=Math.max(I,4);var P=new Float32Array(I*I*4);P.set(M.boneMatrices);var A=new _s(P,I,I,vr,hr);M.boneMatrices=P,M.boneTexture=A,M.boneTextureSize=I}b.setValue(ut,"boneTexture",M.boneTexture,W),b.setValue(ut,"boneTextureSize",M.boneTextureSize)}else b.setOptional(ut,M,"boneMatrices")}}return(m||u.receiveShadow!==i.receiveShadow)&&(u.receiveShadow=i.receiveShadow,b.setValue(ut,"receiveShadow",i.receiveShadow)),m&&(b.setValue(ut,"toneMappingExposure",d.toneMappingExposure),u.needsLights&&(f=g,(h=S).ambientLightColor.needsUpdate=f,h.lightProbe.needsUpdate=f,h.directionalLights.needsUpdate=f,h.directionalLightShadows.needsUpdate=f,h.pointLights.needsUpdate=f,h.pointLightShadows.needsUpdate=f,h.spotLights.needsUpdate=f,h.spotLightShadows.needsUpdate=f,h.rectAreaLights.needsUpdate=f,h.hemisphereLights.needsUpdate=f),r&&n.fog&&J.refreshFogUniforms(S,r),J.refreshMaterialUniforms(S,n,C,E),Bu.upload(ut,u.uniformsList,S,W)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Bu.upload(ut,u.uniformsList,S,W),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&b.setValue(ut,"center",i.center),b.setValue(ut,"modelViewMatrix",i.modelViewMatrix),b.setValue(ut,"normalMatrix",i.normalMatrix),b.setValue(ut,"modelMatrix",i.matrixWorld),y}bt.setAnimationLoop((function(t){ft.isPresenting||_t&&_t(t)})),"undefined"!==typeof window&&bt.setContext(window),this.setAnimationLoop=function(t){_t=t,ft.setAnimationLoop(t),null===t?bt.stop():bt.start()},this.render=function(t,e){var n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0===e||!0===e.isCamera){if(!0!==v){st.resetDefaultState(),x=-1,w=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===ft.enabled&&!0===ft.isPresenting&&(e=ft.getCamera(e)),!0===t.isScene&&t.onBeforeRender(d,t,e,n||_),(p=tt.get(t,f.length)).init(),f.push(p),F.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(F),O=this.localClippingEnabled,z=et.init(this.clippingPlanes,O,e),(h=Q.get(t,e)).init(),xt(t,e,0,d.sortObjects),h.finish(),!0===d.sortObjects&&h.sort(I,P),!0===z&&et.beginShadows();var r=p.state.shadowsArray;dt.render(r,t,e),p.setupLights(),p.setupLightsView(e),!0===z&&et.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),nt.render(h,t,e,i);var a=h.opaque,o=h.transparent;a.length>0&&wt(a,t,e),o.length>0&&wt(o,t,e),!0===t.isScene&&t.onAfterRender(d,t,e),null!==_&&(W.updateRenderTargetMipmap(_),W.updateMultisampleRenderTarget(_)),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1),f.pop(),p=f.length>0?f[f.length-1]:null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){m!==t&&null===_&&ut.bindFramebuffer(36160,t),m=t},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return h},this.setRenderList=function(t){h=t},this.getRenderTarget=function(){return _},this.setRenderTarget=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=t,g=e,y=n,t&&void 0===q.get(t).__webglFramebuffer&&W.setupRenderTarget(t);var i=m,r=!1;if(t){var a=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=a[e],r=!0):i=t.isWebGLMultisampleRenderTarget?q.get(t).__webglMultisampledFramebuffer:a,S.copy(t.viewport),k.copy(t.scissor),M=t.scissorTest}else S.copy(A).multiplyScalar(C).floor(),k.copy(L).multiplyScalar(C).floor(),M=R;if(b!==i&&(ut.bindFramebuffer(36160,i),b=i),$.viewport(S),$.scissor(k),$.setScissorTest(M),r){var o=q.get(t.texture);ut.framebufferTexture2D(36160,36064,34069+e,o.__webglTexture,n)}},this.readRenderTargetPixels=function(t,e,n,i,r,a,o){if(t&&t.isWebGLRenderTarget){var s=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var u=!1;s!==b&&(ut.bindFramebuffer(36160,s),u=!0);try{var l=t.texture,c=l.format,h=l.type;if(c!==vr&&ot.convert(c)!==ut.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var p=h===pr&&(V.has("EXT_color_buffer_half_float")||U.isWebGL2&&V.has("EXT_color_buffer_float"));if(h!==ur&&ot.convert(h)!==ut.getParameter(35738)&&(h!==hr||!(U.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!p)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ut.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&ut.readPixels(e,n,i,r,ot.convert(c),ot.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&ut.bindFramebuffer(36160,b)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(e.image.width*i),a=Math.floor(e.image.height*i),o=ot.convert(e.format);W.setTexture2D(e,0),ut.copyTexImage2D(3553,n,o,t.x,t.y,r,a,0),$.unbindTexture()},this.copyTextureToTexture=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.image.width,a=e.image.height,o=ot.convert(n.format),s=ot.convert(n.type);W.setTexture2D(n,0),ut.pixelStorei(37440,n.flipY),ut.pixelStorei(37441,n.premultiplyAlpha),ut.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?ut.texSubImage2D(3553,i,t.x,t.y,r,a,o,s,e.image.data):e.isCompressedTexture?ut.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):ut.texSubImage2D(3553,i,t.x,t.y,o,s,e.image),0===i&&n.generateMipmaps&&ut.generateMipmap(3553),$.unbindTexture()},this.initTexture=function(t){W.setTexture2D(t,0),$.unbindTexture()},this.resetState=function(){$.reset(),st.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Pl(t){Il.call(this,t)}kl.prototype=Object.assign(Object.create(ds.prototype),{constructor:kl,isArrayCamera:!0}),Ml.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ml,isGroup:!0}),Object.assign(Tl.prototype,{constructor:Tl,getHandSpace:function(){return null===this._hand&&(this._hand=new Ml,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Ml,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Ml,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){var i=null,r=null,a=null,o=this._targetRay,s=this._grip,u=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(u&&t.hand){a=!0;var l,c=wt(t.hand.values());try{for(c.s();!(l=c.n()).done;){var h=l.value,p=e.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var f=new Ml;f.matrixAutoUpdate=!1,f.visible=!1,u.joints[h.jointName]=f,u.add(f)}var d=u.joints[h.jointName];null!==p&&(d.matrix.fromArray(p.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.jointRadius=p.radius),d.visible=null!==p}}catch(Tx){c.e(Tx)}finally{c.f()}var v=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],g=v.position.distanceTo(m.position);u.inputState.pinching&&g>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!u.inputState.pinching&&g<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&null!==(i=e.getPose(t.targetRaySpace,n))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==u&&(u.visible=null!==a),this}}),Object.assign(El.prototype,Ar.prototype),Pl.prototype=Object.assign(Object.create(Il.prototype),{constructor:Pl,isWebGL1Renderer:!0});var Al=function(t){kt(n,t);var e=Mt(n);function n(){var t;return Tt(this,n),t=e.call(this),Object.defineProperty(ft(t),"isScene",{value:!0}),t.type="Scene",t.background=null,t.environment=null,t.fog=null,t.overrideMaterial=null,t.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:ft(t)})),t}return Ct(n,[{key:"copy",value:function(t,e){return xt(mt(n.prototype),"copy",this).call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}},{key:"toJSON",value:function(t){var e=xt(mt(n.prototype),"toJSON",this).call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}]),n}(qa);function Ll(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Cr,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Or.generateUUID()}Object.defineProperty(Ll.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ll.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this},set:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Or.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var e=new Ll(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Or.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var Rl,Dl=new Wr;function zl(t,e,n,i){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}function Ol(t){go.call(this),this.type="SpriteMaterial",this.color=new fo(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.defineProperties(zl.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(zl.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)Dl.x=this.getX(e),Dl.y=this.getY(e),Dl.z=this.getZ(e),Dl.applyMatrix4(t),this.setXYZ(e,Dl.x,Dl.y,Dl.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)e.push(this.data.array[i+r]);return new xo(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new zl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)e.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Ol.prototype=Object.create(go.prototype),Ol.prototype.constructor=Ol,Ol.prototype.isSpriteMaterial=!0,Ol.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var Fl=new Wr,Nl=new Wr,Bl=new Wr,jl=new Fr,Vl=new Fr,Ul=new ba,$l=new Wr,Hl=new Wr,ql=new Wr,Wl=new Fr,Gl=new Fr,Zl=new Fr;function Xl(t){if(qa.call(this),this.type="Sprite",void 0===Rl){Rl=new Uo;var e=new Ll(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Rl.setIndex([0,1,2,0,2,3]),Rl.setAttribute("position",new zl(e,3,0,!1)),Rl.setAttribute("uv",new zl(e,2,3,!1))}this.geometry=Rl,this.material=void 0!==t?t:new Ol,this.center=new Fr(.5,.5)}function Yl(t,e,n,i,r,a){jl.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(Vl.x=a*jl.x-r*jl.y,Vl.y=r*jl.x+a*jl.y):Vl.copy(jl),t.copy(e),t.x+=Vl.x,t.y+=Vl.y,t.applyMatrix4(Ul)}Xl.prototype=Object.assign(Object.create(qa.prototype),{constructor:Xl,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Nl.setFromMatrixScale(this.matrixWorld),Ul.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Bl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Nl.multiplyScalar(-Bl.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;Yl($l.set(-.5,-.5,0),Bl,a,Nl,n,i),Yl(Hl.set(.5,-.5,0),Bl,a,Nl,n,i),Yl(ql.set(.5,.5,0),Bl,a,Nl,n,i),Wl.set(0,0),Gl.set(1,0),Zl.set(1,1);var o=t.ray.intersectTriangle($l,Hl,ql,!1,Fl);if(null!==o||(Yl(Hl.set(-.5,.5,0),Bl,a,Nl,n,i),Gl.set(0,1),null!==(o=t.ray.intersectTriangle($l,ql,Hl,!1,Fl)))){var s=t.ray.origin.distanceTo(Fl);s<t.near||s>t.far||e.push({distance:s,point:Fl.clone(),uv:oo.getUV(Fl,$l,Hl,ql,Wl,Gl,Zl,new Fr),face:null,object:this})}},copy:function(t){return qa.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});var Kl=new Wr,Jl=new Wr;function Ql(){qa.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Ql.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ql,isLOD:!0,copy:function(t){qa.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,i=e.length;n<i;n++){var r=e[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e=Math.abs(e);var n,i=this.levels;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){var n,i;for(n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){Kl.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(Kl);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){Kl.setFromMatrixPosition(t.matrixWorld),Jl.setFromMatrixPosition(this.matrixWorld);var n,i,r=Kl.distanceTo(Jl)/t.zoom;for(e[0].object.visible=!0,n=1,i=e.length;n<i&&r>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)e[n].object.visible=!1}},toJSON:function(t){var e=qa.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var a=n[i];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}});var tc=new Wr,ec=new $r,nc=new $r,ic=new Wr,rc=new ba;function ac(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),os.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ba,this.bindMatrixInverse=new ba}function oc(){qa.call(this),this.type="Bone"}ac.prototype=Object.assign(Object.create(os.prototype),{constructor:ac,isSkinnedMesh:!0,copy:function(t){return os.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new $r,e=this.geometry.attributes.skinWeight,n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){os.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(t,e){var n=this.skeleton,i=this.geometry;ec.fromBufferAttribute(i.attributes.skinIndex,t),nc.fromBufferAttribute(i.attributes.skinWeight,t),tc.fromBufferAttribute(i.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var r=0;r<4;r++){var a=nc.getComponent(r);if(0!==a){var o=ec.getComponent(r);rc.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),e.addScaledVector(ic.copy(tc).applyMatrix4(rc),a)}}return e.applyMatrix4(this.bindMatrixInverse)}}),oc.prototype=Object.assign(Object.create(qa.prototype),{constructor:oc,isBone:!0});var sc=new ba,uc=new ba;function lc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Or.generateUUID(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(lc.prototype,{init:function(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new ba)}},calculateInverses:function(){this.boneInverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var n=new ba;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(var i=0,r=this.bones.length;i<r;i++){var a=this.bones[i];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=t.length;r<a;r++){var o=t[r]?t[r].matrixWorld:uc;sc.multiplyMatrices(o,e[r]),sc.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)},clone:function(){return new lc(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var i=this.bones[e];if(i.name===t)return i}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(t,e){this.uuid=t.uuid;for(var n=0,i=t.bones.length;n<i;n++){var r=t.bones[n],a=e[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new oc),this.bones.push(a),this.boneInverses.push((new ba).fromArray(t.boneInverses[n]))}return this.init(),this},toJSON:function(){var t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var e=this.bones,n=this.boneInverses,i=0,r=e.length;i<r;i++){var a=e[i];t.bones.push(a.uuid);var o=n[i];t.boneInverses.push(o.toArray())}return t}});var cc=new ba,hc=new ba,pc=[],fc=new os;function dc(t,e,n){os.call(this,t,e),this.instanceMatrix=new xo(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function vc(t){go.call(this),this.type="LineBasicMaterial",this.color=new fo(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}dc.prototype=Object.assign(Object.create(os.prototype),{constructor:dc,isInstancedMesh:!0,copy:function(t){return os.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this},getColorAt:function(t,e){e.fromArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var n=this.matrixWorld,i=this.count;if(fc.geometry=this.geometry,fc.material=this.material,void 0!==fc.material)for(var r=0;r<i;r++){this.getMatrixAt(r,cc),hc.multiplyMatrices(n,cc),fc.matrixWorld=hc,fc.raycast(t,pc);for(var a=0,o=pc.length;a<o;a++){var s=pc[a];s.instanceId=r,s.object=this,e.push(s)}pc.length=0}},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new xo(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),vc.prototype=Object.create(go.prototype),vc.prototype.constructor=vc,vc.prototype.isLineBasicMaterial=!0,vc.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};var mc=new Wr,gc=new Wr,yc=new ba,_c=new _a,bc=new ha;function xc(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uo,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new vc;qa.call(this),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}xc.prototype=Object.assign(Object.create(qa.prototype),{constructor:xc,isLine:!0,copy:function(t){return qa.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],i=1,r=e.count;i<r;i++)mc.fromBufferAttribute(e,i-1),gc.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=mc.distanceTo(gc);t.setAttribute("lineDistance",new Po(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(t,e){var n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),bc.copy(n.boundingSphere),bc.applyMatrix4(i),bc.radius+=r,!1!==t.ray.intersectsSphere(bc)){yc.copy(i).invert(),_c.copy(t.ray).applyMatrix4(yc);var a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new Wr,u=new Wr,l=new Wr,c=new Wr,h=this.isLineSegments?2:1;if(n.isBufferGeometry){var p=n.index,f=n.attributes.position;if(null!==p)for(var d=p.array,v=0,m=d.length-1;v<m;v+=h){var g=d[v],y=d[v+1];if(s.fromBufferAttribute(f,g),u.fromBufferAttribute(f,y),!(_c.distanceSqToSegment(s,u,c,l)>o)){c.applyMatrix4(this.matrixWorld);var _=t.ray.origin.distanceTo(c);_<t.near||_>t.far||e.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var b=0,x=f.count-1;b<x;b+=h){if(s.fromBufferAttribute(f,b),u.fromBufferAttribute(f,b+1),!(_c.distanceSqToSegment(s,u,c,l)>o)){c.applyMatrix4(this.matrixWorld);var w=t.ray.origin.distanceTo(c);w<t.near||w>t.far||e.push({distance:w,point:l.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var i=e[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=t.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var wc=new Wr,Sc=new Wr;function kc(t,e){xc.call(this,t,e),this.type="LineSegments"}function Mc(t,e){xc.call(this,t,e),this.type="LineLoop"}function Tc(t){go.call(this),this.type="PointsMaterial",this.color=new fo(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}kc.prototype=Object.assign(Object.create(xc.prototype),{constructor:kc,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[],i=0,r=e.count;i<r;i+=2)wc.fromBufferAttribute(e,i),Sc.fromBufferAttribute(e,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+wc.distanceTo(Sc);t.setAttribute("lineDistance",new Po(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),Mc.prototype=Object.assign(Object.create(xc.prototype),{constructor:Mc,isLineLoop:!0}),Tc.prototype=Object.create(go.prototype),Tc.prototype.constructor=Tc,Tc.prototype.isPointsMaterial=!0,Tc.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var Ec=new ba,Cc=new _a,Ic=new ha,Pc=new Wr;function Ac(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uo,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tc;qa.call(this),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}function Lc(t,e,n,i,r,a,o){var s=Cc.distanceSqToPoint(t);if(s<n){var u=new Wr;Cc.closestPointToPoint(t,u),u.applyMatrix4(i);var l=r.ray.origin.distanceTo(u);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:e,face:null,object:o})}}function Rc(t,e,n,i,r,a,o,s,u){Vr.call(this,t,e,n,i,r,a,o,s,u),this.format=void 0!==o?o:dr,this.minFilter=void 0!==a?a:or,this.magFilter=void 0!==r?r:or,this.generateMipmaps=!1;var l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}function Dc(t,e,n,i,r,a,o,s,u,l,c,h){Vr.call(this,null,a,o,s,u,l,i,r,c,h),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function zc(t,e,n,i,r,a,o,s,u){Vr.call(this,t,e,n,i,r,a,o,s,u),this.needsUpdate=!0}function Oc(t,e,n,i,r,a,o,s,u,l){if((l=void 0!==l?l:mr)!==mr&&l!==gr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===mr&&(n=lr),void 0===n&&l===gr&&(n=fr),Vr.call(this,null,i,r,a,o,s,l,n,u),this.image={width:t,height:e},this.magFilter=void 0!==o?o:ar,this.minFilter=void 0!==s?s:ar,this.flipY=!1,this.generateMipmaps=!1}Ac.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ac,isPoints:!0,copy:function(t){return qa.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){var n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ic.copy(n.boundingSphere),Ic.applyMatrix4(i),Ic.radius+=r,!1!==t.ray.intersectsSphere(Ic)){Ec.copy(i).invert(),Cc.copy(t.ray).applyMatrix4(Ec);var a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isBufferGeometry){var s=n.index,u=n.attributes.position;if(null!==s)for(var l=s.array,c=0,h=l.length;c<h;c++){var p=l[c];Pc.fromBufferAttribute(u,p),Lc(Pc,p,o,i,t,e,this)}else for(var f=0,d=u.count;f<d;f++)Pc.fromBufferAttribute(u,f),Lc(Pc,f,o,i,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var i=e[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=t.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Rc.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Rc,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){var t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Dc.prototype=Object.create(Vr.prototype),Dc.prototype.constructor=Dc,Dc.prototype.isCompressedTexture=!0,zc.prototype=Object.create(Vr.prototype),zc.prototype.constructor=zc,zc.prototype.isCanvasTexture=!0,Oc.prototype=Object.create(Vr.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isDepthTexture=!0;var Fc=function(t){kt(n,t);var e=Mt(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;Tt(this,n),(t=e.call(this)).type="CircleGeometry",t.parameters={radius:i,segments:r,thetaStart:a,thetaLength:o},r=Math.max(3,r);var s=[],u=[],l=[],c=[],h=new Wr,p=new Fr;u.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(var f=0,d=3;f<=r;f++,d+=3){var v=a+f/r*o;h.x=i*Math.cos(v),h.y=i*Math.sin(v),u.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(u[d]/i+1)/2,p.y=(u[d+1]/i+1)/2,c.push(p.x,p.y)}for(var m=1;m<=r;m++)s.push(m,m+1,0);return t.setIndex(s),t.setAttribute("position",new Po(u,3)),t.setAttribute("normal",new Po(l,3)),t.setAttribute("uv",new Po(c,2)),t}return Ct(n)}(Uo);new Wr,new Wr,new Wr,new oo;var Nc=function(t,e,n){n=n||2;var i,r,a,o,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Bc(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,i){var r,a,o,s=[];for(r=0,a=e.length;r<a;r++)(o=Bc(t,e[r]*i,r<a-1?e[r+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),s.push(Yc(o));for(s.sort(Wc),r=0;r<s.length;r++)Gc(s[r],n),n=jc(n,n.next);return n}(t,e,p,n)),t.length>80*n){i=a=t[0],r=o=t[1];for(var d=n;d<h;d+=n)(s=t[d])<i&&(i=s),(u=t[d+1])<r&&(r=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-i,o-r))?1/l:0}return Vc(p,f,n,i,r,l),f};function Bc(t,e,n,i,r){var a,o;if(r===function(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(a=e;a<n;a+=i)o=oh(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=oh(a,t[a],t[a+1],o);return o&&th(o,o.next)&&(sh(o),o=o.next),o}function jc(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!th(i,i.next)&&0!==Qc(i.prev,i,i.next))i=i.next;else{if(sh(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Vc(t,e,n,i,r,a,o){if(t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=Xc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,a,o,s,u,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?$c(t,i,r,a):Uc(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),sh(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Vc(t=Hc(jc(t),e,n),e,n,i,r,a,2):2===o&&qc(t,e,n,i,r,a):Vc(jc(t),e,n,i,r,a,1);break}}}function Uc(t){var e=t.prev,n=t,i=t.next;if(Qc(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Kc(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Qc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function $c(t,e,n,i){var r=t.prev,a=t,o=t.next;if(Qc(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=Xc(s,u,e,n,i),p=Xc(l,c,e,n,i),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&Kc(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Qc(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&Kc(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Qc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Kc(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Qc(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&Kc(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Qc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Hc(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!th(r,a)&&eh(r,i,i.next,a)&&rh(r,a)&&rh(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),sh(i),sh(i.next),i=t=a),i=i.next}while(i!==t);return jc(i)}function qc(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Jc(o,s)){var u=ah(o,s);return o=jc(o,o.next),u=jc(u,u.next),Vc(o,e,n,i,r,a),void Vc(u,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function Wc(t,e){return t.x-e.x}function Gc(t,e){if(e=function(t,e){var n,i=e,r=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n;var u,l=n,c=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&Kc(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(r-i.x),rh(i,t)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&Zc(n,i)))&&(n=i,p=u)),i=i.next}while(i!==l);return n}(t,e),e){var n=ah(e,t);jc(e,e.next),jc(n,n.next)}}function Zc(t,e){return Qc(t.prev,t,e.prev)<0&&Qc(e.next,t,t.next)<0}function Xc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yc(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Kc(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function Jc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&eh(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(rh(t,e)&&rh(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Qc(t.prev,t,e.prev)||Qc(t,e.prev,e))||th(t,e)&&Qc(t.prev,t,t.next)>0&&Qc(e.prev,e,e.next)>0)}function Qc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function th(t,e){return t.x===e.x&&t.y===e.y}function eh(t,e,n,i){var r=ih(Qc(t,e,n)),a=ih(Qc(t,e,i)),o=ih(Qc(n,i,t)),s=ih(Qc(n,i,e));return r!==a&&o!==s||(!(0!==r||!nh(t,n,e))||(!(0!==a||!nh(t,i,e))||(!(0!==o||!nh(n,t,i))||!(0!==s||!nh(n,e,i)))))}function nh(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ih(t){return t>0?1:t<0?-1:0}function rh(t,e){return Qc(t.prev,t,t.next)<0?Qc(t,e,t.next)>=0&&Qc(t,t.prev,e)>=0:Qc(t,e,t.prev)<0||Qc(t,t.next,e)<0}function ah(t,e){var n=new uh(t.i,t.x,t.y),i=new uh(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function oh(t,e,n,i){var r=new uh(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function sh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function uh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var lh={area:function(t){for(var e=t.length,n=0,i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},isClockWise:function(t){return lh.area(t)<0},triangulateShape:function(t,e){var n=[],i=[],r=[];ch(t),hh(n,t);var a=t.length;e.forEach(ch);for(var o=0;o<e.length;o++)i.push(a),a+=e[o].length,hh(n,e[o]);for(var s=Nc(n,i),u=0;u<s.length;u+=3)r.push(s.slice(u,u+3));return r}};function ch(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function hh(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}var ph=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;Tt(this,n),(r=e.call(this)).type="ExtrudeGeometry",r.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];for(var a=ft(r),o=[],s=[],u=0,l=t.length;u<l;u++){c(t[u])}function c(t){var e=[],n=void 0!==i.curveSegments?i.curveSegments:12,r=void 0!==i.steps?i.steps:1,u=void 0!==i.depth?i.depth:100,l=void 0===i.bevelEnabled||i.bevelEnabled,c=void 0!==i.bevelThickness?i.bevelThickness:6,h=void 0!==i.bevelSize?i.bevelSize:c-2,p=void 0!==i.bevelOffset?i.bevelOffset:0,f=void 0!==i.bevelSegments?i.bevelSegments:3,d=i.extrudePath,v=void 0!==i.UVGenerator?i.UVGenerator:fh;void 0!==i.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=i.amount);var m,g,y,_,b,x=!1;d&&(m=d.getSpacedPoints(r),x=!0,l=!1,g=d.computeFrenetFrames(r,!1),y=new Wr,_=new Wr,b=new Wr),l||(f=0,c=0,h=0,p=0);var w=t.extractPoints(n),S=w.shape,k=w.holes;if(!lh.isClockWise(S)){S=S.reverse();for(var M=0,T=k.length;M<T;M++){var E=k[M];lh.isClockWise(E)&&(k[M]=E.reverse())}}for(var C=lh.triangulateShape(S,k),I=S,P=0,A=k.length;P<A;P++){var L=k[P];S=S.concat(L)}function R(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}var D=S.length,z=C.length;function O(t,e,n){var i,r,a,o=t.x-e.x,s=t.y-e.y,u=n.x-t.x,l=n.y-t.y,c=o*o+s*s,h=o*l-s*u;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(c),f=Math.sqrt(u*u+l*l),d=e.x-s/p,v=e.y+o/p,m=((n.x-l/f-d)*l-(n.y+u/f-v)*u)/(o*l-s*u),g=(i=d+o*m-t.x)*i+(r=v+s*m-t.y)*r;if(g<=2)return new Fr(i,r);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?u>Number.EPSILON&&(y=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new Fr(i/a,r/a)}for(var F=[],N=0,B=I.length,j=B-1,V=N+1;N<B;N++,j++,V++)j===B&&(j=0),V===B&&(V=0),F[N]=O(I[N],I[j],I[V]);for(var U,$=[],H=F.concat(),q=0,W=k.length;q<W;q++){var G=k[q];U=[];for(var Z=0,X=G.length,Y=X-1,K=Z+1;Z<X;Z++,Y++,K++)Y===X&&(Y=0),K===X&&(K=0),U[Z]=O(G[Z],G[Y],G[K]);$.push(U),H=H.concat(U)}for(var J=0;J<f;J++){for(var Q=J/f,tt=c*Math.cos(Q*Math.PI/2),et=h*Math.sin(Q*Math.PI/2)+p,nt=0,it=I.length;nt<it;nt++){var rt=R(I[nt],F[nt],et);At(rt.x,rt.y,-tt)}for(var at=0,ot=k.length;at<ot;at++){var st=k[at];U=$[at];for(var ut=0,lt=st.length;ut<lt;ut++){var ct=R(st[ut],U[ut],et);At(ct.x,ct.y,-tt)}}}for(var ht=h+p,pt=0;pt<D;pt++){var ft=l?R(S[pt],H[pt],ht):S[pt];x?(_.copy(g.normals[0]).multiplyScalar(ft.x),y.copy(g.binormals[0]).multiplyScalar(ft.y),b.copy(m[0]).add(_).add(y),At(b.x,b.y,b.z)):At(ft.x,ft.y,0)}for(var dt=1;dt<=r;dt++)for(var vt=0;vt<D;vt++){var mt=l?R(S[vt],H[vt],ht):S[vt];x?(_.copy(g.normals[dt]).multiplyScalar(mt.x),y.copy(g.binormals[dt]).multiplyScalar(mt.y),b.copy(m[dt]).add(_).add(y),At(b.x,b.y,b.z)):At(mt.x,mt.y,u/r*dt)}for(var gt=f-1;gt>=0;gt--){for(var yt=gt/f,_t=c*Math.cos(yt*Math.PI/2),bt=h*Math.sin(yt*Math.PI/2)+p,xt=0,wt=I.length;xt<wt;xt++){var St=R(I[xt],F[xt],bt);At(St.x,St.y,u+_t)}for(var kt=0,Mt=k.length;kt<Mt;kt++){var Tt=k[kt];U=$[kt];for(var Et=0,Ct=Tt.length;Et<Ct;Et++){var It=R(Tt[Et],U[Et],bt);x?At(It.x,It.y+m[r-1].y,m[r-1].x+_t):At(It.x,It.y,u+_t)}}}function Pt(t,e){for(var n=t.length;--n>=0;){var i=n,a=n-1;a<0&&(a=t.length-1);for(var o=0,s=r+2*f;o<s;o++){var u=D*o,l=D*(o+1);Rt(e+i+u,e+a+u,e+a+l,e+i+l)}}}function At(t,n,i){e.push(t),e.push(n),e.push(i)}function Lt(t,e,n){Dt(t),Dt(e),Dt(n);var i=o.length/3,r=v.generateTopUV(a,o,i-3,i-2,i-1);zt(r[0]),zt(r[1]),zt(r[2])}function Rt(t,e,n,i){Dt(t),Dt(e),Dt(i),Dt(e),Dt(n),Dt(i);var r=o.length/3,s=v.generateSideWallUV(a,o,r-6,r-3,r-2,r-1);zt(s[0]),zt(s[1]),zt(s[3]),zt(s[1]),zt(s[2]),zt(s[3])}function Dt(t){o.push(e[3*t+0]),o.push(e[3*t+1]),o.push(e[3*t+2])}function zt(t){s.push(t.x),s.push(t.y)}!function(){var t=o.length/3;if(l){for(var e=0,n=D*e,i=0;i<z;i++){var s=C[i];Lt(s[2]+n,s[1]+n,s[0]+n)}n=D*(e=r+2*f);for(var u=0;u<z;u++){var c=C[u];Lt(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<z;h++){var p=C[h];Lt(p[2],p[1],p[0])}for(var d=0;d<z;d++){var v=C[d];Lt(v[0]+D*r,v[1]+D*r,v[2]+D*r)}}a.addGroup(t,o.length/3-t,0)}(),function(){var t=o.length/3,e=0;Pt(I,e),e+=I.length;for(var n=0,i=k.length;n<i;n++){var r=k[n];Pt(r,e),e+=r.length}a.addGroup(t,o.length/3-t,1)}()}return r.setAttribute("position",new Po(o,3)),r.setAttribute("uv",new Po(s,2)),r.computeVertexNormals(),r}return Ct(n,[{key:"toJSON",value:function(){var t=Uo.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(var i=0,r=t.length;i<r;i++){var a=t[i];n.shapes.push(a.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}}]),n}(Uo),fh={generateTopUV:function(t,e,n,i,r){var a=e[3*n],o=e[3*n+1],s=e[3*i],u=e[3*i+1],l=e[3*r],c=e[3*r+1];return[new Fr(a,o),new Fr(s,u),new Fr(l,c)]},generateSideWallUV:function(t,e,n,i,r,a){var o=e[3*n],s=e[3*n+1],u=e[3*n+2],l=e[3*i],c=e[3*i+1],h=e[3*i+2],p=e[3*r],f=e[3*r+1],d=e[3*r+2],v=e[3*a],m=e[3*a+1],g=e[3*a+2];return Math.abs(s-c)<.01?[new Fr(o,1-u),new Fr(l,1-h),new Fr(p,1-d),new Fr(v,1-g)]:[new Fr(s,1-u),new Fr(c,1-h),new Fr(f,1-d),new Fr(m,1-g)]}};function dh(t,e,n){Uo.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n};var i=[],r=[],a=[],o=[],s=1e-5,u=new Wr,l=new Wr,c=new Wr,h=new Wr,p=new Wr;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var f=e+1,d=0;d<=n;d++)for(var v=d/n,m=0;m<=e;m++){var g=m/e;t(g,v,l),r.push(l.x,l.y,l.z),g-s>=0?(t(g-s,v,c),h.subVectors(l,c)):(t(g+s,v,c),h.subVectors(c,l)),v-s>=0?(t(g,v-s,c),p.subVectors(l,c)):(t(g,v+s,c),p.subVectors(c,l)),u.crossVectors(h,p).normalize(),a.push(u.x,u.y,u.z),o.push(g,v)}for(var y=0;y<n;y++)for(var _=0;_<e;_++){var b=y*f+_,x=y*f+_+1,w=(y+1)*f+_+1,S=(y+1)*f+_;i.push(b,x,S),i.push(x,w,S)}this.setIndex(i),this.setAttribute("position",new Po(r,3)),this.setAttribute("normal",new Po(a,3)),this.setAttribute("uv",new Po(o,2))}dh.prototype=Object.create(Uo.prototype),dh.prototype.constructor=dh;var vh=function(t){kt(n,t);var e=Mt(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Tt(this,n),(i=e.call(this)).type="ShapeGeometry",i.parameters={shapes:t,curveSegments:r};var a=[],o=[],s=[],u=[],l=0,c=0;if(!1===Array.isArray(t))p(t);else for(var h=0;h<t.length;h++)p(t[h]),i.addGroup(l,c,h),l+=c,c=0;function p(t){var e=o.length/3,n=t.extractPoints(r),i=n.shape,l=n.holes;!1===lh.isClockWise(i)&&(i=i.reverse());for(var h=0,p=l.length;h<p;h++){var f=l[h];!0===lh.isClockWise(f)&&(l[h]=f.reverse())}for(var d=lh.triangulateShape(i,l),v=0,m=l.length;v<m;v++){var g=l[v];i=i.concat(g)}for(var y=0,_=i.length;y<_;y++){var b=i[y];o.push(b.x,b.y,0),s.push(0,0,1),u.push(b.x,b.y)}for(var x=0,w=d.length;x<w;x++){var S=d[x],k=S[0]+e,M=S[1]+e,T=S[2]+e;a.push(k,M,T),c+=3}}return i.setIndex(a),i.setAttribute("position",new Po(o,3)),i.setAttribute("normal",new Po(s,3)),i.setAttribute("uv",new Po(u,2)),i}return Ct(n,[{key:"toJSON",value:function(){var t=Uo.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++){var r=t[n];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}]),n}(Uo);var mh=function(t){kt(n,t);var e=Mt(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;Tt(this,n),(t=e.call(this)).type="SphereGeometry",t.parameters={radius:i,widthSegments:r,heightSegments:a,phiStart:o,phiLength:s,thetaStart:u,thetaLength:l},r=Math.max(3,Math.floor(r)),a=Math.max(2,Math.floor(a));for(var c=Math.min(u+l,Math.PI),h=0,p=[],f=new Wr,d=new Wr,v=[],m=[],g=[],y=[],_=0;_<=a;_++){var b=[],x=_/a,w=0;0==_&&0==u?w=.5/r:_==a&&c==Math.PI&&(w=-.5/r);for(var S=0;S<=r;S++){var k=S/r;f.x=-i*Math.cos(o+k*s)*Math.sin(u+x*l),f.y=i*Math.cos(u+x*l),f.z=i*Math.sin(o+k*s)*Math.sin(u+x*l),m.push(f.x,f.y,f.z),d.copy(f).normalize(),g.push(d.x,d.y,d.z),y.push(k+w,1-x),b.push(h++)}p.push(b)}for(var M=0;M<a;M++)for(var T=0;T<r;T++){var E=p[M][T+1],C=p[M][T],I=p[M+1][T],P=p[M+1][T+1];(0!==M||u>0)&&v.push(E,C,P),(M!==a-1||c<Math.PI)&&v.push(C,I,P)}return t.setIndex(v),t.setAttribute("position",new Po(m,3)),t.setAttribute("normal",new Po(g,3)),t.setAttribute("uv",new Po(y,2)),t}return Ct(n)}(Uo);function gh(t){go.call(this),this.type="ShadowMaterial",this.color=new fo(0),this.transparent=!0,this.setValues(t)}function yh(t){ps.call(this,t),this.type="RawShaderMaterial"}function _h(t){go.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fo(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Fr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function bh(t){_h.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Fr(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Or.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function xh(t){go.call(this),this.type="MeshPhongMaterial",this.color=new fo(16777215),this.specular=new fo(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Fr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function wh(t){go.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new fo(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Fr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Sh(t){go.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Fr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function kh(t){go.call(this),this.type="MeshLambertMaterial",this.color=new fo(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fo(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Mh(t){go.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new fo(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Fr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Th(t){vc.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}gh.prototype=Object.create(go.prototype),gh.prototype.constructor=gh,gh.prototype.isShadowMaterial=!0,gh.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this},yh.prototype=Object.create(ps.prototype),yh.prototype.constructor=yh,yh.prototype.isRawShaderMaterial=!0,_h.prototype=Object.create(go.prototype),_h.prototype.constructor=_h,_h.prototype.isMeshStandardMaterial=!0,_h.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},bh.prototype=Object.create(_h.prototype),bh.prototype.constructor=bh,bh.prototype.isMeshPhysicalMaterial=!0,bh.prototype.copy=function(t){return _h.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new fo).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},xh.prototype=Object.create(go.prototype),xh.prototype.constructor=xh,xh.prototype.isMeshPhongMaterial=!0,xh.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},wh.prototype=Object.create(go.prototype),wh.prototype.constructor=wh,wh.prototype.isMeshToonMaterial=!0,wh.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Sh.prototype=Object.create(go.prototype),Sh.prototype.constructor=Sh,Sh.prototype.isMeshNormalMaterial=!0,Sh.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},kh.prototype=Object.create(go.prototype),kh.prototype.constructor=kh,kh.prototype.isMeshLambertMaterial=!0,kh.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Mh.prototype=Object.create(go.prototype),Mh.prototype.constructor=Mh,Mh.prototype.isMeshMatcapMaterial=!0,Mh.prototype.copy=function(t){return go.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Th.prototype=Object.create(vc.prototype),Th.prototype.constructor=Th,Th.prototype.isLineDashedMaterial=!0,Th.prototype.copy=function(t){return vc.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Eh=Object.freeze({__proto__:null,ShadowMaterial:gh,SpriteMaterial:Ol,RawShaderMaterial:yh,ShaderMaterial:ps,PointsMaterial:Tc,MeshPhysicalMaterial:bh,MeshStandardMaterial:_h,MeshPhongMaterial:xh,MeshToonMaterial:wh,MeshNormalMaterial:Sh,MeshLambertMaterial:kh,MeshDepthMaterial:yl,MeshDistanceMaterial:_l,MeshBasicMaterial:yo,MeshMatcapMaterial:Mh,LineDashedMaterial:Th,LineBasicMaterial:vc,Material:go}),Ch={arraySlice:function(t,e,n){return Ch.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),i=0;i!==e;++i)n[i]=i;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var i=t.length,r=new t.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*e,u=0;u!==e;++u)r[o++]=t[s+u];return r},flattenJSON:function(t,e,n,i){for(var r=1,a=t[0];void 0!==a&&void 0===a[i];)a=t[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(e.push(a.time),n.push.apply(n,o)),a=t[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(e.push(a.time),o.toArray(n,n.length)),a=t[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(e.push(a.time),n.push(o)),a=t[r++]}while(void 0!==a)}},subclip:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=t.clone();a.name=e;for(var o=[],s=0;s<a.tracks.length;++s){for(var u=a.tracks[s],l=u.getValueSize(),c=[],h=[],p=0;p<u.times.length;++p){var f=u.times[p]*r;if(!(f<n||f>=i)){c.push(u.times[p]);for(var d=0;d<l;++d)h.push(u.values[p*l+d])}}0!==c.length&&(u.times=Ch.convertArray(c,u.times.constructor),u.values=Ch.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;for(var v=1/0,m=0;m<a.tracks.length;++m)v>a.tracks[m].times[0]&&(v=a.tracks[m].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*v);return a.resetDuration(),a},makeClipAdditive:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);for(var r=n.tracks.length,a=e/i,o=function(e){var i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)return"continue";var o=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===r}));if(void 0===o)return"continue";var s=0,u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);var l=0,c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);var h=i.times.length-1,p=void 0;if(a<=i.times[0]){var f=s,d=u-s;p=Ch.arraySlice(i.values,f,d)}else if(a>=i.times[h]){var v=h*u+s,m=v+u-s;p=Ch.arraySlice(i.values,v,m)}else{var g=i.createInterpolant(),y=s,_=u-s;g.evaluate(a),p=Ch.arraySlice(g.resultBuffer,y,_)}"quaternion"===r&&(new qr).fromArray(p).normalize().conjugate().toArray(p);for(var b=o.times.length,x=0;x<b;++x){var w=x*c+l;if("quaternion"===r)qr.multiplyQuaternionsFlat(o.values,w,p,0,o.values,w);else for(var S=c-2*l,k=0;k<S;++k)o.values[w+k]-=p[k]}},s=0;s<r;++s)o(s);return t.blendMode=Mr,t}};function Ih(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function Ph(t,e,n,i){Ih.call(this,t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Ah(t,e,n,i){Ih.call(this,t,e,n,i)}function Lh(t,e,n,i){Ih.call(this,t,e,n,i)}function Rh(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ch.convertArray(e,this.TimeBufferType),this.values=Ch.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Dh(t,e,n){Rh.call(this,t,e,n)}function zh(t,e,n,i){Rh.call(this,t,e,n,i)}function Oh(t,e,n,i){Rh.call(this,t,e,n,i)}function Fh(t,e,n,i){Ih.call(this,t,e,n,i)}function Nh(t,e,n,i){Rh.call(this,t,e,n,i)}function Bh(t,e,n,i){Rh.call(this,t,e,n,i)}function jh(t,e,n,i){Rh.call(this,t,e,n,i)}function Vh(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:kr;this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Or.generateUUID(),this.duration<0&&this.resetDuration()}function Uh(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Oh;case"vector":case"vector2":case"vector3":case"vector4":return jh;case"color":return zh;case"quaternion":return Nh;case"bool":case"boolean":return Dh;case"string":return Bh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var n=[],i=[];Ch.flattenJSON(t.keys,n,i,"value"),t.times=n,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(Ih.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{var a;n:{i:if(!(t<i)){for(var o=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===o)break;if(r=i,t<(i=e[++n]))break e}a=e.length;break n}if(t>=r)break t;var s=e[1];t<s&&(n=2,r=s);for(var u=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===u)break;if(i=r,t>=(r=e[--n-1]))break e}a=n,n=0}for(;n<a;){var l=n+a>>>1;t<e[l]?a=l:n=l+1}if(i=e[n],void 0===(r=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i,a=0;a!==i;++a)e[a]=n[r+a];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ih.prototype,{beforeStart_:Ih.prototype.copySampleValue_,afterEnd_:Ih.prototype.copySampleValue_}),Ph.prototype=Object.assign(Object.create(Ih.prototype),{constructor:Ph,DefaultSettings_:{endingStart:xr,endingEnd:xr},intervalChanged_:function(t,e,n){var i=this.parameterPositions,r=t-2,a=t+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case wr:r=t,o=2*e-n;break;case Sr:o=e+i[r=i.length-2]-i[r+1];break;default:r=t,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case wr:a=t,s=2*n-e;break;case Sr:a=1,s=n+i[1]-i[0];break;default:a=t-1,s=e}var u=.5*(n-e),l=this.valueSize;this._weightPrev=u/(e-o),this._weightNext=u/(s-n),this._offsetPrev=r*l,this._offsetNext=a*l},interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,f=(n-e)/(i-e),d=f*f,v=d*f,m=-h*v+2*h*d-h*f,g=(1+h)*v+(-1.5-2*h)*d+(-.5+h)*f+1,y=(-1-p)*v+(1.5+p)*d+.5*f,_=p*v-p*d,b=0;b!==o;++b)r[b]=m*a[l+b]+g*a[u+b]+y*a[s+b]+_*a[c+b];return r}}),Ah.prototype=Object.assign(Object.create(Ih.prototype),{constructor:Ah,interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,u=s-o,l=(n-e)/(i-e),c=1-l,h=0;h!==o;++h)r[h]=a[u+h]*c+a[s+h]*l;return r}}),Lh.prototype=Object.assign(Object.create(Ih.prototype),{constructor:Lh,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Rh,{toJSON:function(t){var e,n=t.constructor;if(void 0!==n.toJSON)e=n.toJSON(t);else{e={name:t.name,times:Ch.convertArray(t.times,Array),values:Ch.convertArray(t.values,Array)};var i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e}}),Object.assign(Rh.prototype,{constructor:Rh,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:_r,InterpolantFactoryMethodDiscrete:function(t){return new Lh(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Ah(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Ph(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case yr:e=this.InterpolantFactoryMethodDiscrete;break;case _r:e=this.InterpolantFactoryMethodLinear;break;case br:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return yr;case this.InterpolantFactoryMethodLinear:return _r;case this.InterpolantFactoryMethodSmooth:return br}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,i=e.length;n!==i;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,i=e.length;n!==i;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<t;)++r;for(;-1!==a&&n[a]>e;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Ch.arraySlice(n,r,a),this.values=Ch.arraySlice(this.values,r*o,a*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),t=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),t=!1;break}a=s}if(void 0!==i&&Ch.isTypedArray(i))for(var u=0,l=i.length;u!==l;++u){var c=i[u];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,c),t=!1;break}}return t},optimize:function(){for(var t=Ch.arraySlice(this.times),e=Ch.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===br,r=t.length-1,a=1,o=1;o<r;++o){var s=!1,u=t[o];if(u!==t[o+1]&&(1!==o||u!==t[0]))if(i)s=!0;else for(var l=o*n,c=l-n,h=l+n,p=0;p!==n;++p){var f=e[l+p];if(f!==e[c+p]||f!==e[h+p]){s=!0;break}}if(s){if(o!==a){t[a]=t[o];for(var d=o*n,v=a*n,m=0;m!==n;++m)e[v+m]=e[d+m]}++a}}if(r>0){t[a]=t[r];for(var g=r*n,y=a*n,_=0;_!==n;++_)e[y+_]=e[g+_];++a}return a!==t.length?(this.times=Ch.arraySlice(t,0,a),this.values=Ch.arraySlice(e,0,a*n)):(this.times=t,this.values=e),this},clone:function(){var t=Ch.arraySlice(this.times,0),e=Ch.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}),Dh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Dh,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:yr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),zh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:zh,ValueTypeName:"color"}),Oh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Oh,ValueTypeName:"number"}),Fh.prototype=Object.assign(Object.create(Ih.prototype),{constructor:Fh,interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-e)/(i-e),u=t*o,l=u+o;u!==l;u+=4)qr.slerpFlat(r,0,a,u-o,a,u,s);return r}}),Nh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Nh,ValueTypeName:"quaternion",DefaultInterpolation:_r,InterpolantFactoryMethodLinear:function(t){return new Fh(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Bh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Bh,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:yr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),jh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:jh,ValueTypeName:"vector"}),Object.assign(Vh,{parse:function(t){for(var e=[],n=t.tracks,i=1/(t.fps||1),r=0,a=n.length;r!==a;++r)e.push(Uh(n[r]).scale(i));var o=new Vh(t.name,t.duration,e,t.blendMode);return o.uuid=t.uuid,o},toJSON:function(t){for(var e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},r=0,a=n.length;r!==a;++r)e.push(Rh.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(t,e,n,i){for(var r=e.length,a=[],o=0;o<r;o++){var s=[],u=[];s.push((o+r-1)%r,o,(o+1)%r),u.push(0,1,0);var l=Ch.getKeyframeOrder(s);s=Ch.sortedArray(s,1,l),u=Ch.sortedArray(u,1,l),i||0!==s[0]||(s.push(r),u.push(u[0])),a.push(new Oh(".morphTargetInfluences["+e[o].name+"]",s,u).scale(1/n))}return new Vh(t,-1,a)},findByName:function(t,e){var n=t;if(!Array.isArray(t)){var i=t;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],u=s.name.match(r);if(u&&u.length>1){var l=u[1],c=i[l];c||(i[l]=c=[]),c.push(s)}}var h=[];for(var p in i)h.push(Vh.CreateFromMorphTargetSequence(p,i[p],e,n));return h},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,i,r){if(0!==n.length){var a=[],o=[];Ch.flattenJSON(n,a,o,i),0!==a.length&&r.push(new t(e,a,o))}},i=[],r=t.name||"default",a=t.fps||30,o=t.blendMode,s=t.length||-1,u=t.hierarchy||[],l=0;l<u.length;l++){var c=u[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},p=void 0;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(var f=0;f<c[p].morphTargets.length;f++)h[c[p].morphTargets[f]]=-1;for(var d in h){for(var v=[],m=[],g=0;g!==c[p].morphTargets.length;++g){var y=c[p];v.push(y.time),m.push(y.morphTarget===d?1:0)}i.push(new Oh(".morphTargetInfluence["+d+"]",v,m))}s=h.length*(a||1)}else{var _=".bones["+e[l].name+"]";n(jh,_+".position",c,"pos",i),n(Nh,_+".quaternion",c,"rot",i),n(jh,_+".scale",c,"scl",i)}}return 0===i.length?null:new Vh(r,s,i,o)}}),Object.assign(Vh.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Vh(this.name,this.duration,t,this.blendMode)},toJSON:function(){return Vh.toJSON(this)}});var $h={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};var Hh=new function(t,e,n){var i=this,r=!1,a=0,o=0,s=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===r&&void 0!==i.onStart&&i.onStart(t,a,o),r=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return u.push(t,e),this},this.removeHandler=function(t){var e=u.indexOf(t);return-1!==e&&u.splice(e,2),this},this.getHandler=function(t){for(var e=0,n=u.length;e<n;e+=2){var i=u[e],r=u[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return r}return null}};function qh(t){this.manager=void 0!==t?t:Hh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(qh.prototype,{load:function(){},loadAsync:function(t,e){var n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var Wh={};function Gh(t){qh.call(this,t)}function Zh(t){qh.call(this,t)}function Xh(t){qh.call(this,t)}function Yh(t){qh.call(this,t)}function Kh(t){qh.call(this,t)}function Jh(t){qh.call(this,t)}function Qh(t){qh.call(this,t)}function tp(){this.type="Curve",this.arcLengthDivisions=200}function ep(t,e,n,i,r,a,o,s){tp.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function np(t,e,n,i,r,a){ep.call(this,t,e,n,n,i,r,a),this.type="ArcCurve"}function ip(){var t=0,e=0,n=0,i=0;function r(r,a,o,s){t=r,e=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(t,e,n,i,a){r(e,n,a*(n-t),a*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,a,o,s){var u=(e-t)/a-(n-t)/(a+o)+(n-e)/o,l=(n-e)/o-(i-e)/(o+s)+(i-n)/s;r(e,n,u*=o,l*=o)},calc:function(r){var a=r*r;return t+e*r+n*a+i*(a*r)}}}Gh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Gh,load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,a=$h.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout((function(){e&&e(a),r.manager.itemEnd(t)}),0),a;if(void 0===Wh[t]){var o,s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var u=s[1],l=!!s[2],c=s[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var h,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":for(var f=new Uint8Array(c.length),d=0;d<c.length;d++)f[d]=c.charCodeAt(d);h="blob"===p?new Blob([f.buffer],{type:u}):f.buffer;break;case"document":var v=new DOMParser;h=v.parseFromString(c,u);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout((function(){e&&e(h),r.manager.itemEnd(t)}),0)}catch(g){setTimeout((function(){i&&i(g),r.manager.itemError(t),r.manager.itemEnd(t)}),0)}}else{for(var m in Wh[t]=[],Wh[t].push({onLoad:e,onProgress:n,onError:i}),(o=new XMLHttpRequest).open("GET",t,!0),o.addEventListener("load",(function(e){var n=this.response,i=Wh[t];if(delete Wh[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),$h.add(t,n);for(var a=0,o=i.length;a<o;a++){var s=i[a];s.onLoad&&s.onLoad(n)}r.manager.itemEnd(t)}else{for(var u=0,l=i.length;u<l;u++){var c=i[u];c.onError&&c.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}}),!1),o.addEventListener("progress",(function(e){for(var n=Wh[t],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(e)}}),!1),o.addEventListener("error",(function(e){var n=Wh[t];delete Wh[t];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),o.addEventListener("abort",(function(e){var n=Wh[t];delete Wh[t];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)o.setRequestHeader(m,this.requestHeader[m]);o.send(null)}return r.manager.itemStart(t),o}Wh[t].push({onLoad:e,onProgress:n,onError:i})},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Zh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Zh,load:function(t,e,n,i){var r=this,a=new Gh(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(t)}}),n,i)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var i=Vh.parse(t[n]);e.push(i)}return e}}),Xh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Xh,load:function(t,e,n,i){var r=this,a=[],o=new Dc,s=new Gh(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials);var u=0;function l(l){s.load(t[l],(function(t){var n=r.parse(t,!0);a[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(o.minFilter=or),o.image=a,o.format=n.format,o.needsUpdate=!0,e&&e(o))}),n,i)}if(Array.isArray(t))for(var c=0,h=t.length;c<h;++c)l(c);else s.load(t,(function(t){var n=r.parse(t,!0);if(n.isCubemap){for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var u=0;u<n.mipmapCount;u++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+u]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=or),o.format=n.format,o.needsUpdate=!0,e&&e(o)}),n,i);return o}}),Yh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Yh,load:function(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,a=$h.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout((function(){e&&e(a),r.manager.itemEnd(t)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),$h.add(t,this),e&&e(this),r.manager.itemEnd(t)}function u(e){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}),Kh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Kh,load:function(t,e,n,i){var r=new gs,a=new Yh(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(t[n],(function(t){r.images[n]=t,6===++o&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(var u=0;u<t.length;++u)s(u);return r}}),Jh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Jh,load:function(t,e,n,i){var r=this,a=new _s,o=new Gh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,(function(t){var n=r.parse(t);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:ir,a.wrapT=void 0!==n.wrapT?n.wrapT:ir,a.magFilter=void 0!==n.magFilter?n.magFilter:or,a.minFilter=void 0!==n.minFilter?n.minFilter:or,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=sr),1===n.mipmapCount&&(a.minFilter=or),a.needsUpdate=!0,e&&e(a,n))}),n,i),a}}),Qh.prototype=Object.assign(Object.create(qh.prototype),{constructor:Qh,load:function(t,e,n,i){var r=new Vr,a=new Yh(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(n){r.image=n;var i=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=i?dr:vr,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}),Object.assign(tp.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=t;a++)r+=(e=this.getPoint(a/t)).distanceTo(i),n.push(r),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n,i=this.getLengths(),r=0,a=i.length;n=e||t*i[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=i[r=Math.floor(s+(u-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){u=r;break}u=r-1}if(i[r=u]===n)return r/(a-1);var l=i[r];return(r+(n-l)/(i[r+1]-l))/(a-1)},getTangent:function(t,e){var n=1e-4,i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=e||(a.isVector2?new Fr:new Wr);return s.copy(o).sub(a).normalize(),s},getTangentAt:function(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e)},computeFrenetFrames:function(t,e){for(var n=new Wr,i=[],r=[],a=[],o=new Wr,s=new ba,u=0;u<=t;u++){var l=u/t;i[u]=this.getTangentAt(l,new Wr),i[u].normalize()}r[0]=new Wr,a[0]=new Wr;var c=Number.MAX_VALUE,h=Math.abs(i[0].x),p=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),p<=c&&(c=p,n.set(0,1,0)),f<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var d=1;d<=t;d++){if(r[d]=r[d-1].clone(),a[d]=a[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(Or.clamp(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(s.makeRotationAxis(o,v))}a[d].crossVectors(i[d],r[d])}if(!0===e){var m=Math.acos(Or.clamp(r[0].dot(r[t]),-1,1));m/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(m=-m);for(var g=1;g<=t;g++)r[g].applyMatrix4(s.makeRotationAxis(i[g],m*g)),a[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),ep.prototype=Object.create(tp.prototype),ep.prototype.constructor=ep,ep.prototype.isEllipseCurve=!0,ep.prototype.getPoint=function(t,e){for(var n=e||new Fr,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+t*r,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,p=u-this.aY;s=h*l-p*c+this.aX,u=h*c+p*l+this.aY}return n.set(s,u)},ep.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ep.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},ep.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},np.prototype=Object.create(ep.prototype),np.prototype.constructor=np,np.prototype.isArcCurve=!0;var rp=new Wr,ap=new ip,op=new ip,sp=new ip;function up(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;tp.call(this),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}function lp(t,e,n,i,r){var a=.5*(i-e),o=.5*(r-n),s=t*t;return(2*n-2*i+a+o)*(t*s)+(-3*n+3*i-2*a-o)*s+a*t+n}function cp(t,e,n,i){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function hp(t,e,n,i,r){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}function pp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fr,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Fr;tp.call(this),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}function fp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Wr,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Wr;tp.call(this),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}function dp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr;tp.call(this),this.type="LineCurve",this.v1=t,this.v2=e}function vp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr;tp.call(this),this.type="LineCurve3",this.v1=t,this.v2=e}function mp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Fr;tp.call(this),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}function gp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Wr;tp.call(this),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}function yp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];tp.call(this),this.type="SplineCurve",this.points=t}up.prototype=Object.create(tp.prototype),up.prototype.constructor=up,up.prototype.isCatmullRomCurve3=!0,up.prototype.getPoint=function(t){var e,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,r=i,a=this.points,o=a.length,s=(o-(this.closed?0:1))*t,u=Math.floor(s),l=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===l&&u===o-1&&(u=o-2,l=1),this.closed||u>0?e=a[(u-1)%o]:(rp.subVectors(a[0],a[1]).add(a[0]),e=rp);var c=a[u%o],h=a[(u+1)%o];if(this.closed||u+2<o?n=a[(u+2)%o]:(rp.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=rp),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,f=Math.pow(e.distanceToSquared(c),p),d=Math.pow(c.distanceToSquared(h),p),v=Math.pow(h.distanceToSquared(n),p);d<1e-4&&(d=1),f<1e-4&&(f=d),v<1e-4&&(v=d),ap.initNonuniformCatmullRom(e.x,c.x,h.x,n.x,f,d,v),op.initNonuniformCatmullRom(e.y,c.y,h.y,n.y,f,d,v),sp.initNonuniformCatmullRom(e.z,c.z,h.z,n.z,f,d,v)}else"catmullrom"===this.curveType&&(ap.initCatmullRom(e.x,c.x,h.x,n.x,this.tension),op.initCatmullRom(e.y,c.y,h.y,n.y,this.tension),sp.initCatmullRom(e.z,c.z,h.z,n.z,this.tension));return r.set(ap.calc(l),op.calc(l),sp.calc(l)),r},up.prototype.copy=function(t){tp.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},up.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},up.prototype.fromJSON=function(t){tp.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push((new Wr).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},pp.prototype=Object.create(tp.prototype),pp.prototype.constructor=pp,pp.prototype.isCubicBezierCurve=!0,pp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr,n=e,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(hp(t,i.x,r.x,a.x,o.x),hp(t,i.y,r.y,a.y,o.y)),n},pp.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},pp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},pp.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},fp.prototype=Object.create(tp.prototype),fp.prototype.constructor=fp,fp.prototype.isCubicBezierCurve3=!0,fp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,n=e,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(hp(t,i.x,r.x,a.x,o.x),hp(t,i.y,r.y,a.y,o.y),hp(t,i.z,r.z,a.z,o.z)),n},fp.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},fp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},fp.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},dp.prototype=Object.create(tp.prototype),dp.prototype.constructor=dp,dp.prototype.isLineCurve=!0,dp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr,n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},dp.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},dp.prototype.getTangent=function(t,e){var n=e||new Fr;return n.copy(this.v2).sub(this.v1).normalize(),n},dp.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},dp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},dp.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},vp.prototype=Object.create(tp.prototype),vp.prototype.constructor=vp,vp.prototype.isLineCurve3=!0,vp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},vp.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},vp.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},vp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},vp.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},mp.prototype=Object.create(tp.prototype),mp.prototype.constructor=mp,mp.prototype.isQuadraticBezierCurve=!0,mp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr,n=e,i=this.v0,r=this.v1,a=this.v2;return n.set(cp(t,i.x,r.x,a.x),cp(t,i.y,r.y,a.y)),n},mp.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},mp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},mp.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},gp.prototype=Object.create(tp.prototype),gp.prototype.constructor=gp,gp.prototype.isQuadraticBezierCurve3=!0,gp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wr,n=e,i=this.v0,r=this.v1,a=this.v2;return n.set(cp(t,i.x,r.x,a.x),cp(t,i.y,r.y,a.y),cp(t,i.z,r.z,a.z)),n},gp.prototype.copy=function(t){return tp.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},gp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},gp.prototype.fromJSON=function(t){return tp.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},yp.prototype=Object.create(tp.prototype),yp.prototype.constructor=yp,yp.prototype.isSplineCurve=!0,yp.prototype.getPoint=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Fr,n=e,i=this.points,r=(i.length-1)*t,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],u=i[a],l=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return n.set(lp(o,s.x,u.x,l.x,c.x),lp(o,s.y,u.y,l.y,c.y)),n},yp.prototype.copy=function(t){tp.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push(i.clone())}return this},yp.prototype.toJSON=function(){var t=tp.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var i=this.points[e];t.points.push(i.toArray())}return t},yp.prototype.fromJSON=function(t){tp.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var i=t.points[e];this.points.push((new Fr).fromArray(i))}return this};var _p=Object.freeze({__proto__:null,ArcCurve:np,CatmullRomCurve3:up,CubicBezierCurve:pp,CubicBezierCurve3:fp,EllipseCurve:ep,LineCurve:dp,LineCurve3:vp,QuadraticBezierCurve:mp,QuadraticBezierCurve3:gp,SplineCurve:yp});function bp(){tp.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function xp(t){bp.call(this),this.type="Path",this.currentPoint=new Fr,t&&this.setFromPoints(t)}function wp(t){xp.call(this,t),this.uuid=Or.generateUUID(),this.type="Shape",this.holes=[]}function Sp(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;qa.call(this),this.type="Light",this.color=new fo(t),this.intensity=e}function kp(t,e,n){Sp.call(this,t,n),this.type="HemisphereLight",this.position.copy(qa.DefaultUp),this.updateMatrix(),this.groundColor=new fo(e)}function Mp(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Fr(512,512),this.map=null,this.mapPass=null,this.matrix=new ba,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ws,this._frameExtents=new Fr(1,1),this._viewportCount=1,this._viewports=[new $r(0,0,1,1)]}function Tp(){Mp.call(this,new ds(50,1,.5,500)),this.focus=1}function Ep(t,e,n,i,r,a){Sp.call(this,t,e),this.type="SpotLight",this.position.copy(qa.DefaultUp),this.updateMatrix(),this.target=new qa,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new Tp}function Cp(){Mp.call(this,new ds(90,1,.5,500)),this._frameExtents=new Fr(4,2),this._viewportCount=6,this._viewports=[new $r(2,1,1,1),new $r(0,1,1,1),new $r(3,1,1,1),new $r(1,1,1,1),new $r(3,0,1,1),new $r(1,0,1,1)],this._cubeDirections=[new Wr(1,0,0),new Wr(-1,0,0),new Wr(0,0,1),new Wr(0,0,-1),new Wr(0,1,0),new Wr(0,-1,0)],this._cubeUps=[new Wr(0,1,0),new Wr(0,1,0),new Wr(0,1,0),new Wr(0,1,0),new Wr(0,0,1),new Wr(0,0,-1)]}function Ip(t,e,n,i){Sp.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new Cp}function Pp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;fs.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}function Ap(){Mp.call(this,new Pp(-5,5,5,-5,.5,500))}function Lp(t,e){Sp.call(this,t,e),this.type="DirectionalLight",this.position.copy(qa.DefaultUp),this.updateMatrix(),this.target=new qa,this.shadow=new Ap}function Rp(t,e){Sp.call(this,t,e),this.type="AmbientLight"}function Dp(t,e,n,i){Sp.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}bp.prototype=Object.assign(Object.create(tp.prototype),{constructor:bp,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new dp(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=e){var r=n[i]-e,a=this.curves[i],o=a.getLength(),s=0===o?0:1-r/o;return a.getPointAt(s)}i++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(){for(var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),u=0;u<s.length;u++){var l=s[u];t&&t.equals(l)||(n.push(l),t=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){tp.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=tp.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++){var i=this.curves[e];t.curves.push(i.toJSON())}return t},fromJSON:function(t){tp.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var i=t.curves[e];this.curves.push((new _p[i.type]).fromJSON(i))}return this}}),xp.prototype=Object.assign(Object.create(bp.prototype),{constructor:xp,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var n=new dp(this.currentPoint.clone(),new Fr(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,i){var r=new mp(this.currentPoint.clone(),new Fr(t,e),new Fr(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(t,e,n,i,r,a){var o=new pp(this.currentPoint.clone(),new Fr(t,e),new Fr(n,i),new Fr(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this},splineThru:function(t){var e=new yp([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+o,e+s,n,i,r,a),this},absarc:function(t,e,n,i,r,a){return this.absellipse(t,e,n,n,i,r,a),this},ellipse:function(t,e,n,i,r,a,o,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+u,e+l,n,i,r,a,o,s),this},absellipse:function(t,e,n,i,r,a,o,s){var u=new ep(t,e,n,i,r,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return bp.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=bp.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return bp.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),wp.prototype=Object.assign(Object.create(xp.prototype),{constructor:wp,getPointsHoles:function(t){for(var e=[],n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){xp.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var i=t.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){var t=xp.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++){var i=this.holes[e];t.holes.push(i.toJSON())}return t},fromJSON:function(t){xp.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var i=t.holes[e];this.holes.push((new xp).fromJSON(i))}return this}}),Sp.prototype=Object.assign(Object.create(qa.prototype),{constructor:Sp,isLight:!0,copy:function(t){return qa.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=qa.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),kp.prototype=Object.assign(Object.create(Sp.prototype),{constructor:kp,isHemisphereLight:!0,copy:function(t){return Sp.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Mp.prototype,{_projScreenMatrix:new ba,_lightPositionWorld:new Wr,_lookTarget:new Wr,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(t.matrixWorld),e.position.copy(a),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),i.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Tp.prototype=Object.assign(Object.create(Mp.prototype),{constructor:Tp,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,n=2*Or.RAD2DEG*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),Mp.prototype.updateMatrices.call(this,t)}}),Ep.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Ep,isSpotLight:!0,copy:function(t){return Sp.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Cp.prototype=Object.assign(Object.create(Mp.prototype),{constructor:Cp,isPointLightShadow:!0,updateMatrices:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),n.position.copy(r),a.copy(n.position),a.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(a),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),Ip.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Ip,isPointLight:!0,copy:function(t){return Sp.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Pp.prototype=Object.assign(Object.create(fs.prototype),{constructor:Pp,isOrthographicCamera:!0,copy:function(t,e){return fs.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-t,a=n+t,o=i+e,s=i-e;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=u*this.view.offsetX)+u*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(t){var e=qa.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Ap.prototype=Object.assign(Object.create(Mp.prototype),{constructor:Ap,isDirectionalLightShadow:!0,updateMatrices:function(t){Mp.prototype.updateMatrices.call(this,t)}}),Lp.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Lp,isDirectionalLight:!0,copy:function(t){return Sp.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Rp.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Rp,isAmbientLight:!0}),Dp.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Dp,isRectAreaLight:!0,copy:function(t){return Sp.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Sp.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});var zp=function(){function t(){Tt(this,t),Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Wr)}return Ct(t,[{key:"set",value:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}},{key:"zero",value:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}},{key:"getAt",value:function(t,e){var n=t.x,i=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*i),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*n),e.addScaledVector(a[4],n*i*1.092548),e.addScaledVector(a[5],i*r*1.092548),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],n*r*1.092548),e.addScaledVector(a[8],.546274*(n*n-i*i)),e}},{key:"getIrradianceAt",value:function(t,e){var n=t.x,i=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*i),e.addScaledVector(a[2],1.023328*r),e.addScaledVector(a[3],1.023328*n),e.addScaledVector(a[4],.858086*n*i),e.addScaledVector(a[5],.858086*i*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],.858086*n*r),e.addScaledVector(a[8],.429043*(n*n-i*i)),e}},{key:"add",value:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}},{key:"addScaledSH",value:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}},{key:"scale",value:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}},{key:"lerp",value:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}},{key:"equals",value:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}},{key:"copy",value:function(t){return this.set(t.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}}],[{key:"getBasisAt",value:function(t,e){var n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}]),t}();function Op(t,e){Sp.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new zp}function Fp(t){qh.call(this,t),this.textures={}}Op.prototype=Object.assign(Object.create(Sp.prototype),{constructor:Op,isLightProbe:!0,copy:function(t){return Sp.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){var e=Sp.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),Fp.prototype=Object.assign(Object.create(qh.prototype),{constructor:Fp,load:function(t,e,n,i){var r=this,a=new Gh(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(t)}}),n,i)},parse:function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var i=new Eh[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=(new fo).setHex(t.sheen)),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(i.morphNormals=t.morphNormals),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.vertexTangents&&(i.vertexTangents=t.vertexTangents),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"===typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var r in t.uniforms){var a=t.uniforms[r];switch(i.uniforms[r]={},a.type){case"t":i.uniforms[r].value=n(a.value);break;case"c":i.uniforms[r].value=(new fo).setHex(a.value);break;case"v2":i.uniforms[r].value=(new Fr).fromArray(a.value);break;case"v3":i.uniforms[r].value=(new Wr).fromArray(a.value);break;case"v4":i.uniforms[r].value=(new $r).fromArray(a.value);break;case"m3":i.uniforms[r].value=(new Nr).fromArray(a.value);break;case"m4":i.uniforms[r].value=(new ba).fromArray(a.value);break;default:i.uniforms[r].value=a.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var o in t.extensions)i.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),i.normalScale=(new Fr).fromArray(s)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Fr).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),i},setTextures:function(t){return this.textures=t,this}});var Np=function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};function Bp(){Uo.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function jp(t,e,n,i){"number"===typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),xo.call(this,t,e,n),this.meshPerAttribute=i||1}function Vp(t){qh.call(this,t)}function Up(t){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),qh.call(this,t),this.options={premultiplyAlpha:"none"}}function $p(){this.type="ShapePath",this.color=new fo,this.subPaths=[],this.currentPath=null}Bp.prototype=Object.assign(Object.create(Uo.prototype),{constructor:Bp,isInstancedBufferGeometry:!0,copy:function(t){return Uo.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=Uo.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),jp.prototype=Object.assign(Object.create(xo.prototype),{constructor:jp,isInstancedBufferAttribute:!0,copy:function(t){return xo.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=xo.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Vp.prototype=Object.assign(Object.create(qh.prototype),{constructor:Vp,load:function(t,e,n,i){var r=this,a=new Gh(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(t)}}),n,i)},parse:function(t){var e={},n={};function i(t,i){if(void 0!==e[i])return e[i];var r=t.interleavedBuffers[i],a=function(t,e){if(void 0!==n[e])return n[e];var i=t.arrayBuffers[e],r=new Uint32Array(i).buffer;return n[e]=r,r}(t,r.buffer),o=new Ll(Do(r.type,a),r.stride);return o.uuid=r.uuid,e[i]=o,o}var r=t.isInstancedBufferGeometry?new Bp:new Uo,a=t.data.index;if(void 0!==a){var o=Do(a.type,a.array);r.setIndex(new xo(o,1))}var s=t.data.attributes;for(var u in s){var l=s[u],c=void 0;if(l.isInterleavedBufferAttribute){c=new zl(i(t.data,l.data),l.itemSize,l.offset,l.normalized)}else{var h=Do(l.type,l.array);c=new(l.isInstancedBufferAttribute?jp:xo)(h,l.itemSize,l.normalized)}void 0!==l.name&&(c.name=l.name),r.setAttribute(u,c)}var p=t.data.morphAttributes;if(p)for(var f in p){for(var d=p[f],v=[],m=0,g=d.length;m<g;m++){var y=d[m],_=void 0;if(y.isInterleavedBufferAttribute)_=new zl(i(t.data,y.data),y.itemSize,y.offset,y.normalized);else _=new xo(Do(y.type,y.array),y.itemSize,y.normalized);void 0!==y.name&&(_.name=y.name),v.push(_)}r.morphAttributes[f]=v}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var b=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==b)for(var x=0,w=b.length;x!==w;++x){var S=b[x];r.addGroup(S.start,S.count,S.materialIndex)}var k=t.data.boundingSphere;if(void 0!==k){var M=new Wr;void 0!==k.center&&M.fromArray(k.center),r.boundingSphere=new ha(M,k.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}),Up.prototype=Object.assign(Object.create(qh.prototype),{constructor:Up,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,a=$h.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout((function(){e&&e(a),r.manager.itemEnd(t)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,r.options)})).then((function(n){$h.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}),Object.assign($p.prototype,{moveTo:function(t,e){return this.currentPath=new xp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this},bezierCurveTo:function(t,e,n,i,r,a){return this.currentPath.bezierCurveTo(t,e,n,i,r,a),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n],a=new wp;a.curves=r.curves,e.push(a)}return e}function i(t,e){for(var n=e.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=e[r],s=e[a],u=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=e[a],u=-u,s=e[r],l=-l),t.y<o.y||t.y>s.y)continue;if(t.y===o.y){if(t.x===o.x)return!0}else{var c=l*(t.x-o.x)-u*(t.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(t.y!==o.y)continue;if(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x)return!0}}return i}var r,a,o,s=lh.isClockWise,u=this.subPaths;if(0===u.length)return[];if(!0===e)return n(u);var l=[];if(1===u.length)return a=u[0],(o=new wp).curves=a.curves,l.push(o),l;var c=!s(u[0].getPoints());c=t?!c:c;var h,p,f=[],d=[],v=[],m=0;d[m]=void 0,v[m]=[];for(var g=0,y=u.length;g<y;g++)r=s(h=(a=u[g]).getPoints()),(r=t?!r:r)?(!c&&d[m]&&m++,d[m]={s:new wp,p:h},d[m].s.curves=a.curves,c&&m++,v[m]=[]):v[m].push({h:a,p:h[0]});if(!d[0])return n(u);if(d.length>1){for(var _=!1,b=[],x=0,w=d.length;x<w;x++)f[x]=[];for(var S=0,k=d.length;S<k;S++)for(var M=v[S],T=0;T<M.length;T++){for(var E=M[T],C=!0,I=0;I<d.length;I++)i(E.p,d[I].p)&&(S!==I&&b.push({froms:S,tos:I,hole:T}),C?(C=!1,f[I].push(E)):_=!0);C&&f[S].push(E)}b.length>0&&(_||(v=f))}for(var P=0,A=d.length;P<A;P++){o=d[P].s,l.push(o);for(var L=0,R=(p=v[P]).length;L<R;L++)o.holes.push(p[L].h)}return l}});var Hp,qp=function(){function t(e){Tt(this,t),Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=e}return Ct(t,[{key:"generateShapes",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=[],i=Wp(t,e,this.data),r=0,a=i.length;r<a;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}}]),t}();function Wp(t,e,n){for(var i=Array.from?Array.from(t):String(t).split(""),r=e/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=[],s=0,u=0,l=0;l<i.length;l++){var c=i[l];if("\n"===c)s=0,u-=a;else{var h=Gp(c,r,s,u,n);s+=h.offsetX,o.push(h.path)}}return o}function Gp(t,e,n,i,r){var a=r.glyphs[t]||r.glyphs["?"];if(a){var o,s,u,l,c,h,p,f,d=new $p;if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),m=0,g=v.length;m<g;){switch(v[m++]){case"m":o=v[m++]*e+n,s=v[m++]*e+i,d.moveTo(o,s);break;case"l":o=v[m++]*e+n,s=v[m++]*e+i,d.lineTo(o,s);break;case"q":u=v[m++]*e+n,l=v[m++]*e+i,c=v[m++]*e+n,h=v[m++]*e+i,d.quadraticCurveTo(c,h,u,l);break;case"b":u=v[m++]*e+n,l=v[m++]*e+i,c=v[m++]*e+n,h=v[m++]*e+i,p=v[m++]*e+n,f=v[m++]*e+i,d.bezierCurveTo(c,h,p,f,u,l)}}return{offsetX:a.ha*e,path:d}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".")}function Zp(t){qh.call(this,t)}Zp.prototype=Object.assign(Object.create(qh.prototype),{constructor:Zp,load:function(t,e,n,i){var r=this,a=new Gh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){var n;try{n=JSON.parse(t)}catch(a){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}var i=r.parse(n);e&&e(i)}),n,i)},parse:function(t){return new qp(t)}});var Xp=function(){return void 0===Hp&&(Hp=new(window.AudioContext||window.webkitAudioContext)),Hp};function Yp(t){qh.call(this,t)}function Kp(t,e,n){Op.call(this,void 0,n);var i=(new fo).set(t),r=(new fo).set(e),a=new Wr(i.r,i.g,i.b),o=new Wr(r.r,r.g,r.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(u)}function Jp(t,e){Op.call(this,void 0,e);var n=(new fo).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Yp.prototype=Object.assign(Object.create(qh.prototype),{constructor:Yp,load:function(t,e,n,i){var r=this,a=new Gh(r.manager);a.setResponseType("arraybuffer"),a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(n){try{var a=n.slice(0);Xp().decodeAudioData(a,(function(t){e(t)}))}catch(o){i?i(o):console.error(o),r.manager.itemError(t)}}),n,i)}}),Kp.prototype=Object.assign(Object.create(Op.prototype),{constructor:Kp,isHemisphereLightProbe:!0,copy:function(t){return Op.prototype.copy.call(this,t),this},toJSON:function(t){return Op.prototype.toJSON.call(this,t)}}),Jp.prototype=Object.assign(Object.create(Op.prototype),{constructor:Jp,isAmbientLightProbe:!0,copy:function(t){return Op.prototype.copy.call(this,t),this},toJSON:function(t){return Op.prototype.toJSON.call(this,t)}});var Qp=new ba,tf=new ba;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ds,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ds,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var n,i,r=t.projectionMatrix.clone(),a=e.eyeSep/2,o=a*e.near/e.focus,s=e.near*Math.tan(Or.DEG2RAD*e.fov*.5)/e.zoom;tf.elements[12]=-a,Qp.elements[12]=a,n=-s*e.aspect+o,i=s*e.aspect+o,r.elements[0]=2*e.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(r),n=-s*e.aspect-o,i=s*e.aspect-o,r.elements[0]=2*e.near/(i-n),r.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(tf),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Qp)}});var ef=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).type="Audio",i.listener=t,i.context=t.context,i.gain=i.context.createGain(),i.gain.connect(t.getInput()),i.autoplay=!1,i.buffer=null,i.detune=0,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.offset=0,i.duration=void 0,i.playbackRate=1,i.isPlaying=!1,i.hasPlaybackControl=!0,i.source=null,i.sourceType="empty",i._startedAt=0,i._progress=0,i._connected=!1,i.filters=[],i}return Ct(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}},{key:"setMediaElementSource",value:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}},{key:"setMediaStreamSource",value:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}},{key:"setBuffer",value:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}},{key:"setDetune",value:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(t){return this.setFilters(t?[t]:[])}},{key:"setPlaybackRate",value:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(t){return this.loopStart=t,this}},{key:"setLoopEnd",value:function(t){return this.loopEnd=t,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}]),n}(qa);function nf(t,e,n){var i,r,a;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(nf.prototype,{accumulate:function(t,e){var n=this.buffer,i=this.valueSize,r=t*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=e}else{var s=e/(a+=e);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a},accumulateAdditive:function(t){var e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){var e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=e*this._origIndex;this._mixBufferRegion(n,i,s,1-r,e)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(var u=e,l=e+e;u!==l;++u)if(n[u]!==n[u+e]){o.setValue(n,i);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(var r=n,a=i;r!==a;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,n=t;n<e;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)t[e+a]=t[n+a]},_slerp:function(t,e,n,i){qr.slerpFlat(t,e,t,e,t,n,i)},_slerpAdditive:function(t,e,n,i,r){var a=this._workIndex*r;qr.multiplyQuaternionsFlat(t,a,t,e,t,n),qr.slerpFlat(t,e,t,e,t,a,i)},_lerp:function(t,e,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=e+o;t[s]=t[s]*a+t[n+o]*i}},_lerpAdditive:function(t,e,n,i,r){for(var a=0;a!==r;++a){var o=e+a;t[o]=t[o]+t[n+a]*i}}});var rf="\\[\\]\\.:\\/",af=new RegExp("[\\[\\]\\.:\\/]","g"),of="[^\\[\\]\\.:\\/]",sf="[^"+rf.replace("\\.","")+"]",uf=/((?:WC+[\/:])*)/.source.replace("WC",of),lf=/(WCOD+)?/.source.replace("WCOD",sf),cf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",of),hf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",of),pf=new RegExp("^"+uf+lf+cf+hf+"$"),ff=["material","materials","bones"];function df(t,e,n){var i=n||vf.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}function vf(t,e,n){this.path=e,this.parsedPath=n||vf.parseTrackName(e),this.node=vf.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(df.prototype,{getValue:function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(vf,{Composite:df,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new vf.Composite(t,e,n):new vf(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(af,"")},parseTrackName:function(t){var e=pf.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==ff.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var i=function t(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===e||r.uuid===e)return r;var a=t(r.children);if(a)return a}return null}(t.children);if(i)return i}return null}}),Object.assign(vf.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)t[e++]=n[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=t[e++]},function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,i=e.propertyName,r=e.propertyIndex;if(t||(t=vf.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var a=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===a){a=o;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==a){if(void 0===t[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[a]}}var s=t[i];if(void 0!==s){var u=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(vf.prototype,{_getValue_unbound:vf.prototype.getValue,_setValue_unbound:vf.prototype.setValue}),Object.assign(function(){this.uuid=Or.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length,o=void 0,s=t.length,u=this.nCachedObjects_,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],p=h.uuid,f=e[p];if(void 0===f){f=s++,e[p]=f,t.push(h);for(var d=0,v=a;d!==v;++d)r[d].push(new vf(h,n[d],i[d]))}else if(f<u){o=t[f];var m=--u,g=t[m];e[g.uuid]=f,t[f]=g,e[p]=m,t[m]=h;for(var y=0,_=a;y!==_;++y){var b=r[y],x=b[m],w=b[f];b[f]=x,void 0===w&&(w=new vf(h,n[y],i[y])),b[m]=w}}else t[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u},remove:function(){for(var t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],u=s.uuid,l=e[u];if(void 0!==l&&l>=r){var c=r++,h=t[c];e[h.uuid]=l,t[l]=h,e[u]=c,t[c]=s;for(var p=0,f=i;p!==f;++p){var d=n[p],v=d[c],m=d[l];d[l]=v,d[c]=m}}}this.nCachedObjects_=r},uncache:function(){for(var t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=t.length,o=0,s=arguments.length;o!==s;++o){var u=arguments[o],l=u.uuid,c=e[l];if(void 0!==c)if(delete e[l],c<r){var h=--r,p=t[h],f=--a,d=t[f];e[p.uuid]=c,t[c]=p,e[d.uuid]=h,t[h]=d,t.pop();for(var v=0,m=i;v!==m;++v){var g=n[v],y=g[h],_=g[f];g[c]=y,g[h]=_,g.pop()}}else{var b=--a,x=t[b];b>0&&(e[x.uuid]=c),t[c]=x,t.pop();for(var w=0,S=i;w!==S;++w){var k=n[w];k[c]=k[b],k.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,i=n[t],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,u=s.length,l=this.nCachedObjects_,c=new Array(u);i=r.length,n[t]=i,a.push(t),o.push(e),r.push(c);for(var h=l,p=s.length;h!==p;++h){var f=s[h];c[h]=new vf(f,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}});var mf=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Tt(this,t),this._mixer=e,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),u={endingStart:xr,endingEnd:xr},l=0;l!==o;++l){var c=a[l].createInterpolant(null);s[l]=c,c.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Ct(t,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(t){return this._startTime=t,this}},{key:"setLoop",value:function(t,e){return this.loop=t,this.repetitions=e,this}},{key:"setEffectiveWeight",value:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(t){return this._scheduleFading(t,0,1)}},{key:"fadeOut",value:function(t){return this._scheduleFading(t,1,0)}},{key:"crossFadeFrom",value:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var i=this._clip.duration,r=t._clip.duration,a=r/i,o=i/r;t.warp(1,a,e),this.warp(o,1,e)}return this}},{key:"crossFadeTo",value:function(t,e,n){return t.crossFadeFrom(this,e,n)}},{key:"stopFading",value:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}},{key:"setEffectiveTimeScale",value:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}},{key:"syncWith",value:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}},{key:"halt",value:function(t){return this.warp(this._effectiveTimeScale,0,t)}},{key:"warp",value:function(t,e,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=r,s[1]=r+n,u[0]=t/a,u[1]=e/a,this}},{key:"stopWarping",value:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(t,e,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(t-r)*n;if(a<0||0===n)return;this._startTime=null,e=n*a}e*=this._updateTimeScale(t);var o=this._updateTime(e),s=this._updateWeight(t);if(s>0){var u=this._interpolants,l=this._propertyBindings;if(this.blendMode===Mr)for(var c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulateAdditive(s);else for(var p=0,f=u.length;p!==f;++p)u[p].evaluate(o),l[p].accumulate(i,s)}}else this._updateWeight(t)}},{key:"_updateWeight",value:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}},{key:"_updateTimeScale",value:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e}},{key:"_updateTime",value:function(t){var e=this._clip.duration,n=this.loop,i=this.time+t,r=this._loopCount,a=2202===n;if(0===t)return-1===r?i:a&&1===(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=e||i<0){var o=Math.floor(i/e);i-=e*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var u=t<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1===(1&r))return e-i}return i}},{key:"_setEndings",value:function(t,e,n){var i=this._interpolantSettings;n?(i.endingStart=wr,i.endingEnd=wr):(i.endingStart=t?this.zeroSlopeAtStart?wr:xr:Sr,i.endingEnd=e?this.zeroSlopeAtEnd?wr:xr:Sr)}},{key:"_scheduleFading",value:function(t,e,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=e,o[1]=r+t,s[1]=n,this}}]),t}();function gf(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}gf.prototype=Object.assign(Object.create(Ar.prototype),{constructor:gf,_bindAction:function(t,e){var n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,a=t._propertyBindings,o=t._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==r;++c){var h=i[c],p=h.name,f=l[p];if(void 0!==f)a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,p));continue}var d=e&&e._propertyBindings[c].binding.parsedPath;++(f=new nf(vf.create(n,p,d),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,p),a[c]=f}o[c].resultBuffer=f.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}for(var r=t._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,i=e.length;n!==i;++n){var r=e[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var i=this._actions,r=this._actionsByClip,a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{var o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=i.length,i.push(t),a.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,u=s[s.length-1],l=t._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,i=e.length;n!==i;++n){var r=e[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_addInactiveBinding:function(t,e,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[e];void 0===a&&(a={},i[e]=a),a[n]=t,t._cacheIndex=r.length,r.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=e[e.length-1],u=t._cacheIndex;s._cacheIndex=u,e[u]=s,e.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new Ah(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){var i=e||this._root,r=i.uuid,a="string"===typeof t?Vh.findByName(i,t):t,o=null!==a?a.uuid:t,s=this._actionsByClip[o],u=null;if(void 0===n&&(n=null!==a?a.blendMode:kr),void 0!==s){var l=s.actionByRoot[r];if(void 0!==l&&l.blendMode===n)return l;u=s.knownActions[0],null===a&&(a=u._clip)}if(null===a)return null;var c=new mf(this,a,e,n);return this._bindAction(c,u),this._addInactiveAction(c,o,r),c},existingAction:function(t,e){var n=e||this._root,i=n.uuid,r="string"===typeof t?Vh.findByName(n,t):t,a=r?r.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1,o=0;o!==n;++o){e[o]._update(i,t,r,a)}for(var s=this._bindings,u=this._nActiveBindings,l=0;l!==u;++l)s[l].apply(a);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var u=a[o];this._deactivateAction(u);var l=u._cacheIndex,c=e[e.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,e[l]=c,e.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[e];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var yf=function(){function t(e){Tt(this,t),"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}return Ct(t,[{key:"clone",value:function(){return new t(void 0===this.value.clone?this.value:this.value.clone())}}]),t}();function _f(t,e,n){Ll.call(this,t,e),this.meshPerAttribute=n||1}function bf(t,e,n,i,r){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}function xf(t,e,n,i){this.ray=new _a(t,e),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new Aa,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function wf(t,e){return t.distance-e.distance}function Sf(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i)for(var r=t.children,a=0,o=r.length;a<o;a++)Sf(r[a],e,n,!0)}_f.prototype=Object.assign(Object.create(Ll.prototype),{constructor:_f,isInstancedInterleavedBuffer:!0,copy:function(t){return Ll.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){var e=Ll.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){var e=Ll.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(bf.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(bf.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(xf.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)},intersectObject:function(t,e,n){var i=n||[];return Sf(t,this,i,e),i.sort(wf),i},intersectObjects:function(t,e,n){var i=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,a=t.length;r<a;r++)Sf(t[r],this,i,e);return i.sort(wf),i}});var kf=new Fr,Mf=function(){function t(e,n){Tt(this,t),Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Fr(1/0,1/0),this.max=void 0!==n?n:new Fr(-1/0,-1/0)}return Ct(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"setFromPoints",value:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var n=kf.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Fr),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Fr),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}},{key:"getParameter",value:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Fr),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}},{key:"clampPoint",value:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Fr),e.copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return kf.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}();function Tf(t){qa.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Tf.prototype=Object.create(qa.prototype),Tf.prototype.constructor=Tf,Tf.prototype.isImmediateRenderObject=!0;var Ef=new yo({side:1,depthWrite:!1,depthTest:!1});function Cf(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),up.call(this,t),this.type="catmullrom"}new os(new us,Ef),tp.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(tp.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(xp.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Cf.prototype=Object.create(up.prototype),Object.assign(Cf.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Object.assign(qh.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Np(t)}}),qh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Mf.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Xr.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(ha.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),ws.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Object.assign(Or,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Or.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Or.ceilPowerOfTwo(t)}}),Object.assign(Nr.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Object.assign(ba.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Wr).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,a)},getInverse:function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),Xa.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Object.assign(qr.prototype,{multiplyVector3:function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(_a.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(oo.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(oo,{barycoordFromPoint:function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),oo.getBarycoord(t,e,n,i,r)},normal:function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),oo.getNormal(t,e,n,i)}}),Object.assign(wp.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ph(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new vh(this,t)}}),Object.assign(Fr.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wr.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign($r.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(qa.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(qa.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(os.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(os.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Ql.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(lc.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ac.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(tp.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),ds.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Sp.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(xo.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ir},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ir)}}}),Object.assign(xo.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Ir:Cr),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Uo.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new xo(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Uo.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Bp.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(xf.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Ll.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Ir},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Ll.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Ir:Cr),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ph.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(Al.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(yf.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(go.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new fo}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(xh.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(bh.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(ps.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Il.prototype,{clearTarget:function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Il.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:Tr}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(bl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Hr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(ef.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Yp).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),ms.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},ms.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},Br.crossOrigin=void 0,Br.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Qh;r.setCrossOrigin(this.crossOrigin);var a=r.load(t,n,void 0,i);return e&&(a.mapping=e),a},Br.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Kh;r.setCrossOrigin(this.crossOrigin);var a=r.load(t,n,void 0,i);return e&&(a.mapping=e),a},Br.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Br.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125");var If=Math.PI/180,Pf=180/Math.PI,Af=6378137,Lf=6356752.31424518;function Rf(t,e,n,i,r,a){var o=zf(t,e,n);return function(t,e,n,i,r,a){var o=zf(i,r,a),s=[t-o[0],e-o[1],n-o[2]];i*=If,r*=If;var u=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r),p=-l*s[0]+u*s[1],f=-h*u*s[0]-h*l*s[1]+c*s[2],d=c*u*s[0]+c*l*s[1]+h*s[2];return[p,f,d]}(o[0],o[1],o[2],i,r,a)}function Df(t,e,n,i,r,a){var o=function(t,e,n,i,r,a){var o=zf(i,r,a);i*=If,r*=If;var s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r),h=-u*t-c*s*e+l*s*n+o[0],p=s*t-c*u*e+l*u*n+o[1],f=l*e+c*n+o[2];return[h,p,f]}(t,e,n,i,r,a);return function(t,e,n){var i=Af,r=Lf,a=i*i,o=r*r,s=a-o,u=Math.sqrt(s/a),l=Math.sqrt(s/o),c=Math.sqrt(t*t+e*e),h=Math.atan2(n*i,c*r),p=Math.sin(h),f=Math.cos(h),d=Math.atan2(e,t),v=Math.atan2(n+l*l*r*p*p*p,c-u*u*i*f*f*f),m=Math.sin(v),g=Math.cos(v),y=i/Math.sqrt(1-u*u*m*m);return[d*Pf,v*Pf,c/g-y]}(o[0],o[1],o[2])}function zf(t,e,n){var i=Af,r=Lf;t*=If,e*=If;var a=Math.cos(t),o=Math.sin(t),s=Math.cos(e),u=Math.sin(e),l=i*i,c=r*r,h=1/Math.sqrt(l*s*s+c*u*u),p=(l*h+n)*s;return[p*a,p*o,(c*h+n)*u]}var Of,Ff=function(){function t(){Tt(this,t)}return Ct(t,[{key:"boundingBoxCorners",value:function(t,e){var n=Df(-e,-e,0,t.lng,t.lat,0),i=Df(e,e,0,t.lng,t.lat,0);return[{lat:n[1],lng:n[0]},{lat:i[1],lng:i[0]}]}},{key:"rotationFromCompass",value:function(t,e){var n=0,i=0,r=0;switch(e){case 1:n=Math.PI/2;break;case 3:n=-Math.PI/2,r=Math.PI;break;case 6:i=-Math.PI/2,r=-Math.PI/2;break;case 8:i=Math.PI/2,r=Math.PI/2}var a=(new ba).makeRotationZ(r),o=new Ca(n,i,t*Math.PI/180,"XYZ"),s=(new ba).makeRotationFromEuler(o),u=(new $r).setAxisAngleFromRotationMatrix(s.multiply(a));return u.multiplyScalar(u.w).toArray().slice(0,3)}}]),t}(),Nf=function(){function t(e){if(Tt(this,t),!e)throw new Error("Incorrect core image data ".concat(e));this._cache=null,this._core=e,this._spatial=null}return Ct(t,[{key:"assetsCached",get:function(){return null!=this._core&&null!=this._spatial&&null!=this._cache&&null!=this._cache.image&&null!=this._cache.mesh}},{key:"cameraParameters",get:function(){return this._spatial.camera_parameters}},{key:"cameraType",get:function(){return this._spatial.camera_type}},{key:"capturedAt",get:function(){return this._spatial.captured_at}},{key:"clusterId",get:function(){return this._spatial.cluster?this._spatial.cluster.id:null}},{key:"clusterUrl",get:function(){return this._spatial.cluster?this._spatial.cluster.url:null}},{key:"compassAngle",get:function(){return null!=this._spatial.computed_compass_angle?this._spatial.computed_compass_angle:this._spatial.compass_angle}},{key:"complete",get:function(){return null!=this._spatial}},{key:"computedAltitude",get:function(){return this._spatial.computed_altitude}},{key:"computedCompassAngle",get:function(){return this._spatial.computed_compass_angle}},{key:"computedLngLat",get:function(){return this._core.computed_geometry}},{key:"creatorId",get:function(){return this._spatial.creator.id}},{key:"creatorUsername",get:function(){return this._spatial.creator.username}},{key:"exifOrientation",get:function(){return this._spatial.exif_orientation}},{key:"height",get:function(){return this._spatial.height}},{key:"image",get:function(){return this._cache.image}},{key:"image$",get:function(){return this._cache.image$}},{key:"id",get:function(){return this._core.id}},{key:"lngLat",get:function(){return null!=this._core.computed_geometry?this._core.computed_geometry:this._core.geometry}},{key:"merged",get:function(){return null!=this._spatial&&null!=this._spatial.merge_id}},{key:"mergeId",get:function(){return this._spatial.merge_id}},{key:"mesh",get:function(){return this._cache.mesh}},{key:"originalAltitude",get:function(){return this._spatial.altitude}},{key:"originalCompassAngle",get:function(){return this._spatial.compass_angle}},{key:"originalLngLat",get:function(){return this._core.geometry}},{key:"ownerId",get:function(){return this._spatial.owner?this._spatial.owner.id:null}},{key:"private",get:function(){return this._spatial.private}},{key:"qualityScore",get:function(){return this._spatial.quality_score}},{key:"rotation",get:function(){return this._spatial.computed_rotation}},{key:"scale",get:function(){return this._spatial.atomic_scale}},{key:"sequenceId",get:function(){return this._core.sequence?this._core.sequence.id:null}},{key:"sequenceEdges",get:function(){return this._cache.sequenceEdges}},{key:"sequenceEdges$",get:function(){return this._cache.sequenceEdges$}},{key:"spatialEdges",get:function(){return this._cache.spatialEdges}},{key:"spatialEdges$",get:function(){return this._cache.spatialEdges$}},{key:"width",get:function(){return this._spatial.width}},{key:"cacheAssets$",value:function(){var t=this;return this._cache.cacheAssets$(this._spatial,this.merged).pipe(De((function(){return t})))}},{key:"cacheImage$",value:function(){var t=this;return this._cache.cacheImage$(this._spatial).pipe(De((function(){return t})))}},{key:"cacheSequenceEdges",value:function(t){this._cache.cacheSequenceEdges(t)}},{key:"cacheSpatialEdges",value:function(t){this._cache.cacheSpatialEdges(t)}},{key:"dispose",value:function(){null!=this._cache&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}},{key:"initializeCache",value:function(t){if(null!=this._cache)throw new Error("Image cache already initialized (".concat(this.id,")."));this._cache=t}},{key:"makeComplete",value:function(t){if(null==t)throw new Error("Fill can not be null.");this._spatial=t}},{key:"resetSequenceEdges",value:function(){this._cache.resetSequenceEdges()}},{key:"resetSpatialEdges",value:function(){this._cache.resetSpatialEdges()}},{key:"uncache",value:function(){null!=this._cache&&(this._cache.dispose(),this._cache=null)}}]),t}(),Bf=function(){function t(e){Tt(this,t),this._disposed=!1,this._provider=e,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new te,this._image$=this._imageChanged$.pipe(Di(null),bi(1),ne()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new te,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(Di(this._sequenceEdges),bi(1),ne()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe((function(){})),this._spatialEdgesChanged$=new te,this._spatialEdges$=this._spatialEdgesChanged$.pipe(Di(this._spatialEdges),bi(1),ne()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe((function(){})),this._cachingAssets$=null}return Ct(t,[{key:"image",get:function(){return this._image}},{key:"image$",get:function(){return this._image$}},{key:"mesh",get:function(){return this._mesh}},{key:"sequenceEdges",get:function(){return this._sequenceEdges}},{key:"sequenceEdges$",get:function(){return this._sequenceEdges$}},{key:"spatialEdges",get:function(){return this._spatialEdges}},{key:"spatialEdges$",get:function(){return this._spatialEdges$}},{key:"cacheAssets$",value:function(t,e){var n=this;return null!=this._cachingAssets$||(this._cachingAssets$=We(this._cacheImage$(t),this._cacheMesh$(t,e)).pipe(De((function(t){var e=rt(t,2),i=e[0],r=e[1];return n._image=i,n._mesh=r,n})),ei((function(){n._cachingAssets$=null})),bi(1),ne()),this._cachingAssets$.pipe(ri((function(t){return!!t._image}))).subscribe((function(){n._imageChanged$.next(n._image)}),(function(){}))),this._cachingAssets$}},{key:"cacheImage$",value:function(t){var e=this;if(null!=this._image)return xe(this);var n=this._cacheImage$(t).pipe(ri((function(t){return!!t})),Hi((function(t){e._disposeImage(),e._image=t})),De((function(){return e})),bi(1),ne());return n.subscribe((function(){e._imageChanged$.next(e._image)}),(function(){})),n}},{key:"cacheSequenceEdges",value:function(t){this._sequenceEdges={cached:!0,edges:t},this._sequenceEdgesChanged$.next(this._sequenceEdges)}},{key:"cacheSpatialEdges",value:function(t){this._spatialEdges={cached:!0,edges:t},this._spatialEdgesChanged$.next(this._spatialEdges)}},{key:"dispose",value:function(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,null!=this._imageAborter&&(this._imageAborter(),this._imageAborter=null),null!=this._meshAborter&&(this._meshAborter(),this._meshAborter=null)}},{key:"resetSequenceEdges",value:function(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}},{key:"resetSpatialEdges",value:function(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}},{key:"_cacheImage$",value:function(t){var e=this;return Xt.create((function(n){var i=new Promise((function(t,n){e._imageAborter=n})),r=t.thumb.url;if(r)e._provider.getImageBuffer(r,i).then((function(t){e._imageAborter=null;var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){if(e._disposed){window.URL.revokeObjectURL(i.src);var t="Image load was aborted (".concat(r,")");n.error(new Error(t))}else n.next(i),n.complete()},i.onerror=function(){e._imageAborter=null,n.error(new Error("Failed to load image (".concat(r,")")))};var a=new Blob([t]);i.src=window.URL.createObjectURL(a)}),(function(t){e._imageAborter=null,n.error(t)}));else{var a=t.thumb.id,o="Incorrect thumb URL for ".concat(t.id," ")+"(".concat(a,", ").concat(r,")");n.error(new Error(o))}}))}},{key:"_cacheMesh$",value:function(t,e){var n=this;return Xt.create((function(i){if(!e)return i.next(n._createEmptyMesh()),void i.complete();var r=t.mesh.url;if(!r){var a=t.mesh.id,o="Incorrect mesh URL for ".concat(t.id," ")+"(".concat(a,", ").concat(r,")");return console.warn(o),i.next(n._createEmptyMesh()),void i.complete()}var s=new Promise((function(t,e){n._meshAborter=e}));n._provider.getMesh(r,s).then((function(t){n._meshAborter=null,n._disposed||(i.next(t),i.complete())}),(function(t){n._meshAborter=null,console.error(t),i.next(n._createEmptyMesh()),i.complete()}))}))}},{key:"_createEmptyMesh",value:function(){return{faces:[],vertices:[]}}},{key:"_disposeImage",value:function(){null!=this._image&&window.URL.revokeObjectURL(this._image.src),this._image=null}}]),t}(),jf=function(){function t(e){Tt(this,t),this._id=e.id,this._imageIds=e.image_ids}return Ct(t,[{key:"id",get:function(){return this._id}},{key:"imageIds",get:function(){return this._imageIds}},{key:"dispose",value:function(){this._id=null,this._imageIds=null}},{key:"findNext",value:function(t){var e=this._imageIds.indexOf(t);return e+1>=this._imageIds.length||-1===e?null:this._imageIds[e+1]}},{key:"findPrev",value:function(t){var e=this._imageIds.indexOf(t);return 0===e||-1===e?null:this._imageIds[e-1]}}]),t}(),Vf=Ct((function t(){Tt(this,t),this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}));!function(t){t[t.Next=0]="Next",t[t.Prev=1]="Prev",t[t.StepLeft=2]="StepLeft",t[t.StepRight=3]="StepRight",t[t.StepForward=4]="StepForward",t[t.StepBackward=5]="StepBackward",t[t.TurnLeft=6]="TurnLeft",t[t.TurnRight=7]="TurnRight",t[t.TurnU=8]="TurnU",t[t.Spherical=9]="Spherical",t[t.Similar=10]="Similar"}(Of||(Of={}));var Uf=Ct((function t(){Tt(this,t),this.steps={},this.turns={},this.spherical={},this.steps[Of.StepForward]={direction:Of.StepForward,motionChange:0,useFallback:!0},this.steps[Of.StepBackward]={direction:Of.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[Of.StepLeft]={direction:Of.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[Of.StepRight]={direction:Of.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[Of.TurnLeft]={direction:Of.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[Of.TurnRight]={direction:Of.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[Of.TurnU]={direction:Of.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[Of.StepForward]={direction:Of.StepForward,directionChange:0,next:Of.StepLeft,prev:Of.StepRight},this.spherical[Of.StepBackward]={direction:Of.StepBackward,directionChange:Math.PI,next:Of.StepRight,prev:Of.StepLeft},this.spherical[Of.StepLeft]={direction:Of.StepLeft,directionChange:Math.PI/2,next:Of.StepBackward,prev:Of.StepForward},this.spherical[Of.StepRight]={direction:Of.StepRight,directionChange:-Math.PI/2,next:Of.StepForward,prev:Of.StepBackward}})),$f=function(){function t(){Tt(this,t),this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=432e5,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}return Ct(t,[{key:"maxDistance",get:function(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}]),t}(),Hf=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),i=e.call(this,t),Object.setPrototypeOf(ft(i),n.prototype),i.name="MapillaryError",i}return Ct(n)}(_t(Error)),qf=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),i=e.call(this,null!=t?t:"The argument is not valid."),Object.setPrototypeOf(ft(i),n.prototype),i.name="ArgumentMapillaryError",i}return Ct(n)}(Hf),Wf=function(){function t(){Tt(this,t),this._epsilon=1e-9}return Ct(t,[{key:"azimuthalToBearing",value:function(t){return-t+Math.PI/2}},{key:"degToRad",value:function(t){return Math.PI*t/180}},{key:"radToDeg",value:function(t){return 180*t/Math.PI}},{key:"rotationMatrix",value:function(t){var e=new Wr(t[0],t[1],t[2]),n=e.length();return n>0&&e.normalize(),(new ba).makeRotationAxis(e,n)}},{key:"rotate",value:function(t,e){var n=new Wr(t[0],t[1],t[2]),i=this.rotationMatrix(e);return n.applyMatrix4(i),n}},{key:"opticalCenter",value:function(t,e){var n=[-t[0],-t[1],-t[2]],i=[-e[0],-e[1],-e[2]];return this.rotate(i,n)}},{key:"viewingDirection",value:function(t){var e=[-t[0],-t[1],-t[2]];return this.rotate([0,0,1],e)}},{key:"wrap",value:function(t,e,n){if(n<e)throw new Error("Invalid arguments: max must be larger than min.");for(var i=n-e;t>n||t<e;)t>n?t-=i:t<e&&(t+=i);return t}},{key:"wrapAngle",value:function(t){return this.wrap(t,-Math.PI,Math.PI)}},{key:"clamp",value:function(t,e,n){return t<e?e:t>n?n:t}},{key:"angleBetweenVector2",value:function(t,e,n,i){var r=Math.atan2(i,n)-Math.atan2(e,t);return this.wrapAngle(r)}},{key:"angleDifference",value:function(t,e){var n=e-t;return this.wrapAngle(n)}},{key:"relativeRotationAngle",value:function(t,e){var n=this.rotationMatrix([-t[0],-t[1],-t[2]]),i=this.rotationMatrix(e),r=n.multiply(i).elements,a=r[0]+r[5]+r[10];return Math.acos(Math.max(Math.min((a-1)/2,1),-1))}},{key:"angleToPlane",value:function(t,e){var n=(new Wr).fromArray(t),i=n.length();if(i<this._epsilon)return 0;var r=n.dot((new Wr).fromArray(e));return Math.asin(r/i)}},{key:"azimuthal",value:function(t,e){var n=(new Wr).fromArray(t),i=(new Wr).fromArray(e),r=n.clone().dot(i),a=n.clone().sub(i.clone().multiplyScalar(r));return Math.atan2(a.y,a.x)}},{key:"distanceFromLngLat",value:function(t,e,n,i){var r=this.degToRad(i-e),a=this.degToRad(n-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.degToRad(e))*Math.cos(this.degToRad(i))*Math.sin(a/2)*Math.sin(a/2);return 12742e3*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}}]),t}(),Gf=new Wf;function Zf(t){return"spherical"===t}function Xf(t){return"fisheye"===t}function Yf(t,e,n){var i=Rf(t.lng,t.lat,t.alt,n.lng,n.lat,n.alt),r=Gf.rotate(i,e);return[-r.x,-r.y,-r.z]}function Kf(t,e,n,i,r){for(var a=[],o=0;o<e.length;++o)for(var s=e[o],u=n[o],l=0;l<=i;++l)a.push([s[0]+u[0]*l/i,s[1]+u[1]*l/i]);var c=new fs;return c.up.copy(t.upVector()),c.position.copy((new Wr).fromArray(t.unprojectSfM([0,0],0))),c.lookAt((new Wr).fromArray(t.unprojectSfM([0,0],10))),c.updateMatrix(),c.updateMatrixWorld(!0),a.map((function(e){var n=t.unprojectBasic(e,1e4),i=r.worldToCamera(n,c);return[Math.abs(i[0]/i[2]),Math.abs(i[1]/i[2])]}))}var Jf=function(){function t(e,n,i){Tt(this,t),this._spatial=new Wf,this._settings=null!=e?e:new $f,this._directions=null!=n?n:new Uf,this._coefficients=null!=i?i:new Vf}return Ct(t,[{key:"getPotentialEdges",value:function(t,e,n){if(!t.complete)throw new qf("Image has to be full.");if(!t.merged)return[];var i,r=this._spatial.viewingDirection(t.rotation),a=this._spatial.angleToPlane(r.toArray(),[0,0,1]),o=[],s=wt(e);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.merged&&u.id!==t.id){var l=Rf(u.lngLat.lng,u.lngLat.lat,u.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude),c=new Wr(l[0],l[1],l[2]),h=c.length();if(!(h>this._settings.maxDistance&&n.indexOf(u.id)<0)){var p=this._spatial.angleBetweenVector2(r.x,r.y,c.x,c.y),f=this._spatial.angleToPlane(c.toArray(),[0,0,1]),d=this._spatial.viewingDirection(u.rotation),v=this._spatial.angleBetweenVector2(r.x,r.y,d.x,d.y),m=this._spatial.angleToPlane(d.toArray(),[0,0,1])-a,g=this._spatial.relativeRotationAngle(t.rotation,u.rotation),y=this._spatial.angleBetweenVector2(1,0,c.x,c.y),_=null!=u.sequenceId&&null!=t.sequenceId&&u.sequenceId===t.sequenceId,b=u.mergeId===t.mergeId,x=u.creatorId===t.creatorId,w={capturedAt:u.capturedAt,directionChange:v,distance:h,spherical:Zf(u.cameraType),id:u.id,motionChange:p,rotation:g,sameMergeCC:b,sameSequence:_,sameUser:x,sequenceId:u.sequenceId,verticalDirectionChange:m,verticalMotion:f,worldMotionAzimuth:y};o.push(w)}}}}catch(Tx){s.e(Tx)}finally{s.f()}return o}},{key:"computeSequenceEdges",value:function(t,e){if(!t.complete)throw new qf("Image has to be full.");if(t.sequenceId!==e.id)throw new qf("Image and sequence does not correspond.");var n=[],i=e.findNext(t.id);null!=i&&n.push({data:{direction:Of.Next,worldMotionAzimuth:Number.NaN},source:t.id,target:i});var r=e.findPrev(t.id);return null!=r&&n.push({data:{direction:Of.Prev,worldMotionAzimuth:Number.NaN},source:t.id,target:r}),n}},{key:"computeSimilarEdges",value:function(t,e){var n=this;if(!t.complete)throw new qf("Image has to be full.");var i,r=Zf(t.cameraType),a={},o=wt(e);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(null!=s.sequenceId&&!s.sameSequence){if(r){if(!s.spherical)continue}else if(!s.spherical&&Math.abs(s.directionChange)>this._settings.similarMaxDirectionChange)continue;s.distance>this._settings.similarMaxDistance||s.sameUser&&Math.abs(s.capturedAt-t.capturedAt)<this._settings.similarMinTimeDifference||(null==a[s.sequenceId]&&(a[s.sequenceId]=[]),a[s.sequenceId].push(s))}}}catch(Tx){o.e(Tx)}finally{o.f()}var u=[],l=Zf(t.cameraType)?function(t){return t.distance}:function(t){return n._coefficients.similarDistance*t.distance+n._coefficients.similarRotation*t.rotation};for(var c in a)if(a.hasOwnProperty(c)){var h,p=Number.MAX_VALUE,f=null,d=wt(a[c]);try{for(d.s();!(h=d.n()).done;){var v=h.value,m=l(v);m<p&&(p=m,f=v)}}catch(Tx){d.e(Tx)}finally{d.f()}null!=f&&u.push(f)}return u.map((function(e){return{data:{direction:Of.Similar,worldMotionAzimuth:e.worldMotionAzimuth},source:t.id,target:e.id}}))}},{key:"computeStepEdges",value:function(t,e,n,i){if(!t.complete)throw new qf("Image has to be full.");var r=[];if(Zf(t.cameraType))return r;for(var a in this._directions.steps)if(this._directions.steps.hasOwnProperty(a)){var o,s=this._directions.steps[a],u=Number.MAX_VALUE,l=null,c=null,h=wt(e);try{for(h.s();!(o=h.n()).done;){var p=o.value;if(!p.spherical&&!(Math.abs(p.directionChange)>this._settings.stepMaxDirectionChange)){var f=this._spatial.angleDifference(s.motionChange,p.motionChange),d=this._spatial.angleDifference(p.directionChange,f),v=Math.max(Math.abs(f),Math.abs(d));if(!(Math.abs(v)>this._settings.stepMaxDrift)){var m=p.id;if(!s.useFallback||m!==n&&m!==i||(c=p),!(p.distance>this._settings.stepMaxDistance)){f=Math.sqrt(f*f+p.verticalMotion*p.verticalMotion);var g=this._coefficients.stepPreferredDistance*Math.abs(p.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*f/this._settings.stepMaxDrift+this._coefficients.stepRotation*p.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(p.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(p.sameMergeCC?0:1);g<u&&(u=g,l=p)}}}}}catch(Tx){h.e(Tx)}finally{h.f()}null!=(l=null==l?c:l)&&r.push({data:{direction:s.direction,worldMotionAzimuth:l.worldMotionAzimuth},source:t.id,target:l.id})}return r}},{key:"computeTurnEdges",value:function(t,e){if(!t.complete)throw new qf("Image has to be full.");var n=[];if(Zf(t.cameraType))return n;for(var i in this._directions.turns)if(this._directions.turns.hasOwnProperty(i)){var r,a=this._directions.turns[i],o=Number.MAX_VALUE,s=null,u=wt(e);try{for(u.s();!(r=u.n()).done;){var l=r.value;if(!l.spherical&&!(l.distance>this._settings.turnMaxDistance)){var c=a.direction!==Of.TurnU&&l.distance<this._settings.turnMaxRigDistance&&Math.abs(l.directionChange)>this._settings.turnMinRigDirectionChange,h=this._spatial.angleDifference(a.directionChange,l.directionChange),p=void 0;if(c&&l.directionChange*a.directionChange>0&&Math.abs(l.directionChange)<Math.abs(a.directionChange))p=-Math.PI/2+Math.abs(l.directionChange);else{if(Math.abs(h)>this._settings.turnMaxDirectionChange)continue;var f=a.motionChange?this._spatial.angleDifference(a.motionChange,l.motionChange):0;f=Math.sqrt(f*f+l.verticalMotion*l.verticalMotion),p=this._coefficients.turnDistance*l.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*f/Math.PI+this._coefficients.turnSequencePenalty*(l.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(l.sameMergeCC?0:1)}p<o&&(o=p,s=l)}}}catch(Tx){u.e(Tx)}finally{u.f()}null!=s&&n.push({data:{direction:a.direction,worldMotionAzimuth:s.worldMotionAzimuth},source:t.id,target:s.id})}return n}},{key:"computePerspectiveToSphericalEdges",value:function(t,e){if(!t.complete)throw new qf("Image has to be full.");if(Zf(t.cameraType))return[];var n,i=Number.MAX_VALUE,r=null,a=wt(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.spherical){var s=this._coefficients.sphericalPreferredDistance*Math.abs(o.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(o.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(o.sameMergeCC?0:1);s<i&&(i=s,r=o)}}}catch(Tx){a.e(Tx)}finally{a.f()}return null==r?[]:[{data:{direction:Of.Spherical,worldMotionAzimuth:r.worldMotionAzimuth},source:t.id,target:r.id}]}},{key:"computeSphericalEdges",value:function(t,e){if(!t.complete)throw new qf("Image has to be full.");if(!Zf(t.cameraType))return[];var n,i=[],r=[],a=[],o=wt(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!(s.distance>this._settings.sphericalMaxDistance))if(s.spherical){if(s.distance<this._settings.sphericalMinDistance)continue;r.push(s)}else for(var u in this._directions.spherical)if(this._directions.spherical.hasOwnProperty(u)){var l=this._directions.spherical[u],c=this._spatial.angleDifference(s.directionChange,s.motionChange),h=this._spatial.angleDifference(l.directionChange,c);if(!(Math.abs(h)>this._settings.sphericalMaxStepTurnChange)){a.push([l.direction,s]);break}}}}catch(Tx){o.e(Tx)}finally{o.f()}for(var p=Math.PI/this._settings.sphericalMaxItems,f=[],d=[],v=0;v<this._settings.sphericalMaxItems;v++){var m,g=v/this._settings.sphericalMaxItems*2*Math.PI,y=Number.MAX_VALUE,_=null,b=wt(r);try{for(b.s();!(m=b.n()).done;){var x=m.value,w=this._spatial.angleDifference(g,x.motionChange);if(!(Math.abs(w)>p)){var S,k=Number.MAX_VALUE,M=wt(f);try{for(M.s();!(S=M.n()).done;){var T=S.value,E=Math.abs(this._spatial.angleDifference(T,x.motionChange));E<k&&(k=E)}}catch(Tx){M.e(Tx)}finally{M.f()}if(!(k<=p)){var C=this._coefficients.sphericalPreferredDistance*Math.abs(x.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(w)/p+this._coefficients.sphericalSequencePenalty*(x.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(x.sameMergeCC?0:1);C<y&&(y=C,_=x)}}}}catch(Tx){b.e(Tx)}finally{b.f()}null!=_?(f.push(_.motionChange),i.push({data:{direction:Of.Spherical,worldMotionAzimuth:_.worldMotionAzimuth},source:t.id,target:_.id})):d.push(g)}var I={};I[Of.Spherical]=f,I[Of.StepForward]=[],I[Of.StepLeft]=[],I[Of.StepBackward]=[],I[Of.StepRight]=[];for(var P=0,A=d;P<A.length;P++){var L=A[P],R=[];for(var D in this._directions.spherical)if(this._directions.spherical.hasOwnProperty(D)){var z,O=this._directions.spherical[D],F=I[Of.Spherical].concat(I[O.direction]).concat(I[O.prev]).concat(I[O.next]),N=Number.MAX_VALUE,B=null,j=wt(a);try{for(j.s();!(z=j.n()).done;){var V=z.value;if(V[0]===O.direction){var U=this._spatial.angleDifference(L,V[1].motionChange);if(!(Math.abs(U)>p)){var $,H=Number.MAX_VALUE,q=wt(F);try{for(q.s();!($=q.n()).done;){var W=$.value,G=Math.abs(this._spatial.angleDifference(W,V[1].motionChange));G<H&&(H=G)}}catch(Tx){q.e(Tx)}finally{q.f()}if(!(H<=p)){var Z=this._coefficients.sphericalPreferredDistance*Math.abs(V[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(U)/p+this._coefficients.sphericalMergeCCPenalty*(V[1].sameMergeCC?0:1);Z<N&&(N=Z,B=V)}}}}}catch(Tx){j.e(Tx)}finally{j.f()}null!=B&&(R.push(B),i.push({data:{direction:B[0],worldMotionAzimuth:B[1].worldMotionAzimuth},source:t.id,target:B[1].id}))}for(var X=0,Y=R;X<Y.length;X++){var K=Y[X];I[K[0]].push(K[1].motionChange)}}return i}}]),t}(),Qf=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),i=e.call(this,t),Object.setPrototypeOf(ft(i),n.prototype),i.name="GraphMapillaryError",i}return Ct(n)}(Hf),td=function(){function t(e,n,i,r,a,o){Tt(this,t),this._api=e,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new te,this._filterCreator=null!==a&&void 0!==a?a:new tr,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new te,this._filter$=on(xe(this._filter),this._filterSubject$).pipe(bi(1),ne()),this._filterSubscription=this._filter$.subscribe((function(){})),this._defaultAlt=2,this._edgeCalculator=null!==r&&void 0!==r?r:new Jf,this._graphCalculator=null!==i&&void 0!==i?i:new Ff,this._configuration=null!==o&&void 0!==o?o:{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=null!==n&&void 0!==n?n:new t._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}return Ct(t,[{key:"api",get:function(){return this._api}},{key:"changed$",get:function(){return this._changed$}},{key:"filter$",get:function(){return this._filter$}},{key:"cacheBoundingBox$",value:function(t,e){var n=this,i=this._api.data.geometry.bboxToCellIds(t,e).filter((function(t){return!(t in n._cachedTiles)})).map((function(t){return t in n._cachingTiles$?n._cachingTiles$[t]:n._cacheTile$(t)}));return 0===i.length&&i.push(xe(this)),Ye(i).pipe(rn(),ui(),tn((function(){var i,r=[],a=[],o=wt(n._nodeIndex.search({maxX:e.lng,maxY:e.lat,minX:t.lng,minY:t.lat}).map((function(t){return t.node})));try{for(o.s();!(i=o.n()).done;){var s=i.value;s.complete?r.push(s):a.push(s.id)}}catch(Tx){o.e(Tx)}finally{o.f()}for(var u=[];a.length>0;)u.push(a.splice(0,200));var l=xe(r),c=u.map((function(t){return n._api.getSpatialImages$(t).pipe(De((function(t){var e,i=[],r=wt(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(n.hasNode(a.node_id)){var o=n.getNode(a.node_id);o.complete||n._makeFull(o,a.node),i.push(o)}}}catch(Tx){r.e(Tx)}finally{r.f()}return i})))}));return cn(l,Ye(c).pipe(rn()))})),pi((function(t,e){return t.concat(e)})))}},{key:"cacheCell$",value:function(t){var e=this,n=t in this._cachedTiles?xe(this):t in this._cachingTiles$?this._cachingTiles$[t]:this._cacheTile$(t);return n.pipe(tn((function(){var n=e._cachedTiles[t];n.accessed=(new Date).getTime();var i,r=[],a=[],o=wt(n.nodes);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.complete?r.push(s):a.push(s.id)}}catch(Tx){o.e(Tx)}finally{o.f()}for(var u=[];a.length>0;)u.push(a.splice(0,200));var l=xe(r),c=u.map((function(t){return e._api.getSpatialImages$(t).pipe(De((function(t){var n,i=[],r=wt(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.node){var o=a.node_id;if(e.hasNode(o)){var s=e.getNode(o);s.complete||e._makeFull(s,a.node),i.push(s)}}else console.warn("Image is empty (".concat(a.node,")"))}}catch(Tx){r.e(Tx)}finally{r.f()}return i})))}));return cn(l,Ye(c).pipe(rn()))})),pi((function(t,e){return t.concat(e)})))}},{key:"cacheFill$",value:function(t){var e=this;if(t in this._cachingFull$)throw new Qf("Cannot fill node while caching full (".concat(t,")."));if(!this.hasNode(t))throw new Qf("Cannot fill node that does not exist in graph (".concat(t,")."));if(t in this._cachingFill$)return this._cachingFill$[t];var n=this.getNode(t);if(n.complete)throw new Qf("Cannot fill node that is already full (".concat(t,")."));return this._cachingFill$[t]=this._api.getSpatialImages$([t]).pipe(Hi((function(t){var i,r=wt(t);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.node||console.warn("Image is empty ".concat(a.node_id)),n.complete||e._makeFull(n,a.node),delete e._cachingFill$[a.node_id]}}catch(Tx){r.e(Tx)}finally{r.f()}})),De((function(){return e})),ei((function(){t in e._cachingFill$&&delete e._cachingFill$[t],e._changed$.next(e)})),_i(),ne()),this._cachingFill$[t]}},{key:"cacheFull$",value:function(t){var e=this;if(t in this._cachingFull$)return this._cachingFull$[t];if(this.hasNode(t))throw new Qf("Cannot cache full node that already exist in graph (".concat(t,")."));return this._cachingFull$[t]=this._api.getImages$([t]).pipe(Hi((function(n){var i,r=wt(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(!a.node)throw new Qf("Image does not exist (".concat(t,", ").concat(a.node,")."));var o=a.node_id;if(e.hasNode(o)){var s=e.getNode(t);s.complete||e._makeFull(s,a.node)}else{if(null==a.node.sequence.id)throw new Qf("Image has no sequence key (".concat(t,")."));var u=new Nf(a.node);e._makeFull(u,a.node);var l=e._api.data.geometry.lngLatToCellId(u.originalLngLat);e._preStore(l,u),e._setNode(u),delete e._cachingFull$[o]}}}catch(Tx){r.e(Tx)}finally{r.f()}})),De((function(){return e})),ei((function(){t in e._cachingFull$&&delete e._cachingFull$[t],e._changed$.next(e)})),_i(),ne()),this._cachingFull$[t]}},{key:"cacheNodeSequence$",value:function(t){if(!this.hasNode(t))throw new Qf("Cannot cache sequence edges of node that does not exist in graph (".concat(t,")."));var e=this.getNode(t);if(e.sequenceId in this._sequences)throw new Qf("Sequence already cached (".concat(t,"), (").concat(e.sequenceId,")."));return this._cacheSequence$(e.sequenceId)}},{key:"cacheSequence$",value:function(t){if(t in this._sequences)throw new Qf("Sequence already cached (".concat(t,")"));return this._cacheSequence$(t)}},{key:"cacheSequenceEdges",value:function(t){var e=this.getNode(t);if(!(e.sequenceId in this._sequences))throw new Qf("Sequence is not cached (".concat(t,"), (").concat(e.sequenceId,")"));var n=this._sequences[e.sequenceId].sequence,i=this._edgeCalculator.computeSequenceEdges(e,n);e.cacheSequenceEdges(i)}},{key:"cacheSequenceNodes$",value:function(t,e){var n=this;if(!this.hasSequence(t))throw new Qf("Cannot cache sequence nodes of sequence that does not exist in graph (".concat(t,")."));if(this.hasSequenceNodes(t))throw new Qf("Sequence nodes already cached (".concat(t,")."));var i=this.getSequence(t);if(i.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[i.id];var r=[],a=i.imageIds.slice();if(e&&a.length>50){var o=a.indexOf(e),s=Math.max(0,Math.min(o-25,a.length-50));r.push(a.splice(s,50))}for(;a.length>0;)r.push(a.splice(0,200));var u=r.length,l=Ye(r).pipe(tn((function(t){return n._api.getImages$(t).pipe(Hi((function(t){var e,i=wt(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.node){var a=r.node_id;if(n.hasNode(a)){var o=n.getNode(a);o.complete||n._makeFull(o,r.node)}else{null==r.node.sequence.id&&console.warn("Sequence missing, discarding node (".concat(r.node_id,")"));var s=new Nf(r.node);n._makeFull(s,r.node);var l=n._api.data.geometry.lngLatToCellId(s.originalLngLat);n._preStore(l,s),n._setNode(s)}}else console.warn("Image empty (".concat(r.node_id,")"))}}catch(Tx){i.e(Tx)}finally{i.f()}u--})),De((function(){return n})))}),6),ui(),ei((function(){delete n._cachingSequenceNodes$[i.id],0===u&&(n._cachedSequenceNodes[i.id]=!0)})),_i(),ne());return this._cachingSequenceNodes$[i.id]=l,l}},{key:"cacheSpatialArea$",value:function(t){var e=this;if(!this.hasNode(t))throw new Qf("Cannot cache spatial area of node that does not exist in graph (".concat(t,")."));if(t in this._cachedSpatialEdges)throw new Qf("Image already spatially cached (".concat(t,")."));if(!(t in this._requiredSpatialArea))throw new Qf("Spatial area not determined (".concat(t,")."));var n=this._requiredSpatialArea[t];if(0===Object.keys(n.cacheNodes).length)throw new Qf("Spatial nodes already cached (".concat(t,")."));if(t in this._cachingSpatialArea$)return this._cachingSpatialArea$[t];for(var i=[];n.cacheKeys.length>0;)i.push(n.cacheKeys.splice(0,200));for(var r=i.length,a=[],o=function(){var i=u[s],o=e._api.getSpatialImages$(i).pipe(Hi((function(i){var a,o=wt(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.node){var u=s.node_id,l=n.cacheNodes[u];l.complete||e._makeFull(l,s.node),delete n.cacheNodes[u]}else console.warn("Image is empty (".concat(s.node_id,")"))}}catch(Tx){o.e(Tx)}finally{o.f()}0===--r&&delete e._cachingSpatialArea$[t]})),De((function(){return e})),An((function(a){var o,s=wt(i);try{for(s.s();!(o=s.n()).done;){var u=o.value;u in n.all&&delete n.all[u],u in n.cacheNodes&&delete n.cacheNodes[u]}}catch(Tx){s.e(Tx)}finally{s.f()}throw 0===--r&&delete e._cachingSpatialArea$[t],a})),ei((function(){0===Object.keys(n.cacheNodes).length&&e._changed$.next(e)})),_i(),ne());a.push(o)},s=0,u=i;s<u.length;s++)o();return this._cachingSpatialArea$[t]=a,a}},{key:"cacheSpatialEdges",value:function(t){if(t in this._cachedSpatialEdges)throw new Qf("Spatial edges already cached (".concat(t,")."));var e=this.getNode(t),n=this._sequences[e.sequenceId].sequence,i=[],r=n.findPrev(e.id);null!=r&&i.push(r);var a=n.findNext(e.id);null!=a&&i.push(a);var o=this._requiredSpatialArea[t].all,s=[],u=this._filter;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];u(c)&&s.push(c)}var h=this._edgeCalculator.getPotentialEdges(e,s,i),p=this._edgeCalculator.computeStepEdges(e,h,r,a);p=(p=(p=(p=p.concat(this._edgeCalculator.computeTurnEdges(e,h))).concat(this._edgeCalculator.computeSphericalEdges(e,h))).concat(this._edgeCalculator.computePerspectiveToSphericalEdges(e,h))).concat(this._edgeCalculator.computeSimilarEdges(e,h)),e.cacheSpatialEdges(p),this._cachedSpatialEdges[t]=e,delete this._requiredSpatialArea[t],delete this._cachedNodeTiles[t]}},{key:"cacheTiles$",value:function(t){var e=this;if(t in this._cachedNodeTiles)throw new Qf("Tiles already cached (".concat(t,")."));if(t in this._cachedSpatialEdges)throw new Qf("Spatial edges already cached so tiles considered cached (".concat(t,")."));if(!(t in this._requiredNodeTiles))throw new Qf("Tiles have not been determined (".concat(t,")."));var n=this._requiredNodeTiles[t];if(0===n.cache.length&&0===n.caching.length)throw new Qf("Tiles already cached (".concat(t,")."));if(!this.hasNode(t))throw new Qf("Cannot cache tiles of node that does not exist in graph (".concat(t,")."));var i=n.cache.slice();n.caching=this._requiredNodeTiles[t].caching.concat(i),n.cache=[];var r,a=[],o=wt(n.caching);try{var s=function(){var i=r.value,o=i in e._cachingTiles$?e._cachingTiles$[i]:e._cacheTile$(i);a.push(o.pipe(Hi((function(r){var a=n.caching.indexOf(i);a>-1&&n.caching.splice(a,1),0===n.caching.length&&0===n.cache.length&&(delete e._requiredNodeTiles[t],e._cachedNodeTiles[t]=!0)})),An((function(r){var a=n.caching.indexOf(i);throw a>-1&&n.caching.splice(a,1),0===n.caching.length&&0===n.cache.length&&(delete e._requiredNodeTiles[t],e._cachedNodeTiles[t]=!0),r})),ei((function(){e._changed$.next(e)})),_i(),ne()))};for(o.s();!(r=o.n()).done;)s()}catch(Tx){o.e(Tx)}finally{o.f()}return a}},{key:"initializeCache",value:function(t){if(t in this._cachedNodes)throw new Qf("Image already in cache (".concat(t,")."));var e=this.getNode(t),n=this._api.data;e.initializeCache(new Bf(n));var i=(new Date).getTime();this._cachedNodes[t]={accessed:i,node:e},this._updateCachedTileAccess(t,i)}},{key:"isCachingFill",value:function(t){return t in this._cachingFill$}},{key:"isCachingFull",value:function(t){return t in this._cachingFull$}},{key:"isCachingNodeSequence",value:function(t){return this.getNode(t).sequenceId in this._cachingSequences$}},{key:"isCachingSequence",value:function(t){return t in this._cachingSequences$}},{key:"isCachingSequenceNodes",value:function(t){return t in this._cachingSequenceNodes$}},{key:"isCachingTiles",value:function(t){return t in this._requiredNodeTiles&&0===this._requiredNodeTiles[t].cache.length&&this._requiredNodeTiles[t].caching.length>0}},{key:"hasInitializedCache",value:function(t){return t in this._cachedNodes}},{key:"hasNode",value:function(t){var e=(new Date).getTime();return this._updateCachedNodeAccess(t,e),this._updateCachedTileAccess(t,e),t in this._nodes}},{key:"hasNodeSequence",value:function(t){var e=this.getNode(t).sequenceId,n=e in this._sequences;return n&&(this._sequences[e].accessed=(new Date).getTime()),n}},{key:"hasSequence",value:function(t){var e=t in this._sequences;return e&&(this._sequences[t].accessed=(new Date).getTime()),e}},{key:"hasSequenceNodes",value:function(t){return t in this._cachedSequenceNodes}},{key:"hasSpatialArea",value:function(t){if(!this.hasNode(t))throw new Qf("Spatial area nodes cannot be determined if node not in graph (".concat(t,")."));if(t in this._cachedSpatialEdges)return!0;if(t in this._requiredSpatialArea)return 0===Object.keys(this._requiredSpatialArea[t].cacheNodes).length;var e,n=this.getNode(t),i=this._graphCalculator.boundingBoxCorners(n.lngLat,this._tileThreshold),r={all:{},cacheKeys:[],cacheNodes:{}},a=wt(this._nodeIndex.search({maxX:i[1].lng,maxY:i[1].lat,minX:i[0].lng,minY:i[0].lat}));try{for(a.s();!(e=a.n()).done;){var o=e.value;r.all[o.node.id]=o.node,o.node.complete||(r.cacheKeys.push(o.node.id),r.cacheNodes[o.node.id]=o.node)}}catch(Tx){a.e(Tx)}finally{a.f()}return this._requiredSpatialArea[t]=r,0===r.cacheKeys.length}},{key:"hasTiles",value:function(t){var e=this;if(t in this._cachedNodeTiles)return!0;if(t in this._cachedSpatialEdges)return!0;if(!this.hasNode(t))throw new Qf("Image does not exist in graph (".concat(t,")."));var n={cache:[],caching:[]};if(t in this._requiredNodeTiles)n=this._requiredNodeTiles[t];else{var i=this.getNode(t),r=rt(this._graphCalculator.boundingBoxCorners(i.lngLat,this._tileThreshold),2),a=r[0],o=r[1];n.cache=this._api.data.geometry.bboxToCellIds(a,o).filter((function(t){return!(t in e._cachedTiles)})),n.cache.length>0&&(this._requiredNodeTiles[t]=n)}return 0===n.cache.length&&0===n.caching.length}},{key:"getNode",value:function(t){var e=(new Date).getTime();return this._updateCachedNodeAccess(t,e),this._updateCachedTileAccess(t,e),this._nodes[t]}},{key:"getSequence",value:function(t){var e=this._sequences[t];return e.accessed=(new Date).getTime(),e.sequence}},{key:"resetSpatialEdges",value:function(){for(var t=0,e=Object.keys(this._cachedSpatialEdges);t<e.length;t++){var n=e[t];this._cachedSpatialEdges[n].resetSpatialEdges(),delete this._cachedSpatialEdges[n]}}},{key:"reset",value:function(t){var e,n=[],i=wt(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(!this.hasNode(r))throw new Error("Image does not exist ".concat(r));var a=this.getNode(r);a.resetSequenceEdges(),a.resetSpatialEdges(),n.push(a)}}catch(Tx){i.e(Tx)}finally{i.f()}for(var o=0,s=Object.keys(this._cachedNodes);o<s.length;o++){var u=s[o];-1===t.indexOf(u)&&(this._cachedNodes[u].node.dispose(),delete this._cachedNodes[u])}this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(var l=0,c=n;l<c.length;l++){var h=c[l];this._nodes[h.id]=h;var p=this._api.data.geometry.lngLatToCellId(h.originalLngLat);this._preStore(p,h)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}},{key:"setFilter",value:function(t){this._filter=this._filterCreator.createFilter(t),this._filterSubject$.next(this._filter)}},{key:"uncache",value:function(t,e,n){var i={};this._addNewKeys(i,this._cachingFull$),this._addNewKeys(i,this._cachingFill$),this._addNewKeys(i,this._cachingSpatialArea$),this._addNewKeys(i,this._requiredNodeTiles),this._addNewKeys(i,this._requiredSpatialArea);var r,a=wt(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;o in i||(i[o]=!0)}}catch(Tx){a.e(Tx)}finally{a.f()}var s=this._tileThreshold,u=this._graphCalculator,l=this._api.data.geometry,c=new Set(e);for(var h in i)if(i.hasOwnProperty(h)){var p,f=this._nodes[h],d=rt(u.boundingBoxCorners(f.lngLat,s),2),v=d[0],m=d[1],g=wt(l.bboxToCellIds(v,m));try{for(g.s();!(p=g.n()).done;){var y=p.value;c.has(y)||c.add(y)}}catch(Tx){g.e(Tx)}finally{g.f()}}var _=[];for(var b in this._cachedTiles)this._cachedTiles.hasOwnProperty(b)&&!c.has(b)&&_.push([b,this._cachedTiles[b]]);var x,w=_.sort((function(t,e){return e[1].accessed-t[1].accessed})).slice(this._configuration.maxUnusedTiles).map((function(t){return t[0]})),S=wt(w);try{for(S.s();!(x=S.n()).done;){var k=x.value;this._uncacheTile(k,n)}}catch(Tx){S.e(Tx)}finally{S.f()}var M=[],T=[];for(var E in this._preStored)if(this._preStored.hasOwnProperty(E)&&!(E in this._cachingTiles$)){var C=this._preStored[E];for(var I in C)C.hasOwnProperty(I)&&!(I in i)&&C[I].sequenceId!==n&&(I in this._cachedNodes?M.push([this._cachedNodes[I],E]):T.push([I,E]))}var P=M.sort((function(t,e){var n=rt(t,1)[0];return rt(e,1)[0].accessed-n.accessed})).slice(this._configuration.maxUnusedPreStoredImages).map((function(t){var e=rt(t,2),n=e[0],i=e[1];return[n.node.id,i]}));this._uncachePreStored(T),this._uncachePreStored(P);var A=[];for(var L in this._cachedNodes)this._cachedNodes.hasOwnProperty(L)&&!(L in i)&&A.push(this._cachedNodes[L]);var R,D=wt(A.sort((function(t,e){return e.accessed-t.accessed})).slice(this._configuration.maxUnusedImages));try{for(D.s();!(R=D.n()).done;){var z=R.value;z.node.uncache();var O=z.node.id;delete this._cachedNodes[O],O in this._cachedNodeTiles&&delete this._cachedNodeTiles[O],O in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[O]}}catch(Tx){D.e(Tx)}finally{D.f()}var F=[];for(var N in this._sequences)this._sequences.hasOwnProperty(N)&&!(N in this._cachingSequences$)&&N!==n&&F.push(this._sequences[N]);var B,j=wt(F.sort((function(t,e){return e.accessed-t.accessed})).slice(this._configuration.maxSequences));try{for(j.s();!(B=j.n()).done;){var V=B.value,U=V.sequence.id;delete this._sequences[U],U in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[U],V.sequence.dispose()}}catch(Tx){j.e(Tx)}finally{j.f()}}},{key:"updateCells$",value:function(t){var e=this,n=this._cachedTiles,i=this._cachingTiles$;return Ye(t).pipe(tn((function(t){return t in n?e._updateCell$(t):t in i?i[t].pipe(An((function(){return xe(e)})),tn((function(){return e._updateCell$(t)}))):me()})))}},{key:"unsubscribe",value:function(){this._filterSubscription.unsubscribe()}},{key:"_addNewKeys",value:function(t,e){for(var n in e)e.hasOwnProperty(n)&&this.hasNode(n)&&(n in t||(t[n]=!0))}},{key:"_cacheSequence$",value:function(t){var e=this;return t in this._cachingSequences$||(this._cachingSequences$[t]=this._api.getSequence$(t).pipe(Hi((function(n){n?(n.id in e._sequences||(e._sequences[n.id]={accessed:(new Date).getTime(),sequence:new jf(n)}),delete e._cachingSequences$[t]):console.warn("Sequence does not exist "+"(".concat(t,")"))})),De((function(){return e})),ei((function(){t in e._cachingSequences$&&delete e._cachingSequences$[t],e._changed$.next(e)})),_i(),ne())),this._cachingSequences$[t]}},{key:"_cacheTile$",value:function(t){var e=this;return this._cachingTiles$[t]=this._api.getCoreImages$(t).pipe(Hi((function(n){if(!(t in e._cachedTiles)){var i=n.images;e._nodeIndexTiles[t]=[],e._cachedTiles[t]={accessed:(new Date).getTime(),nodes:[]};var r,a=e._cachedTiles[t].nodes,o=e._removeFromPreStore(t),s=wt(i);try{for(s.s();!(r=s.n()).done;){var u=r.value;if(!u)break;if(null!=u.sequence.id)if(null!=o&&u.id in o){var l=o[u.id];delete o[u.id],a.push(l);var c={lat:l.lngLat.lat,lng:l.lngLat.lng,node:l};e._nodeIndex.insert(c),e._nodeIndexTiles[t].push(c),e._nodeToTile[l.id]=t}else{var h=new Nf(u);a.push(h);var p={lat:h.lngLat.lat,lng:h.lngLat.lng,node:h};e._nodeIndex.insert(p),e._nodeIndexTiles[t].push(p),e._nodeToTile[h.id]=t,e._setNode(h)}else console.warn("Sequence missing, discarding "+"node (".concat(u.id,")"))}}catch(Tx){s.e(Tx)}finally{s.f()}delete e._cachingTiles$[t]}})),De((function(){return e})),An((function(n){throw delete e._cachingTiles$[t],n})),_i(),ne()),this._cachingTiles$[t]}},{key:"_makeFull",value:function(t,e){null==e.computed_altitude&&(e.computed_altitude=this._defaultAlt),null==e.computed_rotation&&(e.computed_rotation=this._graphCalculator.rotationFromCompass(e.compass_angle,e.exif_orientation)),t.makeComplete(e)}},{key:"_preStore",value:function(t,e){t in this._preStored||(this._preStored[t]={}),this._preStored[t][e.id]=e}},{key:"_removeFromPreStore",value:function(t){var e=null;return t in this._preStored&&(e=this._preStored[t],delete this._preStored[t]),e}},{key:"_setNode",value:function(t){var e=t.id;if(this.hasNode(e))throw new Qf("Image already exist (".concat(e,")."));this._nodes[e]=t}},{key:"_uncacheTile",value:function(t,e){var n,i=wt(this._cachedTiles[t].nodes);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.id;delete this._nodeToTile[a],a in this._cachedNodes&&delete this._cachedNodes[a],a in this._cachedNodeTiles&&delete this._cachedNodeTiles[a],a in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[a],r.sequenceId===e?(this._preStore(t,r),r.uncache()):(delete this._nodes[a],r.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[r.sequenceId],r.dispose())}}catch(Tx){i.e(Tx)}finally{i.f()}var o,s=wt(this._nodeIndexTiles[t]);try{for(s.s();!(o=s.n()).done;){var u=o.value;this._nodeIndex.remove(u)}}catch(Tx){s.e(Tx)}finally{s.f()}delete this._nodeIndexTiles[t],delete this._cachedTiles[t]}},{key:"_uncachePreStored",value:function(t){var e,n={},i=wt(t);try{for(i.s();!(e=i.n()).done;){var r=rt(e.value,2),a=r[0],o=r[1];a in this._nodes&&delete this._nodes[a],a in this._cachedNodes&&delete this._cachedNodes[a];var s=this._preStored[o][a];s.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[s.sequenceId],delete this._preStored[o][a],s.dispose(),n[o]=!0}}catch(Tx){i.e(Tx)}finally{i.f()}for(var u in n)n.hasOwnProperty(u)&&0===Object.keys(this._preStored[u]).length&&delete this._preStored[u]}},{key:"_updateCachedTileAccess",value:function(t,e){t in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[t]].accessed=e)}},{key:"_updateCachedNodeAccess",value:function(t,e){t in this._cachedNodes&&(this._cachedNodes[t].accessed=e)}},{key:"_updateCell$",value:function(t){var e=this;return this._api.getCoreImages$(t).pipe(tn((function(n){if(!(t in e._cachedTiles))return me();var i=e._nodeIndex,r=e._nodeIndexTiles[t],a=e._nodeToTile,o=e._cachedTiles[t];o.accessed=(new Date).getTime();var s,u=o.nodes,l=wt(n.images);try{for(l.s();!(s=l.n()).done;){var c=s.value;if(null==c)break;if(!e.hasNode(c.id))if(null!=c.sequence.id){var h=new Nf(c);u.push(h);var p={lat:h.lngLat.lat,lng:h.lngLat.lng,node:h};i.insert(p),r.push(p),a[h.id]=t,e._setNode(h)}else console.warn("Sequence missing, discarding "+"node (".concat(c.id,")"))}}catch(Tx){l.e(Tx)}finally{l.f()}return xe(t)})),An((function(t){return console.error(t),me()})))}}],[{key:"register",value:function(e){t._spatialIndex=e}}]),t}(),ed=function(){function t(){Tt(this,t),this._hash={},this._index=new t._spatialIndex(16),this._indexChanged$=new te,this._updated$=new te}return Ct(t,[{key:"changed$",get:function(){return this._indexChanged$}},{key:"updated$",get:function(){return this._updated$}},{key:"add",value:function(t){var e,n=[],i=this._hash,r=this._index,a=wt(t);try{for(a.s();!(e=a.n()).done;){var o=e.value,s=o.id;s in i&&(r.remove(i[s]),n.push(o));var u={lat:o.lngLat.lat,lng:o.lngLat.lng,marker:o};i[s]=u,r.insert(u)}}catch(Tx){a.e(Tx)}finally{a.f()}n.length>0&&this._updated$.next(n),t.length>n.length&&this._indexChanged$.next(this)}},{key:"has",value:function(t){return t in this._hash}},{key:"get",value:function(t){return this.has(t)?this._hash[t].marker:void 0}},{key:"getAll",value:function(){return this._index.all().map((function(t){return t.marker}))}},{key:"remove",value:function(t){var e,n=this._hash,i=this._index,r=!1,a=wt(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(o in n){var s=n[o];i.remove(s),delete n[o],r=!0}}}catch(Tx){a.e(Tx)}finally{a.f()}r&&this._indexChanged$.next(this)}},{key:"removeAll",value:function(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}},{key:"search",value:function(t){var e=rt(t,2),n=e[0],i=e[1];return this._index.search({maxX:i.lng,maxY:i.lat,minX:n.lng,minY:n.lat}).map((function(t){return t.marker}))}},{key:"update",value:function(t){var e=this._hash,n=this._index,i=t.id;if(i in e){n.remove(e[i]);var r={lat:t.lngLat.lat,lng:t.lngLat.lng,marker:t};e[i]=r,n.insert(r)}}}],[{key:"register",value:function(e){t._spatialIndex=e}}]),t}();function nd(t,e,n,i,r){id(t,e,n||0,i||t.length-1,r||ad)}function id(t,e,n,i,r){for(;i>n;){if(i-n>600){var a=i-n+1,o=e-n+1,s=Math.log(a),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1);id(t,e,Math.max(n,Math.floor(e-o*u/a+l)),Math.min(i,Math.floor(e+(a-o)*u/a+l)),r)}var c=t[e],h=n,p=i;for(rd(t,n,e),r(t[i],c)>0&&rd(t,n,i);h<p;){for(rd(t,h,p),h++,p--;r(t[h],c)<0;)h++;for(;r(t[p],c)>0;)p--}0===r(t[n],c)?rd(t,n,p):rd(t,++p,i),p<=e&&(n=p+1),e<=p&&(i=p-1)}}function rd(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function ad(t,e){return t<e?-1:t>e?1:0}var od=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;Tt(this,t),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}return Ct(t,[{key:"all",value:function(){return this._all(this.data,[])}},{key:"search",value:function(t){var e=this.data,n=[];if(!gd(t,e))return n;for(var i=this.toBBox,r=[];e;){for(var a=0;a<e.children.length;a++){var o=e.children[a],s=e.leaf?i(o):o;gd(t,s)&&(e.leaf?n.push(o):md(t,s)?this._all(o,n):r.push(o))}e=r.pop()}return n}},{key:"collides",value:function(t){var e=this.data;if(!gd(t,e))return!1;for(var n=[];e;){for(var i=0;i<e.children.length;i++){var r=e.children[i],a=e.leaf?this.toBBox(r):r;if(gd(t,a)){if(e.leaf||md(t,a))return!0;n.push(r)}}e=n.pop()}return!1}},{key:"load",value:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}},{key:"insert",value:function(t){return t&&this._insert(t,this.data.height-1),this}},{key:"clear",value:function(){return this.data=yd([]),this}},{key:"remove",value:function(t,e){if(!t)return this;for(var n,i,r,a=this.data,o=this.toBBox(t),s=[],u=[];a||s.length;){if(a||(a=s.pop(),i=s[s.length-1],n=u.pop(),r=!0),a.leaf){var l=sd(t,a.children,e);if(-1!==l)return a.children.splice(l,1),s.push(a),this._condense(s),this}r||a.leaf||!md(a,o)?i?(n++,a=i.children[n],r=!1):a=null:(s.push(a),u.push(n),n=0,i=a,a=a.children[0])}return this}},{key:"toBBox",value:function(t){return t}},{key:"compareMinX",value:function(t,e){return t.minX-e.minX}},{key:"compareMinY",value:function(t,e){return t.minY-e.minY}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(t){return this.data=t,this}},{key:"_all",value:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,vt(t.children)):n.push.apply(n,vt(t.children)),t=n.pop();return e}},{key:"_build",value:function(t,e,n,i){var r,a=n-e+1,o=this._maxEntries;if(a<=o)return ud(r=yd(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(r=yd([])).leaf=!1,r.height=i;var s=Math.ceil(a/o),u=s*Math.ceil(Math.sqrt(o));_d(t,e,n,u,this.compareMinX);for(var l=e;l<=n;l+=u){var c=Math.min(l+u-1,n);_d(t,l,c,s,this.compareMinY);for(var h=l;h<=c;h+=s){var p=Math.min(h+s-1,c);r.children.push(this._build(t,h,p,i-1))}}return ud(r,this.toBBox),r}},{key:"_chooseSubtree",value:function(t,e,n,i){for(;i.push(e),!e.leaf&&i.length-1!==n;){for(var r=1/0,a=1/0,o=void 0,s=0;s<e.children.length;s++){var u=e.children[s],l=fd(u),c=(h=t,p=u,(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-l);c<a?(a=c,r=l<r?l:r,o=u):c===a&&l<r&&(r=l,o=u)}e=o||e.children[0]}var h,p;return e}},{key:"_insert",value:function(t,e,n){var i=n?t:this.toBBox(t),r=[],a=this._chooseSubtree(i,this.data,e,r);for(a.children.push(t),cd(a,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)}},{key:"_split",value:function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var a=this._chooseSplitIndex(n,r,i),o=yd(n.children.splice(a,n.children.length-a));o.height=n.height,o.leaf=n.leaf,ud(n,this.toBBox),ud(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(n,o)}},{key:"_splitRoot",value:function(t,e){this.data=yd([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ud(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(t,e,n){for(var i,r=1/0,a=1/0,o=e;o<=n-e;o++){var s=ld(t,0,o,this.toBBox),u=ld(t,o,n,this.toBBox),l=vd(s,u),c=fd(s)+fd(u);l<r?(r=l,i=o,a=c<a?c:a):l===r&&c<a&&(a=c,i=o)}return i||n-e}},{key:"_chooseSplitAxis",value:function(t,e,n){var i=t.leaf?this.compareMinX:hd,r=t.leaf?this.compareMinY:pd;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)}},{key:"_allDistMargin",value:function(t,e,n,i){t.children.sort(i);for(var r=this.toBBox,a=ld(t,0,e,r),o=ld(t,n-e,n,r),s=dd(a)+dd(o),u=e;u<n-e;u++){var l=t.children[u];cd(a,t.leaf?r(l):l),s+=dd(a)}for(var c=n-e-1;c>=e;c--){var h=t.children[c];cd(o,t.leaf?r(h):h),s+=dd(o)}return s}},{key:"_adjustParentBBoxes",value:function(t,e,n){for(var i=n;i>=0;i--)cd(e[i],t)}},{key:"_condense",value:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():ud(t[n],this.toBBox)}}]),t}();function sd(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function ud(t,e){ld(t,0,t.children.length,e,t)}function ld(t,e,n,i,r){r||(r=yd(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a=e;a<n;a++){var o=t.children[a];cd(r,t.leaf?i(o):o)}return r}function cd(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function hd(t,e){return t.minX-e.minX}function pd(t,e){return t.minY-e.minY}function fd(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function dd(t){return t.maxX-t.minX+(t.maxY-t.minY)}function vd(t,e){var n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),a=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,a-i)}function md(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function gd(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function yd(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _d(t,e,n,i,r){for(var a=[e,n];a.length;)if(!((n=a.pop())-(e=a.pop())<=i)){var o=e+Math.ceil((n-e)/i/2)*i;nd(t,o,e,n,r),a.push(e,o,o,n)}}var bd,xd=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"compareMinX",value:function(t,e){return t.lng-e.lng}},{key:"compareMinY",value:function(t,e){return t.lat-e.lat}},{key:"toBBox",value:function(t){return{minX:t.lng,minY:t.lat,maxX:t.lng,maxY:t.lat}}}]),n}(od),wd=Sd;function Sd(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}Sd.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Sd.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Sd.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Sd.prototype.solveCurveX=function(t,e){var n,i,r,a,o;for("undefined"===typeof e&&(e=1e-6),r=t,o=0;o<8;o++){if(a=this.sampleCurveX(r)-t,Math.abs(a)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=a/s}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(a=this.sampleCurveX(r),Math.abs(a-t)<e)return r;t>a?n=r:i=r,r=.5*(i-n)+n}return r},Sd.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))},function(t){t[t.Default=0]="Default",t[t.Instantaneous=1]="Instantaneous"}(bd||(bd={}));var kd=function(){function t(e){Tt(this,t),null!=e?(this._position=(new Wr).fromArray(e.unprojectSfM([0,0],0)),this._lookat=(new Wr).fromArray(e.unprojectSfM([0,0],10)),this._up=e.upVector(),this._focal=this._getFocal(e)):(this._position=new Wr(0,0,0),this._lookat=new Wr(1,0,0),this._up=new Wr(0,0,1),this._focal=1)}return Ct(t,[{key:"position",get:function(){return this._position}},{key:"lookat",get:function(){return this._lookat}},{key:"up",get:function(){return this._up}},{key:"focal",get:function(){return this._focal},set:function(t){this._focal=t}},{key:"lerpCameras",value:function(t,e,n){this._position.subVectors(e.position,t.position).multiplyScalar(n).add(t.position),this._lookat.subVectors(e.lookat,t.lookat).multiplyScalar(n).add(t.lookat),this._up.subVectors(e.up,t.up).multiplyScalar(n).add(t.up),this._focal=(1-n)*t.focal+n*e.focal}},{key:"copy",value:function(t){this._position.copy(t.position),this._lookat.copy(t.lookat),this._up.copy(t.up),this._focal=t.focal}},{key:"clone",value:function(){var e=new t;return e.position.copy(this._position),e.lookat.copy(this._lookat),e.up.copy(this._up),e.focal=this._focal,e}},{key:"diff",value:function(t){var e=this._position.distanceToSquared(t.position),n=this._lookat.distanceToSquared(t.lookat),i=this._up.distanceToSquared(t.up),r=100*Math.abs(this._focal-t.focal);return Math.max(e,n,i,r)}},{key:"_getFocal",value:function(t){return Zf(t.cameraType)?.5/Math.tan(Math.PI/2):t.focal}}]),t}(),Md=function(){function t(e,n,i,r,a,o,s,u,l,c){Tt(this,t),this._orientation=this._getValue(e,1);var h=null!=s?s.width:4,p=null!=s?s.height:3,f=this._orientation<5;this._width=this._getValue(n,f?h:p),this._height=this._getValue(i,f?p:h),this._basicAspect=f?this._width/this._height:this._height/this._width,this._basicWidth=f?n:i,this._basicHeight=f?i:n;var d=this._getCameraParameters(l,c),v=d[0],m=d[1],g=d[2];this._focal=this._getValue(v,1),this._scale=this._getValue(r,0),this._worldToCamera=this.createWorldToCamera(a,o),this._worldToCameraInverse=(new ba).copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=(new ba).copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,e),this._textureScale=u||[1,1],this._ck1=m||0,this._ck2=g||0,this._cameraType=c||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}return Ct(t,[{key:"ck1",get:function(){return this._ck1}},{key:"ck2",get:function(){return this._ck2}},{key:"cameraType",get:function(){return this._cameraType}},{key:"basicAspect",get:function(){return this._basicAspect}},{key:"basicHeight",get:function(){return this._basicHeight}},{key:"basicRt",get:function(){return this._basicWorldToCamera}},{key:"basicWidth",get:function(){return this._basicWidth}},{key:"focal",get:function(){return this._focal}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}},{key:"rt",get:function(){return this._worldToCamera}},{key:"srt",get:function(){return this._scaledWorldToCamera}},{key:"srtInverse",get:function(){return this._scaledWorldToCameraInverse}},{key:"scale",get:function(){return this._scale}},{key:"hasValidScale",get:function(){return this._scale>.01&&this._scale<50}},{key:"radialPeak",get:function(){return this._radialPeak}},{key:"width",get:function(){return this._width}},{key:"upVector",value:function(){var t=this._worldToCamera.elements;switch(this._orientation){case 1:default:return new Wr(-t[1],-t[5],-t[9]);case 3:return new Wr(t[1],t[5],t[9]);case 6:return new Wr(-t[0],-t[4],-t[8]);case 8:return new Wr(t[0],t[4],t[8])}}},{key:"projectorMatrix",value:function(){var t=this._normalizedToTextureMatrix(),e=this._focal,n=(new ba).set(e,0,0,0,0,e,0,0,0,0,0,0,0,0,1,0);return t.multiply(n),t.multiply(this._worldToCamera),t}},{key:"projectBasic",value:function(t){var e=this.projectSfM(t);return this._sfmToBasic(e)}},{key:"unprojectBasic",value:function(t,e,n){var i=this._basicToSfm(t);return this.unprojectSfM(i,e,n)}},{key:"projectSfM",value:function(t){var e=new $r(t[0],t[1],t[2],1);return e.applyMatrix4(this._worldToCamera),this._bearingToSfm([e.x,e.y,e.z])}},{key:"unprojectSfM",value:function(t,e,n){var i=this._sfmToBearing(t),r=(n&&!Zf(this._cameraType)?new $r(e*i[0]/i[2],e*i[1]/i[2],e,1):new $r(e*i[0],e*i[1],e*i[2],1)).applyMatrix4(this._worldToCameraInverse);return[r.x/r.w,r.y/r.w,r.z/r.w]}},{key:"_sfmToBearing",value:function(t){if(Zf(this._cameraType)){var e=2*t[0]*Math.PI,n=2*-t[1]*Math.PI;return[Math.cos(n)*Math.sin(e),-Math.sin(n),Math.cos(n)*Math.cos(e)]}if(Xf(this._cameraType)){var i=t[0]/this._focal,r=t[1]/this._focal,a=Math.sqrt(i*i+r*r),o=a/this._distortionFromDistortedRadius(a,this._ck1,this._ck2,this._radialPeak),s=Math.cos(o),u=Math.sin(o),l=a>1e-8?1/a:1;return[u*i*l,u*r*l,s]}var c=t[0]/this._focal,h=t[1]/this._focal,p=Math.sqrt(c*c+h*h),f=this._distortionFromDistortedRadius(p,this._ck1,this._ck2,this._radialPeak),d=new Wr(c/f,h/f,1);return d.normalize(),[d.x,d.y,d.z]}},{key:"_distortionFromDistortedRadius",value:function(t,e,n,i){for(var r=1,a=0;a<10;a++){var o=t/r;o>i&&(o=i),r=1+e*Math.pow(o,2)+n*Math.pow(o,4)}return r}},{key:"_bearingToSfm",value:function(t){if(Zf(this._cameraType)){var e=t[0],n=t[1],i=t[2],r=Math.atan2(e,i),a=Math.atan2(-n,Math.sqrt(e*e+i*i));return[r/(2*Math.PI),-a/(2*Math.PI)]}if(Xf(this._cameraType)){if(t[2]>0){var o=rt(t,3),s=o[0],u=o[1],l=o[2],c=Math.sqrt(s*s+u*u),h=Math.atan2(c,l);h>this._radialPeak&&(h=this._radialPeak);var p=1+Math.pow(h,2)*(this._ck1+Math.pow(h,2)*this._ck2),f=this._focal*p*h/c;return[f*s,f*u]}return[t[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,t[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}if(t[2]>0){var d=t[0]/t[2],v=t[1]/t[2],m=d*d+v*v,g=Math.pow(this._radialPeak,2);m>g&&(m=g);var y=1+this._ck1*m+this._ck2*Math.pow(m,2);return[this._focal*y*d,this._focal*y*v]}return[t[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,t[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}},{key:"_basicToSfm",value:function(t){var e,n;switch(this._orientation){case 1:default:e=t[0],n=t[1];break;case 3:e=1-t[0],n=1-t[1];break;case 6:e=t[1],n=1-t[0];break;case 8:e=1-t[1],n=t[0]}var i=this._width,r=this._height,a=Math.max(i,r);return[e*i/a-i/a/2,n*r/a-r/a/2]}},{key:"_sfmToBasic",value:function(t){var e,n,i=this._width,r=this._height,a=Math.max(i,r),o=(t[0]+i/a/2)/i*a,s=(t[1]+r/a/2)/r*a;switch(this._orientation){case 1:default:e=o,n=s;break;case 3:e=1-o,n=1-s;break;case 6:e=1-s,n=o;break;case 8:e=s,n=1-o}return[e,n]}},{key:"_getValue",value:function(t,e){return null!=t&&t>0?t:e}},{key:"_getCameraParameters",value:function(t,e){if(Zf(e))return[];if(!t||0===t.length)return[1,0,0];var n=3-t.length;return n<=0?t:t.concat(new Array(n).fill(0))}},{key:"createWorldToCamera",value:function(t,e){var n=new Wr(t[0],t[1],t[2]),i=n.length();i>0&&n.normalize();var r=new ba;return r.makeRotationAxis(n,i),r.setPosition(new Wr(e[0],e[1],e[2])),r}},{key:"_createScaledWorldToCamera",value:function(t,e){var n=t.clone(),i=n.elements;return i[12]=e*i[12],i[13]=e*i[13],i[14]=e*i[14],n.scale(new Wr(e,e,e)),n}},{key:"_createBasicWorldToCamera",value:function(t,e){var n=new Wr(0,0,1),i=0;switch(e){case 3:i=Math.PI;break;case 6:i=Math.PI/2;break;case 8:i=3*Math.PI/2}return(new ba).makeRotationAxis(n,i).multiply(t)}},{key:"_getRadialPeak",value:function(t,e){var n=5*e,i=3*t,r=Math.pow(i,2)-4*n*1;if(!(r<0)){var a=(-i-Math.sqrt(r))/2/n,o=(-i+Math.sqrt(r))/2/n,s=Math.min(a,o),u=Math.max(a,o);return s>0?Math.sqrt(s):u>0?Math.sqrt(u):void 0}}},{key:"_normalizedToTextureMatrix",value:function(){var t=Math.max(this._width,this._height),e=this._orientation<5?this._textureScale[0]:this._textureScale[1],n=this._orientation<5?this._textureScale[1]:this._textureScale[0],i=t/this._width*e,r=t/this._height*n;switch(this._orientation){case 1:default:return(new ba).set(i,0,0,.5,0,-r,0,.5,0,0,1,0,0,0,0,1);case 3:return(new ba).set(-i,0,0,.5,0,r,0,.5,0,0,1,0,0,0,0,1);case 6:return(new ba).set(0,-r,0,.5,-i,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new ba).set(0,r,0,.5,i,0,0,.5,0,0,1,0,0,0,0,1)}}}]),t}(),Td=function(){function t(e){Tt(this,t),this._spatial=new Wf,this._referenceThreshold=.01,this._transitionMode=e.transitionMode,this._reference=e.reference,this._alpha=e.alpha,this._camera=e.camera.clone(),this._zoom=e.zoom,this._currentIndex=e.currentIndex,this._trajectory=e.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];var n,i=wt(this._trajectory);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this._imageToTranslation(r,this._reference),o=new Md(r.exifOrientation,r.width,r.height,r.scale,r.rotation,a,r.image,void 0,r.cameraParameters,r.cameraType);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new kd(o))}}catch(Tx){i.e(Tx)}finally{i.f()}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new kd,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}return Ct(t,[{key:"reference",get:function(){return this._reference}},{key:"alpha",get:function(){return this._getAlpha()}},{key:"camera",get:function(){return this._camera}},{key:"zoom",get:function(){return this._zoom}},{key:"trajectory",get:function(){return this._trajectory}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"currentImage",get:function(){return this._currentImage}},{key:"previousImage",get:function(){return this._previousImage}},{key:"currentCamera",get:function(){return this._currentCamera}},{key:"currentTransform",get:function(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}},{key:"previousTransform",get:function(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}},{key:"motionless",get:function(){return this._motionless}},{key:"transitionMode",get:function(){return this._transitionMode}},{key:"move",value:function(t){}},{key:"moveTo",value:function(t){}},{key:"rotate",value:function(t){}},{key:"rotateUnbounded",value:function(t){}},{key:"rotateWithoutInertia",value:function(t){}},{key:"rotateBasic",value:function(t){}},{key:"rotateBasicUnbounded",value:function(t){}},{key:"rotateBasicWithoutInertia",value:function(t){}},{key:"rotateToBasic",value:function(t){}},{key:"setSpeed",value:function(t){}},{key:"zoomIn",value:function(t,e){}},{key:"update",value:function(t){}},{key:"setCenter",value:function(t){}},{key:"setZoom",value:function(t){}},{key:"dolly",value:function(t){}},{key:"orbit",value:function(t){}},{key:"setViewMatrix",value:function(t){}},{key:"truck",value:function(t){}},{key:"append",value:function(t){if(t.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(t):(this._trajectory=this._trajectory.concat(t),this._appendToTrajectories(t))}},{key:"prepend",value:function(t){if(t.length<1)throw Error("Trajectory can not be empty");this._trajectory=t.slice().concat(this._trajectory),this._currentIndex+=t.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(t),this._setCurrentCamera()}},{key:"remove",value:function(t){if(t<0)throw Error("n must be a positive integer");if(this._currentIndex-1<t)throw Error("Current and previous images can not be removed");for(var e=0;e<t;e++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}},{key:"clearPrior",value:function(){this._currentIndex>0&&this.remove(this._currentIndex-1)}},{key:"clear",value:function(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}},{key:"cut",value:function(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}},{key:"set",value:function(t){this._setTrajectory(t),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}},{key:"getCenter",value:function(){return null!=this._currentImage?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}},{key:"setTransitionMode",value:function(t){this._transitionMode=t}},{key:"_getAlpha",value:function(){return 1}},{key:"_setCurrent",value:function(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}},{key:"_setCurrentCamera",value:function(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}},{key:"_motionlessTransition",value:function(){return null!=this._currentImage&&null!=this._previousImage&&(this._transitionMode===bd.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}},{key:"_setReference",value:function(t){return!(Math.abs(t.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(t.lngLat.lng-this.reference.lng)<this._referenceThreshold)&&(!(null!=this._previousImage&&!this._motionlessTransition())&&(this._reference.lat=t.lngLat.lat,this._reference.lng=t.lngLat.lng,this._reference.alt=t.computedAltitude,!0))}},{key:"_setCurrentImage",value:function(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}},{key:"_setTrajectory",value:function(t){if(t.length<1)throw new qf("Trajectory can not be empty");null!=this._currentImage?(this._trajectory=[this._currentImage].concat(t),this._currentIndex=1):(this._trajectory=t.slice(),this._currentIndex=0)}},{key:"_setTrajectories",value:function(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}},{key:"_appendToTrajectories",value:function(t){var e,n=wt(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!i.assetsCached)throw new qf("Assets must be cached when image is added to trajectory");var r=this._imageToTranslation(i,this.reference),a=new Md(i.exifOrientation,i.width,i.height,i.scale,i.rotation,r,i.image,void 0,i.cameraParameters,i.cameraType);this._trajectoryTransforms.push(a),this._trajectoryCameras.push(new kd(a))}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"_prependToTrajectories",value:function(t){var e,n=wt(t.reverse());try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!i.assetsCached)throw new qf("Assets must be cached when added to trajectory");var r=this._imageToTranslation(i,this.reference),a=new Md(i.exifOrientation,i.width,i.height,i.scale,i.rotation,r,i.image,void 0,i.cameraParameters,i.cameraType);this._trajectoryTransforms.unshift(a),this._trajectoryCameras.unshift(new kd(a))}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"_imageToTranslation",value:function(t,e){return Yf({alt:t.computedAltitude,lat:t.lngLat.lat,lng:t.lngLat.lng},t.rotation,e)}},{key:"_sameConnectedComponent",value:function(){var t=this._currentImage,e=this._previousImage;return!!t&&!!e&&t.mergeId===e.mergeId}},{key:"_withinOriginalDistance",value:function(){var t=this._currentImage,e=this._previousImage;return!t||!e||this._spatial.distanceFromLngLat(t.originalLngLat.lng,t.originalLngLat.lat,e.originalLngLat.lng,e.originalLngLat.lat)<25}}]),t}(),Ed=function(){function t(e,n){Tt(this,t),this._phi=e,this._theta=n}return Ct(t,[{key:"phi",get:function(){return this._phi},set:function(t){this._phi=t}},{key:"theta",get:function(){return this._theta},set:function(t){this._theta=t}},{key:"isZero",get:function(){return 0===this._phi&&0===this._theta}},{key:"copy",value:function(t){this._phi=t.phi,this._theta=t.theta}},{key:"lerp",value:function(t,e){this._phi=(1-e)*this._phi+e*t.phi,this._theta=(1-e)*this._theta+e*t.theta}},{key:"multiply",value:function(t){this._phi*=t,this._theta*=t}},{key:"threshold",value:function(t){this._phi=Math.abs(this._phi)>t?this._phi:0,this._theta=Math.abs(this._theta)>t?this._theta:0}},{key:"lengthSquared",value:function(){return this._phi*this._phi+this._theta*this._theta}},{key:"reset",value:function(){this._phi=0,this._theta=0}}]),t}(),Cd=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._animationSpeed=1/40,i._rotationDelta=new Ed(0,0),i._requestedRotationDelta=null,i._basicRotation=[0,0],i._requestedBasicRotation=null,i._requestedBasicRotationUnbounded=null,i._rotationAcceleration=.86,i._rotationIncreaseAlpha=.97,i._rotationDecreaseAlpha=.9,i._rotationThreshold=.001,i._unboundedRotationAlpha=.8,i._desiredZoom=t.zoom,i._minZoom=0,i._maxZoom=3,i._lookatDepth=10,i._desiredLookat=null,i._desiredCenter=null,i}return Ct(n,[{key:"rotate",value:function(t){null!=this._currentImage&&(0===t.phi&&0===t.theta||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,null!=this._requestedRotationDelta?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+t.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+t.theta):this._requestedRotationDelta=new Ed(t.phi,t.theta)))}},{key:"rotateUnbounded",value:function(t){if(null!=this._currentImage&&(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(t,this._currentCamera),this._applyRotation(t,this._previousCamera),this._desiredLookat)){var e=(new qr).setFromUnitVectors(this._currentCamera.up,new Wr(0,0,1)),n=e.clone().invert(),i=(new Wr).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(e),r=i.length(),a=Math.atan2(i.y,i.x);a+=t.phi;var o=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);o+=t.theta,o=Math.max(.1,Math.min(Math.PI-.1,o)),i.x=Math.sin(o)*Math.cos(a),i.y=Math.sin(o)*Math.sin(a),i.z=Math.cos(o),i.applyQuaternion(n),this._desiredLookat.copy(this._camera.position).add(i.multiplyScalar(r))}}},{key:"rotateWithoutInertia",value:function(t){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;var e=Math.PI/(10*Math.pow(2,this._zoom)),n={phi:this._spatial.clamp(t.phi,-e,e),theta:this._spatial.clamp(t.theta,-e,e)};this._applyRotation(n,this._currentCamera),this._applyRotation(n,this._previousCamera)}}},{key:"rotateBasic",value:function(t){if(null!=this._currentImage)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,null!=this._requestedBasicRotation){this._requestedBasicRotation[0]+=t[0],this._requestedBasicRotation[1]+=t[1];var e=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-e,e),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-e,e)}else this._requestedBasicRotation=t.slice()}},{key:"rotateBasicUnbounded",value:function(t){null!=this._currentImage&&(null!=this._requestedBasicRotationUnbounded?(this._requestedBasicRotationUnbounded[0]+=t[0],this._requestedBasicRotationUnbounded[1]+=t[1]):this._requestedBasicRotationUnbounded=t.slice())}},{key:"rotateBasicWithoutInertia",value:function(t){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;var e=.05/Math.pow(2,this._zoom),n=t.slice();n[0]=this._spatial.clamp(n[0],-e,e),n[1]=this._spatial.clamp(n[1],-e,e),this._applyRotationBasic(n)}}},{key:"rotateToBasic",value:function(t){if(null!=this._currentImage){this._desiredZoom=this._zoom,this._desiredLookat=null,t[0]=this._spatial.clamp(t[0],0,1),t[1]=this._spatial.clamp(t[1],0,1);var e=this.currentTransform.unprojectBasic(t,this._lookatDepth);this._currentCamera.lookat.fromArray(e)}}},{key:"zoomIn",value:function(t,e){if(null!=this._currentImage){this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+t));var n=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),i=n[0],r=n[1],a=Math.pow(2,this._zoom),o=Math.pow(2,this._desiredZoom),s=e[0],u=e[1];Zf(this.currentTransform.cameraType)&&(s-i>.5?s-=1:i-s>.5&&(s=1+s));var l=s-a/o*(s-i),c=u-a/o*(u-r);Zf(this._currentImage.cameraType)?(l=this._spatial.wrap(l+this._basicRotation[0],0,1),c=this._spatial.clamp(c+this._basicRotation[1],.05,.95)):(l=this._spatial.clamp(l,0,1),c=this._spatial.clamp(c,0,1)),this._desiredLookat=(new Wr).fromArray(this.currentTransform.unprojectBasic([l,c],this._lookatDepth))}}},{key:"setCenter",value:function(t){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;var e=[this._spatial.clamp(t[0],0,1),this._spatial.clamp(t[1],0,1)];if(null!=this._currentImage){this._desiredCenter=null;var n=(new Wr).fromArray(this.currentTransform.unprojectBasic(e,this._lookatDepth)),i=null!=this.previousTransform?this.previousTransform:this.currentTransform,r=(new Wr).fromArray(i.unprojectBasic(e,this._lookatDepth));this._currentCamera.lookat.copy(n),this._previousCamera.lookat.copy(r)}else this._desiredCenter=e}},{key:"setZoom",value:function(t){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(t,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}},{key:"_applyRotation",value:function(t,e){if(null!=e){var n=(new qr).setFromUnitVectors(e.up,new Wr(0,0,1)),i=n.clone().invert(),r=new Wr;r.copy(e.lookat).sub(e.position),r.applyQuaternion(n);var a=r.length(),o=Math.atan2(r.y,r.x);o+=t.phi;var s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=t.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),r.x=Math.sin(s)*Math.cos(o),r.y=Math.sin(s)*Math.sin(o),r.z=Math.cos(s),r.applyQuaternion(i),e.lookat.copy(e.position).add(r.multiplyScalar(a))}}},{key:"_applyRotationBasic",value:function(t){var e=this._currentImage,n=null!=this._previousImage?this.previousImage:this.currentImage,i=this._currentCamera,r=this._previousCamera,a=this.currentTransform,o=null!=this.previousTransform?this.previousTransform:this.currentTransform,s=a.projectBasic(i.lookat.toArray()),u=o.projectBasic(r.lookat.toArray());Zf(e.cameraType)?(s[0]=this._spatial.wrap(s[0]+t[0],0,1),s[1]=this._spatial.clamp(s[1]+t[1],.05,.95)):(s[0]=this._spatial.clamp(s[0]+t[0],0,1),s[1]=this._spatial.clamp(s[1]+t[1],0,1)),Zf(n.cameraType)?(u[0]=this._spatial.wrap(u[0]+t[0],0,1),u[1]=this._spatial.clamp(u[1]+t[1],.05,.95)):(u[0]=this._spatial.clamp(u[0]+t[0],0,1),u[1]=this._spatial.clamp(s[1]+t[1],0,1));var l=a.unprojectBasic(s,this._lookatDepth);i.lookat.fromArray(l);var c=o.unprojectBasic(u,this._lookatDepth);r.lookat.fromArray(c)}},{key:"_updateZoom",value:function(t){var e=this._desiredZoom-this._zoom,n=e>0?1:e<0?-1:0;0!==e&&(Math.abs(e)<.002?(this._zoom=this._desiredZoom,null!=this._desiredLookat&&(this._desiredLookat=null)):this._zoom+=n*Math.max(Math.abs(5*t*e),.002))}},{key:"_updateLookat",value:function(t){if(null!==this._desiredLookat){var e=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(e)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*t)}}},{key:"_updateRotation",value:function(){if(null!=this._requestedRotationDelta){var t=this._rotationDelta.lengthSquared();return this._requestedRotationDelta.lengthSquared()>t?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null)}if(!this._rotationDelta.isZero){var e=Zf(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*e),this._rotationDelta.threshold(this._rotationThreshold)}}},{key:"_updateRotationBasic",value:function(){if(null!=this._requestedBasicRotation){var t=this._basicRotation[0],e=this._basicRotation[1],n=this._requestedBasicRotation[0],i=this._requestedBasicRotation[1];return Math.abs(n)>Math.abs(t)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*n:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*n,Math.abs(i)>Math.abs(e)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*i:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*i,void(this._requestedBasicRotation=null)}if(null!=this._requestedBasicRotationUnbounded){var r=this._requestedBasicRotationUnbounded[0],a=this._requestedBasicRotationUnbounded[1];if(Math.abs(r)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*r),Math.abs(a)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*a),null!=this._desiredLookat){var o=this.currentTransform.projectBasic(this._desiredLookat.toArray());o[0]+=r,o[1]+=a,this._desiredLookat=(new Wr).fromArray(this.currentTransform.unprojectBasic(o,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}0===this._basicRotation[0]&&0===this._basicRotation[1]||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}},{key:"_clearRotation",value:function(){Zf(this._currentImage.cameraType)||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),null!=this._requestedBasicRotation&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}},{key:"_setDesiredCenter",value:function(){if(null!=this._desiredCenter){var t=(new Wr).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(t)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(t)),this._desiredCenter=null}}},{key:"_setDesiredZoom",value:function(){this._desiredZoom=Zf(this._currentImage.cameraType)||null==this._previousImage?this._zoom:0}}]),n}(Td),Id=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._adjustCameras(),i._motionless=i._motionlessTransition(),i._baseAlpha=i._alpha,i._speedCoefficient=1,i._unitBezier=new n._interpolator(.74,.67,.38,.96),i._useBezier=!1,i}return Ct(n,[{key:"append",value:function(t){var e=0===this._trajectory.length;e&&this._resetTransition(),xt(mt(n.prototype),"append",this).call(this,t),e&&(this._setDesiredCenter(),this._setDesiredZoom())}},{key:"prepend",value:function(t){var e=0===this._trajectory.length;e&&this._resetTransition(),xt(mt(n.prototype),"prepend",this).call(this,t),e&&(this._setDesiredCenter(),this._setDesiredZoom())}},{key:"set",value:function(t){xt(mt(n.prototype),"set",this).call(this,t),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._useBezier=!0)}},{key:"setSpeed",value:function(t){this._speedCoefficient=this._spatial.clamp(t,0,10)}},{key:"update",value:function(t){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._useBezier=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=Zf(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);var e=this._animationSpeed*(60/t);this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*e),this._useBezier?this._alpha=this._unitBezier.solve(this._baseAlpha):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation),this._updateZoom(e),this._updateLookat(e),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.ceil(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){xt(mt(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){var t=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position)),Zf(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}}},{key:"_resetTransition",value:function(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}],[{key:"register",value:function(t){n._interpolator=t}}]),n}(Cd),Pd=function(){function t(e,n){for(var i in Tt(this,t),this._components={},t.registeredComponents)if(t.registeredComponents.hasOwnProperty(i)){var r=t.registeredComponents[i];this._components[i]={active:!1,component:new r(i,e,n)}}this._coverComponent=new t.registeredCoverComponent("cover",e,n),this._coverComponent.activate(),this._coverActivated=!0}return Ct(t,[{key:"coverActivated",get:function(){return this._coverActivated}},{key:"activateCover",value:function(){if(!this._coverActivated)for(var t in this._coverActivated=!0,this._components)if(this._components.hasOwnProperty(t)){var e=this._components[t];e.active&&e.component.deactivate()}}},{key:"deactivateCover",value:function(){if(this._coverActivated)for(var t in this._coverActivated=!1,this._components)if(this._components.hasOwnProperty(t)){var e=this._components[t];e.active&&e.component.activate()}}},{key:"activate",value:function(t){this._checkName(t),this._components[t].active=!0,this._coverActivated||this.get(t).activate()}},{key:"configure",value:function(t,e){this._checkName(t),this.get(t).configure(e)}},{key:"deactivate",value:function(t){this._checkName(t),this._components[t].active=!1,this._coverActivated||this.get(t).deactivate()}},{key:"get",value:function(t){return this._components[t].component}},{key:"getCover",value:function(){return this._coverComponent}},{key:"remove",value:function(){for(var t in this._coverComponent.deactivate(),this._components)this._components.hasOwnProperty(t)&&this._components[t].component.deactivate()}},{key:"_checkName",value:function(t){if(!(t in this._components))throw new qf("Component does not exist: ".concat(t))}}],[{key:"register",value:function(e){void 0===t.registeredComponents[e.componentName]&&(t.registeredComponents[e.componentName]=e)}},{key:"registerCover",value:function(e){t.registeredCoverComponent=e}}]),t}();Pd.registeredComponents={};var Ad=Array.isArray,Ld=Object.prototype.toString,Rd=Ad||function(t){return"[object Array]"===Ld.call(t)};var Dd="2";Od.NONE=0,Od.VTEXT=1,Od.VNODE=2,Od.WIDGET=3,Od.PROPS=4,Od.ORDER=5,Od.INSERT=6,Od.REMOVE=7,Od.THUNK=8;var zd=Od;function Od(t,e,n){this.type=Number(t),this.vNode=e,this.patch=n}Od.prototype.version=Dd,Od.prototype.type="VirtualPatch";var Fd=function(t){return t&&"VirtualNode"===t.type&&t.version===Dd};var Nd=function(t){return t&&"VirtualText"===t.type&&t.version===Dd};var Bd=function(t){return t&&"Widget"===t.type};var jd=function(t){return t&&"Thunk"===t.type};var Vd=function(t,e){var n=t,i=e;jd(e)&&(i=Ud(e,t));jd(t)&&(n=Ud(t,null));return{a:n,b:i}};function Ud(t,e){var n=t.vnode;if(n||(n=t.vnode=t.render(e)),!(Fd(n)||Nd(n)||Bd(n)))throw new Error("thunk did not return a valid node");return n}var $d=function(t){return"object"===typeof t&&null!==t},Hd=function(t){return t&&("function"===typeof t.hook&&!t.hasOwnProperty("hook")||"function"===typeof t.unhook&&!t.hasOwnProperty("unhook"))};var qd=function t(e,n){var i;for(var r in e){r in n||((i=i||{})[r]=void 0);var a=e[r],o=n[r];if(a!==o)if($d(a)&&$d(o))if(Wd(o)!==Wd(a))(i=i||{})[r]=o;else if(Hd(o))(i=i||{})[r]=o;else{var s=t(a,o);s&&((i=i||{})[r]=s)}else(i=i||{})[r]=o}for(var u in n)u in e||((i=i||{})[u]=n[u]);return i};function Wd(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}function Gd(t,e){var n={a:t};return Zd(t,e,n,0),n}function Zd(t,e,n,i){if(t!==e){var r=n[i],a=!1;if(jd(t)||jd(e))Kd(t,e,n,i);else if(null==e)Bd(t)||(Xd(t,n,i),r=n[i]),r=ev(r,new zd(zd.REMOVE,t,e));else if(Fd(e))if(Fd(t))if(t.tagName===e.tagName&&t.namespace===e.namespace&&t.key===e.key){var o=qd(t.properties,e.properties);o&&(r=ev(r,new zd(zd.PROPS,t,o))),r=function(t,e,n,i,r){for(var a=t.children,o=function(t,e){var n=tv(e),i=n.keys,r=n.free;if(r.length===e.length)return{children:e,moves:null};var a=tv(t),o=a.keys;if(a.free.length===t.length)return{children:e,moves:null};for(var s=[],u=0,l=r.length,c=0,h=0;h<t.length;h++){var p,f=t[h];f.key?i.hasOwnProperty(f.key)?(p=i[f.key],s.push(e[p])):(p=h-c++,s.push(null)):u<l?(p=r[u++],s.push(e[p])):(p=h-c++,s.push(null))}for(var d=u>=r.length?e.length:r[u],v=0;v<e.length;v++){var m=e[v];m.key?o.hasOwnProperty(m.key)||s.push(m):v>=d&&s.push(m)}for(var g,y=s.slice(),_=0,b=[],x=[],w=0;w<e.length;){var S=e[w];for(g=y[_];null===g&&y.length;)b.push(Qd(y,_,null)),g=y[_];g&&g.key===S.key?(_++,w++):S.key?(g&&g.key&&i[g.key]!==w+1?(b.push(Qd(y,_,g.key)),(g=y[_])&&g.key===S.key?_++:x.push({key:S.key,to:w})):x.push({key:S.key,to:w}),w++):g&&g.key&&b.push(Qd(y,_,g.key))}for(;_<y.length;)g=y[_],b.push(Qd(y,_,g&&g.key));if(b.length===c&&!x.length)return{children:s,moves:null};return{children:s,moves:{removes:b,inserts:x}}}(a,e.children),s=o.children,u=a.length,l=s.length,c=u>l?u:l,h=0;h<c;h++){var p=a[h],f=s[h];r+=1,p?Zd(p,f,n,r):f&&(i=ev(i,new zd(zd.INSERT,null,f))),Fd(p)&&p.count&&(r+=p.count)}o.moves&&(i=ev(i,new zd(zd.ORDER,t,o.moves)));return i}(t,e,n,r,i)}else r=ev(r,new zd(zd.VNODE,t,e)),a=!0;else r=ev(r,new zd(zd.VNODE,t,e)),a=!0;else Nd(e)?Nd(t)?t.text!==e.text&&(r=ev(r,new zd(zd.VTEXT,t,e))):(r=ev(r,new zd(zd.VTEXT,t,e)),a=!0):Bd(e)&&(Bd(t)||(a=!0),r=ev(r,new zd(zd.WIDGET,t,e)));r&&(n[i]=r),a&&Xd(t,n,i)}}function Xd(t,e,n){Jd(t,e,n),Yd(t,e,n)}function Yd(t,e,n){if(Bd(t))"function"===typeof t.destroy&&(e[n]=ev(e[n],new zd(zd.REMOVE,t,null)));else if(Fd(t)&&(t.hasWidgets||t.hasThunks))for(var i=t.children,r=i.length,a=0;a<r;a++){var o=i[a];Yd(o,e,n+=1),Fd(o)&&o.count&&(n+=o.count)}else jd(t)&&Kd(t,null,e,n)}function Kd(t,e,n,i){var r=Vd(t,e),a=Gd(r.a,r.b);(function(t){for(var e in t)if("a"!==e)return!0;return!1})(a)&&(n[i]=new zd(zd.THUNK,null,a))}function Jd(t,e,n){if(Fd(t)){if(t.hooks&&(e[n]=ev(e[n],new zd(zd.PROPS,t,function(t){var e={};for(var n in t)e[n]=void 0;return e}(t.hooks)))),t.descendantHooks||t.hasThunks)for(var i=t.children,r=i.length,a=0;a<r;a++){var o=i[a];Jd(o,e,n+=1),Fd(o)&&o.count&&(n+=o.count)}}else jd(t)&&Kd(t,null,e,n)}function Qd(t,e,n){return t.splice(e,1),{from:e,key:n}}function tv(t){for(var e={},n=[],i=t.length,r=0;r<i;r++){var a=t[r];a.key?e[a.key]=r:n.push(r)}return{keys:e,free:n}}function ev(t,e){return t?(Rd(t)?t.push(e):t=[t,e],t):e}var nv=Gd,iv="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function rv(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})})),e}function av(t){var e={exports:{}};return t(e,e.exports),e.exports}var ov=Array.prototype.slice,sv=function(t,e){"length"in t||(t=[t]);t=ov.call(t);for(;t.length;){var n=t.shift(),i=e(n);if(i)return i;n.childNodes&&n.childNodes.length&&(t=ov.call(n.childNodes).concat(t))}};var uv=lv;function lv(t,e){if(!(this instanceof lv))return new lv(t,e);this.data=t,this.nodeValue=t,this.length=t.length,this.ownerDocument=e||null}lv.prototype.nodeType=8,lv.prototype.nodeName="#comment",lv.prototype.toString=function(){return"[object Comment]"};var cv=hv;function hv(t,e){if(!(this instanceof hv))return new hv(t);this.data=t||"",this.length=this.data.length,this.ownerDocument=e||null}hv.prototype.type="DOMTextNode",hv.prototype.nodeType=3,hv.prototype.nodeName="#text",hv.prototype.toString=function(){return this.data},hv.prototype.replaceData=function(t,e,n){var i=this.data,r=i.substring(0,t),a=i.substring(t+e,i.length);this.data=r+n+a,this.length=this.data.length};var pv=function(t){var e=this,n=t.type;t.target||(t.target=e);e.listeners||(e.listeners={});var i=e.listeners[n];if(i)return i.forEach((function(n){t.currentTarget=e,"function"===typeof n?n(t):n.handleEvent(t)}));e.parentNode&&e.parentNode.dispatchEvent(t)};var fv=function(t,e){var n=this;n.listeners||(n.listeners={});n.listeners[t]||(n.listeners[t]=[]);-1===n.listeners[t].indexOf(e)&&n.listeners[t].push(e)};var dv=function(t,e){var n=this;if(!n.listeners)return;if(!n.listeners[t])return;var i=n.listeners[t],r=i.indexOf(e);-1!==r&&i.splice(r,1)};var vv=gv,mv=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function gv(t){switch(t.nodeType){case 3:return bv(t.data);case 8:return"\x3c!--"+t.data+"--\x3e";default:return function(t){var e=[],n=t.tagName;"http://www.w3.org/1999/xhtml"===t.namespaceURI&&(n=n.toLowerCase());e.push("<"+n+function(t){var e=[];for(var n in t)yv(t,n)&&e.push({name:n,value:t[n]});for(var i in t._attributes)for(var r in t._attributes[i]){var a=t._attributes[i][r],o=(a.prefix?a.prefix+":":"")+r;e.push({name:o,value:a.value})}t.className&&e.push({name:"class",value:t.className});return e.length?_v(e):""}(t)+function(t){var e=t.dataset,n=[];for(var i in e)n.push({name:"data-"+i,value:e[i]});return n.length?_v(n):""}(t)),mv.indexOf(n)>-1?e.push(" />"):(e.push(">"),t.childNodes.length?e.push.apply(e,t.childNodes.map(gv)):t.textContent||t.innerText?e.push(bv(t.textContent||t.innerText)):t.innerHTML&&e.push(t.innerHTML),e.push("</"+n+">"));return e.join("")}(t)}}function yv(t,e){var n=typeof t[e];return"style"===e&&Object.keys(t.style).length>0||t.hasOwnProperty(e)&&("string"===n||"boolean"===n||"number"===n)&&"nodeName"!==e&&"className"!==e&&"tagName"!==e&&"textContent"!==e&&"innerText"!==e&&"namespaceURI"!==e&&"innerHTML"!==e}function _v(t){var e=[];return t.forEach((function(t){var n=t.name,i=t.value;"style"===n&&(i=function(t){if("string"===typeof t)return t;var e="";return Object.keys(t).forEach((function(n){var i=t[n];n=n.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})),e+=n+":"+i+";"})),e}(i)),e.push(n+'="'+(bv(i).replace(/"/g,"&quot;")+'"'))})),e.length?" "+e.join(" "):""}function bv(t){var e="";return"string"===typeof t?e=t:t&&(e=t.toString()),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var xv="http://www.w3.org/1999/xhtml",wv=Sv;function Sv(t,e,n){if(!(this instanceof Sv))return new Sv(t);var i=void 0===n?xv:n||null;this.tagName=i===xv?String(t).toUpperCase():t,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=e||null,this.namespaceURI=i,this._attributes={},"INPUT"===this.tagName&&(this.type="text")}Sv.prototype.type="DOMElement",Sv.prototype.nodeType=1,Sv.prototype.appendChild=function(t){return t.parentNode&&t.parentNode.removeChild(t),this.childNodes.push(t),t.parentNode=this,t},Sv.prototype.replaceChild=function(t,e){t.parentNode&&t.parentNode.removeChild(t);var n=this.childNodes.indexOf(e);return e.parentNode=null,this.childNodes[n]=t,t.parentNode=this,e},Sv.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);return this.childNodes.splice(e,1),t.parentNode=null,t},Sv.prototype.insertBefore=function(t,e){t.parentNode&&t.parentNode.removeChild(t);var n=null===e||void 0===e?-1:this.childNodes.indexOf(e);return n>-1?this.childNodes.splice(n,0,t):this.childNodes.push(t),t.parentNode=this,t},Sv.prototype.setAttributeNS=function(t,e,n){var i=null,r=e,a=e.indexOf(":");(a>-1&&(i=e.substr(0,a),r=e.substr(a+1)),"INPUT"===this.tagName&&"type"===e)?this.type=n:(this._attributes[t]||(this._attributes[t]={}))[r]={value:n,prefix:i}},Sv.prototype.getAttributeNS=function(t,e){var n=this._attributes[t],i=n&&n[e]&&n[e].value;return"INPUT"===this.tagName&&"type"===e?this.type:"string"!==typeof i?null:i},Sv.prototype.removeAttributeNS=function(t,e){var n=this._attributes[t];n&&delete n[e]},Sv.prototype.hasAttributeNS=function(t,e){var n=this._attributes[t];return!!n&&e in n},Sv.prototype.setAttribute=function(t,e){return this.setAttributeNS(null,t,e)},Sv.prototype.getAttribute=function(t){return this.getAttributeNS(null,t)},Sv.prototype.removeAttribute=function(t){return this.removeAttributeNS(null,t)},Sv.prototype.hasAttribute=function(t){return this.hasAttributeNS(null,t)},Sv.prototype.removeEventListener=dv,Sv.prototype.addEventListener=fv,Sv.prototype.dispatchEvent=pv,Sv.prototype.focus=function(){},Sv.prototype.toString=function(){return vv(this)},Sv.prototype.getElementsByClassName=function(t){var e=t.split(" "),n=[];return sv(this,(function(t){if(1===t.nodeType){var i=(t.className||"").split(" ");e.every((function(t){return-1!==i.indexOf(t)}))&&n.push(t)}})),n},Sv.prototype.getElementsByTagName=function(t){t=t.toLowerCase();var e=[];return sv(this.childNodes,(function(n){1!==n.nodeType||"*"!==t&&n.tagName.toLowerCase()!==t||e.push(n)})),e},Sv.prototype.contains=function(t){return sv(this,(function(e){return t===e}))||!1};var kv=Mv;function Mv(t){if(!(this instanceof Mv))return new Mv;this.childNodes=[],this.parentNode=null,this.ownerDocument=t||null}Mv.prototype.type="DocumentFragment",Mv.prototype.nodeType=11,Mv.prototype.nodeName="#document-fragment",Mv.prototype.appendChild=wv.prototype.appendChild,Mv.prototype.replaceChild=wv.prototype.replaceChild,Mv.prototype.removeChild=wv.prototype.removeChild,Mv.prototype.toString=function(){return this.childNodes.map((function(t){return String(t)})).join("")};var Tv=Ev;function Ev(t){}Ev.prototype.initEvent=function(t,e,n){this.type=t,this.bubbles=e,this.cancelable=n},Ev.prototype.preventDefault=function(){};var Cv=Iv;function Iv(){if(!(this instanceof Iv))return new Iv;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var Pv=Iv.prototype;Pv.createTextNode=function(t){return new cv(t,this)},Pv.createElementNS=function(t,e){var n=null===t?null:String(t);return new wv(e,this,n)},Pv.createElement=function(t){return new wv(t,this)},Pv.createDocumentFragment=function(){return new kv(this)},Pv.createEvent=function(t){return new Tv(t)},Pv.createComment=function(t){return new uv(t,this)},Pv.getElementById=function(t){return t=String(t),sv(this.childNodes,(function(e){if(String(e.id)===t)return e}))||null},Pv.getElementsByClassName=wv.prototype.getElementsByClassName,Pv.getElementsByTagName=wv.prototype.getElementsByTagName,Pv.contains=wv.prototype.contains,Pv.removeEventListener=dv,Pv.addEventListener=fv,Pv.dispatchEvent=pv;var Av,Lv=new Cv,Rv="undefined"!==typeof iv?iv:"undefined"!==typeof window?window:{};"undefined"!==typeof document?Av=document:(Av=Rv["__GLOBAL_DOCUMENT_CACHE@4"])||(Av=Rv["__GLOBAL_DOCUMENT_CACHE@4"]=Lv);var Dv=Av,zv=function(t,e,n){for(var i in e){var r=e[i];void 0===r?Ov(t,i,r,n):Hd(r)?(Ov(t,i,r,n),r.hook&&r.hook(t,i,n?n[i]:void 0)):$d(r)?Fv(t,e,n,i,r):t[i]=r}};function Ov(t,e,n,i){if(i){var r=i[e];if(Hd(r))r.unhook&&r.unhook(t,e,n);else if("attributes"===e)for(var a in r)t.removeAttribute(a);else if("style"===e)for(var o in r)t.style[o]="";else t[e]="string"===typeof r?"":null}}function Fv(t,e,n,i,r){var a=n?n[i]:void 0;if("attributes"!==i)if(a&&$d(a)&&Nv(a)!==Nv(r))t[i]=r;else{$d(t[i])||(t[i]={});var o="style"===i?"":void 0;for(var s in r){var u=r[s];t[i][s]=void 0===u?o:u}}else for(var l in r){var c=r[l];void 0===c?t.removeAttribute(l):t.setAttribute(l,c)}}function Nv(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}var Bv=function t(e,n){var i=n&&n.document||Dv,r=n?n.warn:null;if(e=Vd(e).a,Bd(e))return e.init();if(Nd(e))return i.createTextNode(e.text);if(!Fd(e))return r&&r("Item is not a valid virtual dom node",e),null;var a=null===e.namespace?i.createElement(e.tagName):i.createElementNS(e.namespace,e.tagName),o=e.properties;zv(a,o);for(var s=e.children,u=0;u<s.length;u++){var l=t(s[u],n);l&&a.appendChild(l)}return a};var jv={},Vv=function(t,e,n,i){return n&&0!==n.length?(n.sort(Hv),Uv(t,e,n,i,0)):{}};function Uv(t,e,n,i,r){if(i=i||{},t){$v(n,r,r)&&(i[r]=t);var a=e.children;if(a)for(var o=t.childNodes,s=0;s<e.children.length;s++){r+=1;var u=a[s]||jv,l=r+(u.count||0);$v(n,r,l)&&Uv(o[s],u,n,i,r),r=l}}return i}function $v(t,e,n){if(0===t.length)return!1;for(var i,r,a=0,o=t.length-1;a<=o;){if(r=t[i=(o+a)/2>>0],a===o)return r>=e&&r<=n;if(r<e)a=i+1;else{if(!(r>n))return!0;o=i-1}}return!1}function Hv(t,e){return t>e?1:-1}var qv=function(t,e){if(Bd(t)&&Bd(e))return"name"in t&&"name"in e?t.id===e.id:t.init===e.init;return!1};var Wv=function(t,e,n){var i=t.type,r=t.vNode,a=t.patch;switch(i){case zd.REMOVE:return function(t,e){var n=t.parentNode;n&&n.removeChild(t);return Gv(t,e),null}(e,r);case zd.INSERT:return function(t,e,n){var i=n.render(e,n);t&&t.appendChild(i);return t}(e,a,n);case zd.VTEXT:return function(t,e,n,i){var r;if(3===t.nodeType)t.replaceData(0,t.length,n.text),r=t;else{var a=t.parentNode;r=i.render(n,i),a&&r!==t&&a.replaceChild(r,t)}return r}(e,0,a,n);case zd.WIDGET:return function(t,e,n,i){var r,a=qv(e,n);r=a?n.update(e,t)||t:i.render(n,i);var o=t.parentNode;o&&r!==t&&o.replaceChild(r,t);a||Gv(t,e);return r}(e,r,a,n);case zd.VNODE:return function(t,e,n,i){var r=t.parentNode,a=i.render(n,i);r&&a!==t&&r.replaceChild(a,t);return a}(e,0,a,n);case zd.ORDER:return function(t,e){for(var n,i,r,a=t.childNodes,o={},s=0;s<e.removes.length;s++)n=a[(i=e.removes[s]).from],i.key&&(o[i.key]=n),t.removeChild(n);for(var u=a.length,l=0;l<e.inserts.length;l++)n=o[(r=e.inserts[l]).key],t.insertBefore(n,r.to>=u++?null:a[r.to])}(e,a),e;case zd.PROPS:return zv(e,a,r.properties),e;case zd.THUNK:return function(t,e){t&&e&&t!==e&&t.parentNode&&t.parentNode.replaceChild(e,t);return e}(e,n.patch(e,a,n));default:return e}};function Gv(t,e){"function"===typeof e.destroy&&Bd(e)&&e.destroy(t)}var Zv=function t(e,n,i){return(i=i||{}).patch=i.patch&&i.patch!==t?i.patch:Xv,i.render=i.render||Bv,i.patch(e,n,i)};function Xv(t,e,n){var i=function(t){var e=[];for(var n in t)"a"!==n&&e.push(Number(n));return e}(e);if(0===i.length)return t;var r=Vv(t,e.a,i),a=t.ownerDocument;n.document||a===Dv||(n.document=a);for(var o=0;o<i.length;o++){var s=i[o];t=Yv(t,r[s],e[s],n)}return t}function Yv(t,e,n,i){if(!e)return t;var r;if(Rd(n))for(var a=0;a<n.length;a++)r=Wv(n[a],e,i),e===t&&(t=r);else r=Wv(n,e,i),e===t&&(t=r);return t}var Kv=Zv,Jv=em,Qv={},tm=[];function em(t,e,n,i,r){this.tagName=t,this.properties=e||Qv,this.children=n||tm,this.key=null!=i?String(i):void 0,this.namespace="string"===typeof r?r:null;var a,o=n&&n.length||0,s=0,u=!1,l=!1,c=!1;for(var h in e)if(e.hasOwnProperty(h)){var p=e[h];Hd(p)&&p.unhook&&(a||(a={}),a[h]=p)}for(var f=0;f<o;f++){var d=n[f];Fd(d)?(s+=d.count||0,!u&&d.hasWidgets&&(u=!0),!l&&d.hasThunks&&(l=!0),c||!d.hooks&&!d.descendantHooks||(c=!0)):!u&&Bd(d)?"function"===typeof d.destroy&&(u=!0):!l&&jd(d)&&(l=!0)}this.count=o+s,this.hasWidgets=u,this.hasThunks=l,this.hooks=a,this.descendantHooks=c}em.prototype.version=Dd,em.prototype.type="VirtualNode";var nm=im;function im(t){this.text=String(t)}im.prototype.version=Dd,im.prototype.type="VirtualText";var rm=function(t){var e,n=String.prototype.split,i=/()??/.exec("")[1]===t;return e=function(e,r,a){if("[object RegExp]"!==Object.prototype.toString.call(r))return n.call(e,r,a);var o,s,u,l,c=[],h=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),p=0;r=new RegExp(r.source,h+"g");for(e+="",i||(o=new RegExp("^"+r.source+"$(?!\\s)",h)),a=a===t?-1>>>0:a>>>0;(s=r.exec(e))&&!((u=s.index+s[0].length)>p&&(c.push(e.slice(p,s.index)),!i&&s.length>1&&s[0].replace(o,(function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===t&&(s[e]=t)})),s.length>1&&s.index<e.length&&Array.prototype.push.apply(c,s.slice(1)),l=s[0].length,p=u,c.length>=a));)r.lastIndex===s.index&&r.lastIndex++;return p===e.length?!l&&r.test("")||c.push(""):c.push(e.slice(p)),c.length>a?c.slice(0,a):c},e}(),am=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,om=/^\.|#/,sm=function(t,e){if(!t)return"DIV";var n,i,r,a,o=!e.hasOwnProperty("id"),s=rm(t,am),u=null;om.test(s[1])&&(u="DIV");for(a=0;a<s.length;a++)(i=s[a])&&(r=i.charAt(0),u?"."===r?(n=n||[]).push(i.substring(1,i.length)):"#"===r&&o&&(e.id=i.substring(1,i.length)):u=i);n&&(e.className&&n.push(e.className),e.className=n.join(" "));return e.namespace?u:u.toUpperCase()};var um=lm;function lm(t){if(!(this instanceof lm))return new lm(t);this.value=t}lm.prototype.hook=function(t,e){t[e]!==this.value&&(t[e]=this.value)};var cm="undefined"!==typeof window?window:"undefined"!==typeof iv?iv:{},hm=function(t,e){if(t in cm)return cm[t];return cm[t]=e,e};var pm=function(t,e,n){var i="__INDIVIDUAL_ONE_VERSION_"+t,r=hm(i+"_ENFORCE_SINGLETON",e);if(r!==e)throw new Error("Can only have one copy of "+t+".\nYou already have version "+r+" installed.\nThis means you cannot install version "+e);return hm(i,n)};pm("ev-store","7");var fm="__EV_STORE_KEY@7",dm=function(t){var e=t[fm];e||(e=t[fm]={});return e};var vm=mm;function mm(t){if(!(this instanceof mm))return new mm(t);this.value=t}mm.prototype.hook=function(t,e){dm(t)[e.substr(3)]=this.value},mm.prototype.unhook=function(t,e){dm(t)[e.substr(3)]=void 0};var gm=function(t,e,n){var i,r,a,o,s=[];!n&&(u=e,"string"===typeof u||Rd(u)||_m(u))&&(n=e,r={});var u;i=sm(t,r=r||e||{}),r.hasOwnProperty("key")&&(a=r.key,r.key=void 0);r.hasOwnProperty("namespace")&&(o=r.namespace,r.namespace=void 0);"INPUT"!==i||o||!r.hasOwnProperty("value")||void 0===r.value||Hd(r.value)||(r.value=um(r.value));(function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if(Hd(n))continue;"ev-"===e.substr(0,3)&&(t[e]=vm(n))}})(r),void 0!==n&&null!==n&&ym(n,s,i,r);return new Jv(i,r,s,a,o)};function ym(t,e,n,i){if("string"===typeof t)e.push(new nm(t));else if("number"===typeof t)e.push(new nm(String(t)));else if(_m(t))e.push(t);else{if(!Rd(t)){if(null===t||void 0===t)return;throw function(t){var e=new Error;return e.type="virtual-hyperscript.unexpected.virtual-element",e.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+bm(t.foreignObject)+".\nThe parent vnode is:\n"+bm(t.parentVnode),e.foreignObject=t.foreignObject,e.parentVnode=t.parentVnode,e}({foreignObject:t,parentVnode:{tagName:n,properties:i}})}for(var r=0;r<t.length;r++)ym(t[r],e,n,i)}}function _m(t){return Fd(t)||Nd(t)||Bd(t)||jd(t)}function bm(t){try{return JSON.stringify(t,null,"    ")}catch(e){return String(t)}}var xm,wm={diff:nv,patch:Kv,h:gm,create:Bv,VNode:Jv,VText:nm},Sm=function(){function t(){Tt(this,t),this._events={}}return Ct(t,[{key:"on",value:function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)}},{key:"off",value:function(t,e){if(t){if(this._listens(t)){var n=this._events[t].indexOf(e);n>=0&&this._events[t].splice(n,1),this._events[t].length||delete this._events[t]}}else this._events={}}},{key:"fire",value:function(t,e){if(this._listens(t)){var n,i=wt(this._events[t]);try{for(i.s();!(n=i.n()).done;){(0,n.value)(e)}}catch(Tx){i.e(Tx)}finally{i.f()}}}},{key:"_listens",value:function(t){return t in this._events}}]),t}(),km=function(){function t(){Tt(this,t),this._subscriptions=[]}return Ct(t,[{key:"push",value:function(t){this._subscriptions.push(t)}},{key:"unsubscribe",value:function(){var t,e=wt(this._subscriptions);try{for(e.s();!(t=e.n()).done;){t.value.unsubscribe()}}catch(Tx){e.e(Tx)}finally{e.f()}this._subscriptions=[]}}]),t}(),Mm=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this))._activated$=new ue(!1),a._configurationSubject$=new te,a._activated=!1,a._container=i,a._name=t,a._navigator=r,a._subscriptions=new km,a._configuration$=a._configurationSubject$.pipe(Di(a.defaultConfiguration),li((function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t})),bi(1),ne()),a._configuration$.subscribe((function(){})),a}return Ct(n,[{key:"activated",get:function(){return this._activated}},{key:"activated$",get:function(){return this._activated$}},{key:"defaultConfiguration",get:function(){return this._getDefaultConfiguration()}},{key:"configuration$",get:function(){return this._configuration$}},{key:"name",get:function(){return this._name}},{key:"activate",value:function(t){this._activated||(void 0!==t&&this._configurationSubject$.next(t),this._activated=!0,this._activate(),this._activated$.next(!0))}},{key:"configure",value:function(t){this._configurationSubject$.next(t)}},{key:"deactivate",value:function(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"resize",value:function(){}}]),n}(Sm);!function(t){t[t.Hidden=0]="Hidden",t[t.Loading=1]="Loading",t[t.Visible=2]="Visible"}(xm||(xm={}));var Tm=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){return Tt(this,n),e.call(this,t,i,r)}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this.configuration$.pipe(ri((function(t){return!!t.id})),hn((function(t){return!t.src})),zi((function(e){return t._getImageSrc$(e.id).pipe(An((function(t){return console.error(t),me()})))})),bi(1),ne()),n=this._subscriptions;n.push(e.pipe(De((function(t){return{src:t}}))).subscribe((function(e){t._configurationSubject$.next(e)}))),n.push(We(this.configuration$,e).pipe(hn((function(t){var e=rt(t,2),n=e[0],i=e[1];return!!n.src&&n.src!==i})),ri()).subscribe((function(t){var e=rt(t,2)[1];window.URL.revokeObjectURL(e)}))),n.push(this._configuration$.pipe(Un(void 0,(function(t){return t.state})),zi((function(e){return We(xe(e.state),t._navigator.stateService.currentImage$)})),zi((function(t){var e=rt(t,2),n=e[0],i=e[1],r=We(xe(i.id),i.image$.pipe(hn((function(t){return!!t})),De((function(t){return t.src}))));return n===xm.Visible?r.pipe(ri()):r})),Un((function(t,e){var n=rt(t,2),i=n[0],r=n[1],a=rt(e,2),o=a[0],s=a[1];return i===o&&r===s})),De((function(t){var e=rt(t,2);return{id:e[0],src:e[1]}}))).subscribe(this._configurationSubject$)),n.push(We(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(De((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2];if(!i.src)return{name:t._name,vNode:wm.h("div",[])};var o=a.width<=640||a.height<=480?".mapillary-cover-compact":"";if(i.state===xm.Hidden){var s=wm.h("div.mapillary-cover-container.mapillary-cover-done"+o,[t._getCoverBackgroundVNode(i)]);return{name:t._name,vNode:s}}var u=wm.h("div.mapillary-cover-container"+o,[t._getCoverButtonVNode(i,r)]);return{name:t._name,vNode:u}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{state:xm.Visible}}},{key:"_getCoverButtonVNode",value:function(t,e){var n=this,i=t.state===xm.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",r=wm.h("div.mapillary-cover-button",[wm.h("div.mapillary-cover-button-icon",[])]),a=wm.h("a.mapillary-cover-logo",{href:e,target:"_blank"},[]),o=wm.h("div.mapillary-cover-indicator",{onclick:function(){n.configure({state:xm.Loading})}},[]);return wm.h(i,[this._getCoverBackgroundVNode(t),o,r,a])}},{key:"_getCoverBackgroundVNode",value:function(t){var e={style:{backgroundImage:"url(".concat(t.src,")")}},n=[];return t.state===xm.Loading&&n.push(wm.h("div.mapillary-cover-spinner",{},[])),wm.h("div.mapillary-cover-background",e,n)}},{key:"_getImageSrc$",value:function(t){var e=this;return Xt.create((function(n){e._navigator.api.getImages$([t]).subscribe((function(i){var r,a=wt(i);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.node_id===t)return void e._navigator.api.data.getImageBuffer(o.node.thumb.url).then((function(e){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){n.next(i.src),n.complete()},i.onerror=function(){n.error(new Error("Failed to load cover "+"image (".concat(t,")")))};var r=new Blob([e]);i.src=window.URL.createObjectURL(r)}),(function(t){n.error(t)}))}}catch(Tx){a.e(Tx)}finally{a.f()}n.error(new Hf("Non existent cover key: ".concat(t)))}),(function(t){n.error(t)}))}))}}]),n}(Mm);Tm.componentName="cover";var Em=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_activate",value:function(){var t=this;this._subscriptions.push(We(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(De((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2],o=t._makeAttribution(r.creatorUsername,i,r.id,r.capturedAt,a.width);return{name:t._name,vNode:o}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}},{key:"makeImageUrl",value:function(t,e){return"".concat(t,"/app/?pKey=").concat(e,"&focus=photo")}},{key:"_makeAttribution",value:function(t,e,n,i,r){var a=r<=640,o=this._makeDate(i,a),s=this._makeBy(t,e,n,a),u=a?".mapillary-attribution-compact":"";return wm.h("div.mapillary-attribution-container"+u,{},[].concat(vt(s),[o]))}},{key:"_makeBy",value:function(t,e,n,i){var r=wm.h("div.mapillary-attribution-logo",[]);return t?this._makeCreatorBy(r,t,e,n,i):this._makeGeneralBy(r,e,n,i)}},{key:"_makeCreatorBy",value:function(t,e,n,i,r){var a=wm.h("a.mapillary-attribution-icon-container",{href:n,rel:"noreferrer",target:"_blank"},[t]),o=r?"".concat(e):"image by ".concat(e),s=wm.h("div.mapillary-attribution-username",{textContent:o},[]);return[a,wm.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(n,i),rel:"noreferrer",target:"_blank"},[s])]}},{key:"_makeGeneralBy",value:function(t,e,n,i){var r=wm.h("div.mapillary-attribution-username",{textContent:"images by"},[]),a=[wm.h("div.mapillary-attribution-icon-container",{},[t]),wm.h("div.mapillary-attribution-username",{textContent:"contributors"},[])];return i||a.unshift(r),[wm.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(e,n),rel:"noreferrer",target:"_blank"},a)]}},{key:"_makeDate",value:function(t,e){var n=new Date(t).toDateString().split(" "),i=(n.length>3?e?[n[3]]:[n[1],n[2]+",",n[3]]:n).join(" ");return wm.h("div.mapillary-attribution-date",{textContent:i},[])}}]),n}(Mm);Em.componentName="attribution";var Cm,Im=function(){function t(){Tt(this,t),this._unprojectDepth=200}return Ct(t,[{key:"basicToCanvas",value:function(t,e,n,i,r){var a=i.unprojectBasic([t,e],this._unprojectDepth);return this.projectToCanvas(a,n,r)}},{key:"basicToCanvasSafe",value:function(t,e,n,i,r){var a=this.basicToViewportSafe(t,e,i,r);return null===a?null:this.viewportToCanvas(a[0],a[1],n)}},{key:"basicToViewport",value:function(t,e,n,i){var r=n.unprojectBasic([t,e],this._unprojectDepth);return this.projectToViewport(r,i)}},{key:"basicToViewportSafe",value:function(t,e,n,i){var r=n.unprojectBasic([t,e],this._unprojectDepth);return this.worldToCamera(r,i)[2]>0?null:this.projectToViewport(r,i)}},{key:"cameraToViewport",value:function(t,e){var n=(new Wr).fromArray(t).applyMatrix4(e.projectionMatrix);return[n.x,n.y]}},{key:"canvasPosition",value:function(t,e){var n=e.getBoundingClientRect();return[t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop]}},{key:"canvasToBasic",value:function(t,e,n,i,r){var a=this.unprojectFromCanvas(t,e,n,r).toArray();return i.projectBasic(a)}},{key:"canvasToViewport",value:function(t,e,n){var i=rt(this.containerToCanvas(n),2);return[2*t/i[0]-1,1-2*e/i[1]]}},{key:"containerToCanvas",value:function(t){return[t.offsetWidth,t.offsetHeight]}},{key:"getBasicDistances",value:function(t,e){var n=this.viewportToBasic(-1,1,t,e),i=this.viewportToBasic(1,1,t,e),r=this.viewportToBasic(1,-1,t,e),a=this.viewportToBasic(-1,-1,t,e),o=0,s=0,u=0,l=0;return n[1]<0&&i[1]<0&&(o=n[1]>i[1]?-n[1]:-i[1]),i[0]>1&&r[0]>1&&(s=i[0]<r[0]?i[0]-1:r[0]-1),r[1]>1&&a[1]>1&&(u=r[1]<a[1]?r[1]-1:a[1]-1),a[0]<0&&n[0]<0&&(l=a[0]>n[0]?-a[0]:-n[0]),[o,s,u,l]}},{key:"getPixelDistances",value:function(t,e,n){var i=this.viewportToBasic(-1,1,e,n),r=this.viewportToBasic(1,1,e,n),a=this.viewportToBasic(1,-1,e,n),o=this.viewportToBasic(-1,-1,e,n),s=0,u=0,l=0,c=0,h=rt(this.containerToCanvas(t),2),p=h[0],f=h[1];if(i[1]<0&&r[1]<0){var d=i[1]>r[1]?i[0]:r[0],v=this.basicToCanvas(d,0,t,e,n);s=v[1]>0?v[1]:0}if(r[0]>1&&a[0]>1){var m=r[0]<a[0]?r[1]:a[1],g=this.basicToCanvas(1,m,t,e,n);u=g[0]<p?p-g[0]:0}if(a[1]>1&&o[1]>1){var y=a[1]<o[1]?a[0]:o[0],_=this.basicToCanvas(y,1,t,e,n);l=_[1]<f?f-_[1]:0}if(o[0]<0&&i[0]<0){var b=o[0]>i[0]?o[1]:i[1],x=this.basicToCanvas(0,b,t,e,n);c=x[0]>0?x[0]:0}return[s,u,l,c]}},{key:"insideElement",value:function(t,e){var n=e.getBoundingClientRect(),i=n.left+e.clientLeft,r=i+e.clientWidth,a=n.top+e.clientTop,o=a+e.clientHeight;return t.clientX>i&&t.clientX<r&&t.clientY>a&&t.clientY<o}},{key:"projectToCanvas",value:function(t,e,n){var i=this.projectToViewport(t,n);return this.viewportToCanvas(i[0],i[1],e)}},{key:"projectToCanvasSafe",value:function(t,e,n){if(this.worldToCamera(t,n)[2]>0)return null;var i=this.projectToViewport(t,n);return this.viewportToCanvas(i[0],i[1],e)}},{key:"projectToViewport",value:function(t,e){var n=new Wr(t[0],t[1],t[2]).project(e);return[n.x,n.y]}},{key:"unprojectFromCanvas",value:function(t,e,n,i){var r=this.canvasToViewport(t,e,n);return this.unprojectFromViewport(r[0],r[1],i)}},{key:"unprojectFromViewport",value:function(t,e,n){return new Wr(t,e,1).unproject(n)}},{key:"viewportToBasic",value:function(t,e,n,i){var r=new Wr(t,e,1).unproject(i).toArray();return n.projectBasic(r)}},{key:"viewportToCanvas",value:function(t,e,n){var i=rt(this.containerToCanvas(n),2);return[i[0]*(t+1)/2,-i[1]*(e-1)/2]}},{key:"worldToCamera",value:function(t,e){return new Wr(t[0],t[1],t[2]).applyMatrix4(e.matrixWorldInverse).toArray()}}]),t}();!function(t){t[t.Automatic=0]="Automatic",t[t.Large=1]="Large",t[t.Small=2]="Small"}(Cm||(Cm={}));var Pm=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._spatial=new Wf,a._viewportCoords=new Im,a._svgNamespace="http://www.w3.org/2000/svg",a._distinctThreshold=Math.PI/360,a._animationSpeed=.075,a._unitBezier=new wd(.74,.67,.38,.96),a}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this._subscriptions,n=this._container.renderService.renderCamera$.pipe(De((function(e){var n=t._spatial.degToRad(e.perspective.fov),i=e.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:2*Math.atan(e.perspective.aspect*Math.tan(.5*n));return[t._spatial.azimuthalToBearing(e.rotation.phi),i]})),Un((function(e,n){return Math.abs(n[0]-e[0])<t._distinctThreshold&&Math.abs(n[1]-e[1])<t._distinctThreshold}))),i=We(this._navigator.stateService.currentState$.pipe(Un(void 0,(function(t){return t.state.currentImage.id}))),this._navigator.panService.panImages$).pipe(De((function(e){var n=rt(e,2),i=n[0],r=n[1],a=i.state.currentImage,o=i.state.currentTransform;if(Zf(a.cameraType))return[Math.PI,Math.PI];var s,u=t._computeProjectedPoints(o),l=t._spatial.degToRad(t._computeHorizontalFov(u)),c=l/2,h=l/2,p=wt(r);try{for(p.s();!(s=p.n()).done;){var f=rt(s.value,3),d=f[0],v=f[2],m=t._spatial.wrap(d.compassAngle-a.compassAngle,-180,180);m<0?c=t._spatial.degToRad(Math.abs(m))+v/2:h=t._spatial.degToRad(Math.abs(m))+v/2}}catch(Tx){p.e(Tx)}finally{p.f()}return[c,h]})),Un((function(e,n){var i=rt(e,2),r=i[0],a=i[1],o=rt(n,2),s=o[0],u=o[1];return Math.abs(s-r)<t._distinctThreshold&&Math.abs(u-a)<t._distinctThreshold}))),r=We(this._navigator.stateService.currentState$.pipe(Un(void 0,(function(t){return t.state.currentImage.id}))),this._container.renderService.bearing$).pipe(De((function(e){var n=rt(e,2),i=n[0],r=n[1];return t._spatial.degToRad(i.state.currentImage.compassAngle-r)}))),a=new te,o=a.pipe(li((function(t,e){return e(t)}),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),De((function(e){var n=t._unitBezier.solve(e.alpha),i=e.curr,r=e.prev;return[t._interpolate(r[0],i[0],n),t._interpolate(r[1],i[1],n)]})));e.push(i.pipe(De((function(e){return function(n){var i=t._unitBezier.solve(n.alpha),r=n.curr,a=n.prev,o=[t._interpolate(a[0],r[0],i),t._interpolate(a[1],r[1],i)];return{alpha:0,curr:e.slice(),prev:o}}}))).subscribe(a)),e.push(i.pipe(zi((function(){return t._container.renderService.renderCameraFrame$.pipe(Ci(1),li((function(e){return e+t._animationSpeed}),0),Vi((function(e){return e<=1+t._animationSpeed})),De((function(t){return Math.min(t,1)})))})),De((function(t){return function(e){return{alpha:t,curr:e.curr.slice(),prev:e.prev.slice()}}}))).subscribe(a));var s=We(r,o).pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return[n,i[0],i[1]]})));e.push(We(n,s,this._configuration$,this._container.renderService.size$).pipe(De((function(e){var n=rt(e,4),i=rt(n[0],2),r=i[0],a=i[1],o=rt(n[1],3),s=o[0],u=o[1],l=o[2],c=n[2],h=n[3],p=t._createBackground(r),f=t._createFovIndicator(u,l,s),d=t._createNorth(r),v=t._createCircleSectorCompass(t._createCircleSector(Math.max(Math.PI/20,a),"#FFF")),m=c.size===Cm.Small||c.size===Cm.Automatic&&h.width<640?".mapillary-bearing-compact":"";return{name:t._name,vNode:wm.h("div.mapillary-bearing-indicator-container"+m,{oncontextmenu:function(t){t.preventDefault()}},[p,f,d,v])}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{size:Cm.Automatic}}},{key:"_createFovIndicator",value:function(t,e,n){var i=this._createFovArc(t,e),r=wm.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[i]);return wm.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:"rotateZ(".concat(this._spatial.radToDeg(n),"deg)"),width:"36px"}},[r])}},{key:"_createFovArc",value:function(t,e){var n=16.75,i=t+e;if(i>2*Math.PI-Math.PI/90)return wm.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:"".concat(n),stroke:"#FFF","stroke-width":"".concat(2.5)},namespace:this._svgNamespace},[]);var r=-Math.PI/2-t,a=r+i,o=n*Math.cos(r),s=n*Math.sin(r),u=n*Math.cos(a),l=n*Math.sin(a),c=i>=Math.PI?1:0,h="M ".concat(o," ").concat(s," A ").concat(n," ").concat(n," 0 ").concat(c," 1 ").concat(u," ").concat(l);return wm.h("path",{attributes:{d:h,"fill-opacity":"0",stroke:"#FFF","stroke-width":"".concat(2.5)},namespace:this._svgNamespace},[])}},{key:"_createCircleSectorCompass",value:function(t){var e=wm.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[t]);return wm.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[e])}},{key:"_createCircleSector",value:function(t,e){if(t>2*Math.PI-Math.PI/90)return wm.h("circle",{attributes:{cx:"0",cy:"0",fill:e,r:"1"},namespace:this._svgNamespace},[]);var n=-Math.PI/2-t/2,i=n+t,r=Math.cos(n),a=Math.sin(n),o=Math.cos(i),s=Math.sin(i),u=t>=Math.PI?1:0,l="M 0 0 ".concat(r," ").concat(a," A 1 1 0 ").concat(u," 1 ").concat(o," ").concat(s);return wm.h("path",{attributes:{d:l,fill:e},namespace:this._svgNamespace},[])}},{key:"_createNorth",value:function(t){var e=wm.h("div.mapillary-bearing-north",[]);return wm.h("div.mapillary-bearing-north-container",{style:{transform:"rotateZ(".concat(this._spatial.radToDeg(-t),"deg)")}},[e])}},{key:"_createBackground",value:function(t){return wm.h("div.mapillary-bearing-indicator-background",{style:{transform:"rotateZ(".concat(this._spatial.radToDeg(-t),"deg)")}},[wm.h("div.mapillary-bearing-indicator-background-circle",[]),wm.h("div.mapillary-bearing-indicator-background-arrow-container",[wm.h("div.mapillary-bearing-indicator-background-arrow",[])])])}},{key:"_computeProjectedPoints",value:function(t){return Kf(t,[[1,0]],[[0,.5]],12,this._viewportCoords)}},{key:"_computeHorizontalFov",value:function(t){var e=this,n=t.map((function(t){return e._coordToFov(t[0])}));return Math.min.apply(Math,vt(n))}},{key:"_coordToFov",value:function(t){return this._spatial.radToDeg(2*Math.atan(t))}},{key:"_interpolate",value:function(t,e,n){return(1-n)*t+n*e}}]),n}(Mm);Pm.componentName="bearing";var Am=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){return Tt(this,n),e.call(this,t,i,r)}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this._subscriptions;e.push(We(this._navigator.stateService.currentImage$.pipe(zi((function(t){return t.sequenceEdges$})),hn((function(t){return t.cached}))),this._configuration$).pipe(zi((function(e){var n=e[0],i=e[1],r=Math.max(0,Math.min(4,i.depth.sequence));return cn(t._cache$(n.edges,Of.Next,r),t._cache$(n.edges,Of.Prev,r)).pipe(An((function(t){return console.error("Failed to cache sequence edges.",t),me()})))}))).subscribe((function(){}))),e.push(We(this._navigator.stateService.currentImage$.pipe(zi((function(t){return We(xe(t),t.spatialEdges$.pipe(hn((function(t){return t.cached}))))}))),this._configuration$).pipe(zi((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1],s=a.edges,u=o.depth,l=Math.max(0,Math.min(2,u.spherical)),c=Zf(r.cameraType)?0:Math.max(0,Math.min(3,u.step)),h=Zf(r.cameraType)?0:Math.max(0,Math.min(1,u.turn)),p=t._cache$(s,Of.Spherical,l);return cn(t._cache$(s,Of.StepForward,c),t._cache$(s,Of.StepBackward,c),t._cache$(s,Of.StepLeft,c),t._cache$(s,Of.StepRight,c),p,t._cache$(s,Of.TurnLeft,h),t._cache$(s,Of.TurnRight,h),t._cache$(s,Of.TurnU,h)).pipe(An((function(t){return console.error("Failed to cache spatial edges.",t),me()})))}))).subscribe((function(){})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}},{key:"_cache$",value:function(t,e,n){var i=this;return mn(xe(t),xe(n)).pipe(Jn((function(t){var n=t[0],r=t[1],a=[];if(r>0){var o,s=wt(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.data.direction===e&&a.push(mn(i._navigator.graphService.cacheImage$(u.target).pipe(tn((function(t){return i._imageToEdges$(t,e)}))),xe(r-1)))}}catch(Tx){s.e(Tx)}finally{s.f()}}return Ye(a).pipe(rn())})),Ci(1))}},{key:"_imageToEdges$",value:function(t,e){return([Of.Next,Of.Prev].indexOf(e)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(ri((function(t){return t.cached})),De((function(t){return t.edges})))}}]),n}(Mm);Am.componentName="cache";var Lm=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),i=e.call(this,null!=t?t:"The request was cancelled."),Object.setPrototypeOf(ft(i),n.prototype),i.name="CancelMapillaryError",i}return Ct(n)}(Hf),Rm=function(){function t(e,n){Tt(this,t),this._spatial=new Wf,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(e),this._resize(n),this._reset()}return Ct(t,[{key:"minWidth",get:function(){return this._minWidth}},{key:"maxWidth",get:function(){return this._maxWidth}},{key:"containerWidth",get:function(){return this._containerWidth}},{key:"containerWidthCss",get:function(){return this._containerWidthCss}},{key:"containerMarginCss",get:function(){return this._containerMarginCss}},{key:"containerLeftCss",get:function(){return this._containerLeftCss}},{key:"containerHeight",get:function(){return this._containerHeight}},{key:"containerHeightCss",get:function(){return this._containerHeightCss}},{key:"containerBottomCss",get:function(){return this._containerBottomCss}},{key:"stepCircleSize",get:function(){return this._stepCircleSize}},{key:"stepCircleSizeCss",get:function(){return this._stepCircleSizeCss}},{key:"stepCircleMarginCss",get:function(){return this._stepCircleMarginCss}},{key:"turnCircleSize",get:function(){return this._turnCircleSize}},{key:"turnCircleSizeCss",get:function(){return this._turnCircleSizeCss}},{key:"outerRadius",get:function(){return this._outerRadius}},{key:"innerRadius",get:function(){return this._innerRadius}},{key:"shadowOffset",get:function(){return this._shadowOffset}},{key:"configure",value:function(t){this._configure(t),this._reset()}},{key:"resize",value:function(t){this._resize(t),this._reset()}},{key:"angleToCoordinates",value:function(t){return[Math.cos(t),Math.sin(t)]}},{key:"relativeAngleToCoordiantes",value:function(t,e){var n=this._spatial.wrapAngle(t-e);return this.angleToCoordinates(n)}},{key:"_configure",value:function(t){this._minWidth=t.minWidth,this._maxWidth=this._getMaxWidth(t.minWidth,t.maxWidth)}},{key:"_resize",value:function(t){this._elementWidth=t.width,this._elementHeight=t.height}},{key:"_reset",value:function(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}},{key:"_getContainerWidth",value:function(t,e){var n=(t-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),i=(e-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),r=Math.max(0,Math.min(1,Math.min(n,i)));return r=.04*Math.round(25*r),this._minWidth+r*(this._maxWidth-this._minWidth)}},{key:"_getContainerHeight",value:function(t){return.77*t}},{key:"_getStepCircleDiameter",value:function(t){return.34*t}},{key:"_getTurnCircleDiameter",value:function(t){return.3*t}},{key:"_getOuterRadius",value:function(t){return.31*t}},{key:"_getInnerRadius",value:function(t){return.125*t}},{key:"_numberToCssPixels",value:function(t){return t+"px"}},{key:"_getMaxWidth",value:function(t,e){return t>e?t:e}}]),t}(),Dm=function(){function t(e,n){Tt(this,t),this._isEdge=!1,this._spatial=new Wf,this._calculator=new Rm(e,n),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[Of.StepForward,Of.StepBackward,Of.StepLeft,Of.StepRight],this._turnDirections=[Of.TurnLeft,Of.TurnRight,Of.TurnU],this._turnNames={},this._turnNames[Of.TurnLeft]="mapillary-direction-turn-left",this._turnNames[Of.TurnRight]="mapillary-direction-turn-right",this._turnNames[Of.TurnU]="mapillary-direction-turn-around";var i=!!document.documentMode;this._isEdge=!i&&!!window.StyleMedia}return Ct(t,[{key:"needsRender",get:function(){return this._needsRender}},{key:"render",value:function(t){this._needsRender=!1;var e=this._rotation,n=[],i=[];return Zf(this._image.cameraType)?n=n.concat(this._createSphericalArrows(t,e)):(n=(n=n.concat(this._createPerspectiveToSphericalArrows(t,e))).concat(this._createStepArrows(t,e)),i=i.concat(this._createTurnArrows(t))),this._getContainer(n,i,e)}},{key:"setEdges",value:function(t,e){this._setEdges(t,e),this._setNeedsRender()}},{key:"setImage",value:function(t){this._image=t,this._clearEdges(),this._setNeedsRender()}},{key:"setRenderCamera",value:function(t){var e=t.rotation;Math.abs(e.phi-this._rotation.phi)<this._epsilon||(this._rotation=e,this._setNeedsRender())}},{key:"setConfiguration",value:function(t){var e=!1;this._highlightKey===t.highlightId&&this._distinguishSequence===t.distinguishSequence||(this._highlightKey=t.highlightId,this._distinguishSequence=t.distinguishSequence,e=!0),this._calculator.minWidth===t.minWidth&&this._calculator.maxWidth===t.maxWidth||(this._calculator.configure(t),e=!0),e&&this._setNeedsRender()}},{key:"resize",value:function(t){this._calculator.resize(t),this._setNeedsRender()}},{key:"_setNeedsRender",value:function(){null!=this._image&&(this._needsRender=!0)}},{key:"_clearEdges",value:function(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}},{key:"_setEdges",value:function(t,e){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];var n,i=wt(t.edges);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.data.direction;this._stepDirections.indexOf(a)>-1?this._stepEdges.push(r):this._turnDirections.indexOf(a)>-1?this._turnEdges.push(r):r.data.direction===Of.Spherical&&this._sphericalEdges.push(r)}}catch(Tx){i.e(Tx)}finally{i.f()}if(this._distinguishSequence&&null!=e){var o,s=wt(this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges));try{for(s.s();!(o=s.n()).done;){var u,l=o.value.target,c=wt(e.imageIds);try{for(c.s();!(u=c.n()).done;){if(u.value===l){this._sequenceEdgeKeys.push(l);break}}}catch(Tx){c.e(Tx)}finally{c.f()}}}catch(Tx){s.e(Tx)}finally{s.f()}}}},{key:"_createSphericalArrows",value:function(t,e){var n,i=[],r=wt(this._sphericalEdges);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(this._createVNodeByKey(t,a.target,a.data.worldMotionAzimuth,e,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"))}}catch(Tx){r.e(Tx)}finally{r.f()}var o,s=wt(this._stepEdges);try{for(s.s();!(o=s.n()).done;){var u=o.value;i.push(this._createSphericalToPerspectiveArrow(t,u.target,u.data.worldMotionAzimuth,e,u.data.direction))}}catch(Tx){s.e(Tx)}finally{s.f()}return i}},{key:"_createSphericalToPerspectiveArrow",value:function(t,e,n,i,r){var a=Math.PI/8,o=i.phi;switch(r){case Of.StepBackward:o=i.phi-Math.PI;break;case Of.StepLeft:o=i.phi+Math.PI/2;break;case Of.StepRight:o=i.phi-Math.PI/2}return Math.abs(this._spatial.wrapAngle(n-o))<a?this._createVNodeByKey(t,e,n,i,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(e,n,i)}},{key:"_createPerspectiveToSphericalArrows",value:function(t,e){var n,i=[],r=wt(this._sphericalEdges);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(this._createVNodeByKey(t,a.target,a.data.worldMotionAzimuth,e,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0))}}catch(Tx){r.e(Tx)}finally{r.f()}return i}},{key:"_createStepArrows",value:function(t,e){var n,i=[],r=wt(this._stepEdges);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.push(this._createVNodeByDirection(t,a.target,a.data.worldMotionAzimuth,e,a.data.direction))}}catch(Tx){r.e(Tx)}finally{r.f()}return i}},{key:"_createTurnArrows",value:function(t){var e,n=[],i=wt(this._turnEdges);try{for(i.s();!(e=i.n()).done;){var r=e.value,a=r.data.direction,o=this._turnNames[a];n.push(this._createVNodeByTurn(t,r.target,o,a))}}catch(Tx){i.e(Tx)}finally{i.f()}return n}},{key:"_createVNodeByKey",value:function(t,e,n,i,r,a,o){return this._createVNode(e,n,i,r,a,"mapillary-direction-circle",(function(n){t.moveTo$(e).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))}),o)}},{key:"_createVNodeByDirection",value:function(t,e,n,i,r){return this._createVNode(e,n,i,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",(function(e){t.moveDir$(r).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))}))}},{key:"_createVNodeByTurn",value:function(t,e,n,i){var r={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(i){case Of.TurnLeft:r.left="5px",r.top="5px";break;case Of.TurnRight:r.right="5px",r.top="5px";break;case Of.TurnU:r.left="5px",r.bottom="5px"}var a={attributes:{"data-id":e},onclick:function(e){t.moveDir$(i).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))},style:r},o="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(e)>-1&&(o+="-sequence"),this._highlightKey===e&&(o+="-highlight");var s=wm.h("div.".concat(n),{},[]);return wm.h("div."+o,a,[s])}},{key:"_createVNodeInactive",value:function(t,e,n){return this._createVNode(t,e,n,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}},{key:"_createVNode",value:function(t,e,n,i,r,a,o,s){var u=this._calculator.angleToCoordinates(e-n.phi),l=Math.round(-i*u[1]+.5*this._calculator.containerWidth),c=Math.round(-i*u[0]+.5*this._calculator.containerHeight),h=this._calculator.relativeAngleToCoordiantes(e,n.phi),p=this._calculator.shadowOffset,f=-p*h[1],d=p*h[0],v="drop-shadow(".concat(f,"px ").concat(d,"px 1px rgba(0,0,0,0.8))"),m={style:{"-webkit-filter":v,filter:v}},g=wm.h("div."+r,m,[]),y=-this._spatial.radToDeg(e-n.phi),_=s?"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(y,"deg) translateZ(-0.01px)"):"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(y,"deg)"),b={attributes:{"data-id":t},onclick:o,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:_,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(t)>-1&&(a+="-sequence"),this._highlightKey===t&&(a+="-highlight"),wm.h("div."+a,b,[g])}},{key:"_getContainer",value:function(t,e,n){var i=this._isEdge?"rotateX(60deg)":"perspective(".concat(this._calculator.containerWidthCss,") rotateX(60deg)"),r={oncontextmenu:function(t){t.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:i,width:this._calculator.containerWidthCss}};return wm.h("div.mapillary-direction-perspective",r,e.concat(t))}}]),t}(),zm=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._renderer=a||new Dm(o.defaultConfiguration,{height:i.container.offsetHeight,width:i.container.offsetWidth}),o._hoveredIdSubject$=new te,o._hoveredId$=o._hoveredIdSubject$.pipe(Ei()),o}return Ct(n,[{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"_activate",value:function(){var t=this,e=this._subscriptions;e.push(this._configuration$.subscribe((function(e){t._renderer.setConfiguration(e)}))),e.push(this._container.renderService.size$.subscribe((function(e){t._renderer.resize(e)}))),e.push(this._navigator.stateService.currentImage$.pipe(Hi((function(e){t._container.domRenderer.render$.next({name:t._name,vNode:wm.h("div",{},[])}),t._renderer.setImage(e)})),Ki(this._configuration$),zi((function(e){var n=rt(e,2),i=n[0],r=n[1];return We(i.spatialEdges$,r.distinguishSequence?t._navigator.graphService.cacheSequence$(i.sequenceId).pipe(An((function(t){return console.error("Failed to cache sequence (".concat(i.sequenceId,")"),t),xe(null)}))):xe(null))}))).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1];t._renderer.setEdges(i,r)}))),e.push(this._container.renderService.renderCameraFrame$.pipe(Hi((function(e){t._renderer.setRenderCamera(e)})),De((function(){return t._renderer})),hn((function(t){return t.needsRender})),De((function(e){return{name:t._name,vNode:e.render(t._navigator)}}))).subscribe(this._container.domRenderer.render$)),e.push(We(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(Di(null)),this._container.mouseService.mouseUp$.pipe(Di(null))).pipe(De((function(t){for(var e=rt(t,1)[0].getElementsByClassName("mapillary-direction-perspective"),n=0;n<e.length;n++){var i=e.item(n).querySelector(":hover");if(null!=i&&i.hasAttribute("data-id"))return i.getAttribute("data-id")}return null})),Un()).subscribe(this._hoveredIdSubject$)),e.push(this._hoveredId$.subscribe((function(e){var n="hover",i={id:e,target:t,type:n};t.fire(n,i)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}]),n}(Mm);zm.componentName="direction";var Om=Ct((function t(){Tt(this,t)}));Om.fisheye={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.fisheyeCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.perspective={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.perspectiveCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.perspectiveDistorted={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.perspectiveDistortedCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.spherical={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},Om.sphericalCurtain={fragment:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n#define tau 6.28318530718\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lng = atan(b.x, b.z);\n    float x = lng / tau + 0.5;\n    float y = lat / tau * 2.0 + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};var Fm,Nm=function(){function t(e,n){Tt(this,t),this._imagePlaneDepth=null!=e?e:200,this._imageSphereRadius=null!=n?n:200}return Ct(t,[{key:"createMesh",value:function(t,e){return Zf(e.cameraType)?this._createImageSphere(t,e):Xf(e.cameraType)?this._createImagePlaneFisheye(t,e):this._createImagePlane(t,e)}},{key:"createFlatMesh",value:function(t,e,n,i,r,a){var o=this._createTexture(t.image),s=new ps(this._createDistortedPlaneMaterialParameters(e,o));return new os(this._getFlatImagePlaneGeoFromBasic(e,n,i,r,a),s)}},{key:"createCurtainMesh",value:function(t,e){return Zf(e.cameraType)?this._createSphereCurtainMesh(t,e):Xf(e.cameraType)?this._createCurtainMeshFisheye(t,e):this._createCurtainMesh(t,e)}},{key:"createDistortedCurtainMesh",value:function(t,e){return this._createDistortedCurtainMesh(t,e)}},{key:"_createCurtainMesh",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createCurtainPlaneMaterialParameters(e,n));return new os(this._useMesh(e,t)?this._getImagePlaneGeo(e,t):this._getRegularFlatImagePlaneGeo(e),i)}},{key:"_createCurtainMeshFisheye",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createCurtainPlaneMaterialParametersFisheye(e,n));return new os(this._useMesh(e,t)?this._getImagePlaneGeoFisheye(e,t):this._getRegularFlatImagePlaneGeo(e),i)}},{key:"_createDistortedCurtainMesh",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createDistortedCurtainPlaneMaterialParameters(e,n));return new os(this._getRegularFlatImagePlaneGeo(e),i)}},{key:"_createSphereCurtainMesh",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createCurtainSphereMaterialParameters(e,n));return this._useMesh(e,t)?new os(this._getImageSphereGeo(e,t),i):new os(this._getFlatImageSphereGeo(e),i)}},{key:"_createImageSphere",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createSphereMaterialParameters(e,n));return this._useMesh(e,t)?new os(this._getImageSphereGeo(e,t),i):new os(this._getFlatImageSphereGeo(e),i)}},{key:"_createImagePlane",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createPlaneMaterialParameters(e,n));return new os(this._useMesh(e,t)?this._getImagePlaneGeo(e,t):this._getRegularFlatImagePlaneGeo(e),i)}},{key:"_createImagePlaneFisheye",value:function(t,e){var n=this._createTexture(t.image),i=new ps(this._createPlaneMaterialParametersFisheye(e,n));return new os(this._useMesh(e,t)?this._getImagePlaneGeoFisheye(e,t):this._getRegularFlatImagePlaneGeoFisheye(e),i)}},{key:"_createSphereMaterialParameters",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.spherical.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:t.rt},projectorTex:{value:e}},vertexShader:Om.spherical.vertex}}},{key:"_createCurtainSphereMaterialParameters",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.sphericalCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:t.rt},projectorTex:{value:e}},vertexShader:Om.sphericalCurtain.vertex}}},{key:"_createPlaneMaterialParameters",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.perspective.fragment,side:2,transparent:!0,uniforms:{focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Om.perspective.vertex}}},{key:"_createPlaneMaterialParametersFisheye",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.fisheye.fragment,side:2,transparent:!0,uniforms:{focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Om.fisheye.vertex}}},{key:"_createCurtainPlaneMaterialParametersFisheye",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.fisheyeCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Om.fisheyeCurtain.vertex}}},{key:"_createCurtainPlaneMaterialParameters",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.perspectiveCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},focal:{value:t.focal},k1:{value:t.ck1},k2:{value:t.ck2},opacity:{value:1},projectorMat:{value:t.basicRt},projectorTex:{value:e},radial_peak:{value:t.radialPeak?t.radialPeak:0},scale_x:{value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:Om.perspectiveCurtain.vertex}}},{key:"_createDistortedCurtainPlaneMaterialParameters",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.perspectiveDistortedCurtain.fragment,side:2,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:t.projectorMatrix()},projectorTex:{value:e}},vertexShader:Om.perspectiveDistortedCurtain.vertex}}},{key:"_createDistortedPlaneMaterialParameters",value:function(t,e){return{depthWrite:!1,fragmentShader:Om.perspectiveDistorted.fragment,side:2,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:t.projectorMatrix()},projectorTex:{value:e}},vertexShader:Om.perspectiveDistorted.vertex}}},{key:"_createTexture",value:function(t){var e=new Vr(t);return e.minFilter=or,e.needsUpdate=!0,e}},{key:"_useMesh",value:function(t,e){return e.mesh.vertices.length&&t.hasValidScale}},{key:"_getImageSphereGeo",value:function(t,e){for(var n=t.srtInverse,i=5*t.scale,r=this._imageSphereRadius*t.scale,a=e.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],p=a[l+2],f=Math.sqrt(c*c+h*h+p*p),d=Math.max(i,Math.min(f,r))/f,v=new Wr(c*d,h*d,p*d);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=e.mesh.faces,g=new Uint16Array(m.length),y=0;y<m.length;++y)g[y]=m[y];var _=new Uo;return _.setAttribute("position",new xo(s,3)),_.setIndex(new xo(g,1)),_}},{key:"_getImagePlaneGeo",value:function(t,e){for(var n=t.srtInverse,i=5*t.scale,r=this._imagePlaneDepth*t.scale,a=e.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],p=a[l+2];u<4&&(c*=3,h*=3);var f=Math.max(i,Math.min(p,r)),d=f/p,v=new Wr(c*d,h*d,f);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=e.mesh.faces,g=new Uint16Array(m.length),y=0;y<m.length;++y)g[y]=m[y];var _=new Uo;return _.setAttribute("position",new xo(s,3)),_.setIndex(new xo(g,1)),_}},{key:"_getImagePlaneGeoFisheye",value:function(t,e){for(var n=t.srtInverse,i=5*t.scale,r=this._imagePlaneDepth*t.scale,a=e.mesh.vertices,o=a.length/3,s=new Float32Array(a.length),u=0;u<o;++u){var l=3*u,c=a[l+0],h=a[l+1],p=a[l+2],f=Math.sqrt(c*c+h*h+p*p),d=Math.max(i,Math.min(f,r))/f,v=new Wr(c*d,h*d,p*d);v.applyMatrix4(n),s[l+0]=v.x,s[l+1]=v.y,s[l+2]=v.z}for(var m=e.mesh.faces,g=new Uint16Array(m.length),y=0;y<m.length;++y)g[y]=m[y];var _=new Uo;return _.setAttribute("position",new xo(s,3)),_.setIndex(new xo(g,1)),_}},{key:"_getFlatImageSphereGeo",value:function(t){var e=new mh(this._imageSphereRadius,20,40),n=t.rt.clone().invert();return e.applyMatrix4(n),e}},{key:"_getRegularFlatImagePlaneGeo",value:function(t){var e=t.width,n=t.height,i=Math.max(e,n),r=e/2/i,a=n/2/i;return this._getFlatImagePlaneGeo(t,r,a)}},{key:"_getFlatImagePlaneGeo",value:function(t,e,n){var i=[];return i.push(t.unprojectSfM([-e,-n],this._imagePlaneDepth)),i.push(t.unprojectSfM([e,-n],this._imagePlaneDepth)),i.push(t.unprojectSfM([e,n],this._imagePlaneDepth)),i.push(t.unprojectSfM([-e,n],this._imagePlaneDepth)),this._createFlatGeometry(i)}},{key:"_getRegularFlatImagePlaneGeoFisheye",value:function(t){var e=t.width,n=t.height,i=Math.max(e,n),r=e/2/i,a=n/2/i;return this._getFlatImagePlaneGeoFisheye(t,r,a)}},{key:"_getFlatImagePlaneGeoFisheye",value:function(t,e,n){var i=[];return i.push(t.unprojectSfM([-e,-n],this._imagePlaneDepth)),i.push(t.unprojectSfM([e,-n],this._imagePlaneDepth)),i.push(t.unprojectSfM([e,n],this._imagePlaneDepth)),i.push(t.unprojectSfM([-e,n],this._imagePlaneDepth)),this._createFlatGeometry(i)}},{key:"_getFlatImagePlaneGeoFromBasic",value:function(t,e,n,i,r){var a=[];return a.push(t.unprojectBasic([e,i],this._imagePlaneDepth)),a.push(t.unprojectBasic([n,i],this._imagePlaneDepth)),a.push(t.unprojectBasic([n,r],this._imagePlaneDepth)),a.push(t.unprojectBasic([e,r],this._imagePlaneDepth)),this._createFlatGeometry(a)}},{key:"_createFlatGeometry",value:function(t){for(var e=new Float32Array(12),n=0;n<t.length;n++){var i=3*n;e[i+0]=t[n][0],e[i+1]=t[n][1],e[i+2]=t[n][2]}var r=new Uint16Array(6);r[0]=0,r[1]=1,r[2]=3,r[3]=1,r[4]=2,r[5]=3;var a=new Uo;return a.setAttribute("position",new xo(e,3)),a.setIndex(new xo(r,1)),a}}]),t}(),Bm=function(){function t(){Tt(this,t),this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new Al,this._sceneOld=new Al,this._scenePeriphery=new Al}return Ct(t,[{key:"planes",get:function(){return this._planes}},{key:"planesOld",get:function(){return this._planesOld}},{key:"planesPeriphery",get:function(){return this._planesPeriphery}},{key:"scene",get:function(){return this._scene}},{key:"sceneOld",get:function(){return this._sceneOld}},{key:"scenePeriphery",get:function(){return this._scenePeriphery}},{key:"updateImagePlanes",value:function(t){for(var e in this._dispose(this._planesOld,this.sceneOld),this._planes)if(this._planes.hasOwnProperty(e)){var n=this._planes[e];this._scene.remove(n),this._sceneOld.add(n)}for(var i in t)t.hasOwnProperty(i)&&this._scene.add(t[i]);this._planesOld=this._planes,this._planes=t}},{key:"addImagePlanes",value:function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];this._scene.add(n),this._planes[e]=n}}},{key:"addImagePlanesOld",value:function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];this._sceneOld.add(n),this._planesOld[e]=n}}},{key:"setImagePlanes",value:function(t){this._clear(),this.addImagePlanes(t)}},{key:"addPeripheryPlanes",value:function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];this._scenePeriphery.add(n),this._planesPeriphery[e]=n}}},{key:"setPeripheryPlanes",value:function(t){this._clearPeriphery(),this.addPeripheryPlanes(t)}},{key:"setImagePlanesOld",value:function(t){this._clearOld(),this.addImagePlanesOld(t)}},{key:"clear",value:function(){this._clear(),this._clearOld()}},{key:"_clear",value:function(){this._dispose(this._planes,this._scene),this._planes={}}},{key:"_clearOld",value:function(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}},{key:"_clearPeriphery",value:function(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}},{key:"_dispose",value:function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];e.remove(i),i.geometry.dispose(),i.material.dispose();var r=i.material.uniforms.projectorTex.value;null!=r&&r.dispose()}}}]),t}(),jm=function(){function t(){Tt(this,t),this._factory=new Nm,this._scene=new Bm,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}return Ct(t,[{key:"frameId",get:function(){return this._frameId}},{key:"needsRender",get:function(){return this._needsRender}},{key:"indicateNeedsRender",value:function(){this._needsRender=!0}},{key:"addPeripheryPlane",value:function(t,e){var n=this._factory.createMesh(t,e),i={};i[t.id]=n,this._scene.addPeripheryPlanes(i),this._needsRender=!0}},{key:"clearPeripheryPlanes",value:function(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}},{key:"updateFrame",value:function(t){this._updateFrameId(t.id),this._needsRender=this._updateAlpha(t.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(t.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(t.state)||this._needsRender}},{key:"setTextureProvider",value:function(t,e){var n=this;if(t===this._currentKey){var i=e.textureCreated$.subscribe((function(t){n._updateTexture(t)})),r=e.textureUpdated$.subscribe((function(t){n._needsRender=!0}));if(t in this._providerDisposers)(0,this._providerDisposers[t])(),delete this._providerDisposers[t];this._providerDisposers[t]=function(){i.unsubscribe(),r.unsubscribe(),e.dispose()}}}},{key:"updateTextureImage",value:function(t,e){this._needsRender=!0;var n=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(var i in n)if(n.hasOwnProperty(i)&&i===e.id){var r=n[i].material.uniforms.projectorTex.value;r.image=t,r.needsUpdate=!0}}},{key:"render",value:function(t,e){var n=this._scene.planes,i=this._scene.planesOld,r=this._scene.planesPeriphery,a=Object.keys(i).length?1:this._alpha,o=Object.keys(i).length?1:Math.floor(this._alpha);for(var s in n){if(n.hasOwnProperty(s))n[s].material.uniforms.opacity.value=a}for(var u in i){if(i.hasOwnProperty(u))i[u].material.uniforms.opacity.value=this._alphaOld}for(var l in r){if(r.hasOwnProperty(l))r[l].material.uniforms.opacity.value=o}for(var c in e.render(this._scene.scenePeriphery,t),e.render(this._scene.scene,t),e.render(this._scene.sceneOld,t),n){if(n.hasOwnProperty(c))n[c].material.uniforms.opacity.value=this._alpha}e.render(this._scene.scene,t)}},{key:"clearNeedsRender",value:function(){this._needsRender=!1}},{key:"dispose",value:function(){this._scene.clear()}},{key:"_updateFrameId",value:function(t){this._frameId=t}},{key:"_updateAlpha",value:function(t){return t!==this._alpha&&(this._alpha=t,!0)}},{key:"_updateAlphaOld",value:function(t){return!(t<1||0===this._alphaOld)&&(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}},{key:"_updateImagePlanes",value:function(t){if(null==t.currentImage||t.currentImage.id===this._currentKey)return!1;var e=null!=t.previousImage?t.previousImage.id:null,n=t.currentImage.id;this._previousKey!==e&&this._previousKey!==n&&this._previousKey in this._providerDisposers&&((0,this._providerDisposers[this._previousKey])(),delete this._providerDisposers[this._previousKey]);if(null!=e){if(e!==this._currentKey&&e!==this._previousKey){var i=this._factory.createMesh(t.previousImage,t.previousTransform),r={};r[e]=i,this._scene.updateImagePlanes(r)}this._previousKey=e}this._currentKey=n;var a=this._factory.createMesh(t.currentImage,t.currentTransform),o={};return o[n]=a,this._scene.updateImagePlanes(o),this._alphaOld=1,!0}},{key:"_updateTexture",value:function(t){this._needsRender=!0;var e=this._scene.planes;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n].material,r=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null,r.dispose(),i.uniforms.projectorTex.value=t}}},{key:"_extend",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];for(var s in o)o.hasOwnProperty(s)&&(t[s]=o[s])}return t}}]),t}();!function(t){t[t.Background=0]="Background",t[t.Opaque=1]="Opaque"}(Fm||(Fm={}));var Vm=function(){function t(e){Tt(this,t),this._api=e,this._urls$=new Map}return Ct(t,[{key:"getImage$",value:function(t){var e,n=this,i=new Promise((function(t,n){e=n}));return[Xt.create((function(r){n._api.data.getImageBuffer(t,i).then((function(t){e=null;var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){window.URL.revokeObjectURL(n.src),r.next(n),r.complete()},n.onerror=function(){e=null,window.URL.revokeObjectURL(n.src),r.error(new Error("Failed to load image tile"))};var i=new Blob([t]);n.src=window.URL.createObjectURL(i)}),(function(t){e=null,r.error(t)}))})),function(){e&&e()}]}},{key:"getURLs$",value:function(t,e){var n=this,i=this._inventId(t,e);if(this._urls$.has(i))return this._urls$.get(i);var r={imageId:t,z:e},a=this._api.getImageTiles$(r).pipe(De((function(t){return t.node})),ei((function(){n._urls$.delete(i)})),_i(),ne());return this._urls$.set(i,a),a}},{key:"_inventId",value:function(t,e){return"".concat(t,"-").concat(e)}}]),t}(),Um=function(){function t(){Tt(this,t),this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}return Ct(t,[{key:"add",value:function(t,e){if(this._tiles.has(t))throw new Error("Image tile already stored (".concat(t,")"));this._tiles.set(t,e)}},{key:"addURLs",value:function(t,e){var n,i=this._urls,r=wt(e);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=this.inventId(a);if(this._urls.has(o))throw new Error("URL already stored (".concat(o,")"));i.set(o,a.url)}}catch(Tx){r.e(Tx)}finally{r.f()}this._urlLevels.add(t)}},{key:"dispose",value:function(){this._tiles.forEach((function(t){return window.URL.revokeObjectURL(t.src)})),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}},{key:"get",value:function(t){return this._tiles.get(t)}},{key:"getURL",value:function(t){return this._urls.get(t)}},{key:"has",value:function(t){return this._tiles.has(t)}},{key:"hasURL",value:function(t){return this._urls.has(t)}},{key:"hasURLLevel",value:function(t){return this._urlLevels.has(t)}},{key:"inventId",value:function(t){return"".concat(t.z,"-").concat(t.x,"-").concat(t.y)}}]),t}(),$m=function(){function t(){Tt(this,t),this._viewportCoords=new Im}return Ct(t,[{key:"computeRegionOfInterest",value:function(t,e,n){var i=this._viewportBoundaryPoints(4),r=this._viewportPointsBoundingBox(i,t,n);this._clipBoundingBox(r);var a=2/e.width,o=2/e.height,s=[[-.5*a,.5*o],[.5*a,.5*o],[.5*a,-.5*o],[-.5*a,-.5*o]],u=this._viewportPointsBoundingBox(s,t,n),l=u.minX<u.maxX;return{bbox:r,pixelHeight:u.maxY-u.minY,pixelWidth:u.maxX-u.minX+(l?0:1)}}},{key:"_viewportBoundaryPoints",value:function(t){for(var e=[],n=[[-1,1],[1,1],[1,-1],[-1,-1]],i=[[2,0],[0,-2],[-2,0],[0,2]],r=0;r<4;++r)for(var a=n[r],o=i[r],s=0;s<t;++s)e.push([a[0]+o[0]*s/t,a[1]+o[1]*s/t]);return e}},{key:"_viewportPointsBoundingBox",value:function(t,e,n){var i=this,r=t.map((function(t){return i._viewportCoords.viewportToBasic(t[0],t[1],n,e.perspective)}));return Zf(n.cameraType)?this._boundingBoxSpherical(r):this._boundingBox(r)}},{key:"_boundingBox",value:function(t){for(var e={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY},n=0;n<t.length;++n)e.minX=Math.min(e.minX,t[n][0]),e.maxX=Math.max(e.maxX,t[n][0]),e.minY=Math.min(e.minY,t[n][1]),e.maxY=Math.max(e.maxY,t[n][1]);return e}},{key:"_boundingBoxSpherical",value:function(t){for(var e=this,n=[],i=[],r=0;r<t.length;++r)n.push(t[r][0]),i.push(t[r][1]);n.sort((function(t,n){return e._sign(t-n)})),i.sort((function(t,n){return e._sign(t-n)}));var a=this._intervalSpherical(n);return{maxX:a[1],maxY:i[i.length-1],minX:a[0],minY:i[0]}}},{key:"_intervalSpherical",value:function(t){for(var e=0,n=-1,i=0;i<t.length-1;++i){var r=t[i+1]-t[i];r>e&&(e=r,n=i)}return t[0]+1-t[t.length-1]>e?[t[0],t[t.length-1]]:[t[n+1],t[n]]}},{key:"_clipBoundingBox",value:function(t){t.minX=Math.max(0,Math.min(1,t.minX)),t.maxX=Math.max(0,Math.min(1,t.maxX)),t.minY=Math.max(0,Math.min(1,t.minY)),t.maxY=Math.max(0,Math.min(1,t.maxY))}},{key:"_sign",value:function(t){return t>0?1:t<0?-1:0}}]),t}();function Hm(t,e,n){return Math.max(e,Math.min(n,t))}function qm(t){return 1024/Wm(t)}function Wm(t){return Math.pow(2,t.z-t.max)}function Gm(t){return Math.ceil(function(t){var e=Math.max(t.w,t.h);return Math.log(e)/Math.log(2)}(t))}function Zm(t,e,n){var i=qm(n),r=e.w,a=e.h,o=Math.ceil(r/i)-1,s=Math.ceil(a/i)-1;return{x:Hm(Math.floor(r*t[0]/i),0,o),y:Hm(Math.floor(a*t[1]/i),0,s)}}function Xm(t,e,n){var i=1024*(1/Wm(n)),r=i*t.x,a=i*t.y,o=Math.min(i,e.w-r);return{h:Math.min(i,e.h-a),x:r,y:a,w:o}}function Ym(t,e,n){return n*t<=e&&e<n*(t+1)}function Km(t,e){if(t.z===e.z)return t.x===e.x&&t.y===e.y;var n=t.z<e.z?t:e,i=t.z<e.z?e:t,r=1/Wm({max:i.z,z:n.z}),a=Ym(n.x,i.x,r),o=Ym(n.y,i.y,r);return a&&o}function Jm(t){return t.w>0&&t.h>0}var Qm,tg=function(){function t(e,n,i,r,a,o,s){Tt(this,t);var u={h:i,w:n};Jm(u)||console.warn("Original image size (".concat(n,", ").concat(i,") ")+"is invalid (".concat(e,"). Tiles will not be loaded.")),this._imageId=e,this._size=u,this._level={max:Gm(this._size),z:-1},this._holder=new km,this._updated$=new te,this._createdSubject$=new te,this._created$=this._createdSubject$.pipe(bi(1),ne()),this._holder.push(this._created$.subscribe((function(){}))),this._hasSubject$=new te,this._has$=this._hasSubject$.pipe(Di(!1),bi(1),ne()),this._holder.push(this._has$.subscribe((function(){}))),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=a,this._store=o,this._background=r,this._renderer=s,this._aborts=[],this._render=null,this._disposed=!1}return Ct(t,[{key:"disposed",get:function(){return this._disposed}},{key:"hasTexture$",get:function(){return this._has$}},{key:"id",get:function(){return this._imageId}},{key:"textureUpdated$",get:function(){return this._updated$}},{key:"textureCreated$",get:function(){return this._created$}},{key:"abort",value:function(){this._subscriptions.forEach((function(t){return t.unsubscribe()})),this._subscriptions.clear();var t,e=wt(this._aborts);try{for(e.s();!(t=e.n()).done;){var n=t.value;n()}}catch(Tx){e.e(Tx)}finally{e.f()}this._aborts=[]}},{key:"dispose",value:function(){this._disposed?console.warn("Texture already disposed (".concat(this._imageId,")")):(this._urlSubscriptions.forEach((function(t){return t.unsubscribe()})),this._urlSubscriptions.clear(),this.abort(),null!=this._render&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0)}},{key:"setRegionOfInterest",value:function(t){var e=this;if(Jm(this._size)){var n=1/t.pixelWidth,i=function(t,e,n){return Math.max(e,Math.min(n,Gm(t)))}({h:1/t.pixelHeight,w:n},11,this._level.max);i!==this._level.z&&(this.abort(),this._level.z=i,this._renderedLevel.clear(),this._rendered.forEach((function(t,n){t.z===i&&e._renderedLevel.add(n)}))),null==this._render&&this._initRender();var r=function(t,e,n,i){var r=[];if(t.x>e.x){for(var a=qm(i),o=Math.ceil(n.w/a)-1,s=t.x;s<=o;s++)r.push(s);for(var u=0;u<=e.x;u++)r.push(u)}else for(var l=t.x;l<=e.x;l++)r.push(l);for(var c=[],h=0,p=r;h<p.length;h++)for(var f=p[h],d=t.y;d<=e.y;d++)c.push({x:f,y:d});return c}(Zm([t.bbox.minX,t.bbox.minY],this._size,this._level),Zm([t.bbox.maxX,t.bbox.maxY],this._size,this._level),this._size,this._level);this._fetchTiles(i,r)}}},{key:"_fetchTile",value:function(t){var e=this,n=this._loader.getImage$(t.url),i=n[0],r=n[1];this._aborts.push(r);var a=this._store.inventId(t),o=i.subscribe((function(n){var i=Xm(t,e._size,e._level);e._renderToTarget(i,n),e._subscriptions.delete(a),e._removeFromArray(r,e._aborts),e._markRendered(t),e._store.add(a,n),e._updated$.next(!0)}),(function(t){e._subscriptions.delete(a),e._removeFromArray(r,e._aborts),console.error(t)}));o.closed||this._subscriptions.set(a,o)}},{key:"_fetchTiles",value:function(t,e){var n=this,i=(this._store.hasURLLevel(t)?xe(void 0):this._loader.getURLs$(this._imageId,t).pipe(Hi((function(e){n._store.hasURLLevel(t)||n._store.addURLs(t,e)})))).subscribe((function(){if(t===n._level.z){var i,r=wt(e);try{for(r.s();!(i=r.n()).done;){var a=i.value,o={x:a.x,y:a.y,z:t,url:null},s=n._store.inventId(o);if(!n._renderedLevel.has(s)&&!n._subscriptions.has(s))if(n._store.has(s)){var u=Xm(a,n._size,n._level);n._renderToTarget(u,n._store.get(s)),n._markRendered(o),n._updated$.next(!0)}else o.url=n._store.getURL(s),n._fetchTile(o)}}catch(Tx){r.e(Tx)}finally{r.f()}n._urlSubscriptions.delete(t)}}),(function(e){n._urlSubscriptions.delete(t),console.error(e)}));i.closed||this._urlSubscriptions.set(t,i)}},{key:"_initRender",value:function(){var t=this._size.w/2,e=this._size.h/2,n=new Pp(-t,t,e,-e,-1,1);n.position.z=1;var i=this._renderer.getContext(),r=i.getParameter(i.MAX_TEXTURE_SIZE),a=Math.max(this._size.w,this._size.h),o=r>a?1:r/a,s=Math.floor(o*this._size.w),u=Math.floor(o*this._size.h),l=new Hr(s,u,{depthBuffer:!1,format:dr,magFilter:or,minFilter:or,stencilBuffer:!1});this._render={camera:n,target:l};var c=Xm({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(c,this._background),this._createdSubject$.next(l.texture),this._hasSubject$.next(!0)}},{key:"_markRendered",value:function(t){var e,n=wt(Array.from(this._rendered.entries()).filter((function(e){var n=rt(e,2);n[0];return n[1].z!==t.z})));try{for(n.s();!(e=n.n()).done;){var i=rt(e.value,2),r=i[0],a=i[1];Km(t,a)&&this._rendered.delete(r)}}catch(Tx){n.e(Tx)}finally{n.f()}var o=this._store.inventId(t);this._rendered.set(o,t),this._renderedLevel.add(o)}},{key:"_removeFromArray",value:function(t,e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},{key:"_renderToTarget",value:function(t,e){var n=new Vr(e);n.minFilter=or,n.needsUpdate=!0;var i=new Ms(t.w,t.h),r=new yo({map:n,side:0}),a=new os(i,r);a.position.x=-this._size.w/2+t.x+t.w/2,a.position.y=this._size.h/2-t.y-t.h/2;var o=new Al;o.add(a);var s=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(o,this._render.camera),this._renderer.setRenderTarget(s),o.remove(a),i.dispose(),r.dispose(),n.dispose()}}]),t}();!function(t){t[t.Custom=0]="Custom",t[t.Earth=1]="Earth",t[t.Traversing=2]="Traversing",t[t.Waiting=3]="Waiting",t[t.WaitingInteractively=4]="WaitingInteractively"}(Qm||(Qm={}));var eg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._imageTileLoader=new Vm(r.api),a._roiCalculator=new $m,a._rendererOperation$=new te,a._rendererCreator$=new te,a._rendererDisposer$=new te,a._renderer$=a._rendererOperation$.pipe(li((function(t,e){return e(t)}),null),hn((function(t){return null!=t})),Un(void 0,(function(t){return t.frameId}))),a._rendererCreator$.pipe(De((function(){return function(t){if(null!=t)throw new Error("Multiple image plane states can not be created at the same time");return new jm}}))).subscribe(a._rendererOperation$),a._rendererDisposer$.pipe(De((function(){return function(t){return t.dispose(),null}}))).subscribe(a._rendererOperation$),a}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this._subscriptions;e.push(this._renderer$.pipe(De((function(e){var n={name:t._name,renderer:{frameId:e.frameId,needsRender:e.needsRender,render:e.render.bind(e),pass:Fm.Background}};return e.clearNeedsRender(),n}))).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),e.push(this._navigator.stateService.currentState$.pipe(De((function(t){return function(e){return e.updateFrame(t),e}}))).subscribe(this._rendererOperation$));var n=this._container.configurationService.imageTiling$.pipe(zi((function(e){return e?t._navigator.stateService.currentState$:new te})),Un(void 0,(function(t){return t.state.currentImage.id})),Ki(this._container.glRenderer.webGLRenderer$),De((function(e){var n=rt(e,2),i=n[0],r=n[1],a=i.state,o=a.currentImage,s=a.currentTransform;return new tg(o.id,s.basicWidth,s.basicHeight,o.image,t._imageTileLoader,new Um,r)})),bi(1),ne());e.push(n.subscribe((function(){}))),e.push(n.pipe(De((function(t){return function(e){return e.setTextureProvider(t.id,t),e}}))).subscribe(this._rendererOperation$)),e.push(n.pipe(vi()).subscribe((function(t){t[0].abort()})));var i=this._container.configurationService.imageTiling$.pipe(zi((function(e){return e?We(t._navigator.stateService.state$,t._navigator.stateService.inTranslation$):new te})),zi((function(e){var n=rt(e,2),i=n[0],r=n[1];return(i===Qm.Traversing||i===Qm.Waiting||i===Qm.WaitingInteractively)&&!r?t._container.renderService.renderCameraFrame$:me()})),De((function(t){return{camera:t,height:t.size.height.valueOf(),lookat:t.camera.lookat.clone(),width:t.size.width.valueOf(),zoom:t.zoom.valueOf()}})),vi(),De((function(t){var e=rt(t,2),n=e[0],i=e[1],r=n.width===i.width&&n.height===i.height&&n.zoom===i.zoom&&n.lookat.equals(i.lookat);return{camera:i.camera,stalled:r}})),Un((function(t,e){return t.stalled===e.stalled})),hn((function(t){return t.stalled})),Ki(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(n.pipe(zi((function(e){return i.pipe(De((function(n){var i=rt(n,3),r=i[0],a=i[1],o=i[2],s=r.camera,u=(new Im).viewportToBasic(0,0,o,s.perspective);if(!(u[0]<0||u[1]<0||u[0]>1||u[1]>1))return[t._roiCalculator.computeRegionOfInterest(s,a,o),e]})),hn((function(t){return!!t})))})),hn((function(t){return!t[1].disposed}))).subscribe((function(t){var e=rt(t,2),n=e[0];e[1].setRegionOfInterest(n)})));var r=n.pipe(zi((function(t){return t.hasTexture$})),Di(!1),bi(1),ne());e.push(r.subscribe((function(){}))),e.push(this._navigator.panService.panImages$.pipe(hn((function(t){return 0===t.length})),De((function(){return function(t){return t.clearPeripheryPlanes(),t}}))).subscribe(this._rendererOperation$));var a=this._navigator.panService.panImages$.pipe(zi((function(e){return Ye(e).pipe(tn((function(e){var n=rt(e,2),i=n[0],r=n[1];return We(t._navigator.graphService.cacheImage$(i.id).pipe(An((function(t){return console.error("Failed to cache periphery image (".concat(i.id,")"),t),me()}))),xe(r))})))})),Ei());e.push(a.pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return function(t){return t.addPeripheryPlane(n,i),t}}))).subscribe(this._rendererOperation$)),e.push(a.pipe(tn((function(t){return rt(t,1)[0].cacheImage$().pipe(An((function(){return me()})))})),De((function(t){return function(e){return e.updateTextureImage(t.image,t),e}}))).subscribe(this._rendererOperation$));var o=this._navigator.stateService.currentState$.pipe(De((function(t){return t.state.alpha<1})),Un()),s=We(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,o).pipe(De((function(t){var e=rt(t,4),n=e[0],i=e[1],r=e[2],a=e[3];return!(n||i||r||a)})),hn((function(t){return t})));e.push(this._navigator.stateService.state$.pipe(zi((function(e){return e===Qm.Traversing?t._navigator.panService.panImages$:me()})),zi((function(e){return s.pipe(Ki(t._container.renderService.renderCamera$,t._navigator.stateService.currentImage$,t._navigator.stateService.currentTransform$),tn((function(t){var n=rt(t,4);return xe([n[1],n[2],n[3],e])})))})),zi((function(e){var n=rt(e,4),i=n[0],r=n[1],a=n[2],o=n[3],s=i.camera.lookat.clone().sub(i.camera.position),u=[(new Wf).viewingDirection(r.rotation).angleTo(s),void 0],l=(new Im).viewportToBasic(0,0,a,i.perspective);l[0]>=0&&l[0]<=1&&l[1]>=0&&l[1]<=1&&(u[0]=Number.NEGATIVE_INFINITY);var c,h=wt(o);try{for(h.s();!(c=h.n()).done;){var p=rt(c.value,1)[0],f=(new Wf).viewingDirection(p.rotation).angleTo(s);f<u[0]&&(u[0]=f,u[1]=p.id)}}catch(Tx){h.e(Tx)}finally{h.f()}return u[1]?t._navigator.moveTo$(u[1]).pipe(An((function(){return me()}))):me()}))).subscribe())}},{key:"_deactivate",value:function(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}}]),n}(Mm);eg.componentName="image";var ng=function(){function t(e,n,i){Tt(this,t),this._component=e,this._container=n,this._navigator=i,this._enabled=!1}return Ct(t,[{key:"isEnabled",get:function(){return this._enabled}},{key:"enable",value:function(){!this._enabled&&this._component.activated&&(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}},{key:"disable",value:function(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}]),t}(),ig=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_enable",value:function(){var t=this,e=this._navigator.stateService.currentImage$.pipe(zi((function(t){return t.sequenceEdges$})));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ki(e)).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1],a=null;switch(i.keyCode){case 38:a=Of.Next;break;case 40:a=Of.Prev;break;default:return}if(i.preventDefault(),i.altKey&&!i.shiftKey&&r.cached){var o,s=wt(r.edges);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u.data.direction===a)return void t._navigator.moveTo$(u.target).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))}}catch(Tx){s.e(Tx)}finally{s.f()}}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(t){return{keySequenceNavigation:t}}}]),n}(ng),rg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._spatial=a,o}return Ct(n,[{key:"_enable",value:function(){var t=this,e=this._navigator.stateService.currentImage$.pipe(zi((function(t){return t.spatialEdges$})));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ki(e,this._navigator.stateService.currentState$)).subscribe((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2],o=Zf(a.state.currentImage.cameraType),s=null;switch(i.keyCode){case 37:s=i.shiftKey&&!o?Of.TurnLeft:Of.StepLeft;break;case 38:s=i.shiftKey&&!o?Of.Spherical:Of.StepForward;break;case 39:s=i.shiftKey&&!o?Of.TurnRight:Of.StepRight;break;case 40:s=i.shiftKey&&!o?Of.TurnU:Of.StepBackward;break;default:return}if(i.preventDefault(),!(i.altKey||!r.cached||i.shiftKey&&o))if(o){var u={};u[Of.StepBackward]=Math.PI,u[Of.StepForward]=0,u[Of.StepLeft]=Math.PI/2,u[Of.StepRight]=-Math.PI/2;var l,c=t._rotationFromCamera(a.state.camera).phi,h=t._spatial.wrapAngle(c+u[s]),p=Math.PI/4,f=r.edges.filter((function(t){return t.data.direction===Of.Spherical||t.data.direction===s})),d=Number.MAX_VALUE,v=null,m=wt(f);try{for(m.s();!(l=m.n()).done;){var g=l.value,y=Math.abs(t._spatial.wrapAngle(g.data.worldMotionAzimuth-h));y<Math.min(d,p)&&(d=y,v=g.target)}}catch(Tx){m.e(Tx)}finally{m.f()}if(null==v)return;t._moveTo(v)}else t._moveDir(s,r)}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(t){return{keySpatialNavigation:t}}},{key:"_moveDir",value:function(t,e){var n,i=wt(e.edges);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.data.direction===t)return void this._moveTo(r.target)}}catch(Tx){i.e(Tx)}finally{i.f()}}},{key:"_moveTo",value:function(t){this._navigator.moveTo$(t).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))}},{key:"_rotationFromCamera",value:function(t){var e=t.lookat.clone().sub(t.position),n=e.clone().dot(t.up),i=e.clone().sub(t.up.clone().multiplyScalar(n));return{phi:Math.atan2(i.y,i.x),theta:Math.PI/2-this._spatial.angleToPlane(e.toArray(),[0,0,1])}}}]),n}(ng),ag=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._viewportCoords=a,o}return Ct(n,[{key:"_enable",value:function(){var t=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2];if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0;switch(i.key){case"+":o=1;break;case"-":o=-1;break;default:return}i.preventDefault();var s=t._viewportCoords.unprojectFromViewport(0,0,r.perspective),u=a.projectBasic(s.toArray());t._navigator.stateService.zoomIn(o,u)}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(t){return{keyZoom:t}}}]),n}(ng),og=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_enable",value:function(){var t=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ki(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(zi((function(t){return t.sequenceEdges$}))),this._navigator.stateService.state$.pipe(De((function(t){return t===Qm.Earth})),Un()))).subscribe((function(e){var n=rt(e,6),i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=n[5];if(!(i.altKey||i.ctrlKey||i.metaKey)){switch(i.key){case"D":if(!i.shiftKey)return;var l=r?null:a===Of.Next?Of.Prev:a===Of.Prev?Of.Next:null;null!=l&&t._navigator.playService.setDirection(l);break;case" ":if(i.shiftKey)return;if(!u)if(r)t._navigator.playService.stop();else{var c,h=wt(s.edges);try{for(h.s();!(c=h.n()).done;){c.value.data.direction===a&&t._navigator.playService.play()}}catch(Tx){h.e(Tx)}finally{h.f()}}break;case"<":t._navigator.playService.setSpeed(o-.05);break;case">":t._navigator.playService.setSpeed(o+.05);break;default:return}i.preventDefault()}}))}},{key:"_disable",value:function(){this._keyDownSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(t){return{keyPlay:t}}}]),n}(ng),sg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._keyPlayHandler=new og(ft(a),i,r),a._keySequenceNavigationHandler=new ig(ft(a),i,r),a._keySpatialNavigationHandler=new rg(ft(a),i,r,new Wf),a._keyZoomHandler=new ag(ft(a),i,r,new Im),a}return Ct(n,[{key:"keyPlay",get:function(){return this._keyPlayHandler}},{key:"keySequenceNavigation",get:function(){return this._keySequenceNavigationHandler}},{key:"keySpatialNavigation",get:function(){return this._keySpatialNavigationHandler}},{key:"keyZoom",get:function(){return this._keyZoomHandler}},{key:"_activate",value:function(){var t=this;this._subscriptions.push(this._configuration$.subscribe((function(e){e.keyPlay?t._keyPlayHandler.enable():t._keyPlayHandler.disable(),e.keySequenceNavigation?t._keySequenceNavigationHandler.enable():t._keySequenceNavigationHandler.disable(),e.keySpatialNavigation?t._keySpatialNavigationHandler.enable():t._keySpatialNavigationHandler.disable(),e.keyZoom?t._keyZoomHandler.enable():t._keyZoomHandler.disable()})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}},{key:"_getDefaultConfiguration",value:function(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}]),n}(Mm);sg.componentName="keyboard";var ug=function(){function t(e,n){Tt(this,t),this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=n||new xf,this._scene=e||new Al}return Ct(t,[{key:"markers",get:function(){return this._markers}},{key:"needsRender",get:function(){return this._needsRender}},{key:"add",value:function(t,e){t.id in this._markers&&this._dispose(t.id),t.createGeometry(e),this._scene.add(t.geometry),this._markers[t.id]=t;var n,i=wt(t.getInteractiveObjects());try{for(i.s();!(n=i.n()).done;){var r=n.value;this._interactiveObjects.push(r),this._objectMarkers[r.uuid]=t.id}}catch(Tx){i.e(Tx)}finally{i.f()}this._needsRender=!0}},{key:"clear",value:function(){for(var t in this._markers)this._markers.hasOwnProperty&&this._dispose(t);this._needsRender=!0}},{key:"get",value:function(t){return this._markers[t]}},{key:"getAll",value:function(){var t=this;return Object.keys(this._markers).map((function(e){return t._markers[e]}))}},{key:"has",value:function(t){return t in this._markers}},{key:"intersectObjects",value:function(t,e){var n=rt(t,2),i=n[0],r=n[1];this._raycaster.setFromCamera(new Fr(i,r),e);var a,o=wt(this._raycaster.intersectObjects(this._interactiveObjects));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.object.uuid in this._objectMarkers)return this._objectMarkers[s.object.uuid]}}catch(Tx){o.e(Tx)}finally{o.f()}return null}},{key:"lerpAltitude",value:function(t,e,n){t in this._markers&&(this._markers[t].lerpAltitude(e,n),this._needsRender=!0)}},{key:"remove",value:function(t){t in this._markers&&(this._dispose(t),this._needsRender=!0)}},{key:"render",value:function(t,e){e.render(this._scene,t),this._needsRender=!1}},{key:"update",value:function(t,e,n){t in this._markers&&(this._markers[t].updatePosition(e,n),this._needsRender=!0)}},{key:"_dispose",value:function(t){var e=this._markers[t];this._scene.remove(e.geometry);var n,i=wt(e.getInteractiveObjects());try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this._interactiveObjects.indexOf(r);-1!==a?this._interactiveObjects.splice(a,1):console.warn("Object does not exist (".concat(r.id,") for ").concat(t)),delete this._objectMarkers[r.uuid]}}catch(Tx){i.e(Tx)}finally{i.f()}e.disposeGeometry(),delete this._markers[t]}}]),t}(),lg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._graphCalculator=new Ff,a._markerScene=new ug,a._markerSet=new ed,a._viewportCoords=new Im,a._relativeGroundAltitude=-2,a}return Ct(n,[{key:"add",value:function(t){this._markerSet.add(t)}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"get",value:function(t){return this._markerSet.get(t)}},{key:"getAll",value:function(){return this._markerSet.getAll()}},{key:"getMarkerIdAt",value:function(t){var e=this;return new Promise((function(n,i){e._container.renderService.renderCamera$.pipe(ri(),De((function(n){var i=e._viewportCoords.canvasToViewport(t[0],t[1],e._container.container);return e._markerScene.intersectObjects(i,n.perspective)}))).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"has",value:function(t){return this._markerSet.has(t)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"remove",value:function(t){this._markerSet.remove(t)}},{key:"removeAll",value:function(){this._markerSet.removeAll()}},{key:"_activate",value:function(){var t=this,e=this._navigator.stateService.currentState$.pipe(De((function(e){return e.state.camera.position.z+t._relativeGroundAltitude})),Un((function(t,e){return Math.abs(t-e)<.01})),bi(1),ne()),n=We(e,this._navigator.stateService.reference$).pipe(ri(),De((function(){})),bi(1),ne()),i=this._configuration$.pipe(De((function(t){return{visibleBBoxSize:Math.max(1,Math.min(200,t.visibleBBoxSize))}}))),r=this._navigator.stateService.currentImage$.pipe(De((function(t){return t.lngLat})),bi(1),ne()),a=We(i,r).pipe(De((function(e){var n=rt(e,2),i=n[0],r=n[1];return t._graphCalculator.boundingBoxCorners(r,i.visibleBBoxSize/2)})),bi(1),ne()),o=We(on(xe(this._markerSet),this._markerSet.changed$),a).pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return n.search(i)}))),s=this._subscriptions;s.push(n.pipe(zi((function(){return o.pipe(Ki(t._navigator.stateService.reference$,e))}))).subscribe((function(e){var n,i=rt(e,3),r=i[0],a=i[1],o=i[2],s=t._markerScene,u=s.markers,l=Object.assign({},u),c=wt(r);try{for(c.s();!(n=c.n()).done;){var h=n.value;if(h.id in u)delete l[h.id];else{var p=Rf(h.lngLat.lng,h.lngLat.lat,a.alt+o,a.lng,a.lat,a.alt);s.add(h,p)}}}catch(Tx){c.e(Tx)}finally{c.f()}for(var f in l)l.hasOwnProperty(f)&&s.remove(f)}))),s.push(n.pipe(zi((function(){return t._markerSet.updated$.pipe(Ki(a,t._navigator.stateService.reference$,e))}))).subscribe((function(e){var n,i=rt(e,4),r=i[0],a=rt(i[1],2),o=a[0],s=a[1],u=i[2],l=i[3],c=t._markerScene,h=wt(r);try{for(h.s();!(n=h.n()).done;){var p=n.value,f=c.has(p.id),d=p.lngLat.lat>o.lat&&p.lngLat.lat<s.lat&&p.lngLat.lng>o.lng&&p.lngLat.lng<s.lng;if(d){var v=Rf(p.lngLat.lng,p.lngLat.lat,u.alt+l,u.lng,u.lat,u.alt);c.add(p,v)}else!d&&f&&c.remove(p.id)}}catch(Tx){h.e(Tx)}finally{h.f()}}))),s.push(this._navigator.stateService.reference$.pipe(Ci(1),Ki(e)).subscribe((function(e){var n,i=rt(e,2),r=i[0],a=i[1],o=t._markerScene,s=wt(o.getAll());try{for(s.s();!(n=s.n()).done;){var u=n.value,l=Rf(u.lngLat.lng,u.lngLat.lat,r.alt+a,r.lng,r.lat,r.alt);o.update(u.id,l)}}catch(Tx){s.e(Tx)}finally{s.f()}}))),s.push(e.pipe(Ci(1),Ki(this._navigator.stateService.reference$,r)).subscribe((function(e){var n,i=rt(e,3),r=i[0],a=i[1],o=i[2],s=t._markerScene,u=Rf(o.lng,o.lat,a.alt+r,a.lng,a.lat,a.alt),l=wt(s.getAll());try{for(l.s();!(n=l.n()).done;){var c=n.value,h=Rf(c.lngLat.lng,c.lngLat.lat,a.alt+r,a.lng,a.lat,a.alt),p=h[0]-u[0],f=h[1]-u[1],d=Math.sqrt(p*p+f*f);d>50||s.lerpAltitude(c.id,r,Math.min(1,Math.max(0,1.2-1.2*d/50)))}}catch(Tx){l.e(Tx)}finally{l.f()}}))),s.push(this._navigator.stateService.currentState$.pipe(De((function(e){var n=t._markerScene;return{name:t._name,renderer:{frameId:e.id,needsRender:n.needsRender,render:n.render.bind(n),pass:Fm.Opaque}}}))).subscribe(this._container.glRenderer.render$));var u=We(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(De((function(e){var n=rt(e,2),i=n[0],r=n[1],a=t._container.container,o=rt(t._viewportCoords.canvasPosition(r,a),2),s=o[0],u=o[1],l=t._viewportCoords.canvasToViewport(s,u,a);return t._markerScene.intersectObjects(l,i.perspective)})),bi(1),ne()),l=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(De((function(){return!0}))),c=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(De((function(){return!1}))),h=cn(l,c).pipe(Di(!1));s.push(cn(l.pipe(Ki(u)),We(c,xe(null))).pipe(Di([!1,null]),vi()).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1],a=r[0],o=a?"markerdragstart":"markerdragend",s=a?r[1]:i[1],u={marker:t._markerScene.get(s),target:t,type:o};t.fire(o,u)})));var p=cn(this._container.mouseService.mouseDown$.pipe(De((function(){return!0}))),this._container.mouseService.documentMouseUp$.pipe(De((function(){return!1})))).pipe(Di(!1));s.push(We(this._container.mouseService.active$,u.pipe(Un()),p,h).pipe(De((function(t){var e=rt(t,4),n=e[0],i=e[1],r=e[2],a=e[3];return!n&&null!=i&&r||a})),Un()).subscribe((function(e){e?(t._container.mouseService.claimMouse(t._name,1),t._container.mouseService.claimWheel(t._name,1)):(t._container.mouseService.unclaimMouse(t._name),t._container.mouseService.unclaimWheel(t._name))})));var f=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(Ki(u,this._container.renderService.renderCamera$),De((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2],o=t._markerScene.get(r),s=t._container.container,u=rt(t._viewportCoords.projectToCanvas(o.geometry.position.toArray(),s,a.perspective),2),l=u[0],c=u[1],h=rt(t._viewportCoords.canvasPosition(i,s),2);return[o,[h[0]-l,h[1]-c],a]})),bi(1),ne());s.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(Ki(f,this._navigator.stateService.reference$,i)).subscribe((function(e){var n=rt(e,4),i=n[0],r=rt(n[1],3),a=r[0],o=r[1],s=r[2],u=n[2],l=n[3];if(t._markerScene.has(a.id)){var c=t._container.container,h=rt(t._viewportCoords.canvasPosition(i,c),2),p=h[0],f=h[1],d=p-o[0],v=f-o[1],m=rt(t._viewportCoords.canvasToViewport(d,v,c),2),g=m[0],y=m[1],_=new Wr(g,y,1).unproject(s.perspective).sub(s.perspective.position).normalize(),b=Math.min(t._relativeGroundAltitude/_.z,l.visibleBBoxSize/2-.1);if(!(b<0)){var x=_.clone().multiplyScalar(b).add(s.perspective.position);x.z=s.perspective.position.z+t._relativeGroundAltitude;var w=rt(Df(x.x,x.y,x.z,u.lng,u.lat,u.alt),2),S=w[0],k=w[1];t._markerScene.update(a.id,x.toArray(),{lat:k,lng:S}),t._markerSet.update(a);var M="markerposition",T={marker:a,target:t,type:M};t.fire(M,T)}}})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._markerScene.clear()}},{key:"_getDefaultConfiguration",value:function(){return{visibleBBoxSize:100}}}]),n}(Mm);function cg(t,e){return t.x<=Math.max(e.p1.x,e.p2.x)&&t.x>=Math.min(e.p1.x,e.p2.x)&&t.y>=Math.max(e.p1.y,e.p2.y)&&t.y>=Math.min(e.p1.y,e.p2.y)}function hg(t,e){var n=t.p2.x-t.p1.x,i=t.p2.y-t.p1.y,r=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,o=n*a-i*r;return o*o<1e-10*(n*n+i*i)*(r*r+a*a)}function pg(t,e,n){var i,r=(e.y-t.y)*(n.x-e.x)-(n.y-e.y)*(e.x-t.x);return(i=r)>0?1:i<0?-1:0}function fg(t,e){if(hg(t,e))return!1;var n=pg(t.p1,t.p2,e.p1),i=pg(t.p1,t.p2,e.p2),r=pg(e.p1,e.p2,t.p1),a=pg(e.p1,e.p2,t.p2);return n!==i&&r!==a||(!(0!==n||!cg(e.p1,t))||(!(0!==i||!cg(e.p2,t))||(!(0!==r||!cg(t.p1,e))||!(0!==a||!cg(t.p2,e)))))}function dg(t,e){if(!hg(t,e)){var n=t.p1.x,i=t.p2.x,r=t.p1.y,a=t.p2.y,o=e.p1.x,s=e.p2.x,u=e.p1.y,l=e.p2.y,c=(n-i)*(u-l)-(r-a)*(o-s);return{x:((n*a-r*i)*(o-s)-(n-i)*(o*l-u*s))/c,y:((n*a-r*i)*(u-l)-(r-a)*(o*l-u*s))/c}}}function vg(t,e){return t>=-1&&t<=1&&e>=-1&&e<=1}function mg(t,e){return t>=0&&t<=1&&e>=0&&e<=1}function gg(t,e,n){for(var i=function(t){for(var e=[],n=[[0,0],[1,0],[1,1],[0,1]],i=[[1,0],[0,1],[-1,0],[0,-1]],r=0;r<4;++r)for(var a=n[r],o=i[r],s=0;s<t;++s)e.push([a[0]+o[0]*s/t,a[1]+o[1]*s/t]);return e}(100),r=i.map((function(i){return n.basicToViewportSafe(i[0],i[1],t,e)})),a=[],o=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],s=[!1,!1,!1,!1],u=0;u<r.length;u++){var l=r[u],c=r[(u+1)%r.length];if(null!==l)if(null!==c){var h=rt(l,2),p=h[0],f=h[1],d=rt(c,2),v=d[0],m=d[1];if(vg(p,f))if(vg(v,m))a.push(l);else for(var g=0;g<4;g++){var y={p1:{x:p,y:f},p2:{x:v,y:m}},_={p1:o[g],p2:o[(g+1)%4]};if(fg(y,_)){var b=dg(y,_);a.push(l,[b.x,b.y]),s[g]=!0}}}else vg(l[0],l[1])&&a.push(l)}var x=rt(n.viewportToBasic(-1,1,t,e),2),w=x[0],S=x[1],k=rt(n.viewportToBasic(1,1,t,e),2),M=k[0],T=k[1],E=rt(n.viewportToBasic(1,-1,t,e),2),C=E[0],I=E[1],P=rt(n.viewportToBasic(-1,-1,t,e),2),A=P[0],L=P[1];mg(w,S)&&(s[3]=s[0]=!0),mg(M,T)&&(s[0]=s[1]=!0),mg(C,I)&&(s[1]=s[2]=!0),mg(A,L)&&(s[2]=s[3]=!0);for(var R=[-1,-1,1,1],D=0,z=a;D<z.length;D++){var O=z[D],F=O[0],N=O[1];F>R[1]&&(R[1]=F),F<R[3]&&(R[3]=F),N>R[0]&&(R[0]=N),N<R[2]&&(R[2]=N)}for(var B=[1,1,-1,-1],j=[],V=0;V<4;V++)s[V]?j.push(0):j.push(Math.abs(B[V]-R[V]));return j}lg.componentName="marker";var yg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a,o){var s;return Tt(this,n),(s=e.call(this,t,i,r))._spatial=o,s._viewportCoords=a,s}return Ct(n,[{key:"_enable",value:function(){var t=this,e=this._navigator.stateService.currentState$.pipe(De((function(t){return t.state.alpha<1})),Un());this._bounceSubscription=We(e,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(De((function(t){return t[0]||t[1]||t[2]||t[3]})),Un(),zi((function(e){return e?me():We(t._container.renderService.renderCamera$,t._navigator.stateService.currentTransform$.pipe(ri()))})),Ki(this._navigator.panService.panImages$)).subscribe((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1];if((a.hasValidScale||!(r.camera.focal<.1))&&0!==r.perspective.aspect&&r.perspective.aspect!==Number.POSITIVE_INFINITY){var s=gg(a,r.perspective,t._viewportCoords),u=t._viewportCoords.viewportToBasic(0,0,a,r.perspective);(u[0]<0||u[0]>1)&&o.length>0&&(s[0]=s[2]=0);var l,c=wt(o);try{for(c.s();!(l=c.n()).done;)for(var h=gg(rt(l.value,2)[1],r.perspective,t._viewportCoords),p=1;p<s.length;p+=2)h[p]<s[p]&&(s[p]=h[p])}catch(Tx){c.e(Tx)}finally{c.f()}if(!(Math.max.apply(Math,vt(s))<.01)){var f=s[1]-s[3],d=s[0]-s[2],v=t._viewportCoords.unprojectFromViewport(0,0,r.perspective).sub(r.perspective.position),m=t._viewportCoords.unprojectFromViewport(f,0,r.perspective).sub(r.perspective.position),g=t._viewportCoords.unprojectFromViewport(0,d,r.perspective).sub(r.perspective.position),y=(f>0?1:-1)*m.angleTo(v),_=(d>0?1:-1)*g.angleTo(v),b=Math.PI/60;y=t._spatial.clamp(.1*y,-b,b),_=t._spatial.clamp(.1*_,-b,b),t._navigator.stateService.rotateUnbounded({phi:y,theta:_})}}}))}},{key:"_disable",value:function(){this._bounceSubscription.unsubscribe()}},{key:"_getConfiguration",value:function(){return{}}}]),n}(ng),_g=function(){function t(){Tt(this,t)}return Ct(t,null,[{key:"filteredPairwiseMouseDrag$",value:function(t,e){return this._filteredPairwiseMouseDrag$(t,e,e.mouseDragStart$,e.mouseDrag$,e.mouseDragEnd$)}},{key:"filteredPairwiseMouseRightDrag$",value:function(t,e){return this._filteredPairwiseMouseDrag$(t,e,e.mouseRightDragStart$,e.mouseRightDrag$,e.mouseRightDragEnd$)}},{key:"_filteredPairwiseMouseDrag$",value:function(t,e,n,i,r){return e.filtered$(t,n).pipe(zi((function(n){return cn(on(xe(n),e.filtered$(t,i)),e.filtered$(t,r).pipe(De((function(){return null})))).pipe(Vi((function(t){return!!t})),Di(null))})),vi(),hn((function(t){return null!=t[0]&&null!=t[1]})))}}]),t}(),bg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a,o){var s;return Tt(this,n),(s=e.call(this,t,i,r))._spatial=o,s._viewportCoords=a,s}return Ct(n,[{key:"_enable",value:function(){var t=this,e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(De((function(){return!0})),Ei()),n=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(De((function(){return!1})),Ei());this._activeMouseSubscription=cn(e,n).subscribe(this._container.mouseService.activate$);var i=cn(e,n).pipe(zi((function(e){return e?t._container.mouseService.documentMouseMove$:me()})));this._preventDefaultSubscription=cn(i,this._container.touchService.touchMove$).subscribe((function(t){t.preventDefault()}));var r=this._container.touchService.singleTouchDragStart$.pipe(De((function(){return!0}))),a=this._container.touchService.singleTouchDragEnd$.pipe(De((function(){return!1})));this._activeTouchSubscription=cn(r,a).subscribe(this._container.touchService.activate$);var o,s=this._navigator.stateService.currentState$.pipe(De((function(t){return Zf(t.state.currentImage.cameraType)||t.state.imagesAhead<1})),Un(),zi((function(e){if(!e)return me();var n=_g.filteredPairwiseMouseDrag$(t._component.name,t._container.mouseService),i=cn(t._container.touchService.singleTouchDragStart$,t._container.touchService.singleTouchDrag$,t._container.touchService.singleTouchDragEnd$.pipe(De((function(){return null})))).pipe(De((function(t){return null!=t&&t.touches.length>0?t.touches[0]:null})),vi(),hn((function(t){return null!=t[0]&&null!=t[1]})));return cn(n,i)})),Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),De((function(e){var n,i=rt(e,4),r=i[0],a=i[1],o=i[2],s=i[3],u=r[0],l=r[1],c=l.clientX-u.clientX,h=l.clientY-u.clientY,p=t._container.container,f=rt(t._viewportCoords.canvasPosition(l,p),2),d=f[0],v=f[1],m=t._viewportCoords.unprojectFromCanvas(d,v,p,a.perspective).sub(a.perspective.position),g=t._viewportCoords.unprojectFromCanvas(d-c,v,p,a.perspective).sub(a.perspective.position),y=t._viewportCoords.unprojectFromCanvas(d,v-h,p,a.perspective).sub(a.perspective.position),_=(c>0?1:-1)*g.angleTo(m),b=(h>0?-1:1)*y.angleTo(m),x=gg(o,a.perspective,t._viewportCoords),w=wt(s);try{for(w.s();!(n=w.n()).done;)for(var S=gg(rt(n.value,2)[1],a.perspective,t._viewportCoords),k=0;k<x.length;k++)S[k]<x[k]&&(x[k]=S[k])}catch(Tx){w.e(Tx)}finally{w.f()}return x[0]>0&&b<0&&(b/=Math.max(1,200*x[0])),x[2]>0&&b>0&&(b/=Math.max(1,200*x[2])),x[1]>0&&_<0&&(_/=Math.max(1,200*x[1])),x[3]>0&&_>0&&(_/=Math.max(1,200*x[3])),{phi:_,theta:b}})),Ei());this._rotateWithoutInertiaSubscription=s.subscribe((function(e){t._navigator.stateService.rotateWithoutInertia(e)})),this._rotateSubscription=s.pipe(li((function(e,n){return t._drainBuffer(e),e.push([Date.now(),n]),e}),[]),(o=cn(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$),function(t){return t.lift(new ki(o))}),De((function(e){var n,i=t._drainBuffer(e.slice()),r={phi:0,theta:0},a=wt(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.phi+=o[1].phi,r.theta+=o[1].theta}}catch(Tx){a.e(Tx)}finally{a.f()}var s=i.length;s>0&&(r.phi/=s,r.theta/=s);var u=Math.PI/18;return r.phi=t._spatial.clamp(r.phi,-u,u),r.theta=t._spatial.clamp(r.theta,-u,u),r}))).subscribe((function(e){t._navigator.stateService.rotate(e)}))}},{key:"_disable",value:function(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}},{key:"_getConfiguration",value:function(t){return{dragPan:t}}},{key:"_drainBuffer",value:function(t){for(var e=Date.now();t.length>0&&e-t[0][0]>50;)t.shift();return t}}]),n}(ng),xg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a,o){var s;return Tt(this,n),(s=e.call(this,t,i,r))._spatial=o,s._viewportCoords=a,s._subscriptions=new km,s}return Ct(n,[{key:"_enable",value:function(){var t=this,e=this._navigator.stateService.state$.pipe(De((function(t){return t===Qm.Earth})),bi(1),ne()),n=this._subscriptions;n.push(e.pipe(zi((function(e){return e?t._container.mouseService.mouseWheel$:me()}))).subscribe((function(t){t.preventDefault()}))),n.push(e.pipe(zi((function(e){return e?_g.filteredPairwiseMouseDrag$(t._component.name,t._container.mouseService).pipe(hn((function(t){var e=rt(t,2),n=e[0],i=e[1];return!(n.ctrlKey&&i.ctrlKey)}))):me()})),Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),De((function(e){var n=rt(e,3),i=rt(n[0],2),r=i[0],a=i[1],o=n[1],s=(n[2],[0,0,1]),u=[0,0,-2],l=t._planeIntersection(a,s,u,o.perspective,t._container.container),c=t._planeIntersection(r,s,u,o.perspective,t._container.container);return l&&c?(new Wr).subVectors(l,c).multiplyScalar(-1).toArray():null})),hn((function(t){return!!t}))).subscribe((function(e){t._navigator.stateService.truck(e)}))),n.push(e.pipe(zi((function(e){return e?_g.filteredPairwiseMouseDrag$(t._component.name,t._container.mouseService).pipe(hn((function(t){var e=rt(t,2),n=e[0],i=e[1];return n.ctrlKey&&i.ctrlKey}))):me()})),De((function(e){var n=rt(e,2),i=n[0],r=n[1];return t._mousePairToRotation(i,r)}))).subscribe((function(e){t._navigator.stateService.orbit(e)}))),n.push(e.pipe(zi((function(e){return e?_g.filteredPairwiseMouseRightDrag$(t._component.name,t._container.mouseService).pipe(hn((function(t){var e=rt(t,2),n=e[0],i=e[1];return!n.ctrlKey&&!i.ctrlKey}))):me()})),De((function(e){var n=rt(e,2),i=n[0],r=n[1];return t._mousePairToRotation(i,r)}))).subscribe((function(e){t._navigator.stateService.orbit(e)}))),n.push(e.pipe(zi((function(e){return e?t._container.mouseService.filteredWheel$(t._component.name,t._container.mouseService.mouseWheel$):me()})),De((function(e){var n=e.deltaY;return 1===e.deltaMode?n*=40:2===e.deltaMode&&(n*=800),-n/t._viewportCoords.containerToCanvas(t._container.container)[1]}))).subscribe((function(e){t._navigator.stateService.dolly(e)})))}},{key:"_disable",value:function(){this._subscriptions.unsubscribe()}},{key:"_getConfiguration",value:function(){return{}}},{key:"_eventToViewport",value:function(t,e){var n=this._viewportCoords.canvasPosition(t,e);return this._viewportCoords.canvasToViewport(n[0],n[1],e)}},{key:"_mousePairToRotation",value:function(t,e){var n=rt(this._eventToViewport(e,this._container.container),2),i=n[0],r=n[1],a=rt(this._eventToViewport(t,this._container.container),2),o=a[0],s=a[1];return{phi:(o-i)*Math.PI,theta:(r-s)*Math.PI/2}}},{key:"_planeIntersection",value:function(t,e,n,i,r){var a=rt(this._viewportCoords.canvasPosition(t,r),2),o=a[0],s=a[1],u=this._viewportCoords.unprojectFromCanvas(o,s,r,i).sub(i.position).normalize();if(Math.abs(this._spatial.angleToPlane(u.toArray(),e))<Math.PI/90)return null;var l=i.position.clone(),c=(new Wr).fromArray(e),h=(new Wr).fromArray(n),p=(new Wr).subVectors(h,l).dot(c)/u.clone().dot(c),f=(new Wr).addVectors(l,u.multiplyScalar(p));return this._viewportCoords.worldToCamera(f.toArray(),i)[2]>0?null:f}}]),n}(ng),wg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._viewportCoords=a,o}return Ct(n,[{key:"_enable",value:function(){var t=this;this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe((function(t){t.preventDefault()})),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(Ki(this._navigator.stateService.currentState$,(function(t,e){return[t,e]})),hn((function(t){var e=t[1].state;return Zf(e.currentImage.cameraType)||e.imagesAhead<1})),De((function(t){return t[0]})),Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,(function(t,e,n){return[t,e,n]}))).subscribe((function(e){var n=e[0],i=e[1],r=e[2],a=t._container.container,o=rt(t._viewportCoords.canvasPosition(n,a),2),s=o[0],u=o[1],l=t._viewportCoords.unprojectFromCanvas(s,u,a,i.perspective),c=r.projectBasic(l.toArray()),h=n.deltaY;1===n.deltaMode?h*=40:2===n.deltaMode&&(h*=800);var p=-3*h/t._viewportCoords.containerToCanvas(a)[1];t._navigator.stateService.zoomIn(p,c)}))}},{key:"_disable",value:function(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}},{key:"_getConfiguration",value:function(t){return{scrollZoom:t}}}]),n}(ng),Sg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._viewportCoords=a,o}return Ct(n,[{key:"_enable",value:function(){var t=this;this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe((function(t){t.originalEvent.preventDefault()}));var e=this._container.touchService.pinchStart$.pipe(De((function(t){return!0}))),n=this._container.touchService.pinchEnd$.pipe(De((function(t){return!1})));this._activeSubscription=cn(e,n).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(Ki(this._navigator.stateService.currentState$),hn((function(t){var e=t[1].state;return Zf(e.currentImage.cameraType)||e.imagesAhead<1})),De((function(t){return t[0]})),Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2],o=t._container.container,s=rt(t._viewportCoords.canvasPosition(i,o),2),u=s[0],l=s[1],c=t._viewportCoords.unprojectFromCanvas(u,l,o,r.perspective),h=a.projectBasic(c.toArray()),p=rt(t._viewportCoords.containerToCanvas(o),2),f=p[0],d=p[1],v=3*i.distanceChange/Math.min(f,d);t._navigator.stateService.zoomIn(v,h)}))}},{key:"_disable",value:function(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}},{key:"_getConfiguration",value:function(t){return{touchZoom:t}}}]),n}(ng),kg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;Tt(this,n),a=e.call(this,t,i,r);var o=new Wf,s=new Im;return a._bounceHandler=new yg(ft(a),i,r,s,o),a._dragPanHandler=new bg(ft(a),i,r,s,o),a._earthControlHandler=new xg(ft(a),i,r,s,o),a._scrollZoomHandler=new wg(ft(a),i,r,s),a._touchZoomHandler=new Sg(ft(a),i,r,s),a}return Ct(n,[{key:"dragPan",get:function(){return this._dragPanHandler}},{key:"earthControl",get:function(){return this._earthControlHandler}},{key:"scrollZoom",get:function(){return this._scrollZoomHandler}},{key:"touchZoom",get:function(){return this._touchZoomHandler}},{key:"_activate",value:function(){var t=this;this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe((function(e){e.dragPan?t._dragPanHandler.enable():t._dragPanHandler.disable(),e.earthControl?t._earthControlHandler.enable():t._earthControlHandler.disable(),e.scrollZoom?t._scrollZoomHandler.enable():t._scrollZoomHandler.disable(),e.touchZoom?t._touchZoomHandler.enable():t._touchZoomHandler.disable()}))),this._container.mouseService.claimMouse(this._name,0)}},{key:"_deactivate",value:function(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}},{key:"_getDefaultConfiguration",value:function(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}]),n}(Mm);kg.componentName="pointer";var Mg,Tg,Eg=function(){function t(e){Tt(this,t),this._document=e||document}return Ct(t,[{key:"document",get:function(){return this._document}},{key:"createElement",value:function(t,e,n){var i=this._document.createElement(t);return e&&(i.className=e),n&&n.appendChild(i),i}}]),t}(),Cg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._dom=a||new Eg,o._popups=[],o._added$=new te,o._popups$=new te,o}return Ct(n,[{key:"add",value:function(t){var e,n=wt(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;-1===this._popups.indexOf(i)&&(this._popups.push(i),this._activated&&i.setParentContainer(this._popupContainer))}}catch(Tx){n.e(Tx)}finally{n.f()}this._added$.next(t),this._popups$.next(this._popups)}},{key:"getAll",value:function(){return this._popups.slice()}},{key:"remove",value:function(t){var e,n=wt(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._remove(i)}}catch(Tx){n.e(Tx)}finally{n.f()}this._popups$.next(this._popups)}},{key:"removeAll",value:function(){var t,e=wt(this._popups.slice());try{for(e.s();!(t=e.n()).done;){var n=t.value;this._remove(n)}}catch(Tx){e.e(Tx)}finally{e.f()}this._popups$.next(this._popups)}},{key:"_activate",value:function(){var t=this;this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);var e,n=wt(this._popups);try{for(n.s();!(e=n.n()).done;){e.value.setParentContainer(this._popupContainer)}}catch(Tx){n.e(Tx)}finally{n.f()}var i=this._subscriptions;i.push(We(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe((function(e){var n,i=rt(e,3),r=i[0],a=i[1],o=i[2],s=wt(t._popups);try{for(s.s();!(n=s.n()).done;){n.value.update(r,a,o)}}catch(Tx){s.e(Tx)}finally{s.f()}})));var r=this._popups$.pipe(Di(this._popups),zi((function(t){return Ye(t).pipe(tn((function(t){return t.changed$})))})),De((function(t){return[t]})));i.push(cn(this._added$,r).pipe(Ki(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe((function(t){var e,n=rt(t,4),i=n[0],r=n[1],a=n[2],o=n[3],s=wt(i);try{for(s.s();!(e=s.n()).done;){e.value.update(r,a,o)}}catch(Tx){s.e(Tx)}finally{s.f()}})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe();var t,e=wt(this._popups);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(Tx){e.e(Tx)}finally{e.f()}this._container.container.removeChild(this._popupContainer),delete this._popupContainer}},{key:"_getDefaultConfiguration",value:function(){return{}}},{key:"_remove",value:function(t){var e=this._popups.indexOf(t);if(-1!==e){var n=this._popups.splice(e,1)[0];this._activated&&n.remove()}}}]),n}(Mm);Cg.componentName="popup",function(t){t[t.Sequence=0]="Sequence",t[t.Spatial=1]="Spatial"}(Mg||(Mg={})),function(t){t[t.Default=0]="Default",t[t.Playback=1]="Playback",t[t.Timeline=2]="Timeline"}(Tg||(Tg={}));var Ig,Pg=function(){function t(e){Tt(this,t),this._container=e,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=Tg.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new te,this._mouseLeaveDirection$=new te,this._notifyChanged$=new te,this._notifyChangingPositionChanged$=new te,this._notifySpeedChanged$=new te,this._notifyIndexChanged$=new te}return Ct(t,[{key:"changed$",get:function(){return this._notifyChanged$}},{key:"changingPositionChanged$",get:function(){return this._notifyChangingPositionChanged$}},{key:"speed$",get:function(){return this._notifySpeedChanged$}},{key:"index$",get:function(){return this._notifyIndexChanged$}},{key:"mouseEnterDirection$",get:function(){return this._mouseEnterDirection$}},{key:"mouseLeaveDirection$",get:function(){return this._mouseLeaveDirection$}},{key:"activate",value:function(){var t=this;this._changingSubscription||(this._changingSubscription=cn(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(hn((function(t){return 0===t.touches.length})))).subscribe((function(){t._changingSpeed&&(t._changingSpeed=!1),t._changingPosition&&t._setChangingPosition(!1)})))}},{key:"deactivate",value:function(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=Tg.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}},{key:"render",value:function(t,e,n,i,r,a,o,s,u){if(!1===e.visible)return wm.h("div.mapillary-sequence-container",{},[]);var l=this._createStepper(t,e,o,n,s,u),c=this._createSequenceControls(n),h=this._createPlaybackControls(n,i,s,e),p=this._createTimelineControls(n,r,a);return wm.h("div.mapillary-sequence-container",[l,c,h,p])}},{key:"getContainerWidth",value:function(t,e){var n=e.minWidth,i=e.maxWidth;i<n&&(i=n);var r=(t.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),a=(t.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);return n+Math.max(0,Math.min(1,Math.min(r,a)))*(i-n)}},{key:"_createPositionInput",value:function(t,e){var n=this;this._index=t;var i=function(t){n._index=Number(t.target.value),n._notifyIndexChanged$.next(n._index)},r=this._container.domContainer.getBoundingClientRect(),a=Math.max(276,Math.min(410,5+.8*r.width))-65,o=function(t){t.stopPropagation(),n._setChangingPosition(!0)},s=function(t){!0===n._changingPosition&&t.stopPropagation()},u={max:null!=e?e:1,min:0,onchange:i,oninput:i,onkeydown:function(t){"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onpointerdown:o,onpointermove:s,ontouchmove:s,ontouchstart:o,style:{width:"".concat(a,"px")},type:"range",value:null!=t?t:0},l=null==t||null==e||e<=1;l&&(u.disabled="true");var c=wm.h("input.mapillary-sequence-position",u,[]),h=l?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return wm.h("div"+h,[c])}},{key:"_createSpeedInput",value:function(t){var e=this;this._speed=t;var n=function(t){e._speed=Number(t.target.value)/1e3,e._notifySpeedChanged$.next(e._speed)},i=this._container.domContainer.getBoundingClientRect(),r=Math.max(276,Math.min(410,5+.8*i.width))-160,a=function(t){e._changingSpeed=!0,t.stopPropagation()},o=function(t){!0===e._changingSpeed&&t.stopPropagation()},s=wm.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:n,oninput:n,onkeydown:function(t){"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onpointerdown:a,onpointermove:o,ontouchmove:o,ontouchstart:a,style:{width:"".concat(r,"px")},type:"range",value:1e3*t},[]);return wm.h("div.mapillary-sequence-speed-container",[s])}},{key:"_createPlaybackControls",value:function(t,e,n,i){var r=this;if(this._mode!==Tg.Playback)return wm.h("div.mapillary-sequence-playback",[]);var a=wm.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),o=i.direction===Of.Next?Of.Prev:Of.Next,s=i.playing,u={onclick:function(){s||n.configure({direction:o})}},l=i.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",c=wm.h("div"+l,u,[a]),h=wm.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),p=wm.h("div.mapillary-sequence-slow-container",[h]),f=wm.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),d=wm.h("div.mapillary-sequence-fast-container",[f]),v=wm.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),m={onclick:function(){r._mode=Tg.Default,r._notifyChanged$.next(r)}},g=wm.h("div.mapillary-sequence-close-button",m,[v]),y=[c,p,this._createSpeedInput(e),d,g],_=Math.round(t/this._stepperDefaultWidth*this._defaultHeight+10),b={style:{top:"".concat(_,"px")}};return wm.h("div.mapillary-sequence-playback",b,y)}},{key:"_createPlayingButton",value:function(t,e,n,i,r){var a=i.direction===Of.Next&&null!=t||i.direction===Of.Prev&&null!=e;a=a&&n;var o={onclick:i.playing?function(){r.stop()}:a?function(){r.play()}:null},s={};i.direction===Of.Prev&&(s.style={transform:"rotate(180deg) translate(50%, 50%)"});var u=wm.h("div.mapillary-sequence-icon",s,[]),l=i.playing?"mapillary-sequence-stop":a?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return wm.h("div."+l,o,[u])}},{key:"_createSequenceControls",value:function(t){var e=this,n=Math.round(8/this._stepperDefaultWidth*t),i={onclick:function(){e._expandControls=!e._expandControls,e._mode=Tg.Default,e._notifyChanged$.next(e)},style:{"border-bottom-right-radius":"".concat(n,"px"),"border-top-right-radius":"".concat(n,"px")}},r=wm.h("div.mapillary-sequence-expander-bar",[]),a=wm.h("div.mapillary-sequence-expander-button",i,[r]),o=this._mode===Tg.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",s=wm.h("div"+o,[]),u={onclick:function(){e._mode=e._mode===Tg.Playback?Tg.Default:Tg.Playback,e._notifyChanged$.next(e)}},l=wm.h("div.mapillary-sequence-playback-button",u,[s]),c=this._mode===Tg.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",h=wm.h("div"+c,[]),p={onclick:function(){e._mode=e._mode===Tg.Timeline?Tg.Default:Tg.Timeline,e._notifyChanged$.next(e)}},f=wm.h("div.mapillary-sequence-timeline-button",p,[h]),d={style:{height:this._defaultHeight/this._stepperDefaultWidth*t+"px",transform:"translate(".concat(t/2+2,"px, 0)"),width:this._controlsDefaultWidth/this._stepperDefaultWidth*t+"px"}},v=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return wm.h("div"+v,d,[l,f,a])}},{key:"_createSequenceArrows",value:function(t,e,n,i,r){var a=this,o={onclick:null!=t?function(){r.moveDir$(Of.Next).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))}:null,onpointerenter:function(){a._mouseEnterDirection$.next(Of.Next)},onpointerleave:function(){a._mouseLeaveDirection$.next(Of.Next)}},s=Math.round(8/this._stepperDefaultWidth*n),u={onclick:null!=e?function(){r.moveDir$(Of.Prev).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))}:null,onpointerenter:function(){a._mouseEnterDirection$.next(Of.Prev)},onpointerleave:function(){a._mouseLeaveDirection$.next(Of.Prev)},style:{"border-bottom-left-radius":"".concat(s,"px"),"border-top-left-radius":"".concat(s,"px")}},l=this._getStepClassName(Of.Next,t,i.highlightId),c=this._getStepClassName(Of.Prev,e,i.highlightId),h=wm.h("div.mapillary-sequence-icon",[]),p=wm.h("div.mapillary-sequence-icon",[]);return[wm.h("div."+c,u,[p]),wm.h("div."+l,o,[h])]}},{key:"_createStepper",value:function(t,e,n,i,r,a){var o,s=null,u=null,l=wt(t.edges);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.data.direction===Of.Next&&(s=c.target),c.data.direction===Of.Prev&&(u=c.target)}}catch(Tx){l.e(Tx)}finally{l.f()}var h=this._createPlayingButton(s,u,n,e,r),p=this._createSequenceArrows(s,u,i,e,a);p.splice(1,0,h);var f={oncontextmenu:function(t){t.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*i+"px",width:i+"px"}};return wm.h("div.mapillary-sequence-stepper",f,p)}},{key:"_createTimelineControls",value:function(t,e,n){var i=this;if(this._mode!==Tg.Timeline)return wm.h("div.mapillary-sequence-timeline",[]);var r=this._createPositionInput(e,n),a=wm.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),o={onclick:function(){i._mode=Tg.Default,i._notifyChanged$.next(i)}},s=wm.h("div.mapillary-sequence-close-button",o,[a]),u=Math.round(t/this._stepperDefaultWidth*this._defaultHeight+10),l={style:{top:"".concat(u,"px")}};return wm.h("div.mapillary-sequence-timeline",l,[r,s])}},{key:"_getStepClassName",value:function(t,e,n){var i=t===Of.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return null==e?i+="-inactive":n===e&&(i+="-highlight"),i}},{key:"_setChangingPosition",value:function(t){this._changingPosition=t,this._notifyChangingPositionChanged$.next(t)}}]),t}(),Ag=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a,o){var s;return Tt(this,n),(s=e.call(this,t,i,r))._sequenceDOMRenderer=a||new Pg(i),s._scheduler=o,s._containerWidth$=new te,s._hoveredIdSubject$=new te,s._hoveredId$=s._hoveredIdSubject$.pipe(Ei()),s._navigator.playService.playing$.pipe(Ci(1),Ki(s._configuration$)).subscribe((function(t){var e=rt(t,2),n=e[0],i=e[1],r="playing",a={playing:n,target:ft(s),type:r};s.fire(r,a),n!==i.playing&&(n?s.play():s.stop())})),s._navigator.playService.direction$.pipe(Ci(1),Ki(s._configuration$)).subscribe((function(t){var e=rt(t,2),n=e[0];n!==e[1].direction&&s.configure({direction:n})})),s}return Ct(n,[{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"play",value:function(){this.configure({playing:!0})}},{key:"stop",value:function(){this.configure({playing:!1})}},{key:"_activate",value:function(){var t=this;this._sequenceDOMRenderer.activate();var e=this._navigator.stateService.currentImage$.pipe(zi((function(t){return t.sequenceEdges$})),bi(1),ne()),n=this._navigator.stateService.currentImage$.pipe(Un(void 0,(function(t){return t.sequenceId})),zi((function(e){return on(xe(null),t._navigator.graphService.cacheSequence$(e.sequenceId).pipe(xi(3),An((function(t){return console.error("Failed to cache sequence",t),xe(null)}))))})),Di(null),bi(1),ne()),i=this._subscriptions;i.push(n.subscribe());var r=this._sequenceDOMRenderer.index$.pipe(Ki(n),De((function(t){var e=rt(t,2),n=e[0],i=e[1];return null!=i?i.imageIds[n]:null})),hn((function(t){return!!t})),Un(),_i(),ne());i.push(cn(r.pipe(zn(100,this._scheduler)),r.pipe(kn(400,this._scheduler))).pipe(Un(),zi((function(e){return t._navigator.moveTo$(e).pipe(An((function(){return me()})))}))).subscribe()),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(hn((function(t){return t}))).subscribe((function(){t._navigator.graphService.setGraphMode(Mg.Sequence)}))),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(hn((function(t){return!t}))).subscribe((function(){t._navigator.graphService.setGraphMode(Mg.Spatial)}))),this._navigator.graphService.graphMode$.pipe(zi((function(e){return e===Mg.Spatial?t._navigator.stateService.currentImage$.pipe(Xn(2)):me()})),hn((function(t){return!t.spatialEdges.cached})),zi((function(e){return t._navigator.graphService.cacheImage$(e.id).pipe(An((function(){return me()})))}))).subscribe(),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(hn((function(t){return t}))).subscribe((function(){t._navigator.playService.stop()}))),i.push(We(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(Di(!1),Un())).pipe(Ki(this._navigator.stateService.currentImage$),zi((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1];return a&&r===Mg.Sequence?t._navigator.graphService.cacheSequenceImages$(o.sequenceId,o.id).pipe(xi(3),An((function(t){return console.error("Failed to cache sequence images.",t),me()}))):me()}))).subscribe());var a=n.pipe(zi((function(e){if(!e)return xe({index:null,max:null});var n=!0;return t._sequenceDOMRenderer.changingPositionChanged$.pipe(Di(!1),Un(),zi((function(e){var i=!e&&n?0:1;return n=!1,e?r:t._navigator.stateService.currentImage$.pipe(De((function(t){return t.id})),Un(),Ci(i))})),De((function(t){var n=e.imageIds.indexOf(t);return-1===n?{index:null,max:null}:{index:n,max:e.imageIds.length-1}})))}))),o=this._navigator.stateService.state$.pipe(De((function(t){return t===Qm.Earth})),Un());i.push(We(e,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(Di(this._sequenceDOMRenderer)),this._navigator.playService.speed$,a,o).pipe(De((function(e){var n=rt(e,7),i=n[0],r=n[1],a=n[2],o=n[4],s=n[5],u=n[6],l=t._sequenceDOMRenderer.render(i,r,a,o,s.index,s.max,!u,t,t._navigator);return{name:t._name,vNode:l}}))).subscribe(this._container.domRenderer.render$)),i.push(this._sequenceDOMRenderer.speed$.subscribe((function(e){t._navigator.playService.setSpeed(e)}))),i.push(this._configuration$.pipe(De((function(t){return t.direction})),Un()).subscribe((function(e){t._navigator.playService.setDirection(e)}))),i.push(We(this._container.renderService.size$,this._configuration$.pipe(Un((function(t,e){return t[0]===e[0]&&t[1]===e[1]}),(function(t){return[t.minWidth,t.maxWidth]})))).pipe(De((function(e){var n=rt(e,2),i=n[0],r=n[1];return t._sequenceDOMRenderer.getContainerWidth(i,r)}))).subscribe(this._containerWidth$)),i.push(this._configuration$.pipe(De((function(t){return t.playing})),Un()).subscribe((function(e){e?t._navigator.playService.play():t._navigator.playService.stop()}))),i.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(zi((function(n){var i=e.pipe(De((function(t){var e,i=wt(t.edges);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.data.direction===n)return r.target}}catch(Tx){i.e(Tx)}finally{i.f()}return null})),Ni(t._sequenceDOMRenderer.mouseLeaveDirection$));return on(i,xe(null))})),Un()).subscribe(this._hoveredIdSubject$)),i.push(this._hoveredId$.subscribe((function(e){var n="hover",i={id:e,target:t,type:n};t.fire(n,i)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}},{key:"_getDefaultConfiguration",value:function(){return{direction:Of.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}]),n}(Mm);Ag.componentName="sequence",function(t){t[t.Motion=0]="Motion",t[t.Stationary=1]="Stationary"}(Ig||(Ig={}));var Lg=function(){function t(){Tt(this,t),this._factory=new Nm,this._scene=new Bm,this._spatial=new Wf,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}return Ct(t,[{key:"disabled",get:function(){return this._disabled}},{key:"frameId",get:function(){return this._frameId}},{key:"needsRender",get:function(){return this._needsRender}},{key:"setTextureProvider",value:function(t,e){this._setTextureProvider(t,this._currentKey,e,this._currentProviderDisposers,this._updateTexture.bind(this))}},{key:"setTextureProviderPrev",value:function(t,e){this._setTextureProvider(t,this._previousKey,e,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}},{key:"update",value:function(t,e){this._updateFrameId(t.id),this._updateImagePlanes(t.state,e)}},{key:"updateCurtain",value:function(t){this._curtain!==t&&(this._curtain=t,this._updateCurtain(),this._needsRender=!0)}},{key:"updateTexture",value:function(t,e){var n=e.id===this._currentKey?this._scene.planes:e.id===this._previousKey?this._scene.planesOld:{};if(0!==Object.keys(n).length)for(var i in this._needsRender=!0,n)if(n.hasOwnProperty(i)){var r=n[i].material.uniforms.projectorTex.value;r.image=t,r.needsUpdate=!0}}},{key:"updateTextureImage",value:function(t,e){if(this._currentKey===e.id){this._needsRender=!0;var n=this._scene.planes;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i].material.uniforms.projectorTex.value;r.image=t,r.needsUpdate=!0}}}},{key:"render",value:function(t,e){this.disabled||e.render(this._scene.sceneOld,t),e.render(this._scene.scene,t),this._needsRender=!1}},{key:"dispose",value:function(){for(var t in this._scene.clear(),this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(t)&&this._currentProviderDisposers[t]();for(var e in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(e)&&this._previousProviderDisposers[e]();this._currentProviderDisposers={},this._previousProviderDisposers={}}},{key:"_getBasicCorners",value:function(t,e){var n,i;return t>e?(n=.5,i=.5*t/e):(n=.5*e/t,i=.5),[[.5-n,.5-i],[.5+n,.5+i]]}},{key:"_setDisabled",value:function(t){this._disabled=null==t.currentImage||null==t.previousImage||Zf(t.currentImage.cameraType)&&!Zf(t.previousImage.cameraType)}},{key:"_setTextureProvider",value:function(t,e,n,i,r){var a=this;if(t===e){var o=n.textureCreated$.subscribe(r),s=n.textureUpdated$.subscribe((function(t){a._needsRender=!0}));if(t in i)(0,i[t])(),delete i[t];i[t]=function(){o.unsubscribe(),s.unsubscribe(),n.dispose()}}}},{key:"_updateCurtain",value:function(){var t=this._scene.planes;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e].material;n.uniforms.curtain&&(n.uniforms.curtain.value=this._curtain)}}},{key:"_updateFrameId",value:function(t){this._frameId=t}},{key:"_updateImagePlanes",value:function(t,e){var n=null!=t.currentImage&&this._currentKey!==t.currentImage.id,i=null!=t.previousImage&&this._previousKey!==t.previousImage.id,r=this._mode!==e;if(n||i||r){this._setDisabled(t),this._needsRender=!0,this._mode=e;var a=t.motionless||e===Ig.Stationary||Zf(t.currentImage.cameraType);if((this.disabled||i)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(i||r){var o=t.previousImage;this._previousKey=o.id;var s=t.currentTransform.rt.elements,u=[s[12],s[13],s[14]],l=t.currentTransform.basicAspect,c=t.previousTransform.basicAspect,h=l>c?[1,c/l]:[l/c,1],p=t.currentImage.rotation,f=t.currentImage.width,d=t.currentImage.height;Zf(o.cameraType)&&(p=t.previousImage.rotation,u=this._spatial.rotate(this._spatial.opticalCenter(t.currentImage.rotation,u).toArray(),p).multiplyScalar(-1).toArray(),f=t.previousImage.width,d=t.previousImage.height);var v=new Md(t.currentImage.exifOrientation,f,d,t.currentImage.scale,p,u,o.image,h,t.currentImage.cameraParameters,t.currentImage.cameraType),m=void 0;if(Zf(o.cameraType))m=this._factory.createMesh(o,a||Zf(t.currentImage.cameraType)?v:t.previousTransform);else if(a){var g=rt(this._getBasicCorners(l,c),2),y=rt(g[0],2),_=y[0],b=y[1],x=rt(g[1],2),w=x[0],S=x[1];m=this._factory.createFlatMesh(t.previousImage,v,_,w,b,S)}else m=this._factory.createMesh(t.previousImage,t.previousTransform);var k={};k[o.id]=m,this._scene.setImagePlanesOld(k)}if(n||r){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=t.currentImage.id;var M={};Zf(t.currentImage.cameraType)?M[t.currentImage.id]=this._factory.createCurtainMesh(t.currentImage,t.currentTransform):M[t.currentImage.id]=a?this._factory.createDistortedCurtainMesh(t.currentImage,t.currentTransform):this._factory.createCurtainMesh(t.currentImage,t.currentTransform),this._scene.setImagePlanes(M),this._updateCurtain()}}}},{key:"_updateTexture",value:function(t){this._needsRender=!0;var e=this._scene.planes;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n].material,r=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null,r.dispose(),i.uniforms.projectorTex.value=t}}},{key:"_updateTexturePrev",value:function(t){this._needsRender=!0;var e=this._scene.planesOld;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n].material,r=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null,r.dispose(),i.uniforms.projectorTex.value=t}}}]),t}(),Rg=function(){function t(e){Tt(this,t),this._container=e,this._interacting=!1,this._notifyModeChanged$=new te,this._notifyPositionChanged$=new te,this._stopInteractionSubscription=null}return Ct(t,[{key:"mode$",get:function(){return this._notifyModeChanged$}},{key:"position$",get:function(){return this._notifyPositionChanged$}},{key:"activate",value:function(){var t=this;this._stopInteractionSubscription||(this._stopInteractionSubscription=cn(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(hn((function(t){return 0===t.touches.length})))).subscribe((function(e){t._interacting&&(t._interacting=!1)})))}},{key:"deactivate",value:function(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}},{key:"render",value:function(t,e,n,i,r){var a=[];if(r){a.push(wm.h("div.mapillary-slider-border",[]));var o=!(n||i);o&&(a.push(this._createModeButton(e)),a.push(this._createModeButton2d(e))),a.push(this._createPositionInput(t,o))}var s=this._container.domContainer.getBoundingClientRect(),u=Math.max(215,Math.min(400,s.width-100));return wm.h("div.mapillary-slider-container",{style:{width:"".concat(u,"px")}},a)}},{key:"_createModeButton",value:function(t){var e=this,n={onclick:function(){t!==Ig.Motion&&e._notifyModeChanged$.next(Ig.Motion)}},i=t===Ig.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return wm.h("div."+i,n,[wm.h("div.mapillary-slider-mode-icon",[])])}},{key:"_createModeButton2d",value:function(t){var e=this,n={onclick:function(){t!==Ig.Stationary&&e._notifyModeChanged$.next(Ig.Stationary)}},i=t===Ig.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return wm.h("div."+i,n,[wm.h("div.mapillary-slider-mode-icon-2d",[])])}},{key:"_createPositionInput",value:function(t,e){var n=this,i=function(t){n._notifyPositionChanged$.next(Number(t.target.value)/1e3)},r=function(t){n._interacting=!0,t.stopPropagation()},a=function(t){n._interacting&&t.stopPropagation()},o=this._container.domContainer.getBoundingClientRect(),s=Math.max(215,Math.min(400,o.width-105))-84+(e?0:52),u=wm.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:i,oninput:i,onkeydown:function(t){"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onpointerdown:r,onpointermove:a,ontouchmove:a,ontouchstart:r,style:{width:"".concat(s,"px")},type:"range",value:1e3*t},[]);return wm.h("div.mapillary-slider-position-container",[u])}}]),t}(),Dg=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._viewportCoords=a||new Im,o._domRenderer=new Rg(i),o._imageTileLoader=new Vm(r.api),o._roiCalculator=new $m,o._spatial=new Wf,o._glRendererOperation$=new te,o._glRendererCreator$=new te,o._glRendererDisposer$=new te,o._glRenderer$=o._glRendererOperation$.pipe(li((function(t,e){return e(t)}),null),hn((function(t){return null!=t})),Un(void 0,(function(t){return t.frameId}))),o._glRendererCreator$.pipe(De((function(){return function(t){if(null!=t)throw new Error("Multiple slider states can not be created at the same time");return new Lg}}))).subscribe(o._glRendererOperation$),o._glRendererDisposer$.pipe(De((function(){return function(t){return t.dispose(),null}}))).subscribe(o._glRendererOperation$),o}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this._subscriptions;e.push(this._domRenderer.mode$.subscribe((function(e){t.configure({mode:e})}))),e.push(this._glRenderer$.pipe(De((function(e){return{name:t._name,renderer:{frameId:e.frameId,needsRender:e.needsRender,render:e.render.bind(e),pass:Fm.Background}}}))).subscribe(this._container.glRenderer.render$));var n=on(this.configuration$.pipe(De((function(t){return null!=t.initialPosition?t.initialPosition:1})),ri()),this._domRenderer.position$),i=this.configuration$.pipe(De((function(t){return t.mode})),Un()),r=this._navigator.stateService.currentState$.pipe(De((function(t){return t.state.motionless})),Un()),a=this._navigator.stateService.currentState$.pipe(De((function(t){return Zf(t.state.currentImage.cameraType)})),Un()),o=We(this._configuration$.pipe(De((function(t){return t.sliderVisible}))),this._navigator.stateService.currentState$.pipe(De((function(t){return!(null==t.state.currentImage||null==t.state.previousImage||Zf(t.state.currentImage.cameraType)&&!Zf(t.state.previousImage.cameraType))})),Un())).pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return n&&i})),Un());this._waitSubscription=We(i,r,a,o).pipe(Ki(this._navigator.stateService.state$)).subscribe((function(e){var n=rt(e,2),i=rt(n[0],4),r=i[0],a=i[1],o=i[2],s=i[3],u=n[1],l=s&&(a||r===Ig.Stationary||o);l&&u!==Qm.WaitingInteractively?t._navigator.stateService.waitInteractively():l||u===Qm.Waiting||t._navigator.stateService.wait()})),e.push(We(n,i,r,a,o).subscribe((function(e){var n=rt(e,4),i=n[0],r=n[1],a=n[2],o=n[3];a||r===Ig.Stationary||o?t._navigator.stateService.moveTo(1):t._navigator.stateService.moveTo(i)}))),e.push(We(n,i,r,a,o,this._container.renderService.size$).pipe(De((function(e){var n=rt(e,5),i=n[0],r=n[1],a=n[2],o=n[3],s=n[4];return{name:t._name,vNode:t._domRenderer.render(i,r,a,o,s)}}))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),e.push(We(n,a,o,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(De((function(e){var n=rt(e,5),i=n[0],r=n[1],a=n[2],o=n[3],s=n[4];if(!r)return a?i:1;var u=t._viewportCoords.viewportToBasic(-1.15,0,s,o.perspective),l=t._viewportCoords.viewportToBasic(1.15,0,s,o.perspective),c=l[0]<u[0]?l[0]+1:l[0],h=u[0]+i*(c-u[0]);return h>1?h-1:h})),De((function(t){return function(e){return e.updateCurtain(t),e}}))).subscribe(this._glRendererOperation$)),e.push(We(this._navigator.stateService.currentState$,i).pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return function(t){return t.update(n,i),t}}))).subscribe(this._glRendererOperation$)),e.push(this._configuration$.pipe(hn((function(t){return null!=t.ids})),zi((function(e){return mn(mn(t._catchCacheImage$(e.ids.background),t._catchCacheImage$(e.ids.foreground)).pipe(De((function(t){return{background:t[0],foreground:t[1]}}))),t._navigator.stateService.currentState$.pipe(ri())).pipe(De((function(t){return{images:t[0],state:t[1].state}})))}))).subscribe((function(e){null!=e.state.currentImage&&null!=e.state.previousImage&&e.state.currentImage.id===e.images.foreground.id&&e.state.previousImage.id===e.images.background.id||(e.state.currentImage.id!==e.images.background.id?e.state.currentImage.id!==e.images.foreground.id||1!==e.state.trajectory.length?(t._navigator.stateService.setImages([e.images.background]),t._navigator.stateService.setImages([e.images.foreground])):t._navigator.stateService.prependImages([e.images.background]):t._navigator.stateService.setImages([e.images.foreground]))}),(function(t){console.error(t)})));var s=this._container.configurationService.imageTiling$.pipe(zi((function(e){return e?t._navigator.stateService.currentState$:new te})),Un(void 0,(function(t){return t.state.currentImage.id})),Ki(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),De((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2],o=i.state;Math.max(a.width,a.height);var s=o.currentImage,u=o.currentTransform;return new tg(s.id,u.basicWidth,u.basicHeight,s.image,t._imageTileLoader,new Um,r)})),bi(1),ne());e.push(s.subscribe((function(){}))),e.push(s.pipe(De((function(t){return function(e){return e.setTextureProvider(t.id,t),e}}))).subscribe(this._glRendererOperation$)),e.push(s.pipe(vi()).subscribe((function(t){t[0].abort()})));var u=this._container.configurationService.imageTiling$.pipe(zi((function(e){return e?We(t._container.renderService.renderCameraFrame$,t._container.renderService.size$.pipe(zn(250))):new te})),De((function(t){var e=rt(t,2),n=e[0],i=e[1];return[n.camera.position.clone(),n.camera.lookat.clone(),n.zoom.valueOf(),i.height.valueOf(),i.width.valueOf()]})),vi(),Ai((function(t){return t[1][2]-t[0][2]<0||0===t[1][2]})),De((function(t){var e=t[0][0].equals(t[1][0]),n=t[0][1].equals(t[1][1]),i=t[0][2]===t[1][2],r=t[0][3]===t[1][3],a=t[0][4]===t[1][4];return e&&n&&i&&r&&a})),Un(),hn((function(t){return t})),zi((function(){return t._container.renderService.renderCameraFrame$.pipe(ri())})),Ki(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(s.pipe(zi((function(e){return u.pipe(De((function(n){var i=rt(n,3),r=i[0],a=i[1],o=i[2];return[t._roiCalculator.computeRegionOfInterest(r,a,o),e]})))})),hn((function(t){return!t[1].disposed}))).subscribe((function(t){var e=t[0];t[1].setRegionOfInterest(e)})));var l=s.pipe(zi((function(t){return t.hasTexture$})),Di(!1),bi(1),ne());e.push(l.subscribe((function(){})));var c=this._container.configurationService.imageTiling$.pipe(zi((function(e){return e?t._navigator.stateService.currentState$:new te})),hn((function(t){return!!t.state.previousImage})),Un(void 0,(function(t){return t.state.previousImage.id})),Ki(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),De((function(e){var n=rt(e,3),i=n[0],r=n[1],a=(n[2],i.state),o=a.previousImage,s=a.previousTransform;return new tg(o.id,s.basicWidth,s.basicHeight,o.image,t._imageTileLoader,new Um,r)})),bi(1),ne());e.push(c.subscribe((function(){}))),e.push(c.pipe(De((function(t){return function(e){return e.setTextureProviderPrev(t.id,t),e}}))).subscribe(this._glRendererOperation$)),e.push(c.pipe(vi()).subscribe((function(t){t[0].abort()})));var h=this._container.configurationService.imageTiling$.pipe(zi((function(e){return e?We(t._container.renderService.renderCameraFrame$,t._container.renderService.size$.pipe(zn(250))):new te})),De((function(t){var e=rt(t,2),n=e[0],i=e[1];return[n.camera.position.clone(),n.camera.lookat.clone(),n.zoom.valueOf(),i.height.valueOf(),i.width.valueOf()]})),vi(),Ai((function(t){return t[1][2]-t[0][2]<0||0===t[1][2]})),De((function(t){var e=t[0][0].equals(t[1][0]),n=t[0][1].equals(t[1][1]),i=t[0][2]===t[1][2],r=t[0][3]===t[1][3],a=t[0][4]===t[1][4];return e&&n&&i&&r&&a})),Un(),hn((function(t){return t})),zi((function(){return t._container.renderService.renderCameraFrame$.pipe(ri())})),Ki(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(c.pipe(zi((function(e){return h.pipe(De((function(n){var i=rt(n,3),r=i[0],a=i[1],o=i[2];return[t._roiCalculator.computeRegionOfInterest(r,a,o),e]})))})),hn((function(t){return!t[1].disposed})),Ki(this._navigator.stateService.currentState$)).subscribe((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1],s=null;if(Zf(o.state.previousImage.cameraType))if(Zf(o.state.currentImage.cameraType)){var u=t._spatial.viewingDirection(o.state.currentImage.rotation),l=t._spatial.viewingDirection(o.state.previousImage.rotation),c=t._spatial.angleBetweenVector2(u.x,u.y,l.x,l.y)/(2*Math.PI);s={bbox:{maxX:t._spatial.wrap(r.bbox.maxX+c,0,1),maxY:r.bbox.maxY,minX:t._spatial.wrap(r.bbox.minX+c,0,1),minY:r.bbox.minY},pixelHeight:r.pixelHeight,pixelWidth:r.pixelWidth}}else{var h=t._spatial.viewingDirection(o.state.currentImage.rotation),p=t._spatial.viewingDirection(o.state.previousImage.rotation),f=t._spatial.angleBetweenVector2(h.x,h.y,p.x,p.y)/(2*Math.PI),d=t._spatial.angleToPlane(h.toArray(),[0,0,1]),v=(t._spatial.angleToPlane(p.toArray(),[0,0,1])-d)/(2*Math.PI),m=o.state.currentTransform,g=Math.max(m.basicWidth,m.basicHeight),y=g>0?2*Math.atan(.5*m.basicWidth/(g*m.focal)):Math.PI/3,_=g>0?2*Math.atan(.5*m.basicHeight/(g*m.focal)):Math.PI/3,b=y/(2*Math.PI),x=_/Math.PI,w=(r.bbox.maxX-r.bbox.minX)*b,S=(r.bbox.maxY-r.bbox.minY)*x,k=r.pixelWidth*b,M=r.pixelHeight*x,T=(r.bbox.minX+r.bbox.maxX)/2-.5,E=(r.bbox.minY+r.bbox.maxY)/2-.5,C=.5+f+b*T-w/2,I=.5+f+b*T+w/2,P=.5+v+x*E-S/2,A=.5+v+x*E+S/2;s={bbox:{maxX:t._spatial.wrap(I,0,1),maxY:A,minX:t._spatial.wrap(C,0,1),minY:P},pixelHeight:M,pixelWidth:k}}else{var L=o.state.currentTransform.basicAspect,R=o.state.previousTransform.basicAspect,D=rt(t._getBasicCorners(L,R),2),z=rt(D[0],2),O=z[0],F=z[1],N=rt(D[1],2),B=N[0]-O,j=N[1]-F,V=r.pixelWidth/B,U=r.pixelHeight/j,$=(B-1)/(2*B)+r.bbox.minX/B,H=(B-1)/(2*B)+r.bbox.maxX/B,q=(j-1)/(2*j)+r.bbox.minY/j,W={maxX:H,maxY:(j-1)/(2*j)+r.bbox.maxY/j,minX:$,minY:q};t._clipBoundingBox(W),s={bbox:W,pixelHeight:U,pixelWidth:V}}a.setRegionOfInterest(s)})));var p=c.pipe(zi((function(t){return t.hasTexture$})),Di(!1),bi(1),ne());e.push(p.subscribe((function(){})))}},{key:"_deactivate",value:function(){var t=this;this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(ri()).subscribe((function(e){e!==Qm.Traversing&&t._navigator.stateService.traverse()})),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}},{key:"_getDefaultConfiguration",value:function(){return{initialPosition:1,mode:Ig.Motion,sliderVisible:!0}}},{key:"_catchCacheImage$",value:function(t){return this._navigator.graphService.cacheImage$(t).pipe(An((function(e){return console.error("Failed to cache slider image (".concat(t,")"),e),me()})))}},{key:"_getBasicCorners",value:function(t,e){var n,i;return t>e?(n=.5,i=.5*t/e):(n=.5*e/t,i=.5),[[.5-n,.5-i],[.5+n,.5+i]]}},{key:"_clipBoundingBox",value:function(t){t.minX=Math.max(0,Math.min(1,t.minX)),t.maxX=Math.max(0,Math.min(1,t.maxX)),t.minY=Math.max(0,Math.min(1,t.minY)),t.maxY=Math.max(0,Math.min(1,t.maxY))}}]),n}(Mm);Dg.componentName="slider";var zg,Og,Fg=function(){function t(e,n){Tt(this,t),this._subscriptions=new km,this._graphService=e,this._stateService=n;var i=this._subscriptions;this._directionSubject$=new te,this._direction$=this._directionSubject$.pipe(Di(Of.Next),bi(1),ne()),i.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new te,this._playing$=this._playingSubject$.pipe(Di(this._playing),bi(1),ne()),i.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new te,this._speed$=this._speedSubject$.pipe(Di(this._speed),bi(1),ne()),i.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}return Ct(t,[{key:"playing",get:function(){return this._playing}},{key:"direction$",get:function(){return this._direction$}},{key:"playing$",get:function(){return this._playing$}},{key:"speed$",get:function(){return this._speed$}},{key:"play",value:function(){var e=this;if(!this._playing){this._stateService.cutImages();var n=this._setSpeed(this._speed);this._stateService.setSpeed(n),this._graphModeSubscription=this._speed$.pipe(De((function(e){return e>t.sequenceSpeed?Mg.Sequence:Mg.Spatial})),Un()).subscribe((function(t){e._graphService.setGraphMode(t)})),this._cacheSubscription=We(this._stateService.currentImage$.pipe(De((function(t){return[t.sequenceId,t.id]})),Un(void 0,(function(t){return rt(t,1)[0]}))),this._graphService.graphMode$,this._direction$).pipe(zi((function(t){var n=rt(t,3),i=rt(n[0],2),r=i[0],a=i[1],o=n[1],s=n[2];return s!==Of.Next&&s!==Of.Prev?xe([void 0,s]):We((o===Mg.Sequence?e._graphService.cacheSequenceImages$(r,a):e._graphService.cacheSequence$(r)).pipe(xi(3),An((function(t){return console.error(t),xe(void 0)}))),xe(s))})),zi((function(t){var n=rt(t,2),i=n[0],r=n[1];if(void 0===i)return me();var a=i.imageIds.slice();return r===Of.Prev&&a.reverse(),e._stateService.currentState$.pipe(De((function(t){return[t.state.trajectory[t.state.trajectory.length-1].id,t.state.imagesAhead]})),li((function(t,n){var i=rt(t,2),r=i[0],o=(i[1],rt(n,2)),s=o[0],u=o[1];void 0===r&&(r=s);var l=a.length-1;if(u>=e._imagesAhead||a[l]===r)return[r,[]];var c=a.indexOf(s),h=a.indexOf(r)+1,p=Math.min(l,c+e._imagesAhead-u)+1;return p<=h?[r,[]]:[a[p-1],a.slice(h,p)]}),[void 0,[]]),tn((function(t){var e=rt(t,2);e[0];return Ye(e[1])})))})),tn((function(t){return e._graphService.cacheImage$(t).pipe(An((function(){return me()})))}),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(hn((function(t){return t.state.imagesAhead<e._imagesAhead})),Un(void 0,(function(t){return t.state.lastImage.id})),De((function(t){for(var e=t.state.lastImage,n=t.state.trajectory,i=void 0,r=n.length-2;r>=0;r--){var a=n[r];if(a.sequenceId!==e.sequenceId)break;if(a.capturedAt!==e.capturedAt){i=a.capturedAt<e.capturedAt;break}}return[t.state.lastImage,i]})),Ki(this._direction$),zi((function(t){var n=rt(t,2),i=rt(n[0],2),r=i[0],a=(i[1],n[1]);return mn(([Of.Next,Of.Prev].indexOf(a)>-1?r.sequenceEdges$:r.spatialEdges$).pipe(ri((function(t){return t.cached})),Yi(15e3)),xe(a)).pipe(De((function(t){var e,n=rt(t,2),i=n[0],r=n[1],a=wt(i.edges);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(o.data.direction===r)return o.target}}catch(Tx){a.e(Tx)}finally{a.f()}return null})),zi((function(t){return null!=t?e._graphService.cacheImage$(t):me()})))}))).subscribe((function(t){e._stateService.appendImagess([t])}),(function(t){console.error(t),e.stop()})),this._clearSubscription=this._stateService.currentImage$.pipe(Mn(1,10)).subscribe((function(t){e._stateService.clearPriorImages()})),this._setPlaying(!0);var i=this._stateService.currentState$.pipe(De((function(t){return t.state})),Un((function(t,e){var n=rt(t,2),i=n[0],r=n[1],a=rt(e,2),o=a[0],s=a[1];return i===o&&r===s}),(function(t){return[t.currentImage.id,t.lastImage.id]})),hn((function(t){return t.currentImage.id===t.lastImage.id&&t.currentIndex===t.trajectory.length-1})),De((function(t){return t.currentImage})));this._stopSubscription=We(i,this._direction$).pipe(zi((function(t){var e=rt(t,2),n=e[0],i=e[1],r=([Of.Next,Of.Prev].indexOf(i)>-1?n.sequenceEdges$:n.spatialEdges$).pipe(ri((function(t){return t.cached})),Yi(15e3),An((function(t){return console.error(t),xe({cached:!1,edges:[]})})));return We(xe(i),r).pipe(De((function(t){var e,n=rt(t,2),i=n[0],r=wt(n[1].edges);try{for(r.s();!(e=r.n()).done;){if(e.value.data.direction===i)return!0}}catch(Tx){r.e(Tx)}finally{r.f()}return!1})))})),tn((function(t){return t||!e._bridging$?xe(t):e._bridging$.pipe(De((function(t){return null!=t})),An((function(t){return console.error(t),xe(!1)})))})),ri((function(t){return!t}))).subscribe(void 0,void 0,(function(){e.stop()})),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(De((function(t){return t===Qm.Earth})),Un(),ri((function(t){return t}))).subscribe(void 0,void 0,(function(){e.stop()})),this._earthSubscription.closed&&(this._earthSubscription=null)}}},{key:"dispose",value:function(){this.stop(),this._subscriptions.unsubscribe()}},{key:"setDirection",value:function(t){this._directionSubject$.next(t)}},{key:"setSpeed",value:function(t){if((t=Math.max(0,Math.min(1,t)))!==this._speed){var e=this._setSpeed(t);this._playing&&this._stateService.setSpeed(e),this._speedSubject$.next(this._speed)}}},{key:"stop",value:function(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(Mg.Spatial),this._setPlaying(!1))}},{key:"_mapSpeed",value:function(t){var e=2*t-1;return Math.pow(10,e)-.2*e}},{key:"_mapImagesAhead",value:function(t){return Math.round(Math.max(10,Math.min(50,8+6*t)))}},{key:"_setPlaying",value:function(t){this._playing=t,this._playingSubject$.next(t)}},{key:"_setSpeed",value:function(t){this._speed=t;var e=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(e),e}}]),t}();Fg.sequenceSpeed=.54,function(t){t[t.Hidden=0]="Hidden",t[t.Homogeneous=1]="Homogeneous",t[t.Cluster=2]="Cluster",t[t.ConnectedComponent=3]="ConnectedComponent",t[t.Sequence=4]="Sequence"}(zg||(zg={})),function(t){t[t.Hidden=0]="Hidden",t[t.Altitude=1]="Altitude",t[t.Flat=2]="Flat"}(Og||(Og={}));var Ng=function(t){kt(n,t);var e=Mt(n);function n(t){var i;Tt(this,n),(i=e.call(this))._originalSize=t.originalSize;var r=t.cluster,a=t.scale,o=t.translation;return i._makeAttributes(r),i.material.size=a*i._originalSize,i.material.vertexColors=!0,i.material.needsUpdate=!0,i.matrixAutoUpdate=!1,i.position.fromArray(o),i.updateMatrix(),i.updateMatrixWorld(!1),i}return Ct(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"resize",value:function(t){this.material.size=t*this._originalSize,this.material.needsUpdate=!0}},{key:"_makeAttributes",value:function(t){var e=[],n=[],i=t.points;for(var r in i)if(i.hasOwnProperty(r)){var a=i[r];e.push.apply(e,vt(a.coordinates));var o=a.color;n.push(o[0]),n.push(o[1]),n.push(o[2])}var s=this.geometry;s.setAttribute("position",new xo(new Float32Array(e),3)),s.setAttribute("color",new xo(new Float32Array(n),3))}}]),n}(Ac),Bg=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this))._makeAttributes(t),i.matrixAutoUpdate=!1,i.updateMatrix(),i.updateMatrixWorld(!1),i}return Ct(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"_makeAttributes",value:function(t){var e=t.slice();e.push(t[0]);var n,i=0,r=new Float32Array(3*(t.length+1)),a=wt(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;r[i++]=o[0],r[i++]=o[1],r[i++]=o[2]}}catch(Tx){a.e(Tx)}finally{a.f()}this.geometry.setAttribute("position",new xo(r,3))}}]),n}(xc);function jg(t,e){return t===e}function Vg(t){var e=function(t){return Math.pow(2,t)}(t),n=e/2;return{min:[-n,-n,-n],max:[n,n,n]}}var Ug=function(){function t(e,n,i,r){Tt(this,t),this.level=e,this.leafLevel=n,this.boundingBox=i,this.parent=r,this.children=[],this.items=[],r&&r.children.push(this)}return Ct(t,[{key:"isEmpty",get:function(){return!(this.children.length||this.items.length)}},{key:"add",value:function(e){var n=this;if(!n.boundingBox.containsPoint(e.position))throw new Error("Item not contained in node");if(jg(n.level,n.leafLevel))return n.items.push(e),this;var i,r=wt(n.children);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(a.boundingBox.containsPoint(e.position))return a.add(e)}}catch(Tx){r.e(Tx)}finally{r.f()}var o,s=wt(n._generateBoundingBoxes());try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u.containsPoint(e.position))return new t(n.level-1,n.leafLevel,u,n).add(e)}}catch(Tx){s.e(Tx)}finally{s.f()}throw new Error("Item not contained in children")}},{key:"intersect",value:function(t,e,n){if(t.intersectBox(this.boundingBox,e))if(jg(this.level,this.leafLevel))n.push(this);else{var i,r=wt(this.children);try{for(r.s();!(i=r.n()).done;){i.value.intersect(t,e,n)}}catch(Tx){r.e(Tx)}finally{r.f()}}}},{key:"remove",value:function(t){var e=this.items.indexOf(t);if(e<0)throw new Error("Item does not exist ".concat(t.uuid));this.items.splice(e,1)}},{key:"traverse",value:function(){var t=this;if(t.isEmpty){var e=t.parent;if(e){var n=e.children.indexOf(t);if(n<0)throw new Error("Corrupt octree");e.children.splice(n,1),this.parent=null,e.traverse()}}}},{key:"_generateBoundingBoxes",value:function(){for(var t=this.boundingBox.min,e=(this.boundingBox.max.x-t.x)/2,n=[],i=0,r=[[t.x,t.y+e,t.z+e],[t.x+e,t.y+e,t.z+e],[t.x,t.y,t.z+e],[t.x+e,t.y,t.z+e],[t.x,t.y+e,t.z],[t.x+e,t.y+e,t.z],[t.x,t.y,t.z],[t.x+e,t.y,t.z]];i<r.length;i++){var a=rt(r[i],3),o=a[0],s=a[1],u=a[2];n.push(new Xr(new Wr(o,s,u),new Wr(o+e,s+e,u+e)))}return n}}]),t}(),$g=function(){function t(e,n){if(Tt(this,t),this.rootLevel=e,this.leafLevel=n,n>e)throw new Error;this._index=new Map,this._root=this._makeRoot()}return Ct(t,[{key:"root",get:function(){return this._root}},{key:"add",value:function(t){if(this.root.boundingBox.containsPoint(t.position)){var e=this._root.add(t);this._index.set(t.uuid,e)}else console.warn("Object outside bounding box ".concat(t.uuid))}},{key:"has",value:function(t){return this._index.has(t.uuid)}},{key:"intersect",value:function(t){var e=[],n=new Wr;return this._root.intersect(t,n,e),e.map((function(t){return t.items})).reduce((function(t,e){return t.push.apply(t,vt(e)),t}),[])}},{key:"reset",value:function(){this._root=this._makeRoot(),this._index.clear()}},{key:"remove",value:function(t){if(!this.has(t))throw new Error("Frame does not exist ".concat(t.uuid));var e=this._index.get(t.uuid);e.remove(t),e.traverse(),this._index.delete(t.uuid)}},{key:"_makeRoot",value:function(){var t=this.rootLevel,e=Vg(t),n=new Xr((new Wr).fromArray(e.min),(new Wr).fromArray(e.max));return new Ug(t,this.leafLevel,n)}}]),t}(),Hg=function(){function t(e,n){Tt(this,t),this._objects=[],this._objectImageMap=new Map,this._octree=null!==e&&void 0!==e?e:new $g(14,6),this._raycaster=null!==n&&void 0!==n?n:new xf,this._interactiveLayer=1,this._raycaster=n||new xf(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}return Ct(t,[{key:"interactiveLayer",get:function(){return this._interactiveLayer}},{key:"octree",get:function(){return this._octree}},{key:"raycaster",get:function(){return this._raycaster}},{key:"add",value:function(t,e){var n=t.uuid;this._objectImageMap.set(n,e),this._objects.push(t),this._octree.add(t)}},{key:"intersectObjects",value:function(t,e){this._raycaster.setFromCamera((new Fr).fromArray(t),e);var n,i=this._octree.intersect(this.raycaster.ray),r=this._raycaster.intersectObjects(i),a=this._objectImageMap,o=wt(r);try{for(o.s();!(n=o.n()).done;){var s=n.value.object.uuid;if(a.has(s))return a.get(s)}}catch(Tx){o.e(Tx)}finally{o.f()}return null}},{key:"remove",value:function(t){var e=this._objects,n=e.indexOf(t);if(-1!==n){var i,r=wt(e.splice(n,1));try{for(r.s();!(i=r.n()).done;){var a=i.value;this._objectImageMap.delete(a.uuid)}}catch(Tx){r.e(Tx)}finally{r.f()}this._octree.remove(t)}else console.warn("Object does not exist")}},{key:"resetIntersectionThreshold",value:function(t){this._raycaster.params.Line.threshold=t?this._largeLineThreshold:this._lineThreshold}}]),t}(),qg=function(t){kt(n,t);var e=Mt(n);function n(t){var i;Tt(this,n),i=e.call(this,t.geometry,t.material);var r=t.mode,a=t.originalOrigin,o=t.transform.unprojectBasic([0,0],0);return i._relativeAltitude=a[2]-o[2],i._makeAttributes(o,a,r),i.matrixAutoUpdate=!1,i.position.fromArray(o),i.updateMatrix(),i.updateMatrixWorld(!1),i}return Ct(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setMode",value:function(t){var e=this.geometry.attributes.position;e.array[5]=this._modeToAltitude(t),e.needsUpdate=!0,this.geometry.computeBoundingSphere()}},{key:"_makeAttributes",value:function(t,e,n){var i=new Float32Array(6);i[0]=0,i[1]=0,i[2]=0,i[3]=e[0]-t[0],i[4]=e[1]-t[1],i[5]=this._modeToAltitude(n);var r=new xo(i,3);this.geometry.setAttribute("position",r),r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},{key:"_modeToAltitude",value:function(t){return t===Og.Altitude?this._relativeAltitude:0}}]),n}(xc),Wg=function(t){kt(n,t);var e=Mt(n);function n(t){var i;Tt(this,n),i=e.call(this,t.geometry,t.material);var r=t.color,a=t.size,o=t.scale,s=t.transform,u=s.unprojectBasic([0,0],0),l=i._makePositions(a,s,u);return i._makeAttributes(l,r),i.geometry.computeBoundingSphere(),i.geometry.computeBoundingBox(),i.matrixAutoUpdate=!1,i.position.fromArray(u),i.scale.set(o,o,o),i.updateMatrix(),i.updateMatrixWorld(!1),i}return Ct(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"setColor",value:function(t){return this._updateColorAttribute(t),this}},{key:"resize",value:function(t){return this.scale.set(t,t,t),this.updateMatrix(),this.updateMatrixWorld(!1),this}},{key:"_makeAttributes",value:function(t,e){var n=this.geometry,i=new xo(new Float32Array(t),3);n.setAttribute("position",i),i.needsUpdate=!0;var r=new xo(new Float32Array(t.length),3);n.setAttribute("color",r),this._updateColorAttribute(e)}},{key:"_updateColorAttribute",value:function(t){for(var e=rt(new fo(t).toArray(),3),n=e[0],i=e[1],r=e[2],a=this.geometry.attributes.color,o=a.array,s=o.length,u=0,l=0;l<s;l++)o[u++]=n,o[u++]=i,o[u++]=r;a.needsUpdate=!0}}]),n}(kc),Gg=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_makePositions",value:function(t,e,n){var i=[];i.push.apply(i,vt(this._makeAxis(t,e,n))),i.push.apply(i,vt(this._makeLat(.5,10,t,e,n)));for(var r=0,a=[0,.25,.5,.75];r<a.length;r++){var o=a[r];i.push.apply(i,vt(this._makeLng(o,10,t,e,n)))}return i}},{key:"_makeAxis",value:function(t,e,n){var i=e.unprojectBasic([.5,1],.8*t),r=e.unprojectBasic([.5,0],1.2*t);return[i[0]-n[0],i[1]-n[1],i[2]-n[2],r[0]-n[0],r[1]-n[1],r[2]-n[2]]}},{key:"_makeLat",value:function(t,e,n,i,r){var a=.8*n,o=rt(r,3),s=o[0],u=o[1],l=o[2],c=[],h=i.unprojectBasic([0,t],a);h[0]-=s,h[1]-=u,h[2]-=l,c.push.apply(c,vt(h));for(var p=1;p<=e;p++){var f=i.unprojectBasic([p/e,t],a);f[0]-=s,f[1]-=u,f[2]-=l,c.push.apply(c,vt(f).concat(vt(f)))}return c.push.apply(c,vt(h)),c}},{key:"_makeLng",value:function(t,e,n,i,r){var a=.8*n,o=rt(r,3),s=o[0],u=o[1],l=o[2],c=[],h=i.unprojectBasic([t,0],a);h[0]-=s,h[1]-=u,h[2]-=l,c.push.apply(c,vt(h));for(var p=0;p<=e;p++){var f=i.unprojectBasic([t,p/e],a);f[0]-=s,f[1]-=u,f[2]-=l,c.push.apply(c,vt(f).concat(vt(f)))}return c.push.apply(c,vt(h)),c}}]),n}(Wg),Zg=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_makePositions",value:function(t,e,n){var i=[];return i.push.apply(i,vt(this._makeDiags(t,e,n))),i.push.apply(i,vt(this._makeFrame(t,8,e,n))),i}},{key:"_makeDiags",value:function(t,e,n){for(var i=t,r=rt(n,3),a=r[0],o=r[1],s=r[2],u=[0,0,0],l=[],c=0,h=[[0,0],[1,0],[1,1],[0,1]];c<h.length;c++){var p=h[c],f=e.unprojectBasic(p,i,!0);f[0]-=a,f[1]-=o,f[2]-=s,l.push.apply(l,u.concat(vt(f)))}return l}},{key:"_makeFrame",value:function(t,e,n,i){var r=[];r.push.apply(r,vt(this._subsample([0,1],[0,0],e))),r.push.apply(r,vt(this._subsample([0,0],[1,0],e))),r.push.apply(r,vt(this._subsample([1,0],[1,1],e)));for(var a=t,o=rt(i,3),s=o[0],u=o[1],l=o[2],c=[],h=0,p=r;h<p.length;h++){var f=p[h],d=n.unprojectBasic(f,a,!0);d[0]-=s,d[1]-=u,d[2]-=l,c.push.apply(c,vt(d))}return c}},{key:"_interpolate",value:function(t,e,n){return t+n*(e-t)}},{key:"_subsample",value:function(t,e,n){if(n<1)return[t,e];var i=[];i.push(t);for(var r=0;r<=n;r++){for(var a=[],o=0;o<3;o++)a.push(this._interpolate(t[o],e[o],r/(n+1)));i.push(a),i.push(a)}return i.push(e),i}}]),n}(Wg),Xg=function(){function t(e,n,i){Tt(this,t),this.id=e,this._scene=n,this._intersection=i,this.cameras=new qa,this.keys=[],this._positionLines={},this._positions=new qa,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new vc({fog:!1,vertexColors:!0}),this._positionMaterial=new vc({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}return Ct(t,[{key:"addImage",value:function(t){var e=t.image,n=e.id;if(this.hasImage(n))throw new Error("Image exists ".concat(n));var i=t.idMap.ccId;this._connectedComponents.has(i)||this._connectedComponents.set(i,[]);var r=t.idMap.clusterId;this._clusters.has(r)||this._clusters.set(r,[]);var a=t.idMap.sequenceId;this._sequences.has(a)||this._sequences.set(a,[]),this._props[n]={image:e,ids:{ccId:i,clusterId:r,sequenceId:a}},this.keys.push(n)}},{key:"applyCameraColor",value:function(t,e){this._cameraFrames[t].setColor(e)}},{key:"applyCameraSize",value:function(t){var e,n=wt(this.cameras.children);try{for(n.s();!(e=n.n()).done;){e.value.resize(t)}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"applyFilter",value:function(t){var e,n=this.clusterVisibles;for(var i in n)n.hasOwnProperty(i)&&(n[i]=!1);for(var r=this._cameraFrames,a=this._positionLines,o=this._intersection.interactiveLayer,s=0,u=Object.values(this._props);s<u.length;s++){var l=u[s],c=l.image,h=t(c),p=c.id;a[p].visible=h;var f=r[p];this._setCameraVisibility(f,h,o),n[e=l.ids.clusterId]||(n[e]=h)}}},{key:"applyPositionMode",value:function(t){this._positions.visible=t!==Og.Hidden;var e,n=wt(this._positions.children);try{for(n.s();!(e=n.n()).done;){e.value.setMode(t)}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"dispose",value:function(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}},{key:"getCamerasByMode",value:function(t){if(t===zg.Cluster)return this._clusters;if(t===zg.ConnectedComponent)return this._connectedComponents;if(t===zg.Sequence)return this._sequences;var e=zg[zg.Homogeneous],n=new Map;return n.set(e,this.cameras.children),n}},{key:"getColorId",value:function(t,e){var n=this._props[t],i=zg;switch(e){case i.Cluster:return n.ids.clusterId;case i.ConnectedComponent:return n.ids.ccId;case i.Sequence:return n.ids.sequenceId;default:return i[i.Homogeneous]}}},{key:"hasImage",value:function(t){return-1!==this.keys.indexOf(t)}},{key:"visualize",value:function(t){var e,n,i=t.id,r=t.visible,a=t.transform,o={color:t.color,material:this._frameMaterial,scale:t.scale,size:t.maxSize,transform:a},s=Zf(a.cameraType)?new Gg(o):new Zg(o),u=this._intersection.interactiveLayer;this._setCameraVisibility(s,r,u),this.cameras.add(s),this._cameraFrames[i]=s,this._intersection.add(s,i);var l=this._props[i].ids;(e=this.clusterVisibles)[n=l.clusterId]||(e[n]=r),this._connectedComponents.get(l.ccId).push(s),this._clusters.get(l.clusterId).push(s),this._sequences.get(l.sequenceId).push(s);var c={material:this._positionMaterial,mode:t.positionMode,originalOrigin:t.originalPosition,transform:a},h=new qg(c);h.visible=r,this._positions.add(h),this._positionLines[i]=h}},{key:"_disposeCameras",value:function(){var t,e=this._intersection,n=this.cameras,i=wt(n.children.slice());try{for(i.s();!(t=i.n()).done;){var r=t.value;r.dispose(),e.remove(r),n.remove(r)}}catch(Tx){i.e(Tx)}finally{i.f()}this._scene.remove(this.cameras)}},{key:"_disposePositions",value:function(){var t,e=this._positions,n=wt(e.children.slice());try{for(n.s();!(t=n.n()).done;){var i=t.value;i.dispose(),e.remove(i)}}catch(Tx){n.e(Tx)}finally{n.f()}this._scene.remove(this._positions)}},{key:"_setCameraVisibility",value:function(t,e,n){t.visible=e,e?t.layers.enable(n):t.layers.disable(n)}}]),t}(),Yg=function(){function t(){Tt(this,t),this._colors=new Map;var e=zg;this._colors.set(e[e.Homogeneous],"#FFFFFF")}return Ct(t,[{key:"getColor",value:function(t){var e=this._colors;return e.has(t)||e.set(t,this._randomColor()),e.get(t)}},{key:"_randomColor",value:function(){return"hsl(".concat(Math.floor(360*Math.random()),", 100%, 50%)")}}]),t}();function Kg(t){return t!==zg.Hidden}var Jg=function(){function t(e,n){Tt(this,t),this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=n||new Al,this._scene.autoUpdate=!1,this._intersection=new Hg,this._assets=new Yg,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=e.cameraVisualizationMode?e.cameraVisualizationMode:zg.Homogeneous,this._cameraSize=e.cameraSize,this._pointSize=e.pointSize,this._pointsVisible=e.pointsVisible,this._positionMode=e.originalPositionMode,this._cellsVisible=e.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=function(){return!0}}return Ct(t,[{key:"needsRender",get:function(){return this._needsRender}},{key:"intersection",get:function(){return this._intersection}},{key:"addCluster",value:function(t,e,n){if(!this.hasCluster(t.id,n)){var i=t.id;if(!(i in this._clusters)){this._clusters[i]={points:new qa,cellIds:[]};var r=this._getClusterVisible(i);this._clusters[i].points.visible=r,this._clusters[i].points.add(new Ng({cluster:t,originalSize:this._originalPointSize,scale:this._pointSize,translation:e})),this._scene.add(this._clusters[i].points)}-1===this._clusters[i].cellIds.indexOf(n)&&this._clusters[i].cellIds.push(n),n in this._cellClusters||(this._cellClusters[n]={keys:[]}),-1===this._cellClusters[n].keys.indexOf(i)&&this._cellClusters[n].keys.push(i),this._needsRender=!0}}},{key:"addImage",value:function(t,e,n,i){var r,a,o,s=t.id,u={clusterId:null!==(r=t.clusterId)&&void 0!==r?r:"NO_CLUSTER_ID",sequenceId:null!==(a=t.sequenceId)&&void 0!==a?a:"NO_SEQUENCE_ID",ccId:null!==(o=t.mergeId)&&void 0!==o?o:"NO_MERGE_ID"};if(!(i in this._images)){var l=new Xg(i,this._scene,this._intersection);l.cameras.visible=Kg(this._cameraVisualizationMode),l.applyPositionMode(this._positionMode),this._images[i]=l}var c=this._images[i];if(!c.hasImage(s)){c.addImage({idMap:u,image:t});var h=c.getColorId(s,this._cameraVisualizationMode),p=this._assets.getColor(h),f=this._filter(t);if(c.visualize({id:s,color:p,positionMode:this._positionMode,scale:this._cameraSize,transform:e,visible:f,maxSize:this._originalCameraSize,originalPosition:n}),this._imageCellMap.set(s,i),s===this._selectedId&&this._highlight(s,this._colors.select,this._cameraVisualizationMode),u.clusterId in this._clusters){var d=this._getClusterVisible(u.clusterId);this._clusters[u.clusterId].points.visible=d}this._needsRender=!0}}},{key:"addCell",value:function(t,e){if(!this.hasCell(e)){var n=new Bg(t);this._cells[e]=new qa,this._cells[e].visible=this._cellsVisible,this._cells[e].add(n),this._scene.add(this._cells[e]),this._needsRender=!0}}},{key:"deactivate",value:function(){this._filter=function(){return!0},this._selectedId=null,this._hoveredId=null,this.uncache()}},{key:"hasCluster",value:function(t,e){return t in this._clusters&&-1!==this._clusters[t].cellIds.indexOf(e)}},{key:"hasCell",value:function(t){return t in this._cells}},{key:"hasImage",value:function(t,e){return e in this._images&&this._images[e].hasImage(t)}},{key:"setCameraSize",value:function(t){if(!(Math.abs(t-this._cameraSize)<.001)){for(var e=this._images,n=0,i=Object.keys(e);n<i.length;n++){e[i[n]].applyCameraSize(t)}this._intersection.raycaster.near=this._getNear(t),this._cameraSize=t,this._needsRender=!0}}},{key:"setFilter",value:function(t){this._filter=t;for(var e={},n=0,i=Object.values(this._images);n<i.length;n++){var r=i[n];r.applyFilter(t);var a=r.clusterVisibles;for(var o in a)a.hasOwnProperty(o)&&(o in e||(e[o]=!1),e[o]||(e[o]=a[o]))}var s=this._pointsVisible;for(var u in e)if(e.hasOwnProperty(u)){e[u]&&(e[u]=s);var l=e[u];u in this._clusters&&(this._clusters[u].points.visible=l)}this._needsRender=!0}},{key:"setHoveredImage",value:function(t){if(null!=t&&!this._imageCellMap.has(t))throw new Hf("Image does not exist: ".concat(t));this._hoveredId!==t&&(this._needsRender=!0,null!=this._hoveredId&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(t,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=t)}},{key:"setNavigationState",value:function(t){this._intersection.resetIntersectionThreshold(t)}},{key:"setPointSize",value:function(t){if(!(Math.abs(t-this._pointSize)<.001)){var e=this._clusters;for(var n in e)if(e.hasOwnProperty(n)){var i,r=wt(e[n].points.children);try{for(r.s();!(i=r.n()).done;){i.value.resize(t)}}catch(Tx){r.e(Tx)}finally{r.f()}}this._pointSize=t,this._needsRender=!0}}},{key:"setPointVisibility",value:function(t){if(t!==this._pointsVisible){for(var e in this._clusters)this._clusters.hasOwnProperty(e)&&(this._clusters[e].points.visible=t);this._pointsVisible=t,this._needsRender=!0}}},{key:"setPositionMode",value:function(t){if(t!==this._positionMode){for(var e=0,n=Object.values(this._images);e<n.length;e++){n[e].applyPositionMode(t)}this._positionMode=t,this._needsRender=!0}}},{key:"setSelectedImage",value:function(t){this._selectedId!==t&&(this._needsRender=!0,null!=this._selectedId&&this._resetCameraColor(this._selectedId),this._highlight(t,this._colors.select,this._cameraVisualizationMode),this._selectedId=t)}},{key:"setCellVisibility",value:function(t){if(t!==this._cellsVisible){for(var e in this._cells)this._cells.hasOwnProperty(e)&&(this._cells[e].visible=t);this._cellsVisible=t,this._needsRender=!0}}},{key:"setCameraVisualizationMode",value:function(t){if(t!==this._cameraVisualizationMode){for(var e=Kg(t),n=this._assets,i=0,r=Object.values(this._images);i<r.length;i++){var a=r[i];a.cameras.visible=e,a.getCamerasByMode(t).forEach((function(t,e){var i,r=n.getColor(e),a=wt(t);try{for(a.s();!(i=a.n()).done;){i.value.setColor(r)}}catch(Tx){a.e(Tx)}finally{a.f()}}))}this._highlight(this._hoveredId,this._colors.hover,t),this._highlight(this._selectedId,this._colors.select,t),this._cameraVisualizationMode=t,this._needsRender=!0}}},{key:"render",value:function(t,e){e.render(this._scene,t),this._needsRender=!1}},{key:"uncache",value:function(t){for(var e=0,n=Object.keys(this._cellClusters);e<n.length;e++){var i=n[e];t&&-1!==t.indexOf(i)||this._disposeReconstruction(i)}for(var r=0,a=Object.keys(this._images);r<a.length;r++){var o=a[r];if(!t||-1===t.indexOf(o)){var s,u=this._imageCellMap,l=wt(this._images[o].keys);try{for(l.s();!(s=l.n()).done;){var c=s.value;u.delete(c)}}catch(Tx){l.e(Tx)}finally{l.f()}this._images[o].dispose(),delete this._images[o]}}for(var h=0,p=Object.keys(this._cells);h<p.length;h++){var f=p[h];t&&-1!==t.indexOf(f)||this._disposeCell(f)}this._needsRender=!0}},{key:"_getClusterVisible",value:function(t){if(!this._pointsVisible)return!1;for(var e=!1,n=0,i=Object.values(this._images);n<i.length;n++){var r=i[n].clusterVisibles;t in r&&(e||(e=r[t]))}return e}},{key:"_disposePoints",value:function(t){var e,n=wt(this._cellClusters[t].keys);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i in this._clusters){var r=this._clusters[i].cellIds.indexOf(t);if(-1!==r&&(this._clusters[i].cellIds.splice(r,1),!(this._clusters[i].cellIds.length>0))){var a,o=wt(this._clusters[i].points.children.slice());try{for(o.s();!(a=o.n()).done;){a.value.dispose()}}catch(Tx){o.e(Tx)}finally{o.f()}this._scene.remove(this._clusters[i].points),delete this._clusters[i]}}}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"_disposeReconstruction",value:function(t){this._disposePoints(t),delete this._cellClusters[t]}},{key:"_disposeCell",value:function(t){var e,n=this._cells[t],i=wt(n.children.slice());try{for(i.s();!(e=i.n()).done;){var r=e.value;r.dispose(),n.remove(r)}}catch(Tx){i.e(Tx)}finally{i.f()}this._scene.remove(n),delete this._cells[t]}},{key:"_getNear",value:function(t){var e=this._rayNearScale*this._originalCameraSize*t;return Math.max(1,e)}},{key:"_resetCameraColor",value:function(t){var e=this._imageCellMap;if(null!=t&&e.has(t)){var n=e.get(t),i=this._images[n],r=i.getColorId(t,this._cameraVisualizationMode),a=this._assets.getColor(r);i.applyCameraColor(t,a)}}},{key:"_highlight",value:function(t,e,n){var i=this._imageCellMap;if(null!=t&&i.has(t)){var r=i.get(t);e=n===zg.Homogeneous?e:"#FFFFFF",this._images[r].applyCameraColor(t,e)}}}]),t}(),Qg=function(){function t(e,n){Tt(this,t),this._graphService=e,this._data=n,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}return Ct(t,[{key:"cacheClusters$",value:function(t){var e=this;if(!this.hasCell(t))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(t))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(t))return this._cachingClusters$[t];var n,i=this.getCell(t).filter((function(t){return!!t.clusterId&&!!t.clusterUrl})).map((function(t){return{key:t.clusterId,url:t.clusterUrl}})),r=Array.from(new Map(i.map((function(t){return[t.key,t]}))).values());this._cellClusters[t]=r,this._cacheRequests[t]=[];var a=new Promise((function(t,e){n=e}));return this._cacheRequests[t].push(n),this._cachingClusters$[t]=this._cacheClusters$(r,t,a).pipe(ei((function(){t in e._cachingClusters$&&delete e._cachingClusters$[t],t in e._cacheRequests&&delete e._cacheRequests[t]})),_i(),ne()),this._cachingClusters$[t]}},{key:"cacheCell$",value:function(t){var e=this;if(this.hasCell(t))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(t)||(this._cachingCells$[t]=this._graphService.cacheCell$(t).pipe(An((function(t){return console.error(t),me()})),hn((function(){return!(t in e._cells)})),Hi((function(n){var i;e._cells[t]=[],(i=e._cells[t]).push.apply(i,vt(n)),delete e._cachingCells$[t]})),ei((function(){t in e._cachingCells$&&delete e._cachingCells$[t]})),_i(),ne())),this._cachingCells$[t]}},{key:"isCachingClusters",value:function(t){return t in this._cachingClusters$}},{key:"isCachingCell",value:function(t){return t in this._cachingCells$}},{key:"hasClusters",value:function(t){if(t in this._cachingClusters$||!(t in this._cellClusters))return!1;var e,n=wt(this._cellClusters[t]);try{for(n.s();!(e=n.n()).done;){if(!(e.value.key in this._clusters))return!1}}catch(Tx){n.e(Tx)}finally{n.f()}return!0}},{key:"hasCell",value:function(t){return!(t in this._cachingCells$)&&t in this._cells}},{key:"getClusters",value:function(t){var e=this;return t in this._cellClusters?this._cellClusters[t].map((function(t){return e._clusters[t.key]})).filter((function(t){return!!t})):[]}},{key:"getCell",value:function(t){return t in this._cells?this._cells[t]:[]}},{key:"uncache",value:function(t){for(var e=0,n=Object.keys(this._cacheRequests);e<n.length;e++){var i=n[e];if(!t||-1===t.indexOf(i)){var r,a=wt(this._cacheRequests[i]);try{for(a.s();!(r=a.n()).done;){(0,r.value)()}}catch(Tx){a.e(Tx)}finally{a.f()}delete this._cacheRequests[i]}}for(var o=0,s=Object.keys(this._cellClusters);o<s.length;o++){var u=s[o];if(!t||-1===t.indexOf(u)){var l,c=wt(this._cellClusters[u]);try{for(c.s();!(l=c.n()).done;){var h=l.value;if(h.key in this._clusterCells){var p=this._clusterCells[h.key].indexOf(u);-1!==p&&(this._clusterCells[h.key].splice(p,1),this._clusterCells[h.key].length>0||(delete this._clusterCells[h.key],delete this._clusters[h.key]))}}}catch(Tx){c.e(Tx)}finally{c.f()}delete this._cellClusters[u]}}for(var f=0,d=Object.keys(this._cells);f<d.length;f++){var v=d[f];t&&-1!==t.indexOf(v)||delete this._cells[v]}}},{key:"updateCell$",value:function(t){var e=this;if(!this.hasCell(t))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(t).pipe(An((function(t){return console.error(t),me()})),hn((function(){return t in e._cells})),Hi((function(n){var i;e._cells[t]=[],(i=e._cells[t]).push.apply(i,vt(n))})),_i(),ne())}},{key:"updateClusters$",value:function(t){var e,n=this;if(!this.hasCell(t))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(t))throw new Error("Cannot update reconstructions for cell that is not cached.");var i=this.getCell(t).filter((function(t){return!!t.clusterId&&!!t.clusterUrl})).map((function(t){return{key:t.clusterId,url:t.clusterUrl}})),r=Array.from(new Map(i.map((function(t){return[t.key,t]}))).values()).filter((function(t){return!(t.key in n._clusters)}));return(e=this._cellClusters[t]).push.apply(e,vt(r)),this._cacheClusters$(r,t,null)}},{key:"_cacheClusters$",value:function(t,e,n){var i=this;return Ye(t).pipe(tn((function(t){return i._hasCluster(t.key)?xe(i._getCluster(t.key)):i._getCluster$(t.url,t.key,n).pipe(An((function(t){return t instanceof Lm||console.error(t),me()})))}),6),hn((function(){return e in i._cellClusters})),Hi((function(t){i._hasCluster(t.id)||(i._clusters[t.id]=t),t.id in i._clusterCells||(i._clusterCells[t.id]=[]),-1===i._clusterCells[t.id].indexOf(e)&&i._clusterCells[t.id].push(e)})))}},{key:"_getCluster",value:function(t){return this._clusters[t]}},{key:"_getCluster$",value:function(t,e,n){var i=this;return Xt.create((function(r){i._data.getCluster(t,n).then((function(t){t.id=e,r.next(t),r.complete()}),(function(t){r.error(t)}))}))}},{key:"_hasCluster",value:function(t){return t in this._clusters}}]),t}();function ty(t,e,n){var i=new Set;return i.add(t),ey(i,[t],0,e,n),Array.from(i)}function ey(t,e,n,i,r){if(!(n>=i)){var a,o=[],s=wt(e);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=r.getAdjacent(u);o.push.apply(o,vt(l))}}catch(Tx){s.e(Tx)}finally{s.f()}for(var c=[],h=0,p=o;h<p.length;h++){var f=p[h];t.has(f)||(t.add(f),c.push(f))}ey(t,c,n+1,i,r)}}var ny=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._cache=new Qg(r.graphService,r.api.data),a._scene=new Jg(a._getDefaultConfiguration()),a._viewportCoords=new Im,a._spatial=new Wf,a}return Ct(n,[{key:"getFrameIdAt",value:function(t){var e=this;return new Promise((function(n,i){e._container.renderService.renderCamera$.pipe(ri(),De((function(n){var i=e._viewportCoords.canvasToViewport(t[0],t[1],e._container.container);return e._scene.intersection.intersectObjects(i,n.perspective)}))).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"_activate",value:function(){var t=this;this._navigator.cacheService.configure({cellDepth:3});var e=this._subscriptions;e.push(this._navigator.stateService.reference$.subscribe((function(){t._scene.uncache()}))),e.push(this._navigator.graphService.filter$.subscribe((function(e){t._scene.setFilter(e)})));var n=this._container.renderService.bearing$.pipe(De((function(t){return 6*Math.floor(t/6)})),Un(),bi(1),ne()),i=this._navigator.stateService.currentImage$.pipe(De((function(e){return t._navigator.api.data.geometry.lngLatToCellId(e.originalLngLat)})),Un(),bi(1),ne()),r=this._configuration$.pipe(De((function(e){return t._spatial.clamp(e.cellGridDepth,1,3)})),Un(),bi(1),ne()),a=We(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return n&&i>Fg.sequenceSpeed})),Un(),bi(1),ne()),o=this._navigator.stateService.state$.pipe(De((function(t){return function(t){return t===Qm.Custom||t===Qm.Earth}(t)})),Un(),bi(1),ne());e.push(o.subscribe((function(e){t._scene.setNavigationState(e)})));var s=We(o,a,n,r,this._navigator.stateService.currentImage$).pipe(Un((function(t,e){var n=rt(t,5),i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=rt(e,5),l=u[0],c=u[1],h=u[2],p=u[3],f=u[4];if(i!==l)return!1;var d=s.id===f.id&&r===c&&o===p;return i?d:d&&a===h})),Dn((function(e){var n=rt(e,5),i=n[0],r=n[1],a=n[2],o=n[3],s=n[4];if(i){var u=t._navigator.api.data.geometry,l=u.lngLatToCellId(s.originalLngLat);return xe(r?[l]:ty(l,o,u))}var c=r?30:90;return xe(t._cellsInFov(s,a,c))})),zi((function(e){return Ye(e).pipe(tn((function(e){return(t._cache.hasCell(e)?xe(t._cache.getCell(e)):t._cache.cacheCell$(e)).pipe(De((function(t){return{id:e,images:t}})))}),6))})));e.push(s.pipe(Ki(this._navigator.stateService.reference$)).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1];t._scene.hasCell(i.id)||t._scene.addCell(t._cellToTopocentric(i.id,r),i.id)}))),e.push(s.pipe(Ki(this._navigator.stateService.reference$)).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1];t._addSceneImages(i,r)}))),e.push(s.pipe(Dn((function(e){var n,i=e.id;return n=t._cache.hasClusters(i)?Ye(t._cache.getClusters(i)):t._cache.isCachingClusters(i)?t._cache.cacheClusters$(i).pipe(ui(null,{}),zi((function(){return Ye(t._cache.getClusters(i))}))):t._cache.hasCell(i)?t._cache.cacheClusters$(i):me(),We(xe(i),n)})),Ki(this._navigator.stateService.reference$)).subscribe((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1];t._scene.hasCluster(a.id,r)||t._scene.addCluster(a,t._computeTranslation(a,o),r)}))),e.push(this._configuration$.pipe(De((function(e){return e.cameraSize=t._spatial.clamp(e.cameraSize,.01,1),e.pointSize=t._spatial.clamp(e.pointSize,.01,1),{cameraSize:e.cameraSize,cameraVisualizationMode:e.cameraVisualizationMode,cellsVisible:e.cellsVisible,originalPositionMode:e.originalPositionMode,pointSize:e.pointSize,pointsVisible:e.pointsVisible}})),Un((function(t,e){return t.cameraSize===e.cameraSize&&t.cameraVisualizationMode===e.cameraVisualizationMode&&t.cellsVisible===e.cellsVisible&&t.originalPositionMode===e.originalPositionMode&&t.pointSize===e.pointSize&&t.pointsVisible===e.pointsVisible}))).subscribe((function(e){t._scene.setCameraSize(e.cameraSize),t._scene.setPointSize(e.pointSize),t._scene.setPointVisibility(e.pointsVisible),t._scene.setCellVisibility(e.cellsVisible);var n=e.cameraVisualizationMode;t._scene.setCameraVisualizationMode(n);var i=e.originalPositionMode;t._scene.setPositionMode(i)}))),e.push(We(i,r).subscribe((function(e){var n=rt(e,2),i=ty(n[0],n[1],t._navigator.api.data.geometry);t._scene.uncache(i),t._cache.uncache(i)}))),e.push(this._navigator.playService.playing$.pipe(zi((function(e){return e?me():t._container.mouseService.dblClick$})),Ki(this._container.renderService.renderCamera$),zi((function(e){var n=rt(e,2),i=n[0],r=n[1],a=t._container.container,o=rt(t._viewportCoords.canvasPosition(i,a),2),s=o[0],u=o[1],l=t._viewportCoords.canvasToViewport(s,u,a),c=t._scene.intersection.intersectObjects(l,r.perspective);return c?t._navigator.moveTo$(c).pipe(An((function(){return me()}))):me()}))).subscribe());var u=We(this._configuration$,this._navigator.stateService.state$).pipe(De((function(e){var n=rt(e,2),i=n[0],r=n[1];return i.cameraSize=t._spatial.clamp(i.cameraSize,.01,1),{size:i.cameraSize,visible:Kg(i.cameraVisualizationMode),state:r}})),Un((function(t,e){return t.size===e.size&&t.visible===e.visible&&t.state===e.state}))),l=this._container.mouseService.mouseMove$.pipe(bi(1),ne());e.push(l.subscribe());var c=cn(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);e.push(We(this._navigator.playService.playing$,c,o,this._navigator.graphService.filter$).pipe(zi((function(e){var n=rt(e,2),i=n[0],r=n[1];return i||"pointerenter"!==r.type?We(xe(r),xe(null),xe(null)):We(on(l.pipe(Xn(1)),t._container.mouseService.mouseMove$),t._container.renderService.renderCamera$,u)}))).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1];if("pointermove"===i.type){var a=t._container.container,o=rt(t._viewportCoords.canvasPosition(i,a),2),s=o[0],u=o[1],l=t._viewportCoords.canvasToViewport(s,u,a),c=t._scene.intersection.intersectObjects(l,r.perspective);t._scene.setHoveredImage(c)}else t._scene.setHoveredImage(null)}))),e.push(this._navigator.stateService.currentId$.subscribe((function(e){t._scene.setSelectedImage(e)}))),e.push(this._navigator.stateService.currentState$.pipe(De((function(e){var n=t._scene;return{name:t._name,renderer:{frameId:e.id,needsRender:n.needsRender,render:n.render.bind(n),pass:Fm.Opaque}}}))).subscribe(this._container.glRenderer.render$));var h=this._navigator.graphService.dataAdded$.pipe(hn((function(e){return t._cache.hasCell(e)})),tn((function(e){return t._cache.updateCell$(e).pipe(De((function(t){return{id:e,images:t}})),Ki(t._navigator.stateService.reference$))})),_i(),ne());e.push(h.subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1];t._addSceneImages(i,r)}))),e.push(h.pipe(Dn((function(e){var n,i=rt(e,1)[0].id,r=t._cache;return n=r.hasClusters(i)?r.updateClusters$(i):r.isCachingClusters(i)?t._cache.cacheClusters$(i).pipe(ui(null,{}),zi((function(){return Ye(r.updateClusters$(i))}))):me(),We(xe(i),n)})),Ki(this._navigator.stateService.reference$)).subscribe((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1];t._scene.hasCluster(a.id,r)||t._scene.addCluster(a,t._computeTranslation(a,o),r)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}},{key:"_getDefaultConfiguration",value:function(){return{cameraSize:.1,cameraVisualizationMode:zg.Homogeneous,cellGridDepth:1,originalPositionMode:Og.Hidden,pointSize:.1,pointsVisible:!0,cellsVisible:!1}}},{key:"_addSceneImages",value:function(t,e){var n,i=t.id,r=wt(t.images);try{for(r.s();!(n=r.n()).done;){var a=n.value;this._scene.hasImage(a.id,i)||this._scene.addImage(a,this._createTransform(a,e),this._computeOriginalPosition(a,e),i)}}catch(Tx){r.e(Tx)}finally{r.f()}}},{key:"_cellsInFov",value:function(t,e,n){var i,r=this._spatial,a=this._navigator.api.data.geometry,o=a.lngLatToCellId(t.originalLngLat),s=[o],u=n/2,l=wt(a.getAdjacent(o));try{for(l.s();!(i=l.n()).done;){var c,h=i.value,p=wt(a.getVertices(h));try{for(p.s();!(c=p.n()).done;){var f=c.value,d=rt(Rf(f.lng,f.lat,0,t.lngLat.lng,t.lngLat.lat,0),2),v=d[0],m=d[1],g=Math.atan2(m,v),y=r.radToDeg(r.azimuthalToBearing(g));Math.abs(y-e)<u&&s.push(h)}}catch(Tx){p.e(Tx)}finally{p.f()}}}catch(Tx){l.e(Tx)}finally{l.f()}return s}},{key:"_computeOriginalPosition",value:function(t,e){return Rf(t.originalLngLat.lng,t.originalLngLat.lat,null!=t.originalAltitude?t.originalAltitude:t.computedAltitude,e.lng,e.lat,e.alt)}},{key:"_cellToTopocentric",value:function(t,e){return this._navigator.api.data.geometry.getVertices(t).map((function(t){return Rf(t.lng,t.lat,-2,e.lng,e.lat,e.alt)}))}},{key:"_computeTranslation",value:function(t,e){return Rf(t.reference.lng,t.reference.lat,t.reference.alt,e.lng,e.lat,e.alt)}},{key:"_createTransform",value:function(t,e){var n=Yf({alt:t.computedAltitude,lat:t.lngLat.lat,lng:t.lngLat.lng},t.rotation,e);return new Md(t.exifOrientation,t.width,t.height,t.scale,t.rotation,n,void 0,void 0,t.cameraParameters,t.cameraType)}}]),n}(Mm);ny.componentName="spatial";var iy=function(){function t(){Tt(this,t),this._notifyChanged$=new te}return Ct(t,[{key:"changed$",get:function(){return this._notifyChanged$}}]),t}(),ry=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),i=e.call(this,null!=t?t:"The provided geometry value is incorrect"),Object.setPrototypeOf(ft(i),n.prototype),i.name="GeometryTagError",i}return Ct(n)}(Hf),ay=function(t){kt(n,t);var e=Mt(n);function n(t){var i;if(Tt(this,n),i=e.call(this),t.length<2)throw new ry("A points geometry must have two or more positions.");i._points=[];var r,a=wt(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o[0]<0||o[0]>1||o[1]<0||o[1]>1)throw new ry("Basic coordinates of points must be on the interval [0, 1].");i._points.push(o.slice())}}catch(Tx){a.e(Tx)}finally{a.f()}return i}return Ct(n,[{key:"points",get:function(){return this._points}},{key:"addPoint2d",value:function(t){var e=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points.push(e),this._notifyChanged$.next(this)}},{key:"getPoint2d",value:function(t){return this._points[t].slice()}},{key:"removePoint2d",value:function(t){if(t<0||t>=this._points.length||this._points.length<3)throw new ry("Index for removed point must be valid.");this._points.splice(t,1),this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(t,e,n){this.setPoint2d(t,e,n)}},{key:"setPoint2d",value:function(t,e,n){var i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points[t]=i,this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(t){return this._getPoints3d(this._points,t)}},{key:"getPoint3d",value:function(t,e){return e.unprojectBasic(this._points[t],200)}},{key:"getPoints2d",value:function(){return this._points.slice()}},{key:"getCentroid2d",value:function(t){if(!t)throw new ry("Get centroid must be called with a transform for points geometries.");var e=rt(this.getRect2d(t),4),n=e[0],i=e[1],r=e[2];return[n<r?(n+r)/2:(n+r+1)/2%1,(i+e[3])/2]}},{key:"getCentroid3d",value:function(t){var e=this.getCentroid2d();return t.unprojectBasic(e,200)}},{key:"getRect2d",value:function(t){var e,n=1,i=0,r=1,a=0,o=this._points,s=wt(o);try{for(s.s();!(e=s.n()).done;){var u=e.value;u[0]<n&&(n=u[0]),u[0]>i&&(i=u[0]),u[1]<r&&(r=u[1]),u[1]>a&&(a=u[1])}}catch(Tx){s.e(Tx)}finally{s.f()}if(Zf(t.cameraType)){for(var l=[],c=0;c<o.length;c++)l[c]=c;l.sort((function(t,e){return o[t][0]<o[e][0]?-1:o[t][0]>o[e][0]?1:t<e?-1:1}));for(var h=o[l[0]][0]+1-o[l[l.length-1]][0],p=0,f=0;f<l.length-1;f++){var d=l[f],v=l[f+1],m=o[v][0]-o[d][0];m>h&&(h=m,p=f+1)}p>0&&(n=o[l[p]][0],i=o[l[p-1]][0])}return[n,r,i,a]}},{key:"setCentroid2d",value:function(t,e){throw new Error("Not implemented")}},{key:"_getPoints3d",value:function(t,e){return t.map((function(t){return e.unprojectBasic(t,200)}))}}]),n}(iy),oy=function(){function t(e,n,i){var r=this;Tt(this,t),this._geometry=e,this._transform=n,this._viewportCoords=i||new Im,this._aborted$=new te,this._created$=new te,this._glObjectsChanged$=new te,this._geometryChangedSubscription=this._geometry.changed$.subscribe((function(){r._onGeometryChanged(),r._glObjectsChanged$.next(r)}))}return Ct(t,[{key:"geometry",get:function(){return this._geometry}},{key:"glObjects",get:function(){return this._glObjects}},{key:"aborted$",get:function(){return this._aborted$}},{key:"created$",get:function(){return this._created$}},{key:"glObjectsChanged$",get:function(){return this._glObjectsChanged$}},{key:"geometryChanged$",get:function(){var t=this;return this._geometry.changed$.pipe(De((function(){return t})))}},{key:"dispose",value:function(){this._geometryChangedSubscription.unsubscribe()}},{key:"_canvasToTransform",value:function(t){var e=Math.round(t[0]),n=Math.round(t[1]);return"translate(-50%,-50%) translate(".concat(e,"px,").concat(n,"px)")}},{key:"_colorToBackground",value:function(t){return"#"+("000000"+t.toString(16)).substr(-6)}},{key:"_createOutine",value:function(t,e){var n=this._getLinePositions(t),i=new Uo;return i.setAttribute("position",new xo(n,3)),new xc(i,new vc({color:e,linewidth:1}))}},{key:"_disposeLine",value:function(t){null!=t&&(t.geometry.dispose(),t.material.dispose())}},{key:"_getLinePositions",value:function(t){for(var e=t.length,n=new Float32Array(3*e),i=0;i<e;++i){var r=3*i,a=t[i];n[r]=a[0],n[r+1]=a[1],n[r+2]=a[2]}return n}}]),t}(),sy=ly,uy=ly;function ly(t,e,n){n=n||2;var i,r,a,o,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=cy(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,i){var r,a,o,s=[];for(r=0,a=e.length;r<a;r++)(o=cy(t,e[r]*i,r<a-1?e[r+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),s.push(xy(o));for(s.sort(gy),r=0;r<s.length;r++)yy(s[r],n),n=hy(n,n.next);return n}(t,e,p,n)),t.length>80*n){i=a=t[0],r=o=t[1];for(var d=n;d<h;d+=n)(s=t[d])<i&&(i=s),(u=t[d+1])<r&&(r=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-i,o-r))?1/l:0}return py(p,f,n,i,r,l),f}function cy(t,e,n,i,r){var a,o;if(r===Dy(t,e,n,i)>0)for(a=e;a<n;a+=i)o=Ay(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=Ay(a,t[a],t[a+1],o);return o&&My(o,o.next)&&(Ly(o),o=o.next),o}function hy(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!My(i,i.next)&&0!==ky(i.prev,i,i.next))i=i.next;else{if(Ly(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function py(t,e,n,i,r,a,o){if(t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=by(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,a,o,s,u,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?dy(t,i,r,a):fy(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Ly(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?py(t=vy(hy(t),e,n),e,n,i,r,a,2):2===o&&my(t,e,n,i,r,a):py(hy(t),e,n,i,r,a,1);break}}}function fy(t){var e=t.prev,n=t,i=t.next;if(ky(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(wy(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&ky(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function dy(t,e,n,i){var r=t.prev,a=t,o=t.next;if(ky(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=by(s,u,e,n,i),p=by(l,c,e,n,i),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&wy(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&ky(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&wy(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&ky(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&wy(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&ky(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&wy(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&ky(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function vy(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!My(r,a)&&Ty(r,i,i.next,a)&&Iy(r,a)&&Iy(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),Ly(i),Ly(i.next),i=t=a),i=i.next}while(i!==t);return hy(i)}function my(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Sy(o,s)){var u=Py(o,s);return o=hy(o,o.next),u=hy(u,u.next),py(o,e,n,i,r,a),void py(u,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function gy(t,e){return t.x-e.x}function yy(t,e){if(e=function(t,e){var n,i=e,r=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n;var u,l=n,c=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&wy(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(r-i.x),Iy(i,t)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&_y(n,i)))&&(n=i,p=u)),i=i.next}while(i!==l);return n}(t,e),e){var n=Py(e,t);hy(e,e.next),hy(n,n.next)}}function _y(t,e){return ky(t.prev,t,e.prev)<0&&ky(e.next,t,t.next)<0}function by(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xy(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function wy(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function Sy(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ty(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Iy(t,e)&&Iy(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(ky(t.prev,t,e.prev)||ky(t,e.prev,e))||My(t,e)&&ky(t.prev,t,t.next)>0&&ky(e.prev,e,e.next)>0)}function ky(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function My(t,e){return t.x===e.x&&t.y===e.y}function Ty(t,e,n,i){var r=Cy(ky(t,e,n)),a=Cy(ky(t,e,i)),o=Cy(ky(n,i,t)),s=Cy(ky(n,i,e));return r!==a&&o!==s||(!(0!==r||!Ey(t,n,e))||(!(0!==a||!Ey(t,i,e))||(!(0!==o||!Ey(n,t,i))||!(0!==s||!Ey(n,e,i)))))}function Ey(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Cy(t){return t>0?1:t<0?-1:0}function Iy(t,e){return ky(t.prev,t,t.next)<0?ky(t,e,t.next)>=0&&ky(t,t.prev,e)>=0:ky(t,e,t.prev)<0||ky(t,t.next,e)<0}function Py(t,e){var n=new Ry(t.i,t.x,t.y),i=new Ry(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Ay(t,e,n,i){var r=new Ry(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ly(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ry(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dy(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}ly.deviation=function(t,e,n,i){var r=e&&e.length,a=r?e[0]*n:t.length,o=Math.abs(Dy(t,0,a,n));if(r)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;o-=Math.abs(Dy(t,l,c,n))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,f=i[s+1]*n,d=i[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},ly.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)n.vertices.push(t[r][a][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n},sy.default=uy;var zy=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oy;if(Tt(this,t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}return Ct(t,[{key:"push",value:function(t){this.data.push(t),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}},{key:"_down",value:function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&n(e[s],o)<0&&(a=s,o=e[s]),n(o,r)>=0)break;e[t]=o,t=a}e[t]=r}}]),t}();function Oy(t,e){return t<e?-1:t>e?1:0}var Fy=rv(Object.freeze({__proto__:null,default:zy}));Fy.default&&(Fy=Fy.default);var Ny=jy,By=jy;function jy(t,e,n){var i,r,a,o;e=e||1;for(var s=0;s<t[0].length;s++){var u=t[0][s];(!s||u[0]<i)&&(i=u[0]),(!s||u[1]<r)&&(r=u[1]),(!s||u[0]>a)&&(a=u[0]),(!s||u[1]>o)&&(o=u[1])}var l=a-i,c=o-r,h=Math.min(l,c),p=h/2;if(0===h){var f=[i,r];return f.distance=0,f}for(var d=new Fy(void 0,Vy),v=i;v<a;v+=h)for(var m=r;m<o;m+=h)d.push(new Uy(v+p,m+p,p,t));var g=function(t){for(var e=0,n=0,i=0,r=t[0],a=0,o=r.length,s=o-1;a<o;s=a++){var u=r[a],l=r[s],c=u[0]*l[1]-l[0]*u[1];n+=(u[0]+l[0])*c,i+=(u[1]+l[1])*c,e+=3*c}return 0===e?new Uy(r[0][0],r[0][1],0,t):new Uy(n/e,i/e,0,t)}(t),y=new Uy(i+l/2,r+c/2,0,t);y.d>g.d&&(g=y);for(var _=d.length;d.length;){var b=d.pop();b.d>g.d&&(g=b,n&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,_)),b.max-g.d<=e||(p=b.h/2,d.push(new Uy(b.x-p,b.y-p,p,t)),d.push(new Uy(b.x+p,b.y-p,p,t)),d.push(new Uy(b.x-p,b.y+p,p,t)),d.push(new Uy(b.x+p,b.y+p,p,t)),_+=4)}n&&(console.log("num probes: "+_),console.log("best distance: "+g.d));var x=[g.x,g.y];return x.distance=g.d,x}function Vy(t,e){return e.max-t.max}function Uy(t,e,n,i){this.x=t,this.y=e,this.h=n,this.d=function(t,e,n){for(var i=!1,r=1/0,a=0;a<n.length;a++)for(var o=n[a],s=0,u=o.length,l=u-1;s<u;l=s++){var c=o[s],h=o[l];c[1]>e!==h[1]>e&&t<(h[0]-c[0])*(e-c[1])/(h[1]-c[1])+c[0]&&(i=!i),r=Math.min(r,$y(t,e,c,h))}return 0===r?0:(i?1:-1)*Math.sqrt(r)}(t,e,i),this.max=this.d+this.h*Math.SQRT2}function $y(t,e,n,i){var r=n[0],a=n[1],o=i[0]-r,s=i[1]-a;if(0!==o||0!==s){var u=((t-r)*o+(e-a)*s)/(o*o+s*s);u>1?(r=i[0],a=i[1]):u>0&&(r+=o*u,a+=s*u)}return(o=t-r)*o+(s=e-a)*s}function Hy(t,e){return t>e?1:t<e?-1:0}Ny.default=By;var qy=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hy,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Tt(this,t),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!n}return Ct(t,[{key:"rotateLeft",value:function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e}},{key:"rotateRight",value:function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e}},{key:"_splay",value:function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}}},{key:"splay",value:function(t){for(var e,n,i,r,a;t.parent;)(n=(e=t.parent).parent)&&n.parent?((i=n.parent).left===n?i.left=t:i.right=t,t.parent=i):(t.parent=null,this._root=t),r=t.left,a=t.right,t===e.left?(n&&(n.left===e?(e.right?(n.left=e.right,n.left.parent=n):n.left=null,e.right=n,n.parent=e):(r?(n.right=r,r.parent=n):n.right=null,t.left=n,n.parent=t)),a?(e.left=a,a.parent=e):e.left=null,t.right=e,e.parent=t):(n&&(n.right===e?(e.left?(n.right=e.left,n.right.parent=n):n.right=null,e.left=n,n.parent=e):(a?(n.left=a,a.parent=n):n.left=null,t.right=n,n.parent=t)),r?(e.right=r,r.parent=e):e.right=null,t.left=e,e.parent=t)}},{key:"replace",value:function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)}},{key:"minNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t}},{key:"maxNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t}},{key:"insert",value:function(t,e){var n=this._root,i=null,r=this._compare;if(this._noDuplicates)for(;n;){if(i=n,0===r(n.key,t))return;n=r(n.key,t)<0?n.right:n.left}else for(;n;)i=n,n=r(n.key,t)<0?n.right:n.left;return n={key:t,data:e,left:null,right:null,parent:i},i?r(i.key,n.key)<0?i.right=n:i.left=n:this._root=n,this.splay(n),this._size++,n}},{key:"find",value:function(t){for(var e=this._root,n=this._compare;e;){var i=n(e.key,t);if(i<0)e=e.right;else{if(!(i>0))return e;e=e.left}}return null}},{key:"contains",value:function(t){for(var e=this._root,n=this._compare;e;){var i=n(t,e.key);if(0===i)return!0;e=i<0?e.left:e.right}return!1}},{key:"remove",value:function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var n=this.minNode(e.right);n.parent!==e&&(this.replace(n,n.right),n.right=e.right,n.right.parent=n),this.replace(e,n),n.left=e.left,n.left.parent=n}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}},{key:"removeNode",value:function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}},{key:"erase",value:function(t){var e=this.find(t);if(e){this.splay(e);var n=e.left,i=e.right,r=null;n&&(n.parent=null,r=this.maxNode(n),this.splay(r),this._root=r),i&&(n?r.right=i:this._root=i,i.parent=r),this._size--}}},{key:"pop",value:function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e}},{key:"next",value:function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e}},{key:"prev",value:function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e}},{key:"forEach",value:function(t){for(var e=this._root,n=[],i=!1,r=0;!i;)e?(n.push(e),e=e.left):n.length>0?(t(e=n.pop(),r++),e=e.right):i=!0;return this}},{key:"range",value:function(t,e,n,i){for(var r=[],a=this._compare,o=this._root;0!==r.length||o;)if(o)r.push(o),o=o.left;else{if(a((o=r.pop()).key,e)>0)break;if(a(o.key,t)>=0&&n.call(i,o))return this;o=o.right}return this}},{key:"keys",value:function(){for(var t=this._root,e=[],n=[],i=!1;!i;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.key),t=t.right):i=!0;return n}},{key:"values",value:function(){for(var t=this._root,e=[],n=[],i=!1;!i;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),n.push(t.data),t=t.right):i=!0;return n}},{key:"at",value:function(t){for(var e=this._root,n=[],i=!1,r=0;!i;)if(e)n.push(e),e=e.left;else if(n.length>0){if(e=n.pop(),r===t)return e;r++,e=e.right}else i=!0;return null}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var i=t.length;return n&&Gy(t,e,0,i-1,this._compare),this._root=Wy(null,t,e,0,i),this._size=i,this}},{key:"min",value:function(){var t=this.minNode(this._root);return t?t.key:null}},{key:"max",value:function(){var t=this.maxNode(this._root);return t?t.key:null}},{key:"isEmpty",value:function(){return null===this._root}},{key:"size",get:function(){return this._size}}],[{key:"createTree",value:function(e,n,i,r,a){return new t(i,a).load(e,n,r)}}]),t}();function Wy(t,e,n,i,r){var a=r-i;if(a>0){var o=i+Math.floor(a/2),s={key:e[o],data:n[o],parent:t};return s.left=Wy(s,e,n,i,o),s.right=Wy(s,e,n,o+1,r),s}return null}function Gy(t,e,n,i,r){if(!(n>=i)){for(var a=t[n+i>>1],o=n-1,s=i+1;;){do{o++}while(r(t[o],a)<0);do{s--}while(r(t[s],a)>0);if(o>=s)break;var u=t[o];t[o]=t[s],t[s]=u,u=e[o],e[o]=e[s],e[s]=u}Gy(t,e,n,s,r),Gy(t,e,s+1,i,r)}}function Zy(t,e,n){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!Xy(e,n)||e.isVertical()?e.prevInResult:e));var i=Xy(t,n);t.resultTransition=i?function(t,e){var n,i=!t.inOut,r=!t.otherInOut;switch(e){case 0:n=i&&r;break;case 1:n=i||r;break;case 3:n=i^r;break;case 2:n=t.isSubject?i&&!r:r&&!i}return n?1:-1}(t,n):0}function Xy(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}var Yy=function(){function t(e,n,i,r,a){Tt(this,t),this.left=n,this.point=e,this.otherEvent=i,this.isSubject=r,this.type=a||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}return Ct(t,[{key:"isBelow",value:function(t){var e=this.point,n=this.otherEvent.point;return this.left?(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])>0:(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])>0}},{key:"isAbove",value:function(t){return!this.isBelow(t)}},{key:"isVertical",value:function(){return this.point[0]===this.otherEvent.point[0]}},{key:"inResult",get:function(){return 0!==this.resultTransition}},{key:"clone",value:function(){var e=new t(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}]),t}();function Ky(t,e){return t[0]===e[0]&&t[1]===e[1]}var Jy=134217729;function Qy(t,e,n,i,r){var a,o,s,u,l=e[0],c=i[0],h=0,p=0;c>l===c>-l?(a=l,l=e[++h]):(a=c,c=i[++p]);var f=0;if(h<t&&p<n)for(c>l===c>-l?(s=a-((o=l+a)-l),l=e[++h]):(s=a-((o=c+a)-c),c=i[++p]),a=o,0!==s&&(r[f++]=s);h<t&&p<n;)c>l===c>-l?(s=a-((o=a+l)-(u=o-a))+(l-u),l=e[++h]):(s=a-((o=a+c)-(u=o-a))+(c-u),c=i[++p]),a=o,0!==s&&(r[f++]=s);for(;h<t;)s=a-((o=a+l)-(u=o-a))+(l-u),l=e[++h],a=o,0!==s&&(r[f++]=s);for(;p<n;)s=a-((o=a+c)-(u=o-a))+(c-u),c=i[++p],a=o,0!==s&&(r[f++]=s);return 0===a&&0!==f||(r[f++]=a),f}function t_(t){return new Float64Array(t)}var e_=t_(4),n_=t_(8),i_=t_(12),r_=t_(16),a_=t_(4);function o_(t,e,n,i,r,a){var o=(e-a)*(n-r),s=(t-r)*(i-a),u=o-s;if(0===o||0===s||o>0!==s>0)return u;var l=Math.abs(o+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(t,e,n,i,r,a,o){var s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M=t-r,T=n-r,E=e-a,C=i-a;h=(x=(d=M-(f=(p=Jy*M)-(p-M)))*(m=C-(v=(p=Jy*C)-(p-C)))-((b=M*C)-f*v-d*v-f*m))-(g=x-(S=(d=E-(f=(p=Jy*E)-(p-E)))*(m=T-(v=(p=Jy*T)-(p-T)))-((w=E*T)-f*v-d*v-f*m))),e_[0]=x-(g+h)+(h-S),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-w),e_[1]=_-(g+h)+(h-w),h=(k=y+g)-y,e_[2]=y-(k-h)+(g-h),e_[3]=k;var I=function(t,e){for(var n=e[0],i=1;i<t;i++)n+=e[i];return n}(4,e_),P=22204460492503146e-32*o;if(I>=P||-I>=P)return I;if(s=t-(M+(h=t-M))+(h-r),l=n-(T+(h=n-T))+(h-r),u=e-(E+(h=e-E))+(h-a),c=i-(C+(h=i-C))+(h-a),0===s&&0===u&&0===l&&0===c)return I;if(P=11093356479670487e-47*o+33306690738754706e-32*Math.abs(I),(I+=M*c+C*s-(E*l+T*u))>=P||-I>=P)return I;h=(x=(d=s-(f=(p=Jy*s)-(p-s)))*(m=C-(v=(p=Jy*C)-(p-C)))-((b=s*C)-f*v-d*v-f*m))-(g=x-(S=(d=u-(f=(p=Jy*u)-(p-u)))*(m=T-(v=(p=Jy*T)-(p-T)))-((w=u*T)-f*v-d*v-f*m))),a_[0]=x-(g+h)+(h-S),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-w),a_[1]=_-(g+h)+(h-w),h=(k=y+g)-y,a_[2]=y-(k-h)+(g-h),a_[3]=k;var A=Qy(4,e_,4,a_,n_);h=(x=(d=M-(f=(p=Jy*M)-(p-M)))*(m=c-(v=(p=Jy*c)-(p-c)))-((b=M*c)-f*v-d*v-f*m))-(g=x-(S=(d=E-(f=(p=Jy*E)-(p-E)))*(m=l-(v=(p=Jy*l)-(p-l)))-((w=E*l)-f*v-d*v-f*m))),a_[0]=x-(g+h)+(h-S),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-w),a_[1]=_-(g+h)+(h-w),h=(k=y+g)-y,a_[2]=y-(k-h)+(g-h),a_[3]=k;var L=Qy(A,n_,4,a_,i_);h=(x=(d=s-(f=(p=Jy*s)-(p-s)))*(m=c-(v=(p=Jy*c)-(p-c)))-((b=s*c)-f*v-d*v-f*m))-(g=x-(S=(d=u-(f=(p=Jy*u)-(p-u)))*(m=l-(v=(p=Jy*l)-(p-l)))-((w=u*l)-f*v-d*v-f*m))),a_[0]=x-(g+h)+(h-S),h=(_=b-((y=b+g)-(h=y-b))+(g-h))-(g=_-w),a_[1]=_-(g+h)+(h-w),h=(k=y+g)-y,a_[2]=y-(k-h)+(g-h),a_[3]=k;var R=Qy(L,i_,4,a_,r_);return r_[R-1]}(t,e,n,i,r,a,l)}function s_(t,e,n){var i=o_(t[0],t[1],e[0],e[1],n[0],n[1]);return i>0?-1:i<0?1:0}function u_(t,e){var n=t.point,i=e.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:function(t,e,n,i){if(t.left!==e.left)return t.left?1:-1;if(0!==s_(n,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,n)}function l_(t,e,n){var i=new Yy(e,!1,t,t.isSubject),r=new Yy(e,!0,t.otherEvent,t.isSubject);return Ky(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),i.contourId=r.contourId=t.contourId,u_(r,t.otherEvent)>0&&(t.otherEvent.left=!0,r.left=!1),t.otherEvent.otherEvent=r,t.otherEvent=i,n.push(r),n.push(i),n}function c_(t,e){return t[0]*e[1]-t[1]*e[0]}function h_(t,e){return t[0]*e[0]+t[1]*e[1]}function p_(t,e,n){var i=function(t,e,n,i,r){var a=[e[0]-t[0],e[1]-t[1]],o=[i[0]-n[0],i[1]-n[1]];function s(t,e,n){return[t[0]+e*n[0],t[1]+e*n[1]]}var u=[n[0]-t[0],n[1]-t[1]],l=c_(a,o),c=l*l,h=h_(a,a);if(c>0){var p=c_(u,o)/l;if(p<0||p>1)return null;var f=c_(u,a)/l;return f<0||f>1?null:0===p||1===p?r?null:[s(t,p,a)]:0===f||1===f?r?null:[s(n,f,o)]:[s(t,p,a)]}if((c=(l=c_(u,a))*l)>0)return null;var d=h_(a,u)/h,v=d+h_(a,o)/h,m=Math.min(d,v),g=Math.max(d,v);return m<=1&&g>=0?1===m?r?null:[s(t,m>0?m:0,a)]:0===g?r?null:[s(t,g<1?g:1,a)]:r&&0===m&&1===g?null:[s(t,m>0?m:0,a),s(t,g<1?g:1,a)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),r=i?i.length:0;if(0===r)return 0;if(1===r&&(Ky(t.point,e.point)||Ky(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===r&&t.isSubject===e.isSubject)return 0;if(1===r)return Ky(t.point,i[0])||Ky(t.otherEvent.point,i[0])||l_(t,i[0],n),Ky(e.point,i[0])||Ky(e.otherEvent.point,i[0])||l_(e,i[0],n),1;var a=[],o=!1,s=!1;return Ky(t.point,e.point)?o=!0:1===u_(t,e)?a.push(e,t):a.push(t,e),Ky(t.otherEvent.point,e.otherEvent.point)?s=!0:1===u_(t.otherEvent,e.otherEvent)?a.push(e.otherEvent,t.otherEvent):a.push(t.otherEvent,e.otherEvent),o&&s||o?(e.type=1,t.type=e.inOut===t.inOut?2:3,o&&!s&&l_(a[1].otherEvent,a[0].point,n),2):s?(l_(a[0],a[1].point,n),3):a[0]!==a[3].otherEvent?(l_(a[0],a[1].point,n),l_(a[1],a[2].point,n),3):(l_(a[0],a[1].point,n),l_(a[3].otherEvent,a[2].point,n),3)}function f_(t,e){if(t===e)return 0;if(0!==s_(t.point,t.otherEvent.point,e.point)||0!==s_(t.point,t.otherEvent.point,e.otherEvent.point))return Ky(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===u_(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var n=t.point,i=e.point;return n[0]===i[0]&&n[1]===i[1]?(n=t.otherEvent.point,i=e.otherEvent.point,n[0]===i[0]&&n[1]===i[1]?0:t.contourId>e.contourId?1:-1):1===u_(t,e)?1:-1}var d_=function(){function t(){Tt(this,t),this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}return Ct(t,[{key:"isExterior",value:function(){return null==this.holeOf}}]),t}();function v_(t,e,n,i){var r,a=t+1,o=e[t].point,s=e.length;for(a<s&&(r=e[a].point);a<s&&r[0]===o[0]&&r[1]===o[1];){if(!n[a])return a;r=e[++a].point}for(a=t-1;n[a]&&a>i;)a--;return a}function m_(t){var e,n,i=function(t){var e,n,i,r,a=[];for(n=0,i=t.length;n<i;n++)((e=t[n]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&a.push(e);for(var o=!1;!o;)for(o=!0,n=0,i=a.length;n<i;n++)n+1<i&&1===u_(a[n],a[n+1])&&(r=a[n],a[n]=a[n+1],a[n+1]=r,o=!1);for(n=0,i=a.length;n<i;n++)(e=a[n]).otherPos=n;for(n=0,i=a.length;n<i;n++)(e=a[n]).left||(r=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=r);return a}(t),r={},a=[],o=function(){if(r[e])return"continue";var t=a.length,n=function(t,e,n){var i=new d_;if(null!=t.prevInResult){var r=t.prevInResult,a=r.outputContourId;if(r.resultTransition>0){var o=e[a];if(null!=o.holeOf){var s=o.holeOf;e[s].holeIds.push(n),i.holeOf=s,i.depth=e[a].depth}else e[a].holeIds.push(n),i.holeOf=a,i.depth=e[a].depth+1}else i.holeOf=null,i.depth=e[a].depth}else i.holeOf=null,i.depth=0;return i}(i[e],a,t),o=function(e){r[e]=!0,i[e].outputContourId=t},s=e,u=e,l=i[e].point;for(n.points.push(l);o(s),o(s=i[s].otherPos),n.points.push(i[s].point),(s=v_(s,i,r,u))!=u;);a.push(n)};for(e=0,n=i.length;e<n;e++)o();return a}var g_=__,y_=__;function __(t,e){if(!(this instanceof __))return new __(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||b_,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function b_(t,e){return t<e?-1:t>e?1:0}__.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i},_down:function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var a=1+(t<<1),o=a+1,s=e[a];if(o<this.length&&n(e[o],s)<0&&(a=o,s=e[o]),n(s,r)>=0)break;e[t]=s,t=a}e[t]=r}},g_.default=y_;var x_=Math.max,w_=Math.min,S_=0;function k_(t,e,n,i,r,a){var o,s,u,l,c,h;for(o=0,s=t.length-1;o<s;o++)if(u=t[o],l=t[o+1],c=new Yy(u,!1,void 0,e),h=new Yy(l,!1,c,e),c.otherEvent=h,u[0]!==l[0]||u[1]!==l[1]){c.contourId=h.contourId=n,a||(c.isExteriorRing=!1,h.isExteriorRing=!1),u_(c,h)>0?h.left=!0:c.left=!0;var p=u[0],f=u[1];r[0]=w_(r[0],p),r[1]=w_(r[1],f),r[2]=x_(r[2],p),r[3]=x_(r[3],f),i.push(c),i.push(h)}}var M_=[];function T_(t,e,n){"number"===typeof t[0][0][0]&&(t=[t]),"number"===typeof e[0][0][0]&&(e=[e]);var i=function(t,e,n){var i=null;return t.length*e.length===0&&(0===n?i=M_:2===n?i=t:1!==n&&3!==n||(i=0===t.length?e:t)),i}(t,e,n);if(i)return i===M_?null:i;var r=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],o=function(t,e,n,i,r){var a,o,s,u,l,c,h=new g_(null,u_);for(s=0,u=t.length;s<u;s++)for(l=0,c=(a=t[s]).length;l<c;l++)(o=0===l)&&S_++,k_(a[l],!0,S_,h,n,o);for(s=0,u=e.length;s<u;s++)for(l=0,c=(a=e[s]).length;l<c;l++)o=0===l,2===r&&(o=!1),o&&S_++,k_(a[l],!1,S_,h,i,o);return h}(t,e,r,a,n);if(i=function(t,e,n,i,r){var a=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(0===r?a=M_:2===r?a=t:1!==r&&3!==r||(a=t.concat(e))),a}(t,e,r,a,n),i)return i===M_?null:i;for(var s=function(t,e,n,i,r,a){for(var o,s,u,l=new qy(f_),c=[],h=Math.min(i[2],r[2]);0!==t.length;){var p=t.pop();if(c.push(p),0===a&&p.point[0]>h||2===a&&p.point[0]>i[2])break;if(p.left){s=o=l.insert(p),o=o!==(u=l.minNode())?l.prev(o):null,s=l.next(s);var f=o?o.key:null;if(Zy(p,f,a),s&&2===p_(p,s.key,t)&&(Zy(p,f,a),Zy(p,s.key,a)),o&&2===p_(o.key,p,t)){var d=o;Zy(f,(d=d!==u?l.prev(d):null)?d.key:null,a),Zy(p,f,a)}}else p=p.otherEvent,s=o=l.find(p),o&&s&&(o=o!==u?l.prev(o):null,s=l.next(s),l.remove(p),s&&o&&p_(o.key,s.key,t))}return c}(o,0,0,r,a,n),u=m_(s),l=[],c=0;c<u.length;c++){var h=u[c];if(h.isExterior()){for(var p=[h.points],f=0;f<h.holeIds.length;f++){var d=h.holeIds[f];p.push(u[d].points)}l.push(p)}}return l}var E_,C_,I_=function(t){kt(n,t);var e=Mt(n);function n(){var t;return Tt(this,n),(t=e.call(this))._subsampleThreshold=.005,t}return Ct(n,[{key:"_getPoleOfInaccessibility2d",value:function(t){return Ny([t],.03)}},{key:"_project",value:function(t,e){var n=this._createCamera(e.upVector().toArray(),e.unprojectSfM([0,0],0),e.unprojectSfM([0,0],10));return this._deunproject(t,e,n)}},{key:"_subsample",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._subsampleThreshold,n=[],i=t.length,r=0;r<i;r++){var a=t[r],o=t[(r+1)%i];n.push(a);for(var s=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)),u=Math.floor(s/e),l=1/(u+1),c=1;c<=u;c++){var h=c*l,p=[(1-h)*a[0]+h*o[0],(1-h)*a[1]+h*o[1]];n.push(p)}}return n}},{key:"_triangulate",value:function(t,e,n,i){var r,a=[t.slice(0,-1)],o=wt(null!=n?n:[]);try{for(o.s();!(r=o.n()).done;){var s=r.value;a.push(s.slice(0,-1))}}catch(Tx){o.e(Tx)}finally{o.f()}var u,l=e.slice(0,-1),c=wt(null!=i?i:[]);try{for(c.s();!(u=c.n()).done;){var h=u.value;l=l.concat(h.slice(0,-1))}}catch(Tx){c.e(Tx)}finally{c.f()}for(var p=sy.flatten(a),f=sy(p.vertices,p.holes,p.dimensions),d=[],v=0;v<f.length;++v){var m=l[f[v]];d.push(m[0]),d.push(m[1]),d.push(m[2])}return d}},{key:"_triangulateSpherical",value:function(t,e,n){for(var i=[],r=1e-9,a=0;a<3;a++)for(var o=0;o<3;o++){var s=a/3+(0===a?-1e-9:r),u=o/3+(0===o?-1e-9:r),l=(a+1)/3+r,c=(o+1)/3+r,h=[[s,u],[s,c],[l,c],[l,u],[s,u]],p=[(2*a+1)/6,(2*o+1)/6];i.push.apply(i,vt(this._triangulateSubarea(t,e,h,p,n)))}return i}},{key:"_unproject",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;return t.map((function(t){return e.unprojectBasic(t,n)}))}},{key:"_createCamera",value:function(t,e,n){var i=new fs;return i.up.copy((new Wr).fromArray(t)),i.position.copy((new Wr).fromArray(e)),i.lookAt((new Wr).fromArray(n)),i.updateMatrix(),i.updateMatrixWorld(!0),i}},{key:"_deunproject",value:function(t,e,n){return t.map((function(t){var i=e.unprojectBasic(t,1e4),r=new Wr(i[0],i[1],i[2]).applyMatrix4(n.matrixWorldInverse);return[r.x/r.z,r.y/r.z]}))}},{key:"_triangulateSubarea",value:function(t,e,n,i,r){var a=T_([t].concat(vt(e)),[n],0);if(!a)return[];var o,s=[],u=this._subsampleThreshold,l=this._createCamera(r.upVector().toArray(),r.unprojectSfM([0,0],0),r.unprojectBasic(i,10)),c=wt(a);try{for(c.s();!(o=c.n()).done;){for(var h=o.value,p=this._subsample(h[0],u),f=this._deunproject(p,r,l),d=this._unproject(p,r),v=[],m=[],g=1;g<h.length;g++){var y=this._subsample(h[g],u),_=this._deunproject(y,r,l),b=this._unproject(y,r);v.push(_),m.push(b)}s.push.apply(s,vt(this._triangulate(f,d,v,m)))}}catch(Tx){c.e(Tx)}finally{c.f()}return s}}]),n}(iy),P_=function(t){kt(n,t);var e=Mt(n);function n(t){var i;if(Tt(this,n),i=e.call(this),4!==t.length)throw new ry("Rectangle needs to have four values.");if(t[1]>t[3])throw new ry("Basic Y coordinates values can not be inverted.");var r,a=wt(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o<0||o>1)throw new ry("Basic coordinates must be on the interval [0, 1].")}}catch(Tx){a.e(Tx)}finally{a.f()}return i._anchorIndex=void 0,i._rect=t.slice(0,4),i._inverted=i._rect[0]>i._rect[2],i}return Ct(n,[{key:"anchorIndex",get:function(){return this._anchorIndex}},{key:"inverted",get:function(){return this._inverted}},{key:"rect",get:function(){return this._rect}},{key:"initializeAnchorIndexing",value:function(t){if(void 0!==this._anchorIndex)throw new ry("Anchor indexing is already initialized.");if(t<0||t>3)throw new ry("Invalid anchor index: ".concat(t,"."));this._anchorIndex=void 0===t?0:t}},{key:"terminateAnchorIndexing",value:function(){this._anchorIndex=void 0}},{key:"setOppositeVertex2d",value:function(t,e){if(void 0===this._anchorIndex)throw new ry("Anchor indexing needs to be initialized.");var n=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],i=this._rect.slice(),r=0===this._anchorIndex?[i[0],i[3]]:1===this._anchorIndex?[i[0],i[1]]:2===this._anchorIndex?[i[2],i[1]]:[i[2],i[3]];if(Zf(e.cameraType)){var a=this._anchorIndex<2?n[0]-i[2]:n[0]-i[0];!this._inverted&&this._anchorIndex<2&&n[0]<.25&&i[2]>.75&&a<-.5||!this._inverted&&this._anchorIndex>=2&&n[0]<.25&&i[2]>.75&&a<-.5?(this._inverted=!0,this._anchorIndex=r[1]>n[1]?0:1):this._inverted&&this._anchorIndex>=2&&n[0]<.25&&i[0]>.75&&a<-.5?(this._inverted=!1,this._anchorIndex=r[0]>n[0]?r[1]>n[1]?3:2:r[1]>n[1]?0:1):!this._inverted&&this._anchorIndex>=2&&n[0]>.75&&i[0]<.25&&a>.5||!this._inverted&&this._anchorIndex<2&&n[0]>.75&&i[0]<.25&&a>.5?(this._inverted=!0,this._anchorIndex=r[1]>n[1]?3:2):this._inverted&&this._anchorIndex<2&&n[0]>.75&&i[2]<.25&&a>.5?(this._inverted=!1,this._anchorIndex=r[0]>n[0]?r[1]>n[1]?3:2:r[1]>n[1]?0:1):this._inverted&&this._anchorIndex<2&&n[0]>i[0]?(this._inverted=!1,this._anchorIndex=r[1]>n[1]?0:1):this._inverted&&this._anchorIndex>=2&&n[0]<i[2]?(this._inverted=!1,this._anchorIndex=r[1]>n[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=r[1]>n[1]?0:1:this._anchorIndex=r[1]>n[1]?3:2:this._anchorIndex=r[0]<=n[0]&&r[1]>n[1]?0:r[0]<=n[0]&&r[1]<=n[1]?1:r[0]>n[0]&&r[1]<=n[1]?2:3;var o=[];0===this._anchorIndex?(o[0]=r[0],o[1]=n[1],o[2]=n[0],o[3]=r[1]):1===this._anchorIndex?(o[0]=r[0],o[1]=r[1],o[2]=n[0],o[3]=n[1]):2===this._anchorIndex?(o[0]=n[0],o[1]=r[1],o[2]=r[0],o[3]=n[1]):(o[0]=n[0],o[1]=n[1],o[2]=r[0],o[3]=r[1]),(!this._inverted&&o[0]>o[2]||this._inverted&&o[0]<o[2])&&(o[0]=i[0],o[2]=i[2]),o[1]>o[3]&&(o[1]=i[1],o[3]=i[3]),this._rect[0]=o[0],this._rect[1]=o[1],this._rect[2]=o[2],this._rect[3]=o[3]}else{this._anchorIndex=r[0]<=n[0]&&r[1]>n[1]?0:r[0]<=n[0]&&r[1]<=n[1]?1:r[0]>n[0]&&r[1]<=n[1]?2:3;var s=[];0===this._anchorIndex?(s[0]=r[0],s[1]=n[1],s[2]=n[0],s[3]=r[1]):1===this._anchorIndex?(s[0]=r[0],s[1]=r[1],s[2]=n[0],s[3]=n[1]):2===this._anchorIndex?(s[0]=n[0],s[1]=r[1],s[2]=r[0],s[3]=n[1]):(s[0]=n[0],s[1]=n[1],s[2]=r[0],s[3]=r[1]),s[0]>s[2]&&(s[0]=i[0],s[2]=i[2]),s[1]>s[3]&&(s[1]=i[1],s[3]=i[3]),this._rect[0]=s[0],this._rect[1]=s[1],this._rect[2]=s[2],this._rect[3]=s[3]}this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(t,e,n){var i=this._rect.slice(),r=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],a=[];if(0===t?(a[0]=r[0],a[1]=i[1],a[2]=i[2],a[3]=r[1]):1===t?(a[0]=r[0],a[1]=r[1],a[2]=i[2],a[3]=i[3]):2===t?(a[0]=i[0],a[1]=r[1],a[2]=r[0],a[3]=i[3]):3===t&&(a[0]=i[0],a[1]=i[1],a[2]=r[0],a[3]=r[1]),Zf(n.cameraType)){var o=t<2&&r[0]>.75&&i[0]<.25||t>=2&&this._inverted&&r[0]>.75&&i[2]<.25,s=t<2&&this._inverted&&r[0]<.25&&i[0]>.75||t>=2&&r[0]<.25&&i[2]>.75;o||s?this._inverted=!this._inverted:(a[0]-i[0]<-.25&&(a[0]=i[0]),a[2]-i[2]>.25&&(a[2]=i[2])),(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2])&&(a[0]=i[0],a[2]=i[2])}else a[0]>a[2]&&(a[0]=i[0],a[2]=i[2]);a[1]>a[3]&&(a[1]=i[1],a[3]=i[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3],this._notifyChanged$.next(this)}},{key:"setCentroid2d",value:function(t,e){var n=this._rect.slice(),i=n[0],r=this._inverted?n[2]+1:n[2],a=n[1],o=n[3],s=i+(r-i)/2,u=a+(o-a)/2,l=0;if(Zf(e.cameraType))l=this._inverted?t[0]+1-s:t[0]-s;else{var c=-i,h=1-r;l=Math.max(c,Math.min(h,t[0]-s))}var p=-a,f=1-o,d=Math.max(p,Math.min(f,t[1]-u));this._rect[0]=n[0]+l,this._rect[1]=n[1]+d,this._rect[2]=n[2]+l,this._rect[3]=n[3]+d,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(t){return this._getPoints2d().map((function(e){return t.unprojectBasic(e,200)}))}},{key:"getVertex2d",value:function(t){return this._rectToVertices2d(this._rect)[t]}},{key:"getNonAdjustedVertex2d",value:function(t){return this._rectToNonAdjustedVertices2d(this._rect)[t]}},{key:"getVertex3d",value:function(t,e){return e.unprojectBasic(this._rectToVertices2d(this._rect)[t],200)}},{key:"getVertices2d",value:function(){return this._rectToVertices2d(this._rect)}},{key:"getVertices3d",value:function(t){return this._rectToVertices2d(this._rect).map((function(e){return t.unprojectBasic(e,200)}))}},{key:"getCentroid2d",value:function(){var t=this._rect;return[(t[0]+(this._inverted?t[2]+1:t[2]))/2,(t[1]+t[3])/2]}},{key:"getCentroid3d",value:function(t){var e=this.getCentroid2d();return t.unprojectBasic(e,200)}},{key:"getPoleOfInaccessibility2d",value:function(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}},{key:"getPoleOfInaccessibility3d",value:function(t){var e=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return t.unprojectBasic(e,200)}},{key:"getTriangles3d",value:function(t){return Zf(t.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),t),this.getPoints3d(t))}},{key:"validate",value:function(t){var e=this._rect;return!(!this._inverted&&t[0]<e[0]||t[0]-e[2]>.25||t[1]<e[1])}},{key:"_getPoints2d",value:function(){for(var t=this._rectToVertices2d(this._rect),e=t.length-1,n=[],i=0;i<e;++i)for(var r=t[i][0],a=t[i][1],o=(t[i+1][0]-r)/9,s=(t[i+1][1]-a)/9,u=0;u<10;++u){var l=[r+u*o,a+u*s];n.push(l)}return n}},{key:"_rectToVertices2d",value:function(t){return[[t[0],t[3]],[t[0],t[1]],[this._inverted?t[2]+1:t[2],t[1]],[this._inverted?t[2]+1:t[2],t[3]],[t[0],t[3]]]}},{key:"_rectToNonAdjustedVertices2d",value:function(t){return[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]}}]),n}(I_),A_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,r,a))._options={color:null==i.color?16777215:i.color,indicateCompleter:null==i.indicateCompleter||i.indicateCompleter},o._rectGeometry=new P_(o._geometry.getRect2d(r)),o._createGlObjects(),o}return Ct(n,[{key:"create",value:function(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}},{key:"dispose",value:function(){xt(mt(n.prototype),"dispose",this).call(this),this._disposeObjects()}},{key:"getDOMObjects",value:function(t,e){for(var n=this,i={offsetHeight:e.height,offsetWidth:e.width},r=[],a=this._geometry.getPoints2d(),o=a.length,s=function(e){var s=e,u=rt(a[e],2),l=u[0],c=u[1],h=n._viewportCoords.basicToCanvasSafe(l,c,i,n._transform,t);if(!h)return"continue";var p=n._canvasToTransform(h),f={onclick:0===e&&o<3?function(t){t.stopPropagation(),n._aborted$.next(n)}:function(t){t.stopPropagation(),n._geometry.removePoint2d(s)},style:{transform:p}};r.push(wm.h("div.mapillary-tag-interactor",f,[]));var d={style:{background:n._colorToBackground(n._options.color),transform:p}};r.push(wm.h("div.mapillary-tag-vertex",d,[]))},u=0;u<o-1;u++)s(u);if(o>2&&!0===this._options.indicateCompleter){var l=rt(this._geometry.getCentroid2d(this._transform),2),c=l[0],h=l[1],p=this._viewportCoords.basicToCanvasSafe(c,h,i,this._transform,t);if(p){var f=this._canvasToTransform(p),d={onclick:function(t){t.stopPropagation(),n._geometry.removePoint2d(n._geometry.points.length-1),n._created$.next(n)},style:{transform:f}};r.push(wm.h("div.mapillary-tag-completer.mapillary-tag-larger",d,[]));var v={style:{background:this._colorToBackground(this._options.color),transform:f}};r.push(wm.h("div.mapillary-tag-vertex.mapillary-tag-larger",v,[]));var m={style:{transform:f}};r.push(wm.h("div.mapillary-tag-dot",m,[]))}}return r}},{key:"_onGeometryChanged",value:function(){this._disposeObjects(),this._rectGeometry=new P_(this._geometry.getRect2d(this._transform)),this._createGlObjects()}},{key:"_createGlObjects",value:function(){this._glObjects=[];var t=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(t,this._options.color),this._glObjects.push(this._outline)}},{key:"_disposeObjects",value:function(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}]),n}(oy),L_=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;Tt(this,n),r=e.call(this);var a=t.length;if(a<3)throw new ry("A polygon must have three or more positions.");if(t[0][0]!==t[a-1][0]||t[0][1]!==t[a-1][1])throw new ry("First and last positions must be equivalent.");r._polygon=[];var o,s=wt(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u[0]<0||u[0]>1||u[1]<0||u[1]>1)throw new ry("Basic coordinates of polygon must be on the interval [0, 1].");r._polygon.push(u.slice())}}catch(Tx){s.e(Tx)}finally{s.f()}if(r._holes=[],null==i)return dt(r);for(var l=0;l<i.length;l++){var c=i[l],h=c.length;if(h<3)throw new ry("A polygon hole must have three or more positions.");if(c[0][0]!==c[h-1][0]||c[0][1]!==c[h-1][1])throw new ry("First and last positions of hole must be equivalent.");r._holes.push([]);var p,f=wt(c);try{for(f.s();!(p=f.n()).done;){var d=p.value;if(d[0]<0||d[0]>1||d[1]<0||d[1]>1)throw new ry("Basic coordinates of hole must be on the interval [0, 1].");r._holes[l].push(d.slice())}}catch(Tx){f.e(Tx)}finally{f.f()}}return r}return Ct(n,[{key:"polygon",get:function(){return this._polygon}},{key:"holes",get:function(){return this._holes}},{key:"addVertex2d",value:function(t){var e=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._polygon.splice(this._polygon.length-1,0,e),this._notifyChanged$.next(this)}},{key:"getVertex2d",value:function(t){return this._polygon[t].slice()}},{key:"removeVertex2d",value:function(t){if(t<0||t>=this._polygon.length||this._polygon.length<4)throw new ry("Index for removed vertex must be valid.");if(t>0&&t<this._polygon.length-1)this._polygon.splice(t,1);else{this._polygon.splice(0,1),this._polygon.pop();var e=this._polygon[0].slice();this._polygon.push(e)}this._notifyChanged$.next(this)}},{key:"setVertex2d",value:function(t,e,n){var i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];0===t||t===this._polygon.length-1?(this._polygon[0]=i.slice(),this._polygon[this._polygon.length-1]=i.slice()):this._polygon[t]=i.slice(),this._notifyChanged$.next(this)}},{key:"setCentroid2d",value:function(t,e){var n,i=this._polygon.map((function(t){return t[0]})),r=this._polygon.map((function(t){return t[1]})),a=Math.min.apply(Math,i),o=Math.max.apply(Math,i),s=Math.min.apply(Math,r),u=Math.max.apply(Math,r),l=this.getCentroid2d(),c=-a,h=1-o,p=-s,f=1-u,d=Math.max(c,Math.min(h,t[0]-l[0])),v=Math.max(p,Math.min(f,t[1]-l[1])),m=wt(this._polygon);try{for(m.s();!(n=m.n()).done;){var g=n.value;g[0]+=d,g[1]+=v}}catch(Tx){m.e(Tx)}finally{m.f()}this._notifyChanged$.next(this)}},{key:"getPoints3d",value:function(t){return this._getPoints3d(this._subsample(this._polygon),t)}},{key:"getVertex3d",value:function(t,e){return e.unprojectBasic(this._polygon[t],200)}},{key:"getVertices2d",value:function(){return this._polygon.slice()}},{key:"getVertices3d",value:function(t){return this._getPoints3d(this._polygon,t)}},{key:"getHolePoints3d",value:function(t){var e=this;return this._holes.map((function(n){return e._getPoints3d(e._subsample(n),t)}))}},{key:"getHoleVertices3d",value:function(t){var e=this;return this._holes.map((function(n){return e._getPoints3d(n,t)}))}},{key:"getCentroid2d",value:function(){for(var t=this._polygon,e=0,n=0,i=0,r=0;r<t.length-1;r++){var a=t[r][0],o=t[r][1],s=t[r+1][0],u=t[r+1][1],l=a*u-s*o;e+=l,n+=(a+s)*l,i+=(o+u)*l}return[n/=6*(e/=2),i/=6*e]}},{key:"getCentroid3d",value:function(t){var e=this.getCentroid2d();return t.unprojectBasic(e,200)}},{key:"get3dDomainTriangles3d",value:function(t){var e=this;return this._triangulate(this._project(this._polygon,t),this.getVertices3d(t),this._holes.map((function(n){return e._project(n,t)})),this.getHoleVertices3d(t))}},{key:"getTriangles3d",value:function(t){var e=this;if(Zf(t.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),t);var n=this._project(this._subsample(this._polygon),t),i=this.getPoints3d(t),r=this._holes.map((function(n){return e._project(e._subsample(n),t)})),a=this.getHolePoints3d(t);return this._triangulate(n,i,r,a)}},{key:"getPoleOfInaccessibility2d",value:function(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}},{key:"getPoleOfInaccessibility3d",value:function(t){var e=this._getPoleOfInaccessibility2d(this._polygon.slice());return t.unprojectBasic(e,200)}},{key:"_getPoints3d",value:function(t,e){return t.map((function(t){return e.unprojectBasic(t,200)}))}}]),n}(I_),R_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,r,a))._options={color:null==i.color?16777215:i.color},o._createGlObjects(),o}return Ct(n,[{key:"create",value:function(){if(this._geometry instanceof P_)this._created$.next(this);else if(this._geometry instanceof L_){var t=this._geometry;t.removeVertex2d(t.polygon.length-2),this._created$.next(this)}}},{key:"dispose",value:function(){xt(mt(n.prototype),"dispose",this).call(this),this._disposeLine(this._outline),this._disposeObjects()}},{key:"getDOMObjects",value:function(t,e){var n=this,i=[],r={offsetHeight:e.height,offsetWidth:e.width},a=function(t){t.stopPropagation(),n._aborted$.next(n)};if(this._geometry instanceof P_){var o=this._geometry.anchorIndex,s=void 0===o?1:o,u=rt(this._geometry.getVertex2d(s),2),l=u[0],c=u[1],h=this._viewportCoords.basicToCanvasSafe(l,c,r,this._transform,t);if(null!=h){var p=this._colorToBackground(this._options.color),f=this._canvasToTransform(h),d={style:{background:p,transform:f}},v={onclick:a,style:{transform:f}};i.push(wm.h("div.mapillary-tag-interactor",v,[])),i.push(wm.h("div.mapillary-tag-vertex",d,[]))}}else if(this._geometry instanceof L_){var m=this._geometry,g=rt(m.getVertex2d(0),2),y=g[0],_=g[1],b=this._viewportCoords.basicToCanvasSafe(y,_,r,this._transform,t);if(null!=b){var x={onclick:m.polygon.length>4?function(t){t.stopPropagation(),m.removeVertex2d(m.polygon.length-2),n._created$.next(n)}:a,style:{transform:this._canvasToTransform(b)}},w=m.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";i.push(wm.h("div."+w,x,[]))}if(m.polygon.length>3){var S=rt(m.getVertex2d(m.polygon.length-3),2),k=S[0],M=S[1],T=this._viewportCoords.basicToCanvasSafe(k,M,r,this._transform,t);if(null!=T){var E={onclick:function(t){t.stopPropagation(),m.removeVertex2d(m.polygon.length-3)},style:{transform:this._canvasToTransform(T)}};i.push(wm.h("div.mapillary-tag-interactor",E,[]))}}var C=m.polygon.slice();C.splice(-2,2);var I,P=wt(C);try{for(P.s();!(I=P.n()).done;){var A=I.value,L=this._viewportCoords.basicToCanvasSafe(A[0],A[1],r,this._transform,t);if(null!=L){var R={style:{background:this._colorToBackground(this._options.color),transform:this._canvasToTransform(L)}};i.push(wm.h("div.mapillary-tag-vertex",R,[]))}}}catch(Tx){P.e(Tx)}finally{P.f()}}return i}},{key:"addPoint",value:function(t){if(this._geometry instanceof P_){if(!this._geometry.validate(t))return;this._created$.next(this)}else if(this._geometry instanceof L_){this._geometry.addVertex2d(t)}}},{key:"_onGeometryChanged",value:function(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}},{key:"_disposeObjects",value:function(){this._outline=null,this._glObjects=[]}},{key:"_createGlObjects",value:function(){var t=this._geometry instanceof P_?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(t,this._options.color),this._glObjects=[this._outline]}}]),n}(oy),D_=function(){function t(e,n){Tt(this,t),this._component=e,this._navigator=n,this._tagOperation$=new te,this._createPoints$=new te,this._createPolygon$=new te,this._createRect$=new te,this._delete$=new te,this._tag$=this._tagOperation$.pipe(li((function(t,e){return e(t)}),null),Ei()),this._replayedTag$=this._tag$.pipe(bi(1),ne()),this._replayedTag$.subscribe(),this._createPoints$.pipe(Ki(this._component.configuration$,this._navigator.stateService.currentTransform$),De((function(t){var e=rt(t,3),n=e[0],i=e[1],r=e[2];return function(){var t=new ay([[n[0],n[1]],[n[0],n[1]]]);return new A_(t,{color:i.createColor,indicateCompleter:i.indicatePointsCompleter},r)}}))).subscribe(this._tagOperation$),this._createRect$.pipe(Ki(this._component.configuration$,this._navigator.stateService.currentTransform$),De((function(t){var e=rt(t,3),n=e[0],i=e[1],r=e[2];return function(){var t=new P_([n[0],n[1],n[0],n[1]]);return new R_(t,{color:i.createColor},r)}}))).subscribe(this._tagOperation$),this._createPolygon$.pipe(Ki(this._component.configuration$,this._navigator.stateService.currentTransform$),De((function(t){var e=rt(t,3),n=e[0],i=e[1],r=e[2];return function(){var t=new L_([[n[0],n[1]],[n[0],n[1]],[n[0],n[1]]]);return new R_(t,{color:i.createColor},r)}}))).subscribe(this._tagOperation$),this._delete$.pipe(De((function(){return function(){return null}}))).subscribe(this._tagOperation$)}return Ct(t,[{key:"createRect$",get:function(){return this._createRect$}},{key:"createPolygon$",get:function(){return this._createPolygon$}},{key:"createPoints$",get:function(){return this._createPoints$}},{key:"delete$",get:function(){return this._delete$}},{key:"tag$",get:function(){return this._tag$}},{key:"replayedTag$",get:function(){return this._replayedTag$}}]),t}(),z_=function(){function t(){Tt(this,t)}return Ct(t,[{key:"render",value:function(t,e,n,i,r){var a,o=[],s=wt(t);try{for(s.s();!(a=s.n()).done;){var u=a.value;o=o.concat(u.getDOMObjects(n,i,r))}}catch(Tx){s.e(Tx)}finally{s.f()}return null!=e&&(o=o.concat(e.getDOMObjects(i,r))),wm.h("div.mapillary-tag-container",{},o)}},{key:"clear",value:function(){return wm.h("div",{},[])}}]),t}(),O_=function(){function t(e,n){Tt(this,t),this._createTag=null,this._needsRender=!1,this._raycaster=n||new xf,this._scene=e||new Al,this._objectTags={},this._retrievableObjects=[],this._tags={}}return Ct(t,[{key:"needsRender",get:function(){return this._needsRender}},{key:"add",value:function(t){var e,n=wt(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.tag.id in this._tags&&this._remove(i.tag.id),this._add(i)}}catch(Tx){n.e(Tx)}finally{n.f()}this._needsRender=!0}},{key:"addCreateTag",value:function(t){var e,n=wt(t.glObjects);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._scene.add(i)}}catch(Tx){n.e(Tx)}finally{n.f()}this._createTag={tag:t,objects:t.glObjects},this._needsRender=!0}},{key:"clear",value:function(){for(var t=0,e=Object.keys(this._tags);t<e.length;t++){var n=e[t];this._remove(n)}this._needsRender=!1}},{key:"get",value:function(t){return this.has(t)?this._tags[t].tag:void 0}},{key:"has",value:function(t){return t in this._tags}},{key:"hasCreateTag",value:function(){return null!=this._createTag}},{key:"intersectObjects",value:function(t,e){var n=rt(t,2),i=n[0],r=n[1];this._raycaster.setFromCamera(new Fr(i,r),e);var a,o=[],s=wt(this._raycaster.intersectObjects(this._retrievableObjects));try{for(s.s();!(a=s.n()).done;){var u=a.value;u.object.uuid in this._objectTags&&o.push(this._objectTags[u.object.uuid])}}catch(Tx){s.e(Tx)}finally{s.f()}return o}},{key:"remove",value:function(t){var e,n=wt(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._remove(i)}}catch(Tx){n.e(Tx)}finally{n.f()}this._needsRender=!0}},{key:"removeAll",value:function(){for(var t=0,e=Object.keys(this._tags);t<e.length;t++){var n=e[t];this._remove(n)}this._needsRender=!0}},{key:"removeCreateTag",value:function(){if(null!=this._createTag){var t,e=wt(this._createTag.objects);try{for(e.s();!(t=e.n()).done;){var n=t.value;this._scene.remove(n)}}catch(Tx){e.e(Tx)}finally{e.f()}this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}},{key:"render",value:function(t,e){e.render(this._scene,t),this._needsRender=!1}},{key:"update",value:function(){this._needsRender=!0}},{key:"updateCreateTagObjects",value:function(t){if(this._createTag.tag!==t)throw new Error("Create tags do not have the same reference.");var e,n=wt(this._createTag.objects);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._scene.remove(i)}}catch(Tx){n.e(Tx)}finally{n.f()}var r,a=wt(t.glObjects);try{for(a.s();!(r=a.n()).done;){var o=r.value;this._scene.add(o)}}catch(Tx){a.e(Tx)}finally{a.f()}this._createTag.objects=t.glObjects,this._needsRender=!0}},{key:"updateObjects",value:function(t){var e=t.tag.id;if(this._tags[e].tag!==t)throw new Error("Tags do not have the same reference.");var n=this._tags[e];this._removeObjects(n),delete this._tags[e],this._add(t),this._needsRender=!0}},{key:"_add",value:function(t){var e=t.tag.id,n={tag:t,objects:[],retrievableObjects:[]};this._tags[e]=n;var i,r=wt(t.getGLObjects());try{for(r.s();!(i=r.n()).done;){var a=i.value;n.objects.push(a),this._scene.add(a)}}catch(Tx){r.e(Tx)}finally{r.f()}var o,s=wt(t.getRetrievableObjects());try{for(s.s();!(o=s.n()).done;){var u=o.value;n.retrievableObjects.push(u),this._retrievableObjects.push(u),this._objectTags[u.uuid]=t.tag.id}}catch(Tx){s.e(Tx)}finally{s.f()}}},{key:"_remove",value:function(t){var e=this._tags[t];this._removeObjects(e),e.tag.dispose(),delete this._tags[t]}},{key:"_removeObjects",value:function(t){var e,n=wt(t.objects);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._scene.remove(i)}}catch(Tx){n.e(Tx)}finally{n.f()}var r,a=wt(t.retrievableObjects);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=this._retrievableObjects.indexOf(o);-1!==s&&this._retrievableObjects.splice(s,1)}}catch(Tx){a.e(Tx)}finally{a.f()}}}]),t}();!function(t){t[t.Default=0]="Default",t[t.CreatePoint=1]="CreatePoint",t[t.CreatePoints=2]="CreatePoints",t[t.CreatePolygon=3]="CreatePolygon",t[t.CreateRect=4]="CreateRect",t[t.CreateRectDrag=5]="CreateRectDrag"}(E_||(E_={})),function(t){t[t.None=0]="None",t[t.Centroid=1]="Centroid",t[t.Vertex=2]="Vertex"}(C_||(C_={}));var F_,N_=function(){function t(e,n,i){Tt(this,t),this._tag=e,this._transform=n,this._viewportCoords=i||new Im,this._glObjectsChanged$=new te,this._interact$=new te}return Ct(t,[{key:"glObjectsChanged$",get:function(){return this._glObjectsChanged$}},{key:"interact$",get:function(){return this._interact$}},{key:"tag",get:function(){return this._tag}}]),t}(),B_=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;return Tt(this,n),(r=e.call(this,t,i))._geometryChangedSubscription=r._tag.geometry.changed$.subscribe((function(){r._onGeometryChanged()})),r._changedSubscription=r._tag.changed$.subscribe((function(){r._onTagChanged()&&r._glObjectsChanged$.next(ft(r))})),r}return Ct(n,[{key:"dispose",value:function(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}},{key:"_colorToCss",value:function(t){return"#"+("000000"+t.toString(16)).substr(-6)}},{key:"_createFill",value:function(){var t=this._getTriangles(),e=new Float32Array(t),n=new Uo;n.setAttribute("position",new xo(e,3)),n.computeBoundingSphere();var i=new yo({side:2,transparent:!0});return this._updateFillMaterial(i),new os(n,i)}},{key:"_createLine",value:function(t){var e=this._getLinePositions(t),n=new Uo;n.setAttribute("position",new xo(e,3)),n.computeBoundingSphere();var i=new vc;this._updateLineBasicMaterial(i);var r=new xc(n,i);return r.renderOrder=1,r}},{key:"_createOutline",value:function(){return this._createLine(this._getPoints3d())}},{key:"_disposeFill",value:function(){null!=this._fill&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}},{key:"_disposeOutline",value:function(){null!=this._outline&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}},{key:"_getLinePositions",value:function(t){for(var e=t.length,n=new Float32Array(3*e),i=0;i<e;++i){var r=3*i,a=t[i];n[r+0]=a[0],n[r+1]=a[1],n[r+2]=a[2]}return n}},{key:"_interact",value:function(t,e,n){var i=this;return function(r){var a=r.offsetX-r.target.offsetWidth/2,o=r.offsetY-r.target.offsetHeight/2;i._interact$.next({cursor:e,offsetX:a,offsetY:o,operation:t,tag:i._tag,vertexIndex:n})}}},{key:"_updateFillGeometry",value:function(){var t=this._getTriangles(),e=new Float32Array(t),n=this._fill.geometry,i=n.getAttribute("position");i.array.length===e.length?(i.set(e),i.needsUpdate=!0):(n.deleteAttribute("position"),n.setAttribute("position",new xo(e,3))),n.computeBoundingSphere()}},{key:"_updateLine",value:function(t,e){var n=this._getLinePositions(e),i=t.geometry,r=i.getAttribute("position");r.set(n),r.needsUpdate=!0,i.computeBoundingSphere()}},{key:"_updateOulineGeometry",value:function(){this._updateLine(this._outline,this._getPoints3d())}}]),n}(N_),j_=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;return Tt(this,n),(r=e.call(this,t,i))._rectGeometry=new P_(r._tag.geometry.getRect2d(i)),r._fill=Zf(i.cameraType)?null:r._createFill(),r._outline=r._tag.lineWidth>=1?r._createOutline():null,r}return Ct(n,[{key:"dispose",value:function(){xt(mt(n.prototype),"dispose",this).call(this),this._disposeFill(),this._disposeOutline()}},{key:"getDOMObjects",value:function(t,e,n){var i=[],r={offsetHeight:n.height,offsetWidth:n.width};if(!this._tag.editable)return i;for(var a=this._colorToCss(this._tag.lineColor),o=this._tag.geometry.getPoints2d(),s=0;s<o.length;s++){var u=rt(o[s],2),l=u[0],c=u[1],h=this._viewportCoords.basicToCanvasSafe(l,c,r,this._transform,e);if(null!=h){var p="crosshair",f=this._interact(C_.Vertex,p,s),d=Math.round(h[0]),v=Math.round(h[1]),m="translate(-50%, -50%) translate(".concat(d,"px,").concat(v,"px)"),g={onpointerdown:f,style:{background:a,transform:m,cursor:p}};if(i.push(wm.h("div.mapillary-tag-resizer",g,[])),this._tag.indicateVertices){var y={style:{background:a,transform:m}};i.push(wm.h("div.mapillary-tag-vertex",y,[]))}}}return i}},{key:"getGLObjects",value:function(){var t=[];return null!=this._fill&&t.push(this._fill),null!=this._outline&&t.push(this._outline),t}},{key:"getRetrievableObjects",value:function(){return null!=this._fill?[this._fill]:[]}},{key:"_onGeometryChanged",value:function(){this._rectGeometry=new P_(this._tag.geometry.getRect2d(this._transform)),null!=this._fill&&this._updateFillGeometry(),null!=this._outline&&this._updateOulineGeometry()}},{key:"_onTagChanged",value:function(){var t=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),t=!0):this._updateOutlineMaterial(),t}},{key:"_getPoints3d",value:function(){return this._rectGeometry.getPoints3d(this._transform)}},{key:"_getTriangles",value:function(){return this._rectGeometry.getTriangles3d(this._transform)}},{key:"_updateFillMaterial",value:function(t){t.color=new fo(this._tag.fillColor),t.opacity=this._tag.fillOpacity,t.needsUpdate=!0}},{key:"_updateLineBasicMaterial",value:function(t){t.color=new fo(this._tag.lineColor),t.linewidth=Math.max(this._tag.lineWidth,1),t.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,t.opacity=this._tag.lineOpacity,t.transparent=this._tag.lineOpacity<1,t.needsUpdate=!0}},{key:"_updateOutlineMaterial",value:function(){var t=this._outline.material;this._updateLineBasicMaterial(t)}}]),n}(B_),V_=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;return Tt(this,n),(r=e.call(this))._id=t,r._geometry=i,r._notifyChanged$=new te,r._notifyChanged$.subscribe((function(t){var e={target:ft(r),type:"tag"};r.fire("tag",e)})),r._geometry.changed$.subscribe((function(t){var e="geometry",n={target:ft(r),type:e};r.fire(e,n)})),r}return Ct(n,[{key:"id",get:function(){return this._id}},{key:"geometry",get:function(){return this._geometry}},{key:"changed$",get:function(){return this._notifyChanged$}},{key:"geometryChanged$",get:function(){var t=this;return this._geometry.changed$.pipe(De((function(){return t})),Ei())}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}}]),n}(Sm),U_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),r=r||{},(a=e.call(this,t,i))._editable=null!=r.editable&&r.editable,a._fillColor=null==r.fillColor?16777215:r.fillColor,a._fillOpacity=null==r.fillOpacity?0:r.fillOpacity,a._indicateVertices=null==r.indicateVertices||r.indicateVertices,a._lineColor=null==r.lineColor?16777215:r.lineColor,a._lineOpacity=null==r.lineOpacity?1:r.lineOpacity,a._lineWidth=null==r.lineWidth?1:r.lineWidth,a}return Ct(n,[{key:"editable",get:function(){return this._editable},set:function(t){this._editable=t,this._notifyChanged$.next(this)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this._fillColor=t,this._notifyChanged$.next(this)}},{key:"fillOpacity",get:function(){return this._fillOpacity},set:function(t){this._fillOpacity=t,this._notifyChanged$.next(this)}},{key:"geometry",get:function(){return this._geometry}},{key:"indicateVertices",get:function(){return this._indicateVertices},set:function(t){this._indicateVertices=t,this._notifyChanged$.next(this)}},{key:"lineColor",get:function(){return this._lineColor},set:function(t){this._lineColor=t,this._notifyChanged$.next(this)}},{key:"lineOpacity",get:function(){return this._lineOpacity},set:function(t){this._lineOpacity=t,this._notifyChanged$.next(this)}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._notifyChanged$.next(this)}},{key:"setOptions",value:function(t){this._editable=null==t.editable?this._editable:t.editable,this._indicateVertices=null==t.indicateVertices?this._indicateVertices:t.indicateVertices,this._lineColor=null==t.lineColor?this._lineColor:t.lineColor,this._lineWidth=null==t.lineWidth?this._lineWidth:t.lineWidth,this._fillColor=null==t.fillColor?this._fillColor:t.fillColor,this._fillOpacity=null==t.fillOpacity?this._fillOpacity:t.fillOpacity,this._notifyChanged$.next(this)}}]),n}(V_);!function(t){t[t.TwoDimensional=0]="TwoDimensional",t[t.ThreeDimensional=1]="ThreeDimensional"}(F_||(F_={}));var $_,H_=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;return Tt(this,n),(r=e.call(this,t,i))._fill=Zf(i.cameraType)?t.domain===F_.TwoDimensional&&t.geometry instanceof L_?r._createFill():null:r._createFill(),r._holes=r._tag.lineWidth>=1?r._createHoles():[],r._outline=r._tag.lineWidth>=1?r._createOutline():null,r}return Ct(n,[{key:"dispose",value:function(){xt(mt(n.prototype),"dispose",this).call(this),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}},{key:"getDOMObjects",value:function(t,e,n){var i=this,r=[],a=this._tag.geometry instanceof P_,o=!Zf(this._transform.cameraType),s={offsetHeight:n.height,offsetWidth:n.width};if(null!=this._tag.icon&&(a||o)){var u=rt(this._tag.geometry instanceof P_?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),2),l=u[0],c=u[1],h=this._viewportCoords.basicToCanvasSafe(l,c,s,this._transform,e);if(null!=h){if(t.loaded){var p=t.getDOMSprite(this._tag.icon,this._tag.iconFloat),f=Math.round(h[0]),d=Math.round(h[1]),v={onclick:function(t){t.stopPropagation(),i._tag.click$.next(i._tag)},onpointerdown:function(){i._interact$.next({offsetX:0,offsetY:0,operation:C_.None,tag:i._tag})},style:{transform:"translate(".concat(f,"px,").concat(d,"px)")}};r.push(wm.h("div.mapillary-tag-symbol",v,[p]))}}}else if(null!=this._tag.text&&(a||o)){var m=rt(this._tag.geometry instanceof P_?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),2),g=m[0],y=m[1],_=this._viewportCoords.basicToCanvasSafe(g,y,s,this._transform,e);if(null!=_){var b=Math.round(_[0]),x=Math.round(_[1]),w=this._tag.geometry instanceof P_?"translate(".concat(b,"px,").concat(x,"px)"):"translate(-50%, -50%) translate(".concat(b,"px,").concat(x,"px)"),S={onpointerdown:function(){i._interact$.next({offsetX:0,offsetY:0,operation:C_.None,tag:i._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:w},textContent:this._tag.text};r.push(wm.h("span.mapillary-tag-symbol",S,[]))}}if(!this._tag.editable)return r;var k=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof P_){var M=rt(this._tag.geometry.getCentroid2d(),2),T=M[0],E=M[1],C=this._viewportCoords.basicToCanvasSafe(T,E,s,this._transform,e);if(null!=C){var I=this._interact(C_.Centroid,"move"),P=Math.round(C[0]),A=Math.round(C[1]),L={onpointerdown:I,style:{background:k,transform:"translate(-50%, -50%) translate(".concat(P,"px,").concat(A,"px)")}};r.push(wm.h("div.mapillary-tag-mover",L,[]))}}for(var R=this._tag.geometry.getVertices2d(),D=0;D<R.length-1;D++)if(!a||!(null!=this._tag.icon&&D===this._tag.iconIndex||null==this._tag.icon&&null!=this._tag.text&&3===D)){var z=rt(R[D],2),O=z[0],F=z[1],N=this._viewportCoords.basicToCanvasSafe(O,F,s,this._transform,e);if(null!=N){var B=a?D%2===0?"nesw-resize":"nwse-resize":"crosshair",j=this._interact(C_.Vertex,B,D),V=Math.round(N[0]),U=Math.round(N[1]),$="translate(-50%, -50%) translate(".concat(V,"px,").concat(U,"px)"),H={onpointerdown:j,style:{background:k,transform:$,cursor:B}};if(r.push(wm.h("div.mapillary-tag-resizer",H,[])),this._tag.indicateVertices){var q={style:{background:k,transform:$}};r.push(wm.h("div.mapillary-tag-vertex",q,[]))}}}return r}},{key:"getGLObjects",value:function(){var t=[];null!=this._fill&&t.push(this._fill);var e,n=wt(this._holes);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push(i)}}catch(Tx){n.e(Tx)}finally{n.f()}return null!=this._outline&&t.push(this._outline),t}},{key:"getRetrievableObjects",value:function(){return null!=this._fill?[this._fill]:[]}},{key:"_onGeometryChanged",value:function(){null!=this._fill&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),null!=this._outline&&this._updateOulineGeometry()}},{key:"_onTagChanged",value:function(){var t=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),t=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),t}},{key:"_getPoints3d",value:function(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}},{key:"_getTriangles",value:function(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}},{key:"_updateFillMaterial",value:function(t){t.color=new fo(this._tag.fillColor),t.opacity=this._tag.fillOpacity,t.needsUpdate=!0}},{key:"_updateLineBasicMaterial",value:function(t){t.color=new fo(this._tag.lineColor),t.linewidth=Math.max(this._tag.lineWidth,1),t.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,t.opacity=this._tag.lineOpacity,t.transparent=this._tag.lineOpacity<1,t.needsUpdate=!0}},{key:"_createHoles",value:function(){var t=[];if(this._tag.geometry instanceof L_){var e,n=wt(this._getHoles3d());try{for(n.s();!(e=n.n()).done;){var i=e.value,r=this._createLine(i);t.push(r)}}catch(Tx){n.e(Tx)}finally{n.f()}}return t}},{key:"_disposeHoles",value:function(){var t,e=wt(this._holes);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.geometry.dispose(),n.material.dispose()}}catch(Tx){e.e(Tx)}finally{e.f()}this._holes=[]}},{key:"_getHoles3d",value:function(){var t=this._tag.geometry;return this._in3dDomain()?t.getHoleVertices3d(this._transform):t.getHolePoints3d(this._transform)}},{key:"_in3dDomain",value:function(){return this._tag.geometry instanceof L_&&this._tag.domain===F_.ThreeDimensional}},{key:"_updateHoleGeometries",value:function(){var t=this._getHoles3d();if(t.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(var e=0;e<this._holes.length;e++){var n=t[e],i=this._holes[e];this._updateLine(i,n)}}},{key:"_updateHoleMaterials",value:function(){var t,e=wt(this._holes);try{for(e.s();!(t=e.n()).done;){var n=t.value;this._updateLineBasicMaterial(n.material)}}catch(Tx){e.e(Tx)}finally{e.f()}}},{key:"_updateOutlineMaterial",value:function(){this._updateLineBasicMaterial(this._outline.material)}}]),n}(B_);!function(t){t[t.Bottom=0]="Bottom",t[t.BottomLeft=1]="BottomLeft",t[t.BottomRight=2]="BottomRight",t[t.Center=3]="Center",t[t.Left=4]="Left",t[t.Right=5]="Right",t[t.Top=6]="Top",t[t.TopLeft=7]="TopLeft",t[t.TopRight=8]="TopRight"}($_||($_={}));var q_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;Tt(this,n),a=e.call(this,t,i);var o=null!=(r=r||{}).domain&&i instanceof L_?r.domain:F_.TwoDimensional,s=a._twoDimensionalPolygon(o,i);return a._domain=o,a._editable=null!=r.editable&&!s&&r.editable,a._fillColor=null==r.fillColor?16777215:r.fillColor,a._fillOpacity=null==r.fillOpacity?0:r.fillOpacity,a._icon=void 0===r.icon?null:r.icon,a._iconFloat=null==r.iconFloat?$_.Center:r.iconFloat,a._iconIndex=null==r.iconIndex?3:r.iconIndex,a._indicateVertices=null==r.indicateVertices||r.indicateVertices,a._lineColor=null==r.lineColor?16777215:r.lineColor,a._lineOpacity=null==r.lineOpacity?1:r.lineOpacity,a._lineWidth=null==r.lineWidth?1:r.lineWidth,a._text=void 0===r.text?null:r.text,a._textColor=null==r.textColor?16777215:r.textColor,a._click$=new te,a._click$.subscribe((function(){var t="click",e={target:ft(a),type:t};a.fire(t,e)})),a}return Ct(n,[{key:"click$",get:function(){return this._click$}},{key:"domain",get:function(){return this._domain}},{key:"editable",get:function(){return this._editable},set:function(t){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=t,this._notifyChanged$.next(this))}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this._fillColor=t,this._notifyChanged$.next(this)}},{key:"fillOpacity",get:function(){return this._fillOpacity},set:function(t){this._fillOpacity=t,this._notifyChanged$.next(this)}},{key:"geometry",get:function(){return this._geometry}},{key:"icon",get:function(){return this._icon},set:function(t){this._icon=t,this._notifyChanged$.next(this)}},{key:"iconFloat",get:function(){return this._iconFloat},set:function(t){this._iconFloat=t,this._notifyChanged$.next(this)}},{key:"iconIndex",get:function(){return this._iconIndex},set:function(t){this._iconIndex=t,this._notifyChanged$.next(this)}},{key:"indicateVertices",get:function(){return this._indicateVertices},set:function(t){this._indicateVertices=t,this._notifyChanged$.next(this)}},{key:"lineColor",get:function(){return this._lineColor},set:function(t){this._lineColor=t,this._notifyChanged$.next(this)}},{key:"lineOpacity",get:function(){return this._lineOpacity},set:function(t){this._lineOpacity=t,this._notifyChanged$.next(this)}},{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._notifyChanged$.next(this)}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._notifyChanged$.next(this)}},{key:"textColor",get:function(){return this._textColor},set:function(t){this._textColor=t,this._notifyChanged$.next(this)}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"setOptions",value:function(t){var e=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=e||null==t.editable?this._editable:t.editable,this._icon=void 0===t.icon?this._icon:t.icon,this._iconFloat=null==t.iconFloat?this._iconFloat:t.iconFloat,this._iconIndex=null==t.iconIndex?this._iconIndex:t.iconIndex,this._indicateVertices=null==t.indicateVertices?this._indicateVertices:t.indicateVertices,this._lineColor=null==t.lineColor?this._lineColor:t.lineColor,this._lineWidth=null==t.lineWidth?this._lineWidth:t.lineWidth,this._fillColor=null==t.fillColor?this._fillColor:t.fillColor,this._fillOpacity=null==t.fillOpacity?this._fillOpacity:t.fillOpacity,this._text=void 0===t.text?this._text:t.text,this._textColor=null==t.textColor?this._textColor:t.textColor,this._notifyChanged$.next(this)}},{key:"_twoDimensionalPolygon",value:function(t,e){return t!==F_.ThreeDimensional&&e instanceof L_}}]),n}(V_),W_=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"dispose",value:function(){}},{key:"getDOMObjects",value:function(t,e,n){var i=this,r=this._tag,a={offsetHeight:n.height,offsetWidth:n.width},o=[],s=rt(r.geometry.getCentroid2d(),2),u=s[0],l=s[1],c=this._viewportCoords.basicToCanvasSafe(u,l,a,this._transform,e);if(null!=c){var h=function(t){i._interact$.next({offsetX:0,offsetY:0,operation:C_.None,tag:r})},p=Math.round(c[0]),f=Math.round(c[1]);if(null!=r.icon){if(t.loaded){var d=t.getDOMSprite(r.icon,$_.Bottom),v={onpointerdown:h,style:{pointerEvents:"all",transform:"translate(".concat(p,"px,").concat(f+8,"px)")}};o.push(wm.h("div",v,[d]))}}else if(null!=r.text){var m="translate(-50%,0%) translate(".concat(p,"px,").concat(f+8,"px)"),g={onpointerdown:h,style:{color:this._colorToCss(r.textColor),transform:m},textContent:r.text};o.push(wm.h("span.mapillary-tag-symbol",g,[]))}var y=this._interact(C_.Centroid,r,"move"),_=this._colorToCss(r.color),b="translate(-50%,-50%) translate(".concat(p,"px,").concat(f,"px)");if(r.editable){var x={onpointerdown:y,style:{background:_,transform:b}};o.push(wm.h("div.mapillary-tag-spot-interactor",x,[]))}var w={style:{background:_,transform:b}};o.push(wm.h("div.mapillary-tag-vertex",w,[]))}return o}},{key:"getGLObjects",value:function(){return[]}},{key:"getRetrievableObjects",value:function(){return[]}},{key:"_colorToCss",value:function(t){return"#"+("000000"+t.toString(16)).substr(-6)}},{key:"_interact",value:function(t,e,n,i){var r=this;return function(a){var o=a.offsetX-a.target.offsetWidth/2,s=a.offsetY-a.target.offsetHeight/2;r._interact$.next({cursor:n,offsetX:o,offsetY:s,operation:t,tag:e,vertexIndex:i})}}}]),n}(N_),G_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),r=r||{},(a=e.call(this,t,i))._color=null==r.color?16777215:r.color,a._editable=null!=r.editable&&r.editable,a._icon=void 0===r.icon?null:r.icon,a._text=void 0===r.text?null:r.text,a._textColor=null==r.textColor?16777215:r.textColor,a}return Ct(n,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._notifyChanged$.next(this)}},{key:"editable",get:function(){return this._editable},set:function(t){this._editable=t,this._notifyChanged$.next(this)}},{key:"icon",get:function(){return this._icon},set:function(t){this._icon=t,this._notifyChanged$.next(this)}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._notifyChanged$.next(this)}},{key:"textColor",get:function(){return this._textColor},set:function(t){this._textColor=t,this._notifyChanged$.next(this)}},{key:"setOptions",value:function(t){this._color=null==t.color?this._color:t.color,this._editable=null==t.editable?this._editable:t.editable,this._icon=void 0===t.icon?this._icon:t.icon,this._text=void 0===t.text?this._text:t.text,this._textColor=null==t.textColor?this._textColor:t.textColor,this._notifyChanged$.next(this)}}]),n}(V_),Z_=function(){function t(){Tt(this,t),this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new te}return Ct(t,[{key:"active",get:function(){return this._active}},{key:"changed$",get:function(){return this._notifyChanged$}},{key:"activate",value:function(t){if(!this._active){for(var e in this._hashDeactivated)if(this._hashDeactivated.hasOwnProperty(e)){var n=this._hashDeactivated[e];this._add(n,t)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}},{key:"deactivate",value:function(){if(this._active){for(var t in this._hash)this._hash.hasOwnProperty(t)&&(this._hashDeactivated[t]=this._hash[t].tag);this._hash={},this._active=!1}}},{key:"add",value:function(t,e){this._assertActivationState(!0);var n,i=wt(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;this._add(r,e)}}catch(Tx){i.e(Tx)}finally{i.f()}this._notifyChanged$.next(this)}},{key:"addDeactivated",value:function(t){this._assertActivationState(!1);var e,n=wt(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!(i instanceof q_||i instanceof G_||i instanceof U_))throw new Error("Tag type not supported");this._hashDeactivated[i.id]=i}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"get",value:function(t){return this.has(t)?this._hash[t]:void 0}},{key:"getAll",value:function(){var t=this._hash;return Object.keys(t).map((function(e){return t[e]}))}},{key:"getAllDeactivated",value:function(){var t=this._hashDeactivated;return Object.keys(t).map((function(e){return t[e]}))}},{key:"getDeactivated",value:function(t){return this.hasDeactivated(t)?this._hashDeactivated[t]:void 0}},{key:"has",value:function(t){return t in this._hash}},{key:"hasDeactivated",value:function(t){return t in this._hashDeactivated}},{key:"remove",value:function(t){this._assertActivationState(!0);var e,n=this._hash,i=wt(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;r in n&&delete n[r]}}catch(Tx){i.e(Tx)}finally{i.f()}this._notifyChanged$.next(this)}},{key:"removeAll",value:function(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}},{key:"removeAllDeactivated",value:function(){this._assertActivationState(!1),this._hashDeactivated={}}},{key:"removeDeactivated",value:function(t){this._assertActivationState(!1);var e,n=this._hashDeactivated,i=wt(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;r in n&&delete n[r]}}catch(Tx){i.e(Tx)}finally{i.f()}}},{key:"_add",value:function(t,e){if(t instanceof q_)this._hash[t.id]=new H_(t,e);else if(t instanceof G_)this._hash[t.id]=new W_(t,e);else{if(!(t instanceof U_))throw new Error("Tag type not supported");this._hash[t.id]=new j_(t,e)}}},{key:"_assertActivationState",value:function(t){if(t!==this._active)throw new Error("Tag set not in correct state for operation.")}}]),t}(),X_=function(t){kt(n,t);var e=Mt(n);function n(t){var i;Tt(this,n),i=e.call(this);var r=t[0],a=t[1];if(r<0||r>1||a<0||a>1)throw new ry("Basic coordinates must be on the interval [0, 1].");return i._point=t.slice(),i}return Ct(n,[{key:"point",get:function(){return this._point}},{key:"getCentroid2d",value:function(){return this._point.slice()}},{key:"getCentroid3d",value:function(t){return t.unprojectBasic(this._point,200)}},{key:"setCentroid2d",value:function(t,e){var n=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._point[0]=n[0],this._point[1]=n[1],this._notifyChanged$.next(this)}}]),n}(iy),Y_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._name="".concat(o._component.name,"-").concat(o._getNameExtension()),o._viewportCoords=a,o}return Ct(n,[{key:"_getConfiguration",value:function(t){return{}}},{key:"_mouseEventToBasic",value:function(t,e,n,i,r,a){r=null!=r?r:0,a=null!=a?a:0;var o=rt(this._viewportCoords.canvasPosition(t,e),2),s=o[0],u=o[1];return this._viewportCoords.canvasToBasic(s-r,u-a,e,i,n.perspective)}}]),n}(ng),K_=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a,o){var s;return Tt(this,n),(s=e.call(this,t,i,r,a))._tagCreator=o,s._geometryCreated$=new te,s}return Ct(n,[{key:"geometryCreated$",get:function(){return this._geometryCreated$}},{key:"_enable",value:function(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}},{key:"_disable",value:function(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}},{key:"_validateBasic",value:function(t){var e=t[0],n=t[1];return 0<=e&&e<=1&&0<=n&&n<=1}},{key:"_mouseEventToBasic$",value:function(t){var e=this;return t.pipe(Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),De((function(t){var n=rt(t,3),i=n[0],r=n[1],a=n[2];return e._mouseEventToBasic(i,e._container.container,r,a)})))}}]),n}(Y_),J_=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_enableCreate",value:function(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(hn(this._validateBasic),De((function(t){return new X_(t)}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-point"}}]),n}(K_),Q_=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_enableCreate",value:function(){var t=this;this._container.mouseService.deferPixels(this._name,4);var e=this._navigator.stateService.currentTransform$.pipe(De((function(){})),bi(1),ne());this._deleteSubscription=e.pipe(Ci(1)).subscribe(this._tagCreator.delete$);var n=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(Ei());this._createSubscription=e.pipe(zi((function(){return n.pipe(hn(t._validateBasic),Xn(1))}))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(zi((function(e){return e?We(xe(e),cn(t._container.mouseService.mouseMove$,t._container.mouseService.domMouseMove$),t._container.renderService.renderCamera$,t._navigator.stateService.currentTransform$):me()}))).subscribe((function(e){var n=rt(e,4),i=n[0],r=n[1],a=n[2],o=n[3],s=t._mouseEventToBasic(r,t._container.container,a,o);t._setVertex2d(i,s,o)})),this._addPointSubscription=this._tagCreator.tag$.pipe(zi((function(t){return t?We(xe(t),n):me()}))).subscribe((function(e){var n=rt(e,2),i=n[0],r=n[1];t._addPoint(i,r)})),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(zi((function(t){return t?t.created$.pipe(De((function(t){return t.geometry}))):me()}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}]),n}(K_),tb=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_create$",get:function(){return this._tagCreator.createPoints$}},{key:"_addPoint",value:function(t,e){t.geometry.addPoint2d(e)}},{key:"_getNameExtension",value:function(){return"create-points"}},{key:"_setVertex2d",value:function(t,e,n){t.geometry.setPoint2d(t.geometry.points.length-1,e,n)}}]),n}(Q_),eb=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_create$",get:function(){return this._tagCreator.createPolygon$}},{key:"_addPoint",value:function(t,e){t.addPoint(e)}},{key:"_getNameExtension",value:function(){return"create-polygon"}},{key:"_setVertex2d",value:function(t,e,n){t.geometry.setVertex2d(t.geometry.polygon.length-2,e,n)}}]),n}(Q_),nb=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_create$",get:function(){return this._tagCreator.createRect$}},{key:"_addPoint",value:function(t,e){var n=t.geometry;n.validate(e)||(e=n.getNonAdjustedVertex2d(3)),t.addPoint(e)}},{key:"_enable",value:function(){xt(mt(n.prototype),"_enable",this).call(this),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(hn((function(t){return!!t}))).subscribe((function(t){t.geometry.initializeAnchorIndexing()}))}},{key:"_disable",value:function(){xt(mt(n.prototype),"_disable",this).call(this),this._initializeAnchorIndexingSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-rect"}},{key:"_setVertex2d",value:function(t,e,n){t.geometry.setOppositeVertex2d(e,n)}}]),n}(Q_),ib=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"_enableCreate",value:function(){var t=this;this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(De((function(t){return null})),Ci(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(hn(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(hn((function(t){return!!t}))).subscribe((function(t){t.geometry.initializeAnchorIndexing()}));var e=We(cn(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(Ki(this._navigator.stateService.currentTransform$),De((function(e){var n=rt(e,2),i=rt(n[0],2),r=i[0],a=i[1],o=n[1];return t._mouseEventToBasic(r,t._container.container,a,o)})));this._setVertexSubscription=this._tagCreator.tag$.pipe(zi((function(n){return n?We(xe(n),e,t._navigator.stateService.currentTransform$):me()}))).subscribe((function(t){var e=rt(t,3),n=e[0],i=e[1],r=e[2];n.geometry.setOppositeVertex2d(i,r)}));var n=this._container.mouseService.mouseDragEnd$.pipe(Ki(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(hn(this._validateBasic)),(function(t,e){return e})),Ei());this._addPointSubscription=this._tagCreator.tag$.pipe(zi((function(t){return t?We(xe(t),n):me()}))).subscribe((function(t){var e=rt(t,2),n=e[0],i=e[1],r=n.geometry;r.validate(i)||(i=r.getNonAdjustedVertex2d(3)),n.addPoint(i)})),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(zi((function(t){return t?t.created$.pipe(De((function(t){return t.geometry}))):me()}))).subscribe(this._geometryCreated$)}},{key:"_disableCreate",value:function(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"create-rect-drag"}}]),n}(K_),rb=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a,o){var s;return Tt(this,n),(s=e.call(this,t,i,r,a))._tagSet=o,s}return Ct(n,[{key:"_enable",value:function(){var t=this,e=this._tagSet.changed$.pipe(De((function(t){return t.getAll()})),zi((function(t){return Ye(t).pipe(tn((function(t){return t.interact$})))})),zi((function(e){return on(xe(e),t._container.mouseService.documentMouseUp$.pipe(De((function(){return{offsetX:0,offsetY:0,operation:C_.None,tag:null}})),ri()))})),Ei());cn(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(Ei()),this._claimMouseSubscription=e.pipe(zi((function(e){return e.tag?t._container.mouseService.domMouseDragStart$:me()}))).subscribe((function(){t._container.mouseService.claimMouse(t._name,3)})),this._cursorSubscription=e.pipe(De((function(t){return t.cursor})),Un()).subscribe((function(e){for(var n=0,i=["crosshair","move","nesw-resize","nwse-resize"];n<i.length;n++){var r=i[n];t._container.container.classList.remove("component-tag-edit-".concat(r))}e&&t._container.container.classList.add("component-tag-edit-".concat(e))})),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe((function(e){t._container.mouseService.unclaimMouse(t._name)})),this._preventDefaultSubscription=e.pipe(zi((function(e){return e.tag?t._container.mouseService.documentMouseMove$:me()}))).subscribe((function(t){t.preventDefault()})),this._updateGeometrySubscription=e.pipe(zi((function(e){return e.operation!==C_.None&&e.tag?We(t._container.mouseService.filtered$(t._name,t._container.mouseService.domMouseDrag$).pipe(hn((function(e){return t._viewportCoords.insideElement(e,t._container.container)}))),t._container.renderService.renderCamera$).pipe(Ki(xe(e),t._navigator.stateService.currentTransform$,(function(t,e,n){var i=rt(t,2);return[i[0],i[1],e,n]}))):me()}))).subscribe((function(e){var n=rt(e,4),i=n[0],r=n[1],a=n[2],o=n[3],s=t._mouseEventToBasic(i,t._container.container,r,o,a.offsetX,a.offsetY),u=a.tag.geometry;a.operation===C_.Centroid?u.setCentroid2d(s,o):a.operation===C_.Vertex&&u.setVertex2d(a.vertexIndex,s,o)}))}},{key:"_disable",value:function(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}},{key:"_getNameExtension",value:function(){return"edit-vertex"}}]),n}(Y_),ab=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._tagDomRenderer=new z_,a._tagScene=new O_,a._tagSet=new Z_,a._tagCreator=new D_(ft(a),r),a._viewportCoords=new Im,a._createHandlers={CreatePoint:new J_(ft(a),i,r,a._viewportCoords,a._tagCreator),CreatePoints:new tb(ft(a),i,r,a._viewportCoords,a._tagCreator),CreatePolygon:new eb(ft(a),i,r,a._viewportCoords,a._tagCreator),CreateRect:new nb(ft(a),i,r,a._viewportCoords,a._tagCreator),CreateRectDrag:new ib(ft(a),i,r,a._viewportCoords,a._tagCreator),Default:void 0},a._editVertexHandler=new rb(ft(a),i,r,a._viewportCoords,a._tagSet),a._renderTags$=a._tagSet.changed$.pipe(De((function(t){var e=t.getAll();return e.sort((function(t,e){var n=t.tag.id,i=e.tag.id;return n<i?-1:n>i?1:0})),e})),Ei()),a._tagChanged$=a._renderTags$.pipe(zi((function(t){return Ye(t).pipe(tn((function(t){return cn(t.tag.changed$,t.tag.geometryChanged$)})))})),Ei()),a._renderTagGLChanged$=a._renderTags$.pipe(zi((function(t){return Ye(t).pipe(tn((function(t){return t.glObjectsChanged$})))})),Ei()),a._createGeometryChanged$=a._tagCreator.tag$.pipe(zi((function(t){return null!=t?t.geometryChanged$:me()})),Ei()),a._createGLObjectsChanged$=a._tagCreator.tag$.pipe(zi((function(t){return null!=t?t.glObjectsChanged$:me()})),Ei()),a._creatingConfiguration$=a._configuration$.pipe(Un((function(t,e){return t.mode===e.mode}),(function(t){return{createColor:t.createColor,mode:t.mode}})),bi(1),ne()),a._creatingConfiguration$.subscribe((function(t){var e="tagmode",n={mode:t.mode,target:ft(a),type:e};a.fire(e,n)})),a}return Ct(n,[{key:"add",value:function(t){var e=this;this._activated?this._navigator.stateService.currentTransform$.pipe(ri()).subscribe((function(n){e._tagSet.add(t,n);var i=t.map((function(t){return e._tagSet.get(t.id)}));e._tagScene.add(i)})):this._tagSet.addDeactivated(t)}},{key:"calculateRect",value:function(t){var e=this;return new Promise((function(n,i){e._navigator.stateService.currentTransform$.pipe(ri(),De((function(e){return t.getRect2d(e)}))).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"create",value:function(){this._tagCreator.replayedTag$.pipe(ri(),hn((function(t){return!!t}))).subscribe((function(t){t.create()}))}},{key:"changeMode",value:function(t){this.configure({mode:t})}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"get",value:function(t){if(this._activated){var e=this._tagSet.get(t);return void 0!==e?e.tag:void 0}return this._tagSet.getDeactivated(t)}},{key:"getAll",value:function(){return this.activated?this._tagSet.getAll().map((function(t){return t.tag})):this._tagSet.getAllDeactivated()}},{key:"getTagIdsAt",value:function(t){var e=this;return new Promise((function(n,i){e._container.renderService.renderCamera$.pipe(ri(),De((function(n){var i=e._viewportCoords.canvasToViewport(t[0],t[1],e._container.container);return e._tagScene.intersectObjects(i,n.perspective)}))).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"has",value:function(t){return this._activated?this._tagSet.has(t):this._tagSet.hasDeactivated(t)}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"remove",value:function(t){this._activated?(this._tagSet.remove(t),this._tagScene.remove(t)):this._tagSet.removeDeactivated(t)}},{key:"removeAll",value:function(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}},{key:"_activate",value:function(){var t=this;this._editVertexHandler.enable();var e=Ye(Object.keys(this._createHandlers)).pipe(De((function(e){return t._createHandlers[e]})),hn((function(t){return!!t})),tn((function(t){return t.geometryCreated$})),Ei()),n=this._subscriptions;n.push(e.subscribe((function(e){var n="geometrycreate",i={geometry:e,target:t,type:n};t.fire(n,i)}))),n.push(this._tagCreator.tag$.pipe(Ai((function(t){return null==t})),Un()).subscribe((function(e){var n=null!=e?"tagcreatestart":"tagcreateend",i={target:t,type:n};t.fire(n,i)}))),n.push(e.subscribe((function(){t.changeMode(E_.Default)}))),n.push(this._creatingConfiguration$.subscribe((function(e){t._disableCreateHandlers();var n=E_[e.mode],i=t._createHandlers[n];i&&i.enable()}))),n.push(this._renderTags$.subscribe((function(){var e="tags",n={target:t,type:e};t.fire(e,n)}))),n.push(this._tagCreator.tag$.pipe(zi((function(t){return null!=t?t.aborted$.pipe(De((function(){return null}))):me()}))).subscribe((function(){t.changeMode(E_.Default)}))),n.push(this._tagCreator.tag$.subscribe((function(e){t._tagScene.hasCreateTag()&&t._tagScene.removeCreateTag(),null!=e&&t._tagScene.addCreateTag(e)}))),n.push(this._createGLObjectsChanged$.subscribe((function(e){t._tagScene.updateCreateTagObjects(e)}))),n.push(this._renderTagGLChanged$.subscribe((function(e){t._tagScene.updateObjects(e)}))),n.push(this._tagChanged$.subscribe((function(){t._tagScene.update()}))),n.push(We(this._renderTags$.pipe(Di([]),Hi((function(){t._container.domRenderer.render$.next({name:t._name,vNode:t._tagDomRenderer.clear()})}))),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(Di(null)),cn(this._tagCreator.tag$,this._createGeometryChanged$).pipe(Di(null))).pipe(De((function(e){var n=rt(e,6),i=n[0],r=n[1],a=n[2],o=n[3],s=n[5];return{name:t._name,vNode:t._tagDomRenderer.render(i,s,a,r.perspective,o)}}))).subscribe(this._container.domRenderer.render$)),n.push(this._navigator.stateService.currentState$.pipe(De((function(e){var n=t._tagScene;return{name:t._name,renderer:{frameId:e.id,needsRender:n.needsRender,render:n.render.bind(n),pass:Fm.Opaque}}}))).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(ri()).subscribe((function(e){t._tagSet.activate(e),t._tagScene.add(t._tagSet.getAll())}))}},{key:"_deactivate",value:function(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}},{key:"_getDefaultConfiguration",value:function(){return{createColor:16777215,indicatePointsCompleter:!0,mode:E_.Default}}},{key:"_disableCreateHandlers",value:function(){var t=this._createHandlers;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];n&&n.disable()}}}]),n}(Mm);ab.componentName="tag";var ob=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._viewportCoords=new Im,a._zoomDelta$=new te,a}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this._subscriptions;e.push(We(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(De((function(e){var n=rt(e,4),i=n[0],r=n[1],a=n[2],o=n[3],s=i.state.zoom,u=wm.h("div.mapillary-zoom-in-icon",[]),l=s>=3||r===Qm.Waiting?wm.h("div.mapillary-zoom-in-button-inactive",[u]):wm.h("div.mapillary-zoom-in-button",{onclick:function(){t._zoomDelta$.next(1)}},[u]),c=wm.h("div.mapillary-zoom-out-icon",[]),h=s<=0||r===Qm.Waiting?wm.h("div.mapillary-zoom-out-button-inactive",[c]):wm.h("div.mapillary-zoom-out-button",{onclick:function(){t._zoomDelta$.next(-1)}},[c]),p=a.size===Cm.Small||a.size===Cm.Automatic&&o.width<640?".mapillary-zoom-compact":"";return{name:t._name,vNode:wm.h("div.mapillary-zoom-container"+p,{oncontextmenu:function(t){t.preventDefault()}},[l,h])}}))).subscribe(this._container.domRenderer.render$)),e.push(this._zoomDelta$.pipe(Ki(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe((function(e){var n=rt(e,3),i=n[0],r=n[1],a=n[2],o=t._viewportCoords.unprojectFromViewport(0,0,r.perspective),s=a.projectBasic(o.toArray());t._navigator.stateService.zoomIn(i,s)})))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{size:Cm.Automatic}}}]),n}(Mm);ob.componentName="zoom";var sb=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o;return Tt(this,n),(o=e.call(this,t,i,r))._canvasId="".concat(i.id,"-").concat(o._name),o._dom=a||new Eg,o}return Ct(n,[{key:"_activate",value:function(){var t=this,e=this._container.domRenderer.element$.pipe(De((function(){return t._dom.document.getElementById(t._canvasId)})),hn((function(t){return!!t})),De((function(t){var e=t.parentElement,n=e.offsetWidth;return[t,{height:e.offsetHeight,width:n}]})),Un((function(t,e){return t.height===e.height&&t.width===e.width}),(function(t){return rt(t,2)[1]})));this._subscriptions.push(We(e,this._navigator.stateService.currentImage$).subscribe((function(t){var e=rt(t,2),n=rt(e[0],2),i=n[0],r=n[1],a=e[1];i.width=r.width,i.height=r.height,i.getContext("2d").drawImage(a.image,0,0,r.width,r.height)}))),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:wm.h("canvas#".concat(this._canvasId),[])})}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{}}}]),n}(Mm);sb.componentName="imagefallback";var ub=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),(a=e.call(this,t,i,r))._seqNames={},a._seqNames[Of[Of.Prev]]="-prev",a._seqNames[Of[Of.Next]]="-next",a._spaTopNames={},a._spaTopNames[Of[Of.TurnLeft]]="-turn-left",a._spaTopNames[Of[Of.StepLeft]]="-left",a._spaTopNames[Of[Of.StepForward]]="-forward",a._spaTopNames[Of[Of.StepRight]]="-right",a._spaTopNames[Of[Of.TurnRight]]="-turn-right",a._spaBottomNames={},a._spaBottomNames[Of[Of.TurnU]]="-turn-around",a._spaBottomNames[Of[Of.StepBackward]]="-backward",a}return Ct(n,[{key:"_activate",value:function(){var t=this;this._subscriptions.push(We(this._navigator.stateService.currentImage$,this._configuration$).pipe(zi((function(t){var e=rt(t,2),n=e[0],i=e[1];return We(i.sequence?n.sequenceEdges$.pipe(De((function(t){return t.edges.map((function(t){return t.data.direction}))}))):xe([]),!Zf(n.cameraType)&&i.spatial?n.spatialEdges$.pipe(De((function(t){return t.edges.map((function(t){return t.data.direction}))}))):xe([])).pipe(De((function(t){var e=rt(t,2),n=e[0],i=e[1];return n.concat(i)})))})),De((function(e){var n=t._createArrowRow(t._seqNames,e),i=t._createArrowRow(t._spaTopNames,e),r=t._createArrowRow(t._spaBottomNames,e),a=wm.h("div.mapillary-navigation-sequence",n),o=wm.h("div.NavigationSpatialTop",i),s=wm.h("div.mapillary-navigation-spatial-bottom",r),u=wm.h("div.mapillary-navigation-spatial",[o,s]);return{name:t._name,vNode:wm.h("div.NavigationContainer",[a,u])}}))).subscribe(this._container.domRenderer.render$))}},{key:"_deactivate",value:function(){this._subscriptions.unsubscribe()}},{key:"_getDefaultConfiguration",value:function(){return{sequence:!0,spatial:!0}}},{key:"_createArrowRow",value:function(t,e){var n=[];for(var i in t)if(t.hasOwnProperty(i)){var r=Of[i];-1!==e.indexOf(r)?n.push(this._createVNode(r,t[i],"visible")):n.push(this._createVNode(r,t[i],"hidden"))}return n}},{key:"_createVNode",value:function(t,e,n){var i=this;return wm.h("span.mapillary-navigation-button.mapillary-navigation".concat(e),{onclick:function(){i._navigator.moveDir$(t).subscribe(void 0,(function(t){t instanceof Lm||console.error(t)}))},style:{visibility:n}},[])}}]),n}(Mm);ub.componentName="navigationfallback";function lb(t){for(var e=t.length;--e>=0;)t[e]=0}var cb=256,hb=286,pb=30,fb=15,db=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vb=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),mb=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gb=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yb=new Array(576);lb(yb);var _b=new Array(60);lb(_b);var bb=new Array(512);lb(bb);var xb=new Array(256);lb(xb);var wb=new Array(29);lb(wb);var Sb,kb,Mb,Tb=new Array(pb);function Eb(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function Cb(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}lb(Tb);var Ib=function(t){return t<256?bb[t]:bb[256+(t>>>7)]},Pb=function(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ab=function(t,e,n){t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,Pb(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Lb=function(t,e,n){Ab(t,n[2*e],n[2*e+1])},Rb=function(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},Db=function(t,e,n){var i,r,a=new Array(16),o=0;for(i=1;i<=fb;i++)a[i]=o=o+n[i-1]<<1;for(r=0;r<=e;r++){var s=t[2*r+1];0!==s&&(t[2*r]=Rb(a[s]++,s))}},zb=function(t){var e;for(e=0;e<hb;e++)t.dyn_ltree[2*e]=0;for(e=0;e<pb;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Ob=function(t){t.bi_valid>8?Pb(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Fb=function(t,e,n,i){var r=2*e,a=2*n;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[n]},Nb=function(t,e,n){for(var i=t.heap[n],r=n<<1;r<=t.heap_len&&(r<t.heap_len&&Fb(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Fb(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},Bb=function(t,e,n){var i,r,a,o,s=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],r=t.pending_buf[t.l_buf+s],s++,0===i?Lb(t,r,e):(a=xb[r],Lb(t,a+cb+1,e),0!==(o=db[a])&&(r-=wb[a],Ab(t,r,o)),i--,a=Ib(i),Lb(t,a,n),0!==(o=vb[a])&&(i-=Tb[a],Ab(t,i,o)))}while(s<t.last_lit);Lb(t,256,e)},jb=function(t,e){var n,i,r,a=e.dyn_tree,o=e.stat_desc.static_tree,s=e.stat_desc.has_stree,u=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<u;n++)0!==a[2*n]?(t.heap[++t.heap_len]=l=n,t.depth[n]=0):a[2*n+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[r]=0,t.opt_len--,s&&(t.static_len-=o[2*r+1]);for(e.max_code=l,n=t.heap_len>>1;n>=1;n--)Nb(t,a,n);r=u;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Nb(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=i,a[2*r]=a[2*n]+a[2*i],t.depth[r]=(t.depth[n]>=t.depth[i]?t.depth[n]:t.depth[i])+1,a[2*n+1]=a[2*i+1]=r,t.heap[1]=r++,Nb(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,i,r,a,o,s,u=e.dyn_tree,l=e.max_code,c=e.stat_desc.static_tree,h=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,d=e.stat_desc.max_length,v=0;for(a=0;a<=fb;a++)t.bl_count[a]=0;for(u[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<573;n++)(a=u[2*u[2*(i=t.heap[n])+1]+1]+1)>d&&(a=d,v++),u[2*i+1]=a,i>l||(t.bl_count[a]++,o=0,i>=f&&(o=p[i-f]),s=u[2*i],t.opt_len+=s*(a+o),h&&(t.static_len+=s*(c[2*i+1]+o)));if(0!==v){do{for(a=d-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[d]--,v-=2}while(v>0);for(a=d;0!==a;a--)for(i=t.bl_count[a];0!==i;)(r=t.heap[--n])>l||(u[2*r+1]!==a&&(t.opt_len+=(a-u[2*r+1])*u[2*r],u[2*r+1]=a),i--)}}(t,e),Db(a,l,t.bl_count)},Vb=function(t,e,n){var i,r,a=-1,o=e[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=e[2*(i+1)+1],++s<u&&r===o||(s<l?t.bl_tree[2*r]+=s:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,a=r,0===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4))},Ub=function(t,e,n){var i,r,a=-1,o=e[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),i=0;i<=n;i++)if(r=o,o=e[2*(i+1)+1],!(++s<u&&r===o)){if(s<l)do{Lb(t,r,t.bl_tree)}while(0!==--s);else 0!==r?(r!==a&&(Lb(t,r,t.bl_tree),s--),Lb(t,16,t.bl_tree),Ab(t,s-3,2)):s<=10?(Lb(t,17,t.bl_tree),Ab(t,s-3,3)):(Lb(t,18,t.bl_tree),Ab(t,s-11,7));s=0,a=r,0===o?(u=138,l=3):r===o?(u=6,l=3):(u=7,l=4)}},$b=!1,Hb=function(t,e,n,i){Ab(t,0+(i?1:0),3),function(t,e,n,i){Ob(t),i&&(Pb(t,n),Pb(t,~n)),t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n}(t,e,n,!0)},qb=function(t,e,n,i){var r,a,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<cb;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),jb(t,t.l_desc),jb(t,t.d_desc),o=function(t){var e;for(Vb(t,t.dyn_ltree,t.l_desc.max_code),Vb(t,t.dyn_dtree,t.d_desc.max_code),jb(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*gb[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=n+5,n+4<=r&&-1!==e?Hb(t,e,n,i):4===t.strategy||a===r?(Ab(t,2+(i?1:0),3),Bb(t,yb,_b)):(Ab(t,4+(i?1:0),3),function(t,e,n,i){var r;for(Ab(t,e-257,5),Ab(t,n-1,5),Ab(t,i-4,4),r=0;r<i;r++)Ab(t,t.bl_tree[2*gb[r]+1],3);Ub(t,t.dyn_ltree,e-1),Ub(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Bb(t,t.dyn_ltree,t.dyn_dtree)),zb(t),i&&Ob(t)},Wb={_tr_init:function(t){$b||(!function(){var t,e,n,i,r,a=new Array(16);for(n=0,i=0;i<28;i++)for(wb[i]=n,t=0;t<1<<db[i];t++)xb[n++]=i;for(xb[n-1]=i,r=0,i=0;i<16;i++)for(Tb[i]=r,t=0;t<1<<vb[i];t++)bb[r++]=i;for(r>>=7;i<pb;i++)for(Tb[i]=r<<7,t=0;t<1<<vb[i]-7;t++)bb[256+r++]=i;for(e=0;e<=fb;e++)a[e]=0;for(t=0;t<=143;)yb[2*t+1]=8,t++,a[8]++;for(;t<=255;)yb[2*t+1]=9,t++,a[9]++;for(;t<=279;)yb[2*t+1]=7,t++,a[7]++;for(;t<=287;)yb[2*t+1]=8,t++,a[8]++;for(Db(yb,287,a),t=0;t<pb;t++)_b[2*t+1]=5,_b[2*t]=Rb(t,5);Sb=new Eb(yb,db,257,hb,fb),kb=new Eb(_b,vb,0,pb,fb),Mb=new Eb(new Array(0),mb,0,19,7)}(),$b=!0),t.l_desc=new Cb(t.dyn_ltree,Sb),t.d_desc=new Cb(t.dyn_dtree,kb),t.bl_desc=new Cb(t.bl_tree,Mb),t.bi_buf=0,t.bi_valid=0,zb(t)},_tr_stored_block:Hb,_tr_flush_block:qb,_tr_tally:function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(xb[n]+cb+1)]++,t.dyn_dtree[2*Ib(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){Ab(t,2,3),Lb(t,256,yb),function(t){16===t.bi_valid?(Pb(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},Gb=function(t,e,n,i){for(var r=65535&t|0,a=t>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(r=r+e[i++]|0)|0}while(--o);r%=65521,a%=65521}return r|a<<16|0},Zb=new Uint32Array(function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}()),Xb=function(t,e,n,i){var r=Zb,a=i+n;t^=-1;for(var o=i;o<a;o++)t=t>>>8^r[255&(t^e[o])];return-1^t},Yb={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Kb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Jb=Wb._tr_init,Qb=Wb._tr_stored_block,tx=Wb._tr_flush_block,ex=Wb._tr_tally,nx=Wb._tr_align,ix=Kb.Z_NO_FLUSH,rx=Kb.Z_PARTIAL_FLUSH,ax=Kb.Z_FULL_FLUSH,ox=Kb.Z_FINISH,sx=Kb.Z_BLOCK,ux=Kb.Z_OK,lx=Kb.Z_STREAM_END,cx=Kb.Z_STREAM_ERROR,hx=Kb.Z_DATA_ERROR,px=Kb.Z_BUF_ERROR,fx=Kb.Z_DEFAULT_COMPRESSION,dx=Kb.Z_FILTERED,vx=Kb.Z_HUFFMAN_ONLY,mx=Kb.Z_RLE,gx=Kb.Z_FIXED,yx=Kb.Z_DEFAULT_STRATEGY,_x=Kb.Z_UNKNOWN,bx=Kb.Z_DEFLATED,xx=258,wx=262,Sx=103,kx=113,Mx=666,Tx=function(t,e){return t.msg=Yb[e],e},Ex=function(t){return(t<<1)-(t>4?9:0)},Cx=function(t){for(var e=t.length;--e>=0;)t[e]=0},Ix=function(t,e,n){return(e<<t.hash_shift^n)&t.hash_mask},Px=function(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},Ax=function(t,e){tx(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Px(t.strm)},Lx=function(t,e){t.pending_buf[t.pending++]=e},Rx=function(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Dx=function(t,e,n,i){var r=t.avail_in;return r>i&&(r=i),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),1===t.state.wrap?t.adler=Gb(t.adler,e,r,n):2===t.state.wrap&&(t.adler=Xb(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},zx=function(t,e){var n,i,r=t.max_chain_length,a=t.strstart,o=t.prev_length,s=t.nice_match,u=t.strstart>t.w_size-wx?t.strstart-(t.w_size-wx):0,l=t.window,c=t.w_mask,h=t.prev,p=t.strstart+xx,f=l[a+o-1],d=l[a+o];t.prev_length>=t.good_match&&(r>>=2),s>t.lookahead&&(s=t.lookahead);do{if(l[(n=e)+o]===d&&l[n+o-1]===f&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<p);if(i=xx-(p-a),a=p-xx,i>o){if(t.match_start=e,o=i,i>=s)break;f=l[a+o-1],d=l[a+o]}}}while((e=h[e&c])>u&&0!==--r);return o<=t.lookahead?o:t.lookahead},Ox=function(t){var e,n,i,r,a,o=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=o+(o-wx)){t.window.set(t.window.subarray(o,o+o),0),t.match_start-=o,t.strstart-=o,t.block_start-=o,e=n=t.hash_size;do{i=t.head[--e],t.head[e]=i>=o?i-o:0}while(--n);e=n=o;do{i=t.prev[--e],t.prev[e]=i>=o?i-o:0}while(--n);r+=o}if(0===t.strm.avail_in)break;if(n=Dx(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=Ix(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=Ix(t,t.ins_h,t.window[a+3-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<wx&&0!==t.strm.avail_in)},Fx=function(t,e){for(var n,i;;){if(t.lookahead<wx){if(Ox(t),t.lookahead<wx&&e===ix)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=Ix(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-wx&&(t.match_length=zx(t,n)),t.match_length>=3)if(i=ex(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Ix(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ix(t,t.ins_h,t.window[t.strstart+1]);else i=ex(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(Ax(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===ox?(Ax(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ax(t,!1),0===t.strm.avail_out)?1:2},Nx=function(t,e){for(var n,i,r;;){if(t.lookahead<wx){if(Ox(t),t.lookahead<wx&&e===ix)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=Ix(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-wx&&(t.match_length=zx(t,n),t.match_length<=5&&(t.strategy===dx||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=ex(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=Ix(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(Ax(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=ex(t,0,t.window[t.strstart-1]))&&Ax(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=ex(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===ox?(Ax(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ax(t,!1),0===t.strm.avail_out)?1:2};function Bx(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}var jx=[new Bx(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Ox(t),0===t.lookahead&&e===ix)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+n;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,Ax(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-wx&&(Ax(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ox?(Ax(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(Ax(t,!1),t.strm.avail_out),1)})),new Bx(4,4,8,4,Fx),new Bx(4,5,16,8,Fx),new Bx(4,6,32,32,Fx),new Bx(4,4,16,16,Nx),new Bx(8,16,32,32,Nx),new Bx(8,16,128,128,Nx),new Bx(8,32,128,256,Nx),new Bx(32,128,258,1024,Nx),new Bx(32,258,258,4096,Nx)];function Vx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=bx,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Cx(this.dyn_ltree),Cx(this.dyn_dtree),Cx(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Cx(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Cx(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Ux=function(t){if(!t||!t.state)return Tx(t,cx);t.total_in=t.total_out=0,t.data_type=_x;var e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:kx,t.adler=2===e.wrap?0:1,e.last_flush=ix,Jb(e),ux},$x=function(t){var e,n=Ux(t);return n===ux&&((e=t.state).window_size=2*e.w_size,Cx(e.head),e.max_lazy_match=jx[e.level].max_lazy,e.good_match=jx[e.level].good_length,e.nice_match=jx[e.level].nice_length,e.max_chain_length=jx[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),n},Hx=function(t,e,n,i,r,a){if(!t)return cx;var o=1;if(e===fx&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==bx||i<8||i>15||e<0||e>9||a<0||a>gx)return Tx(t,cx);8===i&&(i=9);var s=new Vx;return t.state=s,s.strm=t,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=a,s.method=n,$x(t)},qx=function(t,e){var n,i;if(!t||!t.state||e>sx||e<0)return t?Tx(t,cx):cx;var r=t.state;if(!t.output||!t.input&&0!==t.avail_in||r.status===Mx&&e!==ox)return Tx(t,0===t.avail_out?px:cx);r.strm=t;var a=r.last_flush;if(r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,Lx(r,31),Lx(r,139),Lx(r,8),r.gzhead?(Lx(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Lx(r,255&r.gzhead.time),Lx(r,r.gzhead.time>>8&255),Lx(r,r.gzhead.time>>16&255),Lx(r,r.gzhead.time>>24&255),Lx(r,9===r.level?2:r.strategy>=vx||r.level<2?4:0),Lx(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Lx(r,255&r.gzhead.extra.length),Lx(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Xb(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Lx(r,0),Lx(r,0),Lx(r,0),Lx(r,0),Lx(r,0),Lx(r,9===r.level?2:r.strategy>=vx||r.level<2?4:0),Lx(r,3),r.status=kx);else{var o=bx+(r.w_bits-8<<4)<<8;o|=(r.strategy>=vx||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(o|=32),o+=31-o%31,r.status=kx,Rx(r,o),0!==r.strstart&&(Rx(r,t.adler>>>16),Rx(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(t.adler=Xb(t.adler,r.pending_buf,r.pending-n,n)),Px(t),n=r.pending,r.pending!==r.pending_buf_size));)Lx(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(t.adler=Xb(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=Xb(t.adler,r.pending_buf,r.pending-n,n)),Px(t),n=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Lx(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>n&&(t.adler=Xb(t.adler,r.pending_buf,r.pending-n,n)),0===i&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=Xb(t.adler,r.pending_buf,r.pending-n,n)),Px(t),n=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Lx(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>n&&(t.adler=Xb(t.adler,r.pending_buf,r.pending-n,n)),0===i&&(r.status=Sx)}else r.status=Sx;if(r.status===Sx&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Px(t),r.pending+2<=r.pending_buf_size&&(Lx(r,255&t.adler),Lx(r,t.adler>>8&255),t.adler=0,r.status=kx)):r.status=kx),0!==r.pending){if(Px(t),0===t.avail_out)return r.last_flush=-1,ux}else if(0===t.avail_in&&Ex(e)<=Ex(a)&&e!==ox)return Tx(t,px);if(r.status===Mx&&0!==t.avail_in)return Tx(t,px);if(0!==t.avail_in||0!==r.lookahead||e!==ix&&r.status!==Mx){var s=r.strategy===vx?function(t,e){for(var n;;){if(0===t.lookahead&&(Ox(t),0===t.lookahead)){if(e===ix)return 1;break}if(t.match_length=0,n=ex(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Ax(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ox?(Ax(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ax(t,!1),0===t.strm.avail_out)?1:2}(r,e):r.strategy===mx?function(t,e){for(var n,i,r,a,o=t.window;;){if(t.lookahead<=xx){if(Ox(t),t.lookahead<=xx&&e===ix)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=o[r=t.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){a=t.strstart+xx;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<a);t.match_length=xx-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=ex(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=ex(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Ax(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===ox?(Ax(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(Ax(t,!1),0===t.strm.avail_out)?1:2}(r,e):jx[r.level].func(r,e);if(3!==s&&4!==s||(r.status=Mx),1===s||3===s)return 0===t.avail_out&&(r.last_flush=-1),ux;if(2===s&&(e===rx?nx(r):e!==sx&&(Qb(r,0,0,!1),e===ax&&(Cx(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Px(t),0===t.avail_out))return r.last_flush=-1,ux}return e!==ox?ux:r.wrap<=0?lx:(2===r.wrap?(Lx(r,255&t.adler),Lx(r,t.adler>>8&255),Lx(r,t.adler>>16&255),Lx(r,t.adler>>24&255),Lx(r,255&t.total_in),Lx(r,t.total_in>>8&255),Lx(r,t.total_in>>16&255),Lx(r,t.total_in>>24&255)):(Rx(r,t.adler>>>16),Rx(r,65535&t.adler)),Px(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?ux:lx)},Wx={deflateInit:function(t,e){return Hx(t,e,bx,15,8,yx)},deflateInit2:Hx,deflateReset:$x,deflateResetKeep:Ux,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?cx:(t.state.gzhead=e,ux):cx},deflate:qx,deflateEnd:function(t){if(!t||!t.state)return cx;var e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==Sx&&e!==kx&&e!==Mx?Tx(t,cx):(t.state=null,e===kx?Tx(t,hx):ux)},deflateSetDictionary:function(t,e){var n=e.length;if(!t||!t.state)return cx;var i=t.state,r=i.wrap;if(2===r||1===r&&42!==i.status||i.lookahead)return cx;if(1===r&&(t.adler=Gb(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){0===r&&(Cx(i.head),i.strstart=0,i.block_start=0,i.insert=0);var a=new Uint8Array(i.w_size);a.set(e.subarray(n-i.w_size,n),0),e=a,n=i.w_size}var o=t.avail_in,s=t.next_in,u=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Ox(i);i.lookahead>=3;){var l=i.strstart,c=i.lookahead-2;do{i.ins_h=Ix(i,i.ins_h,i.window[l+3-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++}while(--c);i.strstart=l,i.lookahead=2,Ox(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=s,t.input=u,t.avail_in=o,i.wrap=r,ux},deflateInfo:"pako deflate (from Nodeca project)"},Gx=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},Zx=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var i in n)Gx(n,i)&&(t[i]=n[i])}}return t},Xx=function(t){for(var e=0,n=0,i=t.length;n<i;n++)e+=t[n].length;for(var r=new Uint8Array(e),a=0,o=0,s=t.length;a<s;a++){var u=t[a];r.set(u,o),o+=u.length}return r},Yx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(nL){Yx=!1}for(var Kx=new Uint8Array(256),Jx=0;Jx<256;Jx++)Kx[Jx]=Jx>=252?6:Jx>=248?5:Jx>=240?4:Jx>=224?3:Jx>=192?2:1;Kx[254]=Kx[254]=1;var Qx=function(t){var e,n,i,r,a,o=t.length,s=0;for(r=0;r<o;r++)55296===(64512&(n=t.charCodeAt(r)))&&r+1<o&&56320===(64512&(i=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(s),a=0,r=0;a<s;r++)55296===(64512&(n=t.charCodeAt(r)))&&r+1<o&&56320===(64512&(i=t.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},tw=function(t,e){var n,i,r=e||t.length,a=new Array(2*r);for(i=0,n=0;n<r;){var o=t[n++];if(o<128)a[i++]=o;else{var s=Kx[o];if(s>4)a[i++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<r;)o=o<<6|63&t[n++],s--;s>1?a[i++]=65533:o<65536?a[i++]=o:(o-=65536,a[i++]=55296|o>>10&1023,a[i++]=56320|1023&o)}}}return function(t,e){if(e<65534&&t.subarray&&Yx)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));for(var n="",i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n}(a,i)},ew=function(t,e){(e=e||t.length)>t.length&&(e=t.length);for(var n=e-1;n>=0&&128===(192&t[n]);)n--;return n<0||0===n?e:n+Kx[t[n]]>e?n:e};var nw=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},iw=Object.prototype.toString,rw=Kb.Z_NO_FLUSH,aw=Kb.Z_SYNC_FLUSH,ow=Kb.Z_FULL_FLUSH,sw=Kb.Z_FINISH,uw=Kb.Z_OK,lw=Kb.Z_STREAM_END,cw=Kb.Z_DEFAULT_COMPRESSION,hw=Kb.Z_DEFAULT_STRATEGY,pw=Kb.Z_DEFLATED;function fw(t){this.options=Zx({level:cw,method:pw,chunkSize:16384,windowBits:15,memLevel:8,strategy:hw},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nw,this.strm.avail_out=0;var n=Wx.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==uw)throw new Error(Yb[n]);if(e.header&&Wx.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"===typeof e.dictionary?Qx(e.dictionary):"[object ArrayBuffer]"===iw.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=Wx.deflateSetDictionary(this.strm,i))!==uw)throw new Error(Yb[n]);this._dict_set=!0}}fw.prototype.push=function(t,e){var n,i,r=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(i=e===~~e?e:!0===e?sw:rw,"string"===typeof t?r.input=Qx(t):"[object ArrayBuffer]"===iw.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(i===aw||i===ow)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if((n=Wx.deflate(r,i))===lw)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=Wx.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===uw;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},fw.prototype.onData=function(t){this.chunks.push(t)},fw.prototype.onEnd=function(t){t===uw&&(this.result=Xx(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var dw=function(t,e){var n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M,T=t.state;n=t.next_in,k=t.input,i=n+(t.avail_in-5),r=t.next_out,M=t.output,a=r-(e-t.avail_out),o=r+(t.avail_out-257),s=T.dmax,u=T.wsize,l=T.whave,c=T.wnext,h=T.window,p=T.hold,f=T.bits,d=T.lencode,v=T.distcode,m=(1<<T.lenbits)-1,g=(1<<T.distbits)-1;t:do{f<15&&(p+=k[n++]<<f,f+=8,p+=k[n++]<<f,f+=8),y=d[p&m];e:for(;;){if(p>>>=_=y>>>24,f-=_,0===(_=y>>>16&255))M[r++]=65535&y;else{if(!(16&_)){if(0===(64&_)){y=d[(65535&y)+(p&(1<<_)-1)];continue e}if(32&_){T.mode=12;break t}t.msg="invalid literal/length code",T.mode=30;break t}b=65535&y,(_&=15)&&(f<_&&(p+=k[n++]<<f,f+=8),b+=p&(1<<_)-1,p>>>=_,f-=_),f<15&&(p+=k[n++]<<f,f+=8,p+=k[n++]<<f,f+=8),y=v[p&g];n:for(;;){if(p>>>=_=y>>>24,f-=_,!(16&(_=y>>>16&255))){if(0===(64&_)){y=v[(65535&y)+(p&(1<<_)-1)];continue n}t.msg="invalid distance code",T.mode=30;break t}if(x=65535&y,f<(_&=15)&&(p+=k[n++]<<f,(f+=8)<_&&(p+=k[n++]<<f,f+=8)),(x+=p&(1<<_)-1)>s){t.msg="invalid distance too far back",T.mode=30;break t}if(p>>>=_,f-=_,x>(_=r-a)){if((_=x-_)>l&&T.sane){t.msg="invalid distance too far back",T.mode=30;break t}if(w=0,S=h,0===c){if(w+=u-_,_<b){b-=_;do{M[r++]=h[w++]}while(--_);w=r-x,S=M}}else if(c<_){if(w+=u+c-_,(_-=c)<b){b-=_;do{M[r++]=h[w++]}while(--_);if(w=0,c<b){b-=_=c;do{M[r++]=h[w++]}while(--_);w=r-x,S=M}}}else if(w+=c-_,_<b){b-=_;do{M[r++]=h[w++]}while(--_);w=r-x,S=M}for(;b>2;)M[r++]=S[w++],M[r++]=S[w++],M[r++]=S[w++],b-=3;b&&(M[r++]=S[w++],b>1&&(M[r++]=S[w++]))}else{w=r-x;do{M[r++]=M[w++],M[r++]=M[w++],M[r++]=M[w++],b-=3}while(b>2);b&&(M[r++]=M[w++],b>1&&(M[r++]=M[w++]))}break}}break}}while(n<i&&r<o);n-=b=f>>3,p&=(1<<(f-=b<<3))-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<o?o-r+257:257-(r-o),T.hold=p,T.bits=f},vw=15,mw=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),gw=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yw=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),_w=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bw=function(t,e,n,i,r,a,o,s){var u,l,c,h,p,f,d,v,m,g=s.bits,y=0,_=0,b=0,x=0,w=0,S=0,k=0,M=0,T=0,E=0,C=null,I=0,P=new Uint16Array(16),A=new Uint16Array(16),L=null,R=0;for(y=0;y<=vw;y++)P[y]=0;for(_=0;_<i;_++)P[e[n+_]]++;for(w=g,x=vw;x>=1&&0===P[x];x--);if(w>x&&(w=x),0===x)return r[a++]=20971520,r[a++]=20971520,s.bits=1,0;for(b=1;b<x&&0===P[b];b++);for(w<b&&(w=b),M=1,y=1;y<=vw;y++)if(M<<=1,(M-=P[y])<0)return-1;if(M>0&&(0===t||1!==x))return-1;for(A[1]=0,y=1;y<vw;y++)A[y+1]=A[y]+P[y];for(_=0;_<i;_++)0!==e[n+_]&&(o[A[e[n+_]]++]=_);if(0===t?(C=L=o,f=19):1===t?(C=mw,I-=257,L=gw,R-=257,f=256):(C=yw,L=_w,f=-1),E=0,_=0,y=b,p=a,S=w,k=0,c=-1,h=(T=1<<w)-1,1===t&&T>852||2===t&&T>592)return 1;for(;;){d=y-k,o[_]<f?(v=0,m=o[_]):o[_]>f?(v=L[R+o[_]],m=C[I+o[_]]):(v=96,m=0),u=1<<y-k,b=l=1<<S;do{r[p+(E>>k)+(l-=u)]=d<<24|v<<16|m|0}while(0!==l);for(u=1<<y-1;E&u;)u>>=1;if(0!==u?(E&=u-1,E+=u):E=0,_++,0===--P[y]){if(y===x)break;y=e[n+o[_]]}if(y>w&&(E&h)!==c){for(0===k&&(k=w),p+=b,M=1<<(S=y-k);S+k<x&&!((M-=P[S+k])<=0);)S++,M<<=1;if(T+=1<<S,1===t&&T>852||2===t&&T>592)return 1;r[c=E&h]=w<<24|S<<16|p-a|0}}return 0!==E&&(r[p+E]=y-k<<24|64<<16|0),s.bits=w,0},xw=Kb.Z_FINISH,ww=Kb.Z_BLOCK,Sw=Kb.Z_TREES,kw=Kb.Z_OK,Mw=Kb.Z_STREAM_END,Tw=Kb.Z_NEED_DICT,Ew=Kb.Z_STREAM_ERROR,Cw=Kb.Z_DATA_ERROR,Iw=Kb.Z_MEM_ERROR,Pw=Kb.Z_BUF_ERROR,Aw=Kb.Z_DEFLATED,Lw=12,Rw=30,Dw=function(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)};function zw(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Ow,Fw,Nw=function(t){if(!t||!t.state)return Ew;var e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,kw},Bw=function(t){if(!t||!t.state)return Ew;var e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Nw(t)},jw=function(t,e){var n;if(!t||!t.state)return Ew;var i=t.state;return e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Ew:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,Bw(t))},Vw=function(t,e){if(!t)return Ew;var n=new zw;t.state=n,n.window=null;var i=jw(t,e);return i!==kw&&(t.state=null),i},Uw=!0,$w=function(t){if(Uw){Ow=new Int32Array(512),Fw=new Int32Array(32);for(var e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(bw(1,t.lens,0,288,Ow,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;bw(2,t.lens,0,32,Fw,0,t.work,{bits:5}),Uw=!1}t.lencode=Ow,t.lenbits=9,t.distcode=Fw,t.distbits=5},Hw=function(t,e,n,i){var r,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):((r=a.wsize-a.wnext)>i&&(r=i),a.window.set(e.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(e.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},qw=function(t,e){var n,i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M,T=0,E=new Uint8Array(4),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Ew;(n=t.state).mode===Lw&&(n.mode=13),o=t.next_out,r=t.output,u=t.avail_out,a=t.next_in,i=t.input,s=t.avail_in,l=n.hold,c=n.bits,h=s,p=u,S=kw;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;c<16;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(2&n.wrap&&35615===l){n.check=0,E[0]=255&l,E[1]=l>>>8&255,n.check=Xb(n.check,E,2,0),l=0,c=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=Rw;break}if((15&l)!==Aw){t.msg="unknown compression method",n.mode=Rw;break}if(c-=4,w=8+(15&(l>>>=4)),0===n.wbits)n.wbits=w;else if(w>n.wbits){t.msg="invalid window size",n.mode=Rw;break}n.dmax=1<<n.wbits,t.adler=n.check=1,n.mode=512&l?10:Lw,l=0,c=0;break;case 2:for(;c<16;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(n.flags=l,(255&n.flags)!==Aw){t.msg="unknown compression method",n.mode=Rw;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Rw;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(E[0]=255&l,E[1]=l>>>8&255,n.check=Xb(n.check,E,2,0)),l=0,c=0,n.mode=3;case 3:for(;c<32;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}n.head&&(n.head.time=l),512&n.flags&&(E[0]=255&l,E[1]=l>>>8&255,E[2]=l>>>16&255,E[3]=l>>>24&255,n.check=Xb(n.check,E,4,0)),l=0,c=0,n.mode=4;case 4:for(;c<16;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(E[0]=255&l,E[1]=l>>>8&255,n.check=Xb(n.check,E,2,0)),l=0,c=0,n.mode=5;case 5:if(1024&n.flags){for(;c<16;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(E[0]=255&l,E[1]=l>>>8&255,n.check=Xb(n.check,E,2,0)),l=0,c=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((f=n.length)>s&&(f=s),f&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+f),w)),512&n.flags&&(n.check=Xb(n.check,i,f,a)),s-=f,a+=f,n.length-=f),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break t;f=0;do{w=i[a+f++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&f<s);if(512&n.flags&&(n.check=Xb(n.check,i,f,a)),s-=f,a+=f,w)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break t;f=0;do{w=i[a+f++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&f<s);if(512&n.flags&&(n.check=Xb(n.check,i,f,a)),s-=f,a+=f,w)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;c<16;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(l!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Rw;break}l=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Lw;break;case 10:for(;c<32;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}t.adler=n.check=Dw(l),l=0,c=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=o,t.avail_out=u,t.next_in=a,t.avail_in=s,n.hold=l,n.bits=c,Tw;t.adler=n.check=1,n.mode=Lw;case Lw:if(e===ww||e===Sw)break t;case 13:if(n.last){l>>>=7&c,c-=7&c,n.mode=27;break}for(;c<3;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}switch(n.last=1&l,c-=1,3&(l>>>=1)){case 0:n.mode=14;break;case 1:if($w(n),n.mode=20,e===Sw){l>>>=2,c-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=Rw}l>>>=2,c-=2;break;case 14:for(l>>>=7&c,c-=7&c;c<32;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if((65535&l)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Rw;break}if(n.length=65535&l,l=0,c=0,n.mode=15,e===Sw)break t;case 15:n.mode=16;case 16:if(f=n.length){if(f>s&&(f=s),f>u&&(f=u),0===f)break t;r.set(i.subarray(a,a+f),o),s-=f,a+=f,u-=f,o+=f,n.length-=f;break}n.mode=Lw;break;case 17:for(;c<14;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(n.nlen=257+(31&l),l>>>=5,c-=5,n.ndist=1+(31&l),l>>>=5,c-=5,n.ncode=4+(15&l),l>>>=4,c-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Rw;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;c<3;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}n.lens[C[n.have++]]=7&l,l>>>=3,c-=3}for(;n.have<19;)n.lens[C[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},S=bw(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,S){t.msg="invalid code lengths set",n.mode=Rw;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;g=(T=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,y=65535&T,!((m=T>>>24)<=c);){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(y<16)l>>>=m,c-=m,n.lens[n.have++]=y;else{if(16===y){for(M=m+2;c<M;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(l>>>=m,c-=m,0===n.have){t.msg="invalid bit length repeat",n.mode=Rw;break}w=n.lens[n.have-1],f=3+(3&l),l>>>=2,c-=2}else if(17===y){for(M=m+3;c<M;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}c-=m,w=0,f=3+(7&(l>>>=m)),l>>>=3,c-=3}else{for(M=m+7;c<M;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}c-=m,w=0,f=11+(127&(l>>>=m)),l>>>=7,c-=7}if(n.have+f>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Rw;break}for(;f--;)n.lens[n.have++]=w}}if(n.mode===Rw)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Rw;break}if(n.lenbits=9,k={bits:n.lenbits},S=bw(1,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,S){t.msg="invalid literal/lengths set",n.mode=Rw;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},S=bw(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,S){t.msg="invalid distances set",n.mode=Rw;break}if(n.mode=20,e===Sw)break t;case 20:n.mode=21;case 21:if(s>=6&&u>=258){t.next_out=o,t.avail_out=u,t.next_in=a,t.avail_in=s,n.hold=l,n.bits=c,dw(t,p),o=t.next_out,r=t.output,u=t.avail_out,a=t.next_in,i=t.input,s=t.avail_in,l=n.hold,c=n.bits,n.mode===Lw&&(n.back=-1);break}for(n.back=0;g=(T=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,y=65535&T,!((m=T>>>24)<=c);){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(g&&0===(240&g)){for(_=m,b=g,x=y;g=(T=n.lencode[x+((l&(1<<_+b)-1)>>_)])>>>16&255,y=65535&T,!(_+(m=T>>>24)<=c);){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}l>>>=_,c-=_,n.back+=_}if(l>>>=m,c-=m,n.back+=m,n.length=y,0===g){n.mode=26;break}if(32&g){n.back=-1,n.mode=Lw;break}if(64&g){t.msg="invalid literal/length code",n.mode=Rw;break}n.extra=15&g,n.mode=22;case 22:if(n.extra){for(M=n.extra;c<M;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;g=(T=n.distcode[l&(1<<n.distbits)-1])>>>16&255,y=65535&T,!((m=T>>>24)<=c);){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(0===(240&g)){for(_=m,b=g,x=y;g=(T=n.distcode[x+((l&(1<<_+b)-1)>>_)])>>>16&255,y=65535&T,!(_+(m=T>>>24)<=c);){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}l>>>=_,c-=_,n.back+=_}if(l>>>=m,c-=m,n.back+=m,64&g){t.msg="invalid distance code",n.mode=Rw;break}n.offset=y,n.extra=15&g,n.mode=24;case 24:if(n.extra){for(M=n.extra;c<M;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Rw;break}n.mode=25;case 25:if(0===u)break t;if(f=p-u,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Rw;break}f>n.wnext?(f-=n.wnext,d=n.wsize-f):d=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=r,d=o-n.offset,f=n.length;f>u&&(f=u),u-=f,n.length-=f;do{r[o++]=v[d++]}while(--f);0===n.length&&(n.mode=21);break;case 26:if(0===u)break t;r[o++]=n.length,u--,n.mode=21;break;case 27:if(n.wrap){for(;c<32;){if(0===s)break t;s--,l|=i[a++]<<c,c+=8}if(p-=u,t.total_out+=p,n.total+=p,p&&(t.adler=n.check=n.flags?Xb(n.check,r,p,o-p):Gb(n.check,r,p,o-p)),p=u,(n.flags?l:Dw(l))!==n.check){t.msg="incorrect data check",n.mode=Rw;break}l=0,c=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;c<32;){if(0===s)break t;s--,l+=i[a++]<<c,c+=8}if(l!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Rw;break}l=0,c=0}n.mode=29;case 29:S=Mw;break t;case Rw:S=Cw;break t;case 31:return Iw;default:return Ew}return t.next_out=o,t.avail_out=u,t.next_in=a,t.avail_in=s,n.hold=l,n.bits=c,(n.wsize||p!==t.avail_out&&n.mode<Rw&&(n.mode<27||e!==xw))&&Hw(t,t.output,t.next_out,p-t.avail_out),h-=t.avail_in,p-=t.avail_out,t.total_in+=h,t.total_out+=p,n.total+=p,n.wrap&&p&&(t.adler=n.check=n.flags?Xb(n.check,r,p,t.next_out-p):Gb(n.check,r,p,t.next_out-p)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Lw?128:0)+(20===n.mode||15===n.mode?256:0),(0===h&&0===p||e===xw)&&S===kw&&(S=Pw),S},Ww={inflateReset:Bw,inflateReset2:jw,inflateResetKeep:Nw,inflateInit:function(t){return Vw(t,15)},inflateInit2:Vw,inflate:qw,inflateEnd:function(t){if(!t||!t.state)return Ew;var e=t.state;return e.window&&(e.window=null),t.state=null,kw},inflateGetHeader:function(t,e){if(!t||!t.state)return Ew;var n=t.state;return 0===(2&n.wrap)?Ew:(n.head=e,e.done=!1,kw)},inflateSetDictionary:function(t,e){var n,i=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?Ew:11===n.mode&&Gb(1,e,i,0)!==n.check?Cw:Hw(t,e,i,i)?(n.mode=31,Iw):(n.havedict=1,kw):Ew},inflateInfo:"pako inflate (from Nodeca project)"};var Gw=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Zw=Object.prototype.toString,Xw=Kb.Z_NO_FLUSH,Yw=Kb.Z_FINISH,Kw=Kb.Z_OK,Jw=Kb.Z_STREAM_END,Qw=Kb.Z_NEED_DICT,tS=Kb.Z_STREAM_ERROR,eS=Kb.Z_DATA_ERROR,nS=Kb.Z_MEM_ERROR;function iS(t){this.options=Zx({chunkSize:65536,windowBits:15,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new nw,this.strm.avail_out=0;var n=Ww.inflateInit2(this.strm,e.windowBits);if(n!==Kw)throw new Error(Yb[n]);if(this.header=new Gw,Ww.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=Qx(e.dictionary):"[object ArrayBuffer]"===Zw.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Ww.inflateSetDictionary(this.strm,e.dictionary))!==Kw))throw new Error(Yb[n])}function rS(t,e){var n=new iS(e);if(n.push(t),n.err)throw n.msg||Yb[n.err];return n.result}iS.prototype.push=function(t,e){var n,i,r,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?Yw:Xw,"[object ArrayBuffer]"===Zw.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),(n=Ww.inflate(a,i))===Qw&&s&&((n=Ww.inflateSetDictionary(a,s))===Kw?n=Ww.inflate(a,i):n===eS&&(n=Qw));a.avail_in>0&&n===Jw&&a.state.wrap>0&&0!==t[a.next_in];)Ww.inflateReset(a),n=Ww.inflate(a,i);switch(n){case tS:case eS:case Qw:case nS:return this.onEnd(n),this.ended=!0,!1}if(r=a.avail_out,a.next_out&&(0===a.avail_out||n===Jw))if("string"===this.options.to){var u=ew(a.output,a.next_out),l=a.next_out-u,c=tw(a.output,u);a.next_out=l,a.avail_out=o-l,l&&a.output.set(a.output.subarray(u,u+l),0),this.onData(c)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==Kw||0!==r){if(n===Jw)return n=Ww.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},iS.prototype.onData=function(t){this.chunks.push(t)},iS.prototype.onEnd=function(t){t===Kw&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Xx(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var aS={Inflate:iS,inflate:rS,inflateRaw:function(t,e){return(e=e||{}).raw=!0,rS(t,e)},ungzip:rS,constants:Kb},oS=aS.inflate,sS=function(t,e,n,i,r){var a,o,s=8*r-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?r-1:0,p=n?-1:1,f=t[e+h];for(h+=p,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=p,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=l}return(f?-1:1)*o*Math.pow(2,a-i)},uS=function(t,e,n,i,r,a){var o,s,u,l=8*a-r-1,c=(1<<l)-1,h=c>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,d=i?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+f]=255&s,f+=d,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;t[n+f]=255&o,f+=d,o/=256,l-=8);t[n+f-d]|=128*v},lS=cS;function cS(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}cS.Varint=0,cS.Fixed64=1,cS.Bytes=2,cS.Fixed32=5;var hS=4294967296,pS=1/hS,fS="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function dS(t){return t.type===cS.Bytes?t.readVarint()+t.pos:t.pos+1}function vS(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function mS(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function gS(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function yS(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function _S(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function bS(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function xS(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function wS(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function SS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function kS(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function MS(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function TS(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ES(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function CS(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function IS(t,e){return PS(t,"GET","arraybuffer",[],null,e)}function PS(t,e,n,i,r,a){var o=new XMLHttpRequest,s=new Promise((function(a,s){o.open(e,t,!0);var u,l=wt(i);try{for(l.s();!(u=l.n()).done;){var c=u.value;o.setRequestHeader(c.name,c.value)}}catch(Tx){l.e(Tx)}finally{l.f()}o.responseType=n,o.timeout=15e3,o.onload=function(){var e;if(200!==o.status){var n=null!==(e=o.response)&&void 0!==e?e:new Hf("Response status error: ".concat(t));s(n)}o.response||s(new Hf("Response empty: ".concat(t))),a(o.response)},o.onerror=function(){s(new Hf("Request error: ".concat(t)))},o.ontimeout=function(){s(new Hf("Request timeout: ".concat(t)))},o.onabort=function(){s(new Hf("Request aborted: ".concat(t)))},o.send("POST"===e?r:null)}));return a&&a.catch((function(){o.abort()})),s}function AS(t,e,n){1===t?e.vertices.push(n.readFloat()):2===t?e.faces.push(n.readVarint()):console.warn("Unsupported pbf tag (".concat(t,")"))}cS.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,t(r,e,this),this.pos===a&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=TS(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=CS(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=TS(this.buf,this.pos)+TS(this.buf,this.pos+4)*hS;return this.pos+=8,t},readSFixed64:function(){var t=TS(this.buf,this.pos)+CS(this.buf,this.pos+4)*hS;return this.pos+=8,t},readFloat:function(){var t=sS(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=sS(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,a=n.buf;if(r=a[n.pos++],i=(112&r)>>4,r<128)return vS(t,i,e);if(r=a[n.pos++],i|=(127&r)<<3,r<128)return vS(t,i,e);if(r=a[n.pos++],i|=(127&r)<<10,r<128)return vS(t,i,e);if(r=a[n.pos++],i|=(127&r)<<17,r<128)return vS(t,i,e);if(r=a[n.pos++],i|=(127&r)<<24,r<128)return vS(t,i,e);if(r=a[n.pos++],i|=(1&r)<<31,r<128)return vS(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&fS?function(t,e,n){return fS.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){var i="",r=e;for(;r<n;){var a,o,s,u=t[r],l=null,c=u>239?4:u>223?3:u>191?2:1;if(r+c>n)break;1===c?u<128&&(l=u):2===c?128===(192&(a=t[r+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(a=t[r+1],o=t[r+2],128===(192&a)&&128===(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[r+1],o=t[r+2],s=t[r+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==cS.Bytes)return t.push(this.readVarint(e));var n=dS(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==cS.Bytes)return t.push(this.readSVarint());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==cS.Bytes)return t.push(this.readBoolean());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==cS.Bytes)return t.push(this.readFloat());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==cS.Bytes)return t.push(this.readDouble());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==cS.Bytes)return t.push(this.readFixed32());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==cS.Bytes)return t.push(this.readSFixed32());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==cS.Bytes)return t.push(this.readFixed64());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==cS.Bytes)return t.push(this.readSFixed64());var e=dS(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===cS.Varint)for(;this.buf[this.pos++]>127;);else if(e===cS.Bytes)this.pos=this.readVarint()+this.pos;else if(e===cS.Fixed32)this.pos+=4;else{if(e!==cS.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ES(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ES(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ES(this.buf,-1&t,this.pos),ES(this.buf,Math.floor(t*pS),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ES(this.buf,-1&t,this.pos),ES(this.buf,Math.floor(t*pS),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,a=0;a<e.length;a++){if((i=e.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&mS(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),uS(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),uS(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&mS(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,cS.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,gS,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,yS,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,xS,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,_S,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,bS,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,wS,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,SS,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,kS,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,MS,e)},writeBytesField:function(t,e){this.writeTag(t,cS.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,cS.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,cS.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,cS.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,cS.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,cS.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,cS.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,cS.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,cS.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,cS.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var LS=function(){function t(){Tt(this,t)}return Ct(t,[{key:"bboxToCellIds",value:function(t,e){throw new Hf("Not implemented")}},{key:"getAdjacent",value:function(t){throw new Hf("Not implemented")}},{key:"getVertices",value:function(t){throw new Hf("Not implemented")}},{key:"lngLatToCellId",value:function(t){throw new Hf("Not implemented")}},{key:"_approxBboxToCellIds",value:function(t,e){if(e.lat<=t.lat||e.lng<=t.lng)throw new Hf("North east needs to be top right of south west");var n=(t.lat+e.lat)/2,i=(t.lng+e.lng)/2,r=Rf(e.lng,e.lat,0,i,n,0),a=Math.max(r[0],r[1]);return this._lngLatToCellIds({lat:n,lng:i},a)}},{key:"_enuToGeodetic",value:function(t,e){var n=rt(Df(t[0],t[1],t[2],e.lng,e.lat,0),2),i=n[0];return{lat:n[1],lng:i}}},{key:"_getLngLatBoundingBoxCorners",value:function(t,e){var n=this;return[[-e,e,0],[e,e,0],[e,-e,0],[-e,-e,0]].map((function(e){return n._enuToGeodetic(e,t)}))}},{key:"_lngLatToCellIds",value:function(t,e){var n,i=this.lngLatToCellId(t),r=wt(this._getLngLatBoundingBoxCorners(t,e));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(this.lngLatToCellId(a)!==i)return[i].concat(vt(this.getAdjacent(i)))}}catch(Tx){r.e(Tx)}finally{r.f()}return[i]}}]),t}(),RS=function(t){kt(n,t);var e=Mt(n);function n(t){var i;if(Tt(this,n),(i=e.call(this))._geometry=t,!(i._geometry instanceof LS))throw new Hf("The data provider requires a geometry provider base instance.");return i}return Ct(n,[{key:"geometry",get:function(){return this._geometry}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"getCoreImages",value:function(t){return Promise.reject(new Hf("Not implemented"))}},{key:"getCluster",value:function(t,e){return Promise.reject(new Hf("Not implemented"))}},{key:"getSpatialImages",value:function(t){return Promise.reject(new Hf("Not implemented"))}},{key:"getImages",value:function(t){return Promise.reject(new Hf("Not implemented"))}},{key:"getImageBuffer",value:function(t,e){return Promise.reject(new Hf("Not implemented"))}},{key:"getImageTiles",value:function(t){return Promise.reject(new Hf("Not implemented"))}},{key:"getMesh",value:function(t,e){return Promise.reject(new Hf("Not implemented"))}},{key:"getSequence",value:function(t){return Promise.reject(new Hf("Not implemented"))}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"setAccessToken",value:function(t){throw new Hf("Not implemented")}}]),n}(Sm),DS=av((function(t){!function(e,n){t&&t.exports?t.exports=n():(e.dcodeIO=e.dcodeIO||{}).Long=n()}(iv,(function(){function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var n={},i={};function r(t,e){var r,a,s;return e?(s=0<=(t>>>=0)&&t<256)&&(a=i[t])?a:(r=o(t,(0|t)<0?-1:0,!0),s&&(i[t]=r),r):(s=-128<=(t|=0)&&t<128)&&(a=n[t])?a:(r=o(t,t<0?-1:0,!1),s&&(n[t]=r),r)}function a(t,e){if(isNaN(t)||!isFinite(t))return e?v:d;if(e){if(t<0)return v;if(t>=h)return b}else{if(t<=-p)return x;if(t+1>=p)return _}return t<0?a(-t,e).neg():o(t%c|0,t/c|0,e)}function o(e,n,i){return new t(e,n,i)}t.fromInt=r,t.fromNumber=a,t.fromBits=o;var s=Math.pow;function u(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d;if("number"===typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(t.substring(1),e,n).neg();for(var r=a(s(n,8)),o=d,l=0;l<t.length;l+=8){var c=Math.min(8,t.length-l),h=parseInt(t.substring(l,l+c),n);if(c<8){var p=a(s(n,c));o=o.mul(p).add(a(h))}else o=(o=o.mul(r)).add(a(h))}return o.unsigned=e,o}function l(e){return e instanceof t?e:"number"===typeof e?a(e):"string"===typeof e?u(e):o(e.low,e.high,e.unsigned)}t.fromString=u,t.fromValue=l;var c=4294967296,h=c*c,p=h/2,f=r(1<<24),d=r(0);t.ZERO=d;var v=r(0,!0);t.UZERO=v;var m=r(1);t.ONE=m;var g=r(1,!0);t.UONE=g;var y=r(-1);t.NEG_ONE=y;var _=o(-1,2147483647,!1);t.MAX_VALUE=_;var b=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=b;var x=o(0,-2147483648,!1);t.MIN_VALUE=x;var w=t.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},w.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var e=a(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=a(s(t,6),this.unsigned),o=this,u="";;){var l=o.div(r),c=(o.sub(l.mul(r)).toInt()>>>0).toString(t);if((o=l).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1===(1&this.low)},w.isEven=function(){return 0===(1&this.low)},w.equals=function(t){return e(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!==1||t.high>>>31!==1)&&(this.high===t.high&&this.low===t.low)},w.eq=w.equals,w.notEquals=function(t){return!this.eq(t)},w.neq=w.notEquals,w.lessThan=function(t){return this.comp(t)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(t){return this.comp(t)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(t){return this.comp(t)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(t){return this.comp(t)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(t){if(e(t)||(t=l(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(m)},w.neg=w.negate,w.add=function(t){e(t)||(t=l(t));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,c=t.low>>>16,h=0,p=0,f=0,d=0;return f+=(d+=a+(65535&t.low))>>>16,p+=(f+=r+c)>>>16,h+=(p+=i+u)>>>16,h+=n+s,o((f&=65535)<<16|(d&=65535),(h&=65535)<<16|(p&=65535),this.unsigned)},w.subtract=function(t){return e(t)||(t=l(t)),this.add(t.neg())},w.sub=w.subtract,w.multiply=function(t){if(this.isZero())return d;if(e(t)||(t=l(t)),t.isZero())return d;if(this.eq(x))return t.isOdd()?x:d;if(t.eq(x))return this.isOdd()?x:d;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(f)&&t.lt(f))return a(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,u=t.high>>>16,c=65535&t.high,h=t.low>>>16,p=65535&t.low,v=0,m=0,g=0,y=0;return g+=(y+=s*p)>>>16,m+=(g+=r*p)>>>16,g&=65535,m+=(g+=s*h)>>>16,v+=(m+=i*p)>>>16,m&=65535,v+=(m+=r*h)>>>16,m&=65535,v+=(m+=s*c)>>>16,v+=n*p+i*h+r*c+s*u,o((g&=65535)<<16|(y&=65535),(v&=65535)<<16|(m&=65535),this.unsigned)},w.mul=w.multiply,w.divide=function(t){if(e(t)||(t=l(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?v:d;var n,i,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return v;if(t.gt(this.shru(1)))return g;r=v}else{if(this.eq(x))return t.eq(m)||t.eq(y)?x:t.eq(x)?m:(n=this.shr(1).div(t).shl(1)).eq(d)?t.isNegative()?m:y:(i=this.sub(t.mul(n)),r=n.add(i.div(t)));if(t.eq(x))return this.unsigned?v:d;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=d}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:s(2,o-48),c=a(n),h=c.mul(t);h.isNegative()||h.gt(i);)h=(c=a(n-=u,this.unsigned)).mul(t);c.isZero()&&(c=m),r=r.add(c),i=i.sub(h)}return r},w.div=w.divide,w.modulo=function(t){return e(t)||(t=l(t)),this.sub(this.div(t).mul(t))},w.mod=w.modulo,w.not=function(){return o(~this.low,~this.high,this.unsigned)},w.and=function(t){return e(t)||(t=l(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},w.or=function(t){return e(t)||(t=l(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},w.xor=function(t){return e(t)||(t=l(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},w.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(t){return e(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0===(t&=63))return this;var n=this.high;return t<32?o(this.low>>>t|n<<32-t,n>>>t,this.unsigned):o(32===t?n:n>>>t-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},w.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},w.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t}))})),zS=av((function(t){!function(t){var e=t.S2={L:{}};e.L.LatLng=function(t,e,n){var i=parseFloat(t,10),r=parseFloat(e,10);if(isNaN(i)||isNaN(r))throw new Error("Invalid LatLng object: ("+t+", "+e+")");return!0!==n&&(i=Math.max(Math.min(i,90),-90),r=(r+180)%360+(r<-180||180===r?180:-180)),{lat:i,lng:r}},e.L.LatLng.DEG_TO_RAD=Math.PI/180,e.L.LatLng.RAD_TO_DEG=180/Math.PI,e.LatLngToXYZ=function(t){var n=e.L.LatLng.DEG_TO_RAD,i=t.lat*n,r=t.lng*n,a=Math.cos(i);return[Math.cos(r)*a,Math.sin(r)*a,Math.sin(i)]},e.XYZToLatLng=function(t){var n=e.L.LatLng.RAD_TO_DEG,i=Math.atan2(t[2],Math.sqrt(t[0]*t[0]+t[1]*t[1])),r=Math.atan2(t[1],t[0]);return e.L.LatLng(i*n,r*n)};e.XYZToFaceUV=function(t){var e=function(t){var e=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])];return e[0]>e[1]?e[0]>e[2]?0:2:e[1]>e[2]?1:2}(t);t[e]<0&&(e+=3);var n=function(t,e){var n,i;switch(t){case 0:n=e[1]/e[0],i=e[2]/e[0];break;case 1:n=-e[0]/e[1],i=e[2]/e[1];break;case 2:n=-e[0]/e[2],i=-e[1]/e[2];break;case 3:n=e[2]/e[0],i=e[1]/e[0];break;case 4:n=e[2]/e[1],i=-e[0]/e[1];break;case 5:n=-e[1]/e[2],i=-e[0]/e[2];break;default:throw{error:"Invalid face"}}return[n,i]}(e,t);return[e,n]},e.FaceUVToXYZ=function(t,e){var n=e[0],i=e[1];switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw{error:"Invalid face"}}};var n=function(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))};e.STToUV=function(t){return[n(t[0]),n(t[1])]};var i=function(t){return t>=0?.5*Math.sqrt(1+3*t):1-.5*Math.sqrt(1-3*t)};e.UVToST=function(t){return[i(t[0]),i(t[1])]},e.STToIJ=function(t,e){var n=1<<e,i=function(t){var e=Math.floor(t*n);return Math.max(0,Math.min(n-1,e))};return[i(t[0]),i(t[1])]},e.IJToST=function(t,e,n){var i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]};var r=function(t,e,n,i){if(0==i){1==n&&(e.x=t-1-e.x,e.y=t-1-e.y);var r=e.x;e.x=e.y,e.y=r}},a=function(t,e,n,i){var r={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};"number"!==typeof i&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var a=i%2?"d":"a",o=[],s=n-1;s>=0;s--){var u=1<<s,l=r[a][2*(t&u?1:0)+(e&u?1:0)];o.push(l[0]),a=l[1]}return o};e.S2Cell=function(){},e.S2Cell.FromHilbertQuadKey=function(t){var n,i,a,o,s,u,l=t.split("/"),c=parseInt(l[0]),h=l[1],p=h.length,f={x:0,y:0};for(n=p-1;n>=0;n--)i=p-n,o=0,s=0,"1"===(a=h[n])?s=1:"2"===a?(o=1,s=1):"3"===a&&(o=1),u=Math.pow(2,i-1),r(u,f,o,s),f.x+=u*o,f.y+=u*s;if(c%2===1){var d=f.x;f.x=f.y,f.y=d}return e.S2Cell.FromFaceIJ(parseInt(c),[f.x,f.y],i)},e.S2Cell.FromLatLng=function(t,n){if(!t.lat&&0!==t.lat||!t.lng&&0!==t.lng)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var i=e.LatLngToXYZ(t),r=e.XYZToFaceUV(i),a=e.UVToST(r[1]),o=e.STToIJ(a,n);return e.S2Cell.FromFaceIJ(r[0],o,n)},e.S2Cell.FromFaceIJ=function(t,n,i){var r=new e.S2Cell;return r.face=t,r.ij=n,r.level=i,r},e.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},e.S2Cell.prototype.getLatLng=function(){var t=e.IJToST(this.ij,this.level,[.5,.5]),n=e.STToUV(t),i=e.FaceUVToXYZ(this.face,n);return e.XYZToLatLng(i)},e.S2Cell.prototype.getCornerLatLngs=function(){for(var t=[],n=[[0,0],[0,1],[1,1],[1,0]],i=0;i<4;i++){var r=e.IJToST(this.ij,this.level,n[i]),a=e.STToUV(r),o=e.FaceUVToXYZ(this.face,a);t.push(e.XYZToLatLng(o))}return t},e.S2Cell.prototype.getFaceAndQuads=function(){var t=a(this.ij[0],this.ij[1],this.level,this.face);return[this.face,t]},e.S2Cell.prototype.toHilbertQuadkey=function(){var t=a(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+t.join("")},e.latLngToNeighborKeys=e.S2Cell.latLngToNeighborKeys=function(t,n,i){return e.S2Cell.FromLatLng({lat:t,lng:n},i).getNeighbors().map((function(t){return t.toHilbertQuadkey()}))},e.S2Cell.prototype.getNeighbors=function(){var t=function(t,n,i){var r=1<<i;if(n[0]>=0&&n[1]>=0&&n[0]<r&&n[1]<r)return e.S2Cell.FromFaceIJ(t,n,i);var a=e.IJToST(n,i,[.5,.5]),o=e.STToUV(a),s=e.FaceUVToXYZ(t,o),u=e.XYZToFaceUV(s);return t=u[0],o=u[1],a=e.UVToST(o),n=e.STToIJ(a,i),e.S2Cell.FromFaceIJ(t,n,i)},n=this.face,i=this.ij[0],r=this.ij[1],a=this.level;return[t(n,[i-1,r],a),t(n,[i,r-1],a),t(n,[i+1,r],a),t(n,[i,r+1],a)]},e.FACE_BITS=3,e.MAX_LEVEL=30,e.POS_BITS=2*e.MAX_LEVEL+1,e.facePosLevelToId=e.S2Cell.facePosLevelToId=e.fromFacePosLevel=function(n,i,r){var a,o,s,u=t.dcodeIO&&t.dcodeIO.Long||DS;for(r||(r=i.length),i.length>r&&(i=i.substr(0,r)),a=u.fromString(n.toString(10),!0,10).toString(2);a.length<e.FACE_BITS;)a="0"+a;for(o=u.fromString(i,!0,4).toString(2);o.length<2*r;)o="0"+o;for(s=a+o,s+="1";s.length<e.FACE_BITS+e.POS_BITS;)s+="0";return u.fromString(s,!0,2).toString(10)},e.keyToId=e.S2Cell.keyToId=e.toId=e.toCellId=e.fromKey=function(t){var n=t.split("/");return e.fromFacePosLevel(n[0],n[1],n[1].length)},e.idToKey=e.S2Cell.idToKey=e.S2Cell.toKey=e.toKey=e.fromId=e.fromCellId=e.S2Cell.toHilbertQuadkey=e.toHilbertQuadkey=function(n){for(var i=t.dcodeIO&&t.dcodeIO.Long||DS,r=i.fromString(n,!0,10).toString(2);r.length<e.FACE_BITS+e.POS_BITS;)r="0"+r;for(var a=r.lastIndexOf("1"),o=r.substring(0,3),s=r.substring(3,a),u=s.length/2,l=i.fromString(o,!0,2).toString(10),c=i.fromString(s,!0,2).toString(4);c.length<u;)c="0"+c;return l+"/"+c},e.keyToLatLng=e.S2Cell.keyToLatLng=function(t){return e.S2Cell.FromHilbertQuadKey(t).getLatLng()},e.idToLatLng=e.S2Cell.idToLatLng=function(t){var n=e.idToKey(t);return e.keyToLatLng(n)},e.S2Cell.latLngToKey=e.latLngToKey=e.latLngToQuadkey=function(t,n,i){if(isNaN(i)||i<1||i>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return e.S2Cell.FromLatLng({lat:t,lng:n},i).toHilbertQuadkey()},e.stepKey=function(e,n){var i,r=t.dcodeIO&&t.dcodeIO.Long||DS,a=e.split("/"),o=a[0],s=a[1],u=a[1].length,l=r.fromString(s,!0,4);n>0?i=l.add(Math.abs(n)):n<0&&(i=l.subtract(Math.abs(n)));var c=i.toString(4);for("0"===c&&console.warning(new Error("face/position wrapping is not yet supported"));c.length<u;)c="0"+c;return o+"/"+c},e.S2Cell.prevKey=e.prevKey=function(t){return e.stepKey(t,-1)},e.S2Cell.nextKey=e.nextKey=function(t){return e.stepKey(t,1)}}(t.exports)})),OS=function(t){kt(n,t);var e=Mt(n);function n(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:17;return Tt(this,n),(t=e.call(this))._level=i,t}return Ct(n,[{key:"bboxToCellIds",value:function(t,e){return this._approxBboxToCellIds(t,e)}},{key:"getAdjacent",value:function(t){for(var e=zS.S2.idToKey(t),n=e.split("/")[1].length,i=rt(this._getNeighbors(e,n),4),r=i[0],a=i[1],o=i[2],s=i[3],u=[e,r,a,o,s],l=[r,a,o,s],c=0,h=Array.from(new Set([].concat(vt(this._getNeighbors(r,n)),vt(this._getNeighbors(a,n)),vt(this._getNeighbors(o,n)),vt(this._getNeighbors(s,n))).filter((function(t){return!u.includes(t)}))));c<h.length;c++){var p,f=h[c],d=0,v=wt(this._getNeighbors(f,n));try{for(v.s();!(p=v.n()).done;){var m=p.value;u.includes(m)&&d++}}catch(Tx){v.e(Tx)}finally{v.f()}2===d&&l.push(f)}return l.map((function(t){return zS.S2.keyToId(t)}))}},{key:"getVertices",value:function(t){var e=zS.S2.idToKey(t);return zS.S2.S2Cell.FromHilbertQuadKey(e).getCornerLatLngs().map((function(t){return{lat:t.lat,lng:t.lng}}))}},{key:"lngLatToCellId",value:function(t){return this._lngLatToId(t,this._level)}},{key:"_getNeighbors",value:function(t,e){var n=zS.S2.keyToLatLng(t);return zS.S2.latLngToNeighborKeys(n.lat,n.lng,e)}},{key:"_lngLatToId",value:function(t,e){var n=zS.S2.latLngToKey(t.lat,t.lng,e);return zS.S2.keyToId(n)}}]),n}(LS);var FS=function(){function t(){Tt(this,t)}return Ct(t,[{key:"clusterReconstruction",value:function(t){var e=t.points,n=1/255;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i].color;r[0]*=n,r[1]*=n,r[2]*=n}var a=t.reference_lla;return{id:null,points:e,reference:{alt:a.altitude,lat:a.latitude,lng:a.longitude}}}},{key:"coreImage",value:function(t){var e=this._geometry(t.geometry),n=this._geometry(t.computed_geometry),i={id:t.sequence};return{computed_geometry:n,geometry:e,id:t.id,sequence:i}}},{key:"spatialImage",value:function(t){var e,n,i,r;t.camera_type=function(t){switch(t){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}(t.camera_type),t.merge_id=t.merge_cc?t.merge_cc.toString():null,t.private=null;var a="spherical"===t.camera_type?t.thumb_2048_url:t.thumb_1024_url;return t.thumb=null!==(e=t.thumb)&&void 0!==e?e:{id:null,url:a},t.cluster=null!==(n=t.sfm_cluster)&&void 0!==n?n:{id:null,url:null},t.creator={id:null,username:null},t.owner=null!==(i=t.owner)&&void 0!==i?i:{id:null},t.mesh=null!==(r=t.mesh)&&void 0!==r?r:{id:null,url:null},t}},{key:"_geometry",value:function(t){var e=null===t||void 0===t?void 0:t.coordinates;return e?{lat:e[1],lng:e[0]}:null}}]),t}(),NS=function(){function t(){Tt(this,t),this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","exif_orientation","height","merge_cc","mesh","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}return Ct(t,[{key:"images",value:function(t,e){return"image_ids=".concat(t.join(","),"&fields=").concat(e.join(","))}},{key:"imagesS2",value:function(t,e){return"s2=".concat(t,"&fields=").concat(e.join(","))}},{key:"imageTiles",value:function(t,e){return"z=".concat(t,"&fields=").concat(e.join(","))}},{key:"imageTilesPath",value:function(t){return"".concat(t,"/").concat(this._imageTilesPath)}},{key:"sequence",value:function(t){return"sequence_id=".concat(t)}}]),t}(),BS=function(t){kt(n,t);var e=Mt(n);function n(t,i,r,a){var o,s;Tt(this,n),(o=e.call(this,null!==i&&void 0!==i?i:new OS))._convert=null!==r&&void 0!==r?r:new FS,o._query=null!==a&&void 0!==a?a:new NS,o._method="GET";var u=null!==t&&void 0!==t?t:{};return o._endpoint=null!==(s=u.endpoint)&&void 0!==s?s:"https://graph.mapillary.com",o._accessToken=u.accessToken,o}return Ct(n,[{key:"getCluster",value:function(t,e){var n=this;return IS(t,e).then((function(t){var e=function(t){var e=oS(t,{to:"string"});return JSON.parse(e)}(t);if(e.length<1)throw new Error("Cluster reconstruction empty");return n._convert.clusterReconstruction(e[0])}))}},{key:"getCoreImages",value:function(t){var e=this,n=[].concat(vt(this._query.idFields),vt(this._query.coreFields)),i=this._query.imagesS2(t,n),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((function(n){var i,r={cell_id:t,images:[]},a=wt(n.data);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=e._convert.coreImage(o);r.images.push(s)}}catch(Tx){a.e(Tx)}finally{a.f()}return r}))}},{key:"getImageBuffer",value:function(t,e){return IS(t,e)}},{key:"getImages",value:function(t){var e=this,n=[].concat(vt(this._query.idFields),vt(this._query.coreFields),vt(this._query.spatialFields)),i=this._query.images(t,n),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((function(t){var n,i=[],r=wt(t.data);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=e._convert.coreImage(a),s=e._convert.spatialImage(a),u={node:Object.assign({},s,o),node_id:a.id};i.push(u)}}catch(Tx){r.e(Tx)}finally{r.f()}return i}))}},{key:"getImageTiles",value:function(t){var e=vt(this._query.imageTileFields),n=this._query.imageTiles(t.z,e),i=new URL(this._query.imageTilesPath(t.imageId),this._endpoint).href;return this._fetchGraphContract(n,i).then((function(e){return{node:e.data,node_id:t.imageId}}))}},{key:"getMesh",value:function(t,e){return IS(t,e).then((function(t){return function(t){return new lS(t).readFields(AS,{faces:[],vertices:[]})}(t)}))}},{key:"getSequence",value:function(t){var e=this._query.sequence(t),n=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(e,n).then((function(e){return{id:t,image_ids:e.data.map((function(t){return t.id}))}}))}},{key:"getSpatialImages",value:function(t){var e=this,n=[].concat(vt(this._query.idFields),vt(this._query.coreFields),vt(this._query.spatialFields)),i=this._query.images(t,n),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then((function(t){var n,i=[],r=wt(t.data);try{for(r.s();!(n=r.n()).done;){var a=n.value,o={node:e._convert.spatialImage(a),node_id:a.id};i.push(o)}}catch(Tx){r.e(Tx)}finally{r.f()}return i}))}},{key:"setAccessToken",value:function(t){this._accessToken=t}},{key:"_createHeaders",value:function(){var t=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&t.push({name:"Authorization",value:"OAuth ".concat(this._accessToken)}),t}},{key:"_fetchGraphContract",value:function(t,e){var n=this,i=this._method,r=this._createHeaders();return PS("".concat(e,"?").concat(t),i,"json",r,null,null).catch((function(t){var e=n._makeErrorMessage(t);throw new Hf(e)}))}},{key:"_makeErrorMessage",value:function(t){var e=t.error;return e?"".concat(e.code," (").concat(e.type,", ").concat(e.fbtrace_id,"): ").concat(e.message):"Failed to fetch data"}}]),n}(RS),jS=function(){function t(e,n){Tt(this,t),this._id=e,this._lngLat=n}return Ct(t,[{key:"id",get:function(){return this._id}},{key:"geometry",get:function(){return this._geometry}},{key:"lngLat",get:function(){return this._lngLat}},{key:"createGeometry",value:function(t){this._geometry||(this._createGeometry(t),this._geometry.updateMatrixWorld(!0))}},{key:"disposeGeometry",value:function(){this._geometry&&(this._disposeGeometry(),this._geometry=void 0)}},{key:"getInteractiveObjects",value:function(){return this._geometry?this._getInteractiveObjects():[]}},{key:"lerpAltitude",value:function(t,e){this._geometry&&(this._geometry.position.z=(1-e)*this._geometry.position.z+e*t)}},{key:"updatePosition",value:function(t,e){e&&(this._lngLat.lat=e.lat,this._lngLat.lng=e.lng),this._geometry&&(this._geometry.position.fromArray(t),this._geometry.updateMatrixWorld(!0))}}]),t}(),VS=function(t){kt(n,t);var e=Mt(n);function n(t,i,r){var a;return Tt(this,n),r=r||{},(a=e.call(this,t,i))._color=null!=r.color?r.color:16777215,a._opacity=null!=r.opacity?r.opacity:.4,a._radius=null!=r.radius?r.radius:1,a}return Ct(n,[{key:"_createGeometry",value:function(t){var e=new os(new Fc(this._radius,16),new yo({color:this._color,opacity:this._opacity,transparent:!0}));e.up.fromArray([0,0,1]),e.renderOrder=-1;var n=new qa;n.add(e),n.position.fromArray(t),this._geometry=n}},{key:"_disposeGeometry",value:function(){var t,e=wt(this._geometry.children);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.geometry.dispose(),n.material.dispose()}}catch(Tx){e.e(Tx)}finally{e.f()}}},{key:"_getInteractiveObjects",value:function(){return[]}}]),n}(jS);var US,$S,HS;!function(t){t[t.Custom=0]="Custom",t[t.Earth=1]="Earth",t[t.Street=2]="Street"}(US||(US={})),function(t){t[t.Letterbox=0]="Letterbox",t[t.Fill=1]="Fill"}($S||($S={})),function(t){t[t.Opaque=0]="Opaque"}(HS||(HS={}));var qS,WS=function(){function t(e,n,i,r,a,o){var s=this;Tt(this,t),this._container=e,this._observer=i,this._navigator=n,this._options=null!=a?a:{},this._key=r,this._navigable=null==r,this._componentService=o||new Pd(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),r?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(ri((function(t){return null!=t}))).subscribe((function(t){s._key=t,s._componentService.deactivateCover(),s._coverComponent.configure({id:s._key,state:xm.Hidden}),s._subscribeCoverComponent(),s._navigator.stateService.start(),s._navigator.cacheService.start(),s._navigator.panService.start(),s._observer.startEmit()}))}return Ct(t,[{key:"navigable",get:function(){return this._navigable}},{key:"get",value:function(t){return this._componentService.get(t)}},{key:"activate",value:function(t){this._componentService.activate(t)}},{key:"activateCover",value:function(){this._coverComponent.configure({state:xm.Visible})}},{key:"deactivate",value:function(t){this._componentService.deactivate(t)}},{key:"deactivateCover",value:function(){this._coverComponent.configure({state:xm.Loading})}},{key:"remove",value:function(){this._componentService.remove(),null!=this._configurationSubscription&&this._configurationSubscription.unsubscribe()}},{key:"_initializeComponents",value:function(){var t,e,n=this._options;this._uFalse(null===(t=n.fallback)||void 0===t?void 0:t.image,"imagefallback"),this._uFalse(null===(e=n.fallback)||void 0===e?void 0:e.navigation,"navigationfallback"),this._uFalse(n.marker,"marker"),this._uFalse(n.popup,"popup"),this._uFalse(n.slider,"slider"),this._uFalse(n.spatial,"spatial"),this._uFalse(n.tag,"tag"),this._uTrue(n.attribution,"attribution"),this._uTrue(n.bearing,"bearing"),this._uTrue(n.cache,"cache"),this._uTrue(n.direction,"direction"),this._uTrue(n.image,"image"),this._uTrue(n.keyboard,"keyboard"),this._uTrue(n.pointer,"pointer"),this._uTrue(n.sequence,"sequence"),this._uTrue(n.zoom,"zoom")}},{key:"_initilizeCoverComponent",value:function(){var t=this._options;this._coverComponent.configure({id:this._key}),void 0===t.cover||t.cover?this.activateCover():this.deactivateCover()}},{key:"_setNavigable",value:function(t){this._navigable!==t&&(this._navigable=t,this._observer.navigable$.next(t))}},{key:"_subscribeCoverComponent",value:function(){var t=this;this._configurationSubscription=this._coverComponent.configuration$.pipe(Un(void 0,(function(t){return t.state}))).subscribe((function(e){e.state===xm.Loading?t._navigator.stateService.currentId$.pipe(ri(),zi((function(n){var i=null==n||n!==e.id;return i&&t._setNavigable(!1),i?t._navigator.moveTo$(e.id):t._navigator.stateService.currentImage$.pipe(ri())}))).subscribe((function(){t._navigator.stateService.start(),t._navigator.cacheService.start(),t._navigator.panService.start(),t._observer.startEmit(),t._coverComponent.configure({state:xm.Hidden}),t._componentService.deactivateCover(),t._setNavigable(!0)}),(function(e){console.error("Failed to deactivate cover.",e),t._coverComponent.configure({state:xm.Visible})})):e.state===xm.Visible&&(t._observer.stopEmit(),t._navigator.stateService.stop(),t._navigator.cacheService.stop(),t._navigator.playService.stop(),t._navigator.panService.stop(),t._componentService.activateCover(),t._setNavigable(null==e.id))}))}},{key:"_uFalse",value:function(t,e){void 0!==t?"boolean"!==typeof t?(this._componentService.configure(e,t),this._componentService.activate(e)):t?this._componentService.activate(e):this._componentService.deactivate(e):this._componentService.deactivate(e)}},{key:"_uTrue",value:function(t,e){void 0!==t?"boolean"!==typeof t?(this._componentService.configure(e,t),this._componentService.activate(e)):t?this._componentService.activate(e):this._componentService.deactivate(e):this._componentService.activate(e)}}]),t}(),GS=function(){function t(e,n,i){Tt(this,t),this._adaptiveOperation$=new te,this._render$=new te,this._renderAdaptive$=new te,this._subscriptions=new km,this._renderService=n,this._currentFrame$=i;var r=this._subscriptions,a=wm.create(wm.h("div.mapillary-dom-renderer",[]));e.appendChild(a),this._offset$=this._adaptiveOperation$.pipe(li((function(t,e){return e(t)}),{elementHeight:e.offsetHeight,elementWidth:e.offsetWidth,imageAspect:0,renderMode:$S.Fill}),hn((function(t){return t.imageAspect>0&&t.elementWidth>0&&t.elementHeight>0})),De((function(t){var e=t.elementWidth/t.elementHeight,n=t.imageAspect/e,i=0,r=0;return t.renderMode===$S.Letterbox?t.imageAspect>e?i=t.elementHeight*(1-1/n)/2:r=t.elementWidth*(1-n)/2:t.imageAspect>e?r=-t.elementWidth*(n-1)/2:i=-t.elementHeight*(1/n-1)/2,{bottom:i,left:r,right:r,top:i}})));var o=this._currentFrame$.pipe(hn((function(t){return null!=t.state.currentImage})),Un((function(t,e){return t===e}),(function(t){return t.state.currentImage.id})),De((function(t){return t.state.currentTransform.basicAspect})),De((function(t){return function(e){return e.imageAspect=t,e}}))).subscribe(this._adaptiveOperation$),s=We(this._renderAdaptive$.pipe(li((function(t,e){return null==e.vNode?delete t[e.name]:t[e.name]=e.vNode,t}),{})),this._offset$).pipe(De((function(t){var e=[],n=t[0];for(var i in n)n.hasOwnProperty(i)&&e.push(n[i]);var r=t[1],a={style:{bottom:r.bottom+"px",left:r.left+"px","pointer-events":"none",position:"absolute",right:r.right+"px",top:r.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:wm.h("div.mapillary-dom-adaptive-renderer",a,e)}}))).subscribe(this._render$);this._vNode$=this._render$.pipe(li((function(t,e){return null==e.vNode?delete t[e.name]:t[e.name]=e.vNode,t}),{}),De((function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return wm.h("div.mapillary-dom-renderer",e)}))),this._vPatch$=this._vNode$.pipe(li((function(t,e){return t.vpatch=wm.diff(t.vNode,e),t.vNode=e,t}),{vNode:wm.h("div.mapillary-dom-renderer",[]),vpatch:null}),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return De(yi(t,n))(e)}}("vpatch")),this._element$=this._vPatch$.pipe(li((function(t,e){return wm.patch(t,e)}),a),bi(1),ne()),r.push(o),r.push(s),r.push(this._element$.subscribe((function(){}))),r.push(this._renderService.size$.pipe(De((function(t){return function(e){return e.elementWidth=t.width,e.elementHeight=t.height,e}}))).subscribe(this._adaptiveOperation$)),r.push(this._renderService.renderMode$.pipe(De((function(t){return function(e){return e.renderMode=t,e}}))).subscribe(this._adaptiveOperation$))}return Ct(t,[{key:"element$",get:function(){return this._element$}},{key:"render$",get:function(){return this._render$}},{key:"renderAdaptive$",get:function(){return this._renderAdaptive$}},{key:"clear",value:function(t){this._renderAdaptive$.next({name:t,vNode:null}),this._render$.next({name:t,vNode:null})}},{key:"remove",value:function(){this._subscriptions.unsubscribe()}}]),t}(),ZS=function(){function t(e,n,i){var r=this;Tt(this,t),this._renderFrame$=new te,this._renderCameraOperation$=new te,this._render$=new te,this._clear$=new te,this._renderOperation$=new te,this._rendererOperation$=new te,this._eraserOperation$=new te,this._triggerOperation$=new te,this._subscriptions=new km,this._opaqueRender$=new te,this._renderService=i;var a=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(li((function(t,e){return e(t)}),{needsRender:!1,renderer:null}),hn((function(t){return!!t.renderer}))),this._renderCollection$=this._renderOperation$.pipe(li((function(t,e){return e(t)}),{}),Ei()),this._renderCamera$=this._renderCameraOperation$.pipe(li((function(t,e){return e(t)}),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(Di((function(t){return t})),li((function(t,e){return e(t)}),{needsRender:!1}));var o=this._triggerOperation$.pipe(Di((function(t){return t})),li((function(t,e){return e(t)}),{needsRender:!1})),s=new fo(986895),u=We(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,o).pipe(De((function(t){var e=rt(t,5),n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=Object.keys(i).map((function(t){return i[t]}));return{camera:r,eraser:a,trigger:o,renderer:n,renders:s}})),hn((function(t){var e,n=t.renderer.needsRender||t.camera.needsRender||t.eraser.needsRender||t.trigger.needsRender,i=t.camera.frameId,r=wt(t.renders);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(a.frameId!==i)return!1;n=n||a.needsRender}}catch(Tx){r.e(Tx)}finally{r.f()}return n})),Un((function(t,e){return t===e}),(function(t){return t.eraser.needsRender||t.trigger.needsRender?-t.camera.frameId:t.camera.frameId}))).subscribe((function(t){t.renderer.needsRender=!1,t.camera.needsRender=!1,t.eraser.needsRender=!1,t.trigger.needsRender=!1;var e,n=t.camera.perspective,i=[],a=[],o=wt(t.renders);try{for(o.s();!(e=o.n()).done;){var u=e.value;u.pass===Fm.Background?i.push(u.render):u.pass===Fm.Opaque&&a.push(u.render)}}catch(Tx){o.e(Tx)}finally{o.f()}var l=t.renderer.renderer;l.resetState(),l.setClearColor(s,1),l.clear();for(var c=0,h=i;c<h.length;c++){(0,h[c])(n,l)}l.clearDepth();for(var p=0,f=a;p<f.length;p++){(0,f[p])(n,l)}l.resetState(),r._opaqueRender$.next()}));a.push(u),a.push(this._renderFrame$.pipe(De((function(t){return function(e){return e.frameId=t.frameId,e.perspective=t.perspective,!0===t.changed&&(e.needsRender=!0),e}}))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();var l=this._render$.pipe(De((function(t){return function(e){return e[t.name]=t.renderer,e}}))),c=this._clear$.pipe(De((function(t){return function(e){return delete e[t],e}})));a.push(cn(l,c).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(ri(),De((function(){n.appendChild(e);var t=i.element,r=new Il({canvas:e});return r.setPixelRatio(window.devicePixelRatio),r.setSize(t.offsetWidth,t.offsetHeight),r.autoClear=!1,r})),bi(1),ne()),a.push(this._webGLRenderer$.subscribe((function(){})));var h=this._webGLRenderer$.pipe(ri(),De((function(t){return function(e){return e.needsRender=!0,e.renderer=t,e}}))),p=this._renderService.size$.pipe(De((function(t){return function(e){return null==e.renderer||(e.renderer.setSize(t.width,t.height),e.needsRender=!0),e}}))),f=this._clear$.pipe(De((function(){return function(t){return null==t.renderer||(t.needsRender=!0),t}})));a.push(cn(h,p,f).subscribe(this._rendererOperation$));var d=this._renderCollection$.pipe(hn((function(t){return 0===Object.keys(t).length})),Ei());a.push(d.subscribe((function(){null!=r._renderFrameSubscription&&(r._renderFrameSubscription.unsubscribe(),r._renderFrameSubscription=null,r._renderFrameSubscribe())}))),a.push(d.pipe(De((function(){return function(t){return t.needsRender=!0,t}}))).subscribe(this._eraserOperation$))}return Ct(t,[{key:"render$",get:function(){return this._render$}},{key:"opaqueRender$",get:function(){return this._opaqueRender$}},{key:"webGLRenderer$",get:function(){return this._webGLRenderer$}},{key:"clear",value:function(t){this._clear$.next(t)}},{key:"remove",value:function(){this._rendererOperation$.next((function(t){if(null!=t.renderer){var e=t.renderer.getContext().getExtension("WEBGL_lose_context");e&&e.loseContext(),t.renderer=null}return t})),null!=this._renderFrameSubscription&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}},{key:"triggerRerender",value:function(){var t=this;this._renderService.renderCameraFrame$.pipe(Ci(1),ri()).subscribe((function(){t._triggerOperation$.next((function(t){return t.needsRender=!0,t}))}))}},{key:"_renderFrameSubscribe",value:function(){var t=this;this._render$.pipe(ri(),De((function(){return function(t){return t.needsRender=!0,t}}))).subscribe((function(e){t._renderCameraOperation$.next(e)})),this._renderFrameSubscription=this._render$.pipe(ri(),tn((function(){return t._renderService.renderCameraFrame$}))).subscribe(this._renderFrame$)}}]),t}(),XS=function(){function t(e,n,i){Tt(this,t),this._spatial=new Wf,this._viewportCoords=new Im,this._size={width:e,height:n},this._initialFov=60,this._alpha=-1,this._renderMode=i,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new kd,this._perspective=new ds(this._initialFov,this._computeAspect(e,n),.16,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}return Ct(t,[{key:"alpha",get:function(){return this._alpha}},{key:"camera",get:function(){return this._camera}},{key:"changed",get:function(){return this._frameId===this._changedForFrame}},{key:"frameId",get:function(){return this._frameId}},{key:"perspective",get:function(){return this._perspective}},{key:"renderMode",get:function(){return this._renderMode}},{key:"rotation",get:function(){return this._rotation}},{key:"zoom",get:function(){return this._zoom}},{key:"size",get:function(){return this._size}},{key:"getTilt",value:function(){return 90-this._spatial.radToDeg(this._rotation.theta)}},{key:"fovToZoom",value:function(t){t=Math.min(90,Math.max(0,t));var e=this._computeCurrentFov(0),n=1===this._alpha?e:this._interpolateFov(e,this._computePreviousFov(0),this._alpha),i=Math.tan(n/2*Math.PI/180),r=Math.tan(t/2*Math.PI/180);return Math.log(i/r)/Math.log(2)}},{key:"setFrame",value:function(t){var e=t.state;e.state!==this._state&&(this._state=e.state,this._state!==Qm.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._changed=!0);var n=e.currentImage.id,i=e.previousImage?e.previousImage.id:null;n!==this._currentImageId&&(this._currentImageId=n,this._currentSpherical=Zf(e.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(e.currentTransform),this._changed=!0),i!==this._previousImageId&&(this._previousImageId=i,this._previousSpherical=Zf(e.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(e.previousTransform),this._changed=!0);var r=e.zoom;r!==this._zoom&&(this._zoom=r,this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(this.zoom),this._previousFov=this._computePreviousFov(this._zoom));var a=e.alpha;if(this._changed||a!==this._alpha){switch(this._alpha=a,this._state){case Qm.Earth:this._perspective.fov=60,this._changed=!0;break;case Qm.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0}this._state!==Qm.Custom&&this._perspective.updateProjectionMatrix()}var o=e.camera;this._camera.diff(o)>1e-9&&(this._camera.copy(o),this._rotation=this._computeRotation(o),this._perspective.up.copy(o.up),this._perspective.position.copy(o.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(o.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(t.id)}},{key:"setProjectionMatrix",value:function(t){this._perspective.projectionMatrix.fromArray(t),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}},{key:"setRenderMode",value:function(t){this._renderMode=t,this._state!==Qm.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}},{key:"setSize",value:function(t){this._size=t,this._state!==Qm.Custom&&(this._perspective.aspect=this._computeAspect(t.width,t.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}},{key:"_computeAspect",value:function(t,e){return 0===t?0:t/e}},{key:"_computeCurrentFov",value:function(t){return 0===this._perspective.aspect?0:this._currentImageId?this._currentSpherical?this._yToFov(1,t):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,t,this.perspective.aspect):this._initialFov}},{key:"_computeFov",value:function(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}},{key:"_computePreviousFov",value:function(t){return 0===this._perspective.aspect?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,t):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,t,this.perspective.aspect):this._currentFov:this._initialFov}},{key:"_computeProjectedPoints",value:function(t){return Kf(t,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}},{key:"_computeRequiredVerticalFov",value:function(t,e,n){var i=Math.max(t[0]/n,t[1]);return this._yToFov(i,e)}},{key:"_computeRotation",value:function(t){var e=t.lookat.clone().sub(t.position),n=t.up.clone();return{phi:this._spatial.azimuthal(e.toArray(),n.toArray()),theta:Math.PI/2-this._spatial.angleToPlane(e.toArray(),[0,0,1])}}},{key:"_computeVerticalFov",value:function(t,e,n,i){var r=this,a=t.map((function(t){return r._computeRequiredVerticalFov(t,n,i)}));return e===$S.Fill?.995*Math.min.apply(Math,vt(a)):Math.max.apply(Math,vt(a))}},{key:"_yToFov",value:function(t,e){return 2*Math.atan(t/Math.pow(2,e))*180/Math.PI}},{key:"_interpolateFov",value:function(t,e,n){return n*t+(1-n)*e}},{key:"_setFrameId",value:function(t){this._frameId=t,this._changed&&(this._changed=!1,this._changedForFrame=t)}}]),t}(),YS=function(){function t(e,n,i,r){var a=this;Tt(this,t),this._subscriptions=new km,this._element=e,this._currentFrame$=n,this._spatial=new Wf,i=null!=i?i:$S.Fill,this._resize$=new te,this._projectionMatrix$=new te,this._renderCameraOperation$=new te,this._size$=new ue({height:this._element.offsetHeight,width:this._element.offsetWidth});var o=this._subscriptions;o.push(this._resize$.pipe(De((function(){return{height:a._element.offsetHeight,width:a._element.offsetWidth}}))).subscribe(this._size$)),this._renderMode$=new ue(i),this._renderCameraHolder$=this._renderCameraOperation$.pipe(Di((function(t){return t})),li((function(t,e){return e(t)}),null!==r&&void 0!==r?r:new XS(this._element.offsetWidth,this._element.offsetHeight,i)),bi(1),ne()),this._renderCameraFrame$=this._currentFrame$.pipe(Ki(this._renderCameraHolder$),Hi((function(t){var e=rt(t,2),n=e[0];e[1].setFrame(n)})),De((function(t){return t[1]})),bi(1),ne()),this._renderCamera$=this._renderCameraFrame$.pipe(hn((function(t){return t.changed})),bi(1),ne()),this._bearing$=this._renderCamera$.pipe(De((function(t){var e=a._spatial.radToDeg(a._spatial.azimuthalToBearing(t.rotation.phi));return a._spatial.wrap(e,0,360)})),bi(1),ne()),o.push(this._size$.pipe(Ci(1),De((function(t){return function(e){return e.setSize(t),e}}))).subscribe(this._renderCameraOperation$)),o.push(this._renderMode$.pipe(Ci(1),De((function(t){return function(e){return e.setRenderMode(t),e}}))).subscribe(this._renderCameraOperation$)),o.push(this._projectionMatrix$.pipe(De((function(t){return function(e){return e.setProjectionMatrix(t),e}}))).subscribe(this._renderCameraOperation$)),o.push(this._bearing$.subscribe((function(){}))),o.push(this._renderCameraHolder$.subscribe((function(){}))),o.push(this._size$.subscribe((function(){}))),o.push(this._renderMode$.subscribe((function(){}))),o.push(this._renderCamera$.subscribe((function(){}))),o.push(this._renderCameraFrame$.subscribe((function(){})))}return Ct(t,[{key:"bearing$",get:function(){return this._bearing$}},{key:"element",get:function(){return this._element}},{key:"projectionMatrix$",get:function(){return this._projectionMatrix$}},{key:"renderCamera$",get:function(){return this._renderCamera$}},{key:"renderCameraFrame$",get:function(){return this._renderCameraFrame$}},{key:"renderMode$",get:function(){return this._renderMode$}},{key:"resize$",get:function(){return this._resize$}},{key:"size$",get:function(){return this._size$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}}]),t}(),KS=function(){function t(e){Tt(this,t),this._keyDown$=sn(e,"keydown"),this._keyUp$=sn(e,"keyup")}return Ct(t,[{key:"keyDown$",get:function(){return this._keyDown$}},{key:"keyUp$",get:function(){return this._keyUp$}}]),t}(),JS=(St(lt={},0,1),St(lt,2,2),lt),QS=function(){function t(e,n,i,r){var a=this;Tt(this,t),this._subscriptions=new km;var o=this._subscriptions;this._activeSubject$=new ue(!1),this._active$=this._activeSubject$.pipe(Un(),bi(1),ne()),this._claimMouse$=new te,this._claimWheel$=new te,this._deferPixelClaims$=new te,this._deferPixels$=this._deferPixelClaims$.pipe(li((function(t,e){return null==e.deferPixels?delete t[e.name]:t[e.name]=e.deferPixels,t}),{}),De((function(t){var e=-1;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];i>e&&(e=i)}return e})),Di(-1),bi(1),ne()),o.push(this._deferPixels$.subscribe((function(){}))),this._documentMouseMove$=sn(r,"pointermove").pipe(hn(this._isMousePen)),this._documentMouseUp$=sn(r,"pointerup").pipe(hn(this._isMousePen)),this._mouseDown$=sn(n,"pointerdown").pipe(hn(this._isMousePen)),this._mouseEnter$=sn(n,"pointerenter").pipe(hn(this._isMousePen)),this._mouseLeave$=sn(n,"pointerleave").pipe(hn(this._isMousePen)),this._mouseMove$=sn(n,"pointermove").pipe(hn(this._isMousePen)),this._mouseUp$=sn(n,"pointerup").pipe(hn(this._isMousePen)),this._mouseOut$=sn(n,"pointerout").pipe(hn(this._isMousePen)),this._mouseOver$=sn(n,"pointerover").pipe(hn(this._isMousePen)),this._domMouseDown$=sn(i,"pointerdown").pipe(hn(this._isMousePen)),this._domMouseMove$=sn(i,"pointermove").pipe(hn(this._isMousePen)),this._click$=sn(n,"click"),this._contextMenu$=sn(n,"contextmenu"),this._windowBlur$=sn(window,"blur"),this._dblClick$=cn(sn(e,"click"),sn(n,"dblclick")).pipe(Mn(3,1),hn((function(t){var e=t[0],i=t[1],r=t[2];return"click"===e.type&&"click"===i.type&&"dblclick"===r.type&&e.target.parentNode===n&&i.target.parentNode===n})),De((function(t){return t[2]})),Ei()),o.push(cn(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe((function(t){t.preventDefault()}))),this._mouseWheel$=cn(sn(n,"wheel"),sn(i,"wheel")).pipe(Ei()),this._consistentContextMenu$=cn(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(Mn(3,1),hn((function(t){return"pointerdown"===t[0].type&&"contextmenu"===t[1].type&&"pointerup"===t[2].type})),De((function(t){return t[1]})),Ei());var s=cn(this._windowBlur$,this._documentMouseMove$.pipe(hn((function(t){return a._buttonReleased(t,0)}))),this._documentMouseUp$.pipe(hn((function(t){return 0===a._mouseButton(t)})))).pipe(Ei()),u=this._createMouseDragInitiate$(0,this._mouseDown$,s,!0).pipe(Ei());this._mouseDragStart$=this._createMouseDragStart$(u).pipe(Ei()),this._mouseDrag$=this._createMouseDrag$(u,s).pipe(Ei()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,s).pipe(Ei());var l=this._createMouseDragInitiate$(0,this._domMouseDown$,s,!1).pipe(Ei());this._domMouseDragStart$=this._createMouseDragStart$(l).pipe(Ei()),this._domMouseDrag$=this._createMouseDrag$(l,s).pipe(Ei()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,s).pipe(Ei());var c=cn(this._windowBlur$,this._documentMouseMove$.pipe(hn((function(t){return a._buttonReleased(t,2)}))),this._documentMouseUp$.pipe(hn((function(t){return 2===a._mouseButton(t)})))).pipe(Ei()),h=this._createMouseDragInitiate$(2,this._mouseDown$,c,!0).pipe(Ei());this._mouseRightDragStart$=this._createMouseDragStart$(h).pipe(Ei()),this._mouseRightDrag$=this._createMouseDrag$(h,c).pipe(Ei()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,c).pipe(Ei()),this._proximateClick$=this._mouseDown$.pipe(zi((function(t){return a._click$.pipe(Ni(a._createDeferredMouseMove$(t,a._documentMouseMove$)),Xn(1))})),Ei()),this._staticClick$=this._mouseDown$.pipe(zi((function(){return a._click$.pipe(Ni(a._documentMouseMove$),Xn(1))})),Ei()),o.push(this._mouseDragStart$.subscribe()),o.push(this._mouseDrag$.subscribe()),o.push(this._mouseDragEnd$.subscribe()),o.push(this._domMouseDragStart$.subscribe()),o.push(this._domMouseDrag$.subscribe()),o.push(this._domMouseDragEnd$.subscribe()),o.push(this._mouseRightDragStart$.subscribe()),o.push(this._mouseRightDrag$.subscribe()),o.push(this._mouseRightDragEnd$.subscribe()),o.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(bi(1),ne()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(bi(1),ne()),o.push(this._mouseOwner$.subscribe((function(){}))),o.push(this._wheelOwner$.subscribe((function(){})))}return Ct(t,[{key:"active$",get:function(){return this._active$}},{key:"activate$",get:function(){return this._activeSubject$}},{key:"documentMouseMove$",get:function(){return this._documentMouseMove$}},{key:"documentMouseUp$",get:function(){return this._documentMouseUp$}},{key:"domMouseDragStart$",get:function(){return this._domMouseDragStart$}},{key:"domMouseDrag$",get:function(){return this._domMouseDrag$}},{key:"domMouseDragEnd$",get:function(){return this._domMouseDragEnd$}},{key:"domMouseDown$",get:function(){return this._domMouseDown$}},{key:"domMouseMove$",get:function(){return this._domMouseMove$}},{key:"mouseOwner$",get:function(){return this._mouseOwner$}},{key:"mouseDown$",get:function(){return this._mouseDown$}},{key:"mouseEnter$",get:function(){return this._mouseEnter$}},{key:"mouseMove$",get:function(){return this._mouseMove$}},{key:"mouseLeave$",get:function(){return this._mouseLeave$}},{key:"mouseOut$",get:function(){return this._mouseOut$}},{key:"mouseOver$",get:function(){return this._mouseOver$}},{key:"mouseUp$",get:function(){return this._mouseUp$}},{key:"click$",get:function(){return this._click$}},{key:"dblClick$",get:function(){return this._dblClick$}},{key:"contextMenu$",get:function(){return this._consistentContextMenu$}},{key:"mouseWheel$",get:function(){return this._mouseWheel$}},{key:"mouseDragStart$",get:function(){return this._mouseDragStart$}},{key:"mouseDrag$",get:function(){return this._mouseDrag$}},{key:"mouseDragEnd$",get:function(){return this._mouseDragEnd$}},{key:"mouseRightDragStart$",get:function(){return this._mouseRightDragStart$}},{key:"mouseRightDrag$",get:function(){return this._mouseRightDrag$}},{key:"mouseRightDragEnd$",get:function(){return this._mouseRightDragEnd$}},{key:"proximateClick$",get:function(){return this._proximateClick$}},{key:"staticClick$",get:function(){return this._staticClick$}},{key:"windowBlur$",get:function(){return this._windowBlur$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}},{key:"claimMouse",value:function(t,e){this._claimMouse$.next({name:t,zindex:e})}},{key:"unclaimMouse",value:function(t){this._claimMouse$.next({name:t,zindex:null})}},{key:"deferPixels",value:function(t,e){this._deferPixelClaims$.next({name:t,deferPixels:e})}},{key:"undeferPixels",value:function(t){this._deferPixelClaims$.next({name:t,deferPixels:null})}},{key:"claimWheel",value:function(t,e){this._claimWheel$.next({name:t,zindex:e})}},{key:"unclaimWheel",value:function(t){this._claimWheel$.next({name:t,zindex:null})}},{key:"filtered$",value:function(t,e){return this._filtered(t,e,this._mouseOwner$)}},{key:"filteredWheel$",value:function(t,e){return this._filtered(t,e,this._wheelOwner$)}},{key:"_createDeferredMouseMove$",value:function(t,e){return e.pipe(De((function(e){var n=e.clientX-t.clientX,i=e.clientY-t.clientY;return[e,Math.sqrt(n*n+i*i)]})),Ki(this._deferPixels$),hn((function(t){var e=rt(t,2);return rt(e[0],2)[1]>e[1]})),De((function(t){var e=rt(t,1);return rt(e[0],1)[0]})))}},{key:"_createMouseDrag$",value:function(t,e){var n=this;return t.pipe(De((function(t){return rt(t,2)[1]})),zi((function(t){return on(xe(t),n._documentMouseMove$).pipe(Ni(e))})))}},{key:"_createMouseDragEnd$",value:function(t,e){return t.pipe(zi((function(){return e.pipe(ri())})))}},{key:"_createMouseDragStart$",value:function(t){return t.pipe(De((function(t){return rt(t,1)[0]})))}},{key:"_createMouseDragInitiate$",value:function(t,e,n,i){var r=this;return e.pipe(hn((function(e){return r._mouseButton(e)===t})),zi((function(t){return We(xe(t),i?r._createDeferredMouseMove$(t,r._documentMouseMove$):r._documentMouseMove$).pipe(Ni(n),Xn(1))})))}},{key:"_createOwner$",value:function(t){return t.pipe(li((function(t,e){return null==e.zindex?delete t[e.name]:t[e.name]=e.zindex,t}),{}),De((function(t){var e=null,n=-1;for(var i in t)t.hasOwnProperty(i)&&t[i]>n&&(n=t[i],e=i);return e})),Di(null))}},{key:"_filtered",value:function(t,e,n){return e.pipe(Ki(n),hn((function(e){return rt(e,2)[1]===t})),De((function(t){return rt(t,1)[0]})))}},{key:"_mouseButton",value:function(t){var e="pointerdown"===t.type||"pointerup"===t.type,n=window.InstallTrigger;return e&&"undefined"!==typeof n&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}},{key:"_buttonReleased",value:function(t,e){var n=JS[e];return void 0===t.buttons||(t.buttons&n)!==n}},{key:"_isMousePen",value:function(t){var e=t.pointerType;return"mouse"===e||"pen"===e}}]),t}(),tk=function(){function t(){Tt(this,t)}return Ct(t,[{key:"json",set:function(t){this._json=t}},{key:"image",set:function(t){this._image=t,this._texture=new Vr(this._image),this._texture.minFilter=ar}},{key:"loaded",get:function(){return!(!this._image||!this._json)}},{key:"getGLSprite",value:function(t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");var e=this._json[t];if(!e)return console.warn("Sprite with key"+t+"does not exist in sprite definition."),new qa;var n=this._texture.clone();n.needsUpdate=!0;var i=this._image.width,r=this._image.height;return n.offset.x=e.x/i,n.offset.y=(r-e.y-e.height)/r,n.repeat.x=e.width/i,n.repeat.y=e.height/r,new Xl(new Ol({map:n}))}},{key:"getDOMSprite",value:function(t,e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");null==e&&(e=$_.Center);var n=this._json[t];if(!n)return console.warn("Sprite with key"+t+"does not exist in sprite definition."),wm.h("div",{},[]);var i=n.y,r=n.x+n.width,a=n.y+n.height,o=n.x,s=-n.x,u=-n.y,l=this._image.height,c=this._image.width;switch(e){case $_.Bottom:case $_.Center:case $_.Top:s-=n.width/2;break;case $_.BottomLeft:case $_.Left:case $_.TopLeft:s-=n.width;case $_.BottomRight:case $_.Right:case $_.TopRight:}switch(e){case $_.Center:case $_.Left:case $_.Right:u-=n.height/2;break;case $_.Top:case $_.TopLeft:case $_.TopRight:u-=n.height;case $_.Bottom:case $_.BottomLeft:case $_.BottomRight:}var h=1/n.pixelRatio;i*=h,r*=h,a*=h,o*=h,s*=h,u*=h,l*=h,c*=h;var p={src:this._image.src,style:{clip:"rect(".concat(i,"px, ").concat(r,"px, ").concat(a,"px, ").concat(o,"px)"),height:"".concat(l,"px"),left:"".concat(s,"px"),position:"absolute",top:"".concat(u,"px"),width:"".concat(c,"px")}};return wm.h("img",p,[])}}]),t}(),ek=function(){function t(e){var n=this;if(Tt(this,t),this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new te,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(Di((function(t){return t})),li((function(t,e){return e(t)}),new tk),bi(1),ne()),this._atlasSubscription=this._spriteAtlas$.subscribe((function(){})),null!=e){var i=this._retina?"@2x":"",r=new XMLHttpRequest;r.open("GET",e+i+".png",!0),r.responseType="arraybuffer",r.onload=function(){var t=new Image;t.onload=function(){n._spriteAtlasOperation$.next((function(e){return e.image=t,e}))};var e=new Blob([r.response]);t.src=window.URL.createObjectURL(e)},r.onerror=function(t){console.error(new Error("Failed to fetch sprite sheet (".concat(e).concat(i,".png)")))},r.send();var a=new XMLHttpRequest;a.open("GET",e+i+".json",!0),a.responseType="text",a.onload=function(){var t=JSON.parse(a.response);n._spriteAtlasOperation$.next((function(e){return e.json=t,e}))},a.onerror=function(t){console.error(new Error("Failed to fetch sheet (".concat(e).concat(i,".json)")))},a.send()}}return Ct(t,[{key:"spriteAtlas$",get:function(){return this._spriteAtlas$}},{key:"dispose",value:function(){this._atlasSubscription.unsubscribe()}}]),t}(),nk=function(){function t(e,n){var i=this;Tt(this,t),this._subscriptions=new km;var r=this._subscriptions;this._activeSubject$=new ue(!1),this._active$=this._activeSubject$.pipe(Un(),bi(1),ne()),r.push(sn(n,"touchmove").subscribe((function(t){t.preventDefault()}))),this._touchStart$=sn(e,"touchstart"),this._touchMove$=sn(e,"touchmove"),this._touchEnd$=sn(e,"touchend"),this._touchCancel$=sn(e,"touchcancel");var a,o=this._touchStart$.pipe(hn((function(t){return 1===t.touches.length&&1===t.targetTouches.length})),Ei());this._doubleTap$=o.pipe((a=function(){return o.pipe(ri(),zi((function(){return cn(dn(300),o).pipe(Xn(1))})))},function(t){return t.lift(new In(a))}),hn((function(t){return 2===t.length})),De((function(t){return t[t.length-1]})),Ei()),r.push(this._doubleTap$.subscribe((function(t){t.preventDefault()}))),this._singleTouchMove$=this._touchMove$.pipe(hn((function(t){return 1===t.touches.length&&1===t.targetTouches.length})),Ei());var s=cn(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(hn((function(t){return 1===t.touches.length&&1===t.targetTouches.length}))),u=cn(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(hn((function(t){return t.touches.length>=1}))),l=cn(this._touchEnd$,this._touchCancel$).pipe(hn((function(t){return 0===t.touches.length})));this._singleTouchDragStart$=s.pipe(tn((function(){return i._singleTouchMove$.pipe(Ni(cn(l,u)),Xn(1))}))),this._singleTouchDragEnd$=s.pipe(tn((function(){return cn(l,u).pipe(ri())}))),this._singleTouchDrag$=s.pipe(zi((function(){return i._singleTouchMove$.pipe(Ci(1),Ni(cn(u,l)))})));var c=cn(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=c.pipe(hn((function(t){return 2===t.touches.length&&2===t.targetTouches.length}))),this._pinchEnd$=c.pipe(hn((function(t){return 2!==t.touches.length||2!==t.targetTouches.length}))),this._pinchOperation$=new te,this._pinch$=this._pinchOperation$.pipe(li((function(t,e){return e(t)}),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));var h=this._touchMove$.pipe(hn((function(t){return 2===t.touches.length&&2===t.targetTouches.length})),De((function(t){return function(e){var n=t.touches[0],i=t.touches[1],r=Math.min(n.clientX,i.clientX),a=Math.max(n.clientX,i.clientX),o=Math.min(n.clientY,i.clientY),s=r+(a-r)/2,u=o+(Math.max(n.clientY,i.clientY)-o)/2,l=s+n.pageX-n.clientX,c=u+n.pageY-n.clientY,h=s+n.screenX-n.clientX,p=u+n.screenY-n.clientY,f=Math.abs(n.clientX-i.clientX),d=Math.abs(n.clientY-i.clientY),v=Math.sqrt(f*f+d*d),m=v-e.distance;return{changeX:f-e.distanceX,changeY:d-e.distanceY,clientX:s,clientY:u,distance:v,distanceChange:m,distanceX:f,distanceY:d,originalEvent:t,pageX:l,pageY:c,screenX:h,screenY:p,touch1:n,touch2:i}}}))).subscribe(this._pinchOperation$);r.push(h),this._pinchChange$=this._pinchStart$.pipe(zi((function(){return i._pinch$.pipe(Ci(1),Ni(i._pinchEnd$))})))}return Ct(t,[{key:"active$",get:function(){return this._active$}},{key:"activate$",get:function(){return this._activeSubject$}},{key:"doubleTap$",get:function(){return this._doubleTap$}},{key:"touchStart$",get:function(){return this._touchStart$}},{key:"touchMove$",get:function(){return this._touchMove$}},{key:"touchEnd$",get:function(){return this._touchEnd$}},{key:"touchCancel$",get:function(){return this._touchCancel$}},{key:"singleTouchDragStart$",get:function(){return this._singleTouchDragStart$}},{key:"singleTouchDrag$",get:function(){return this._singleTouchDrag$}},{key:"singleTouchDragEnd$",get:function(){return this._singleTouchDragEnd$}},{key:"pinch$",get:function(){return this._pinchChange$}},{key:"pinchStart$",get:function(){return this._pinchStart$}},{key:"pinchEnd$",get:function(){return this._pinchEnd$}},{key:"dispose",value:function(){this._subscriptions.unsubscribe()}}]),t}(),ik=function(){function t(e){var n,i,r,a;Tt(this,t);var o=null!==(i=null===(n=null===e||void 0===e?void 0:e.url)||void 0===n?void 0:n.exploreHost)&&void 0!==i?i:"www.mapillary.com",s=null!==(a=null===(r=null===e||void 0===e?void 0:e.url)||void 0===r?void 0:r.scheme)&&void 0!==a?a:"https",u="".concat(s,"://").concat(o);this._exploreUrl$=xe(u);var l=!1!==(null===e||void 0===e?void 0:e.imageTiling);this._imageTiling$=xe(l)}return Ct(t,[{key:"exploreUrl$",get:function(){return this._exploreUrl$}},{key:"imageTiling$",get:function(){return this._imageTiling$}}]),t}(),rk=function(){function t(e,n,i){var r,a=this;if(Tt(this,t),this._onWindowResize=function(){a._trackResize&&a.renderService.resize$.next()},this._dom=null!==i&&void 0!==i?i:new Eg,"string"===typeof e.container){if(this._container=this._dom.document.getElementById(e.container),!this._container)throw new Error('Container "'.concat(e.container,'" not found.'))}else{if(!(e.container instanceof HTMLElement))throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._container=e.container}this._trackResize=!1!==e.trackResize,this.id=null!==(r=this._container.id)&&void 0!==r?r:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new ik(e),this.renderService=new YS(this._container,n.currentState$,e.renderMode),this.glRenderer=new ZS(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new GS(this._domContainer,this.renderService,n.currentState$),this.keyboardService=new KS(this._canvasContainer),this.mouseService=new QS(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new nk(this._canvasContainer,this._domContainer),this.spriteService=new ek(e.sprite),window.addEventListener("resize",this._onWindowResize,!1)}return Ct(t,[{key:"canvas",get:function(){return this._canvas.parentNode?this._canvas:null}},{key:"canvasContainer",get:function(){return this._canvasContainer}},{key:"container",get:function(){return this._container}},{key:"domContainer",get:function(){return this._domContainer}},{key:"remove",value:function(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}},{key:"_removeNode",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}}]),t}(),ak=function(){function t(e,n,i){Tt(this,t),this._graphService=e,this._stateService=n,this._api=i,this._subscriptions=new km,this._started=!1,this._cellDepth=1}return Ct(t,[{key:"started",get:function(){return this._started}},{key:"configure",value:function(t){this._cellDepth=t?Math.max(1,Math.min(3,t.cellDepth)):1}},{key:"start",value:function(){var t=this;if(!this._started){var e=this._subscriptions;e.push(this._stateService.currentState$.pipe(Un(void 0,(function(t){return t.state.currentImage.id})),De((function(t){var e=t.state,n=e.trajectory,i=n.map((function(t){return t.id})),r=n[n.length-1].sequenceId;return[i,e.currentImage.originalLngLat,r]})),Mn(1,5),Ki(this._graphService.graphMode$),zi((function(e){var n=rt(e,2),i=n[0],r=n[1],a=i[0][0],o=i[0][1],s=t._api.data.geometry,u=ty(s.lngLatToCellId(o),t._cellDepth,s),l=r===Mg.Sequence?i[0][2]:void 0;return t._graphService.uncache$(a,u,l)}))).subscribe((function(){}))),e.push(this._graphService.graphMode$.pipe(Ci(1),Ki(this._stateService.currentState$),zi((function(e){var n=rt(e,2),i=n[0],r=n[1];return i===Mg.Sequence?t._keyToEdges(r.state.currentImage.id,(function(t){return t.sequenceEdges$})):Ye(r.state.trajectory.map((function(t){return t.id})).slice(r.state.currentIndex)).pipe(tn((function(e){return t._keyToEdges(e,(function(t){return t.spatialEdges$}))}),6))}))).subscribe((function(){}))),e.push(this._graphService.dataAdded$.pipe(Ki(this._stateService.currentId$),zi((function(e){var n=rt(e,2),i=(n[0],n[1]);return t._graphService.cacheImage$(i)}))).subscribe((function(){}))),this._started=!0}}},{key:"stop",value:function(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}},{key:"_keyToEdges",value:function(t,e){return this._graphService.cacheImage$(t).pipe(zi(e),ri((function(t){return t.cached})),Yi(15e3),An((function(e){return console.error("Failed to cache edges (".concat(t,")."),e),me()})))}}]),t}(),ok=function(){function t(){Tt(this,t),this._loadersSubject$=new te,this._loaders$=this._loadersSubject$.pipe(li((function(t,e){return void 0!==e.task&&(t[e.task]=e.loading),t}),{}),Di({}),bi(1),ne())}return Ct(t,[{key:"loading$",get:function(){return this._loaders$.pipe(De((function(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!0;return!1})),zn(100),Un())}},{key:"taskLoading$",value:function(t){return this._loaders$.pipe(De((function(e){return!!e[t]})),zn(100),Un())}},{key:"startLoading",value:function(t){this._loadersSubject$.next({loading:!0,task:t})}},{key:"stopLoading",value:function(t){this._loadersSubject$.next({loading:!1,task:t})}}]),t}();!function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.Started=2]="Started"}(qS||(qS={}));var sk=function(){function t(e,n,i,r,a,o){Tt(this,t),this._subscriptions=new km,this._graphService=e,this._stateService=n,this._graphCalculator=null!==r&&void 0!==r?r:new Ff,this._spatial=null!==a&&void 0!==a?a:new Wf,this._viewportCoords=null!==o&&void 0!==o?o:new Im,this._mode=!1!==i?qS.Enabled:qS.Disabled,this._panImagesSubject$=new te,this._panImages$=this._panImagesSubject$.pipe(Di([]),bi(1),ne()),this._subscriptions.push(this._panImages$.subscribe())}return Ct(t,[{key:"panImages$",get:function(){return this._panImages$}},{key:"dispose",value:function(){this.stop(),null!=this._panImagesSubscription&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}},{key:"enable",value:function(){this._mode===qS.Disabled&&(this._mode=qS.Enabled,this.start())}},{key:"disable",value:function(){this._mode!==qS.Disabled&&(this.stop(),this._mode=qS.Disabled)}},{key:"start",value:function(){var t=this;if(this._mode===qS.Enabled){var e=this._stateService.currentImage$.pipe(zi((function(e){if(!e.merged||Zf(e.cameraType))return xe([]);var n=xe(e),i=t._graphCalculator.boundingBoxCorners(e.lngLat,20),r=t._graphService.cacheBoundingBox$(i[0],i[1]).pipe(An((function(t){return console.error("Failed to cache periphery bounding box (".concat(e.id,")"),t),me()})),De((function(n){if(Zf(e.cameraType))return[];var i,r=[],a=wt(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.id!==e.id&&(o.mergeId===e.mergeId&&(Zf(o.cameraType)||t._distance(o,e)>4||r.push(o)))}}catch(Tx){a.e(Tx)}finally{a.f()}return r})));return We(n,r).pipe(Ki(t._stateService.reference$),De((function(e){var n,i=rt(e,2),r=rt(i[0],2),a=r[0],o=r[1],s=i[1],u=t._spatial.viewingDirection(a.rotation),l=Yf({lat:a.lngLat.lat,lng:a.lngLat.lng,alt:a.computedAltitude},a.rotation,s),c=t._createTransform(a,l),h=t._spatial.wrap(t._spatial.azimuthal(u.toArray(),c.upVector().toArray()),0,2*Math.PI),p=t._computeProjectedPoints(c),f=t._computeHorizontalFov(p)/180*Math.PI,d=Math.PI/8,v=void 0,m=void 0,g=wt(o);try{for(g.s();!(n=g.n()).done;){var y=n.value,_=Yf({lat:y.lngLat.lat,lng:y.lngLat.lng,alt:y.computedAltitude},y.rotation,s),b=t._createTransform(y,_),x=t._computeProjectedPoints(b),w=t._computeHorizontalFov(x)/180*Math.PI,S=t._spatial.viewingDirection(y.rotation),k=t._spatial.wrap(t._spatial.azimuthal(S.toArray(),b.upVector().toArray()),0,2*Math.PI),M=t._spatial.angleBetweenVector2(u.x,u.y,S.x,S.y),T=Number.NEGATIVE_INFINITY;T=M>0?h>k?h-2*Math.PI+f/2-(k-w/2):h+f/2-(k-w/2):h<k?k+w/2-(h+2*Math.PI-f/2):k+w/2-(h-f/2);var E=Math.abs(w-T),C=t._distance(y,a)+Math.min(t._timeDifference(y,a),4)+20*Math.abs(T-d)+Math.min(5,1/Math.min(w/f,1))+(T>0?-2*E:0);T>0&&T<.5*f&&T<.5*w&&E>.5*f&&(M>0?v?C<v[0]&&(v=[C,y,b,w]):v=[C,y,b,w]:m?C<m[0]&&(m=[C,y,b,w]):m=[C,y,b,w])}}catch(Tx){g.e(Tx)}finally{g.f()}var I=[];return v&&I.push([v[1],v[2],v[3]]),m&&I.push([m[1],m[2],m[3]]),I})),Di([]))})));this._panImagesSubscription=this._stateService.currentState$.pipe(De((function(t){return t.state.imagesAhead>0})),Un(),zi((function(t){return t?xe([]):e}))).subscribe((function(e){t._panImagesSubject$.next(e)})),this._mode=qS.Started}}},{key:"stop",value:function(){this._mode===qS.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=qS.Enabled)}},{key:"_distance",value:function(t,e){var n=rt(Rf(t.lngLat.lng,t.lngLat.lat,t.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude),3),i=n[0],r=n[1],a=n[2];return Math.sqrt(i*i+r*r+a*a)}},{key:"_timeDifference",value:function(t,e){return Math.abs(t.capturedAt-e.capturedAt)/2592e6}},{key:"_createTransform",value:function(t,e){return new Md(t.exifOrientation,t.width,t.height,t.scale,t.rotation,e,t.assetsCached?t.image:void 0,void 0,t.cameraParameters,t.cameraType)}},{key:"_computeProjectedPoints",value:function(t){return Kf(t,[[1,0]],[[0,.5]],20,this._viewportCoords)}},{key:"_computeHorizontalFov",value:function(t){var e=this,n=t.map((function(t){return e._coordToFov(t[0])}));return Math.min.apply(Math,vt(n))}},{key:"_coordToFov",value:function(t){return 2*Math.atan(t)*180/Math.PI}}]),t}(),uk=function(){function t(e){Tt(this,t),this._data=e}return Ct(t,[{key:"data",get:function(){return this._data}},{key:"getCoreImages$",value:function(t){return this._wrap$(this._data.getCoreImages(t))}},{key:"getImages$",value:function(t){return this._wrap$(this._data.getImages(t))}},{key:"getImageTiles$",value:function(t){return this._wrap$(this._data.getImageTiles(t))}},{key:"getSequence$",value:function(t){return this._wrap$(this._data.getSequence(t))}},{key:"getSpatialImages$",value:function(t){return this._wrap$(this._data.getSpatialImages(t))}},{key:"setAccessToken",value:function(t){this._data.setAccessToken(t)}},{key:"_wrap$",value:function(t){return Xt.create((function(e){t.then((function(t){e.next(t),e.complete()}),(function(t){e.error(t)}))}))}}]),t}(),lk=function(){function t(e){var n=this;Tt(this,t),this._dataAdded$=new te,this._subscriptions=new km,this._onDataAdded=function(t){n._graph$.pipe(ri(),tn((function(e){return e.updateCells$(t.cellIds).pipe(Hi((function(){e.resetSpatialEdges()})))}))).subscribe((function(t){n._dataAdded$.next(t)}))};var i=this._subscriptions;this._graph$=on(xe(e),e.changed$).pipe(bi(1),ne()),i.push(this._graph$.subscribe((function(){}))),this._graphMode=Mg.Spatial,this._graphModeSubject$=new te,this._graphMode$=this._graphModeSubject$.pipe(Di(this._graphMode),bi(1),ne()),i.push(this._graphMode$.subscribe((function(){}))),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],e.api.data.on("datacreate",this._onDataAdded)}return Ct(t,[{key:"dataAdded$",get:function(){return this._dataAdded$}},{key:"filter$",get:function(){return this._graph$.pipe(ri(),tn((function(t){return t.filter$})))}},{key:"graphMode$",get:function(){return this._graphMode$}},{key:"cacheBoundingBox$",value:function(t,e){return this._graph$.pipe(ri(),tn((function(n){return n.cacheBoundingBox$(t,e)})))}},{key:"cacheCell$",value:function(t){return this._graph$.pipe(ri(),tn((function(e){return e.cacheCell$(t)})))}},{key:"cacheImage$",value:function(t){var e=this,n=new te;this._firstGraphSubjects$.push(n);var i,r=n.pipe(bi(1),ne()),a=r.pipe(De((function(e){return e.getNode(t)})),tn((function(t){return t.assetsCached?xe(t):t.cacheAssets$()})),bi(1),ne());a.subscribe(void 0,(function(e){console.error("Failed to cache image (".concat(t,")."),e)})),(i=this._graph$.pipe(ri(),tn((function(e){return e.isCachingFull(t)||!e.hasNode(t)?e.cacheFull$(t):e.isCachingFill(t)||!e.getNode(t).complete?e.cacheFill$(t):xe(e)})),Hi((function(e){if(!e.hasNode(t))throw new Qf("Failed to cache image (".concat(t,")"));e.hasInitializedCache(t)||e.initializeCache(t)})),ei((function(){null!=i&&(e._removeFromArray(i,e._initializeCacheSubscriptions),e._removeFromArray(n,e._firstGraphSubjects$))}))).subscribe((function(t){n.next(t),n.complete()}),(function(t){n.error(t)}))).closed||this._initializeCacheSubscriptions.push(i);var o,s,u=r.pipe(An((function(){return me()})),tn((function(e){return e.isCachingNodeSequence(t)||!e.hasNodeSequence(t)?e.cacheNodeSequence$(t):xe(e)})),bi(1),ne());((o=u.pipe(Hi((function(e){e.getNode(t).sequenceEdges.cached||e.cacheSequenceEdges(t)})),ei((function(){null!=o&&e._removeFromArray(o,e._sequenceSubscriptions)}))).subscribe((function(){}),(function(e){console.error("Failed to cache sequence edges (".concat(t,")."),e)}))).closed||this._sequenceSubscriptions.push(o),this._graphMode===Mg.Spatial)&&((s=r.pipe(An((function(){return me()})),Jn((function(e){return e.hasTiles(t)?me():Ye(e.cacheTiles$(t)).pipe(tn((function(e){return e.pipe(tn((function(e){return e.isCachingTiles(t)?me():xe(e)})),An((function(e){return console.error("Failed to cache tile data (".concat(t,")."),e),me()})))})))})),ai(1),tn((function(e){return e.hasSpatialArea(t)?xe(e):Ye(e.cacheSpatialArea$(t)).pipe(tn((function(e){return e.pipe(An((function(e){return console.error("Failed to cache spatial images (".concat(t,")."),e),me()})))})))})),ai(1),tn((function(e){return e.hasNodeSequence(t)?xe(e):e.cacheNodeSequence$(t)})),Hi((function(e){e.getNode(t).spatialEdges.cached||e.cacheSpatialEdges(t)})),ei((function(){null!=s&&e._removeFromArray(s,e._spatialSubscriptions)}))).subscribe((function(){}),(function(e){var n="Failed to cache spatial edges (".concat(t,").");console.error(n,e)}))).closed||this._spatialSubscriptions.push(s));return a.pipe(ri((function(t){return t.assetsCached})))}},{key:"cacheSequence$",value:function(t){return this._graph$.pipe(ri(),tn((function(e){return e.isCachingSequence(t)||!e.hasSequence(t)?e.cacheSequence$(t):xe(e)})),De((function(e){return e.getSequence(t)})))}},{key:"cacheSequenceImages$",value:function(t,e){return this._graph$.pipe(ri(),tn((function(e){return e.isCachingSequence(t)||!e.hasSequence(t)?e.cacheSequence$(t):xe(e)})),tn((function(n){return n.isCachingSequenceNodes(t)||!n.hasSequenceNodes(t)?n.cacheSequenceNodes$(t,e):xe(n)})),De((function(e){return e.getSequence(t)})))}},{key:"dispose",value:function(){this._graph$.pipe(ri()).subscribe((function(t){t.unsubscribe()})),this._subscriptions.unsubscribe()}},{key:"setFilter$",value:function(t){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(ri(),Hi((function(e){e.resetSpatialEdges(),e.setFilter(t)})),De((function(){})))}},{key:"setGraphMode",value:function(t){this._graphMode!==t&&(t===Mg.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=t,this._graphModeSubject$.next(this._graphMode))}},{key:"reset$",value:function(t){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(ri(),Hi((function(e){e.reset(t)})),De((function(){})))}},{key:"uncache$",value:function(t,e,n){return this._graph$.pipe(ri(),Hi((function(i){i.uncache(t,e,n)})),De((function(){})))}},{key:"_abortSubjects",value:function(t){var e,n=wt(t.slice());try{for(n.s();!(e=n.n()).done;){var i=e.value;this._removeFromArray(i,t),i.error(new Error("Cache image request was aborted."))}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"_removeFromArray",value:function(t,e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},{key:"_resetSubscriptions",value:function(t){var e,n=wt(t.slice());try{for(n.s();!(e=n.n()).done;){var i=e.value;this._removeFromArray(i,t),i.closed||i.unsubscribe()}}catch(Tx){n.e(Tx)}finally{n.f()}}}]),t}(),ck=function(){function t(e){Tt(this,t),e.requestAnimationFrame?(this._cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this._requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this._cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this._cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this._cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this._cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this._cancelAnimationFrame=e.clearTimeout.bind(e),this._requestAnimationFrame=function(t){return e.setTimeout(t,1e3/60)})}return Ct(t,[{key:"cancelAnimationFrame",get:function(){return this._cancelAnimationFrame}},{key:"requestAnimationFrame",get:function(){return this._requestAnimationFrame}}]),t}(),hk=function(t){kt(n,t);var e=Mt(n);function n(t){return Tt(this,n),e.call(this,t)}return Ct(n,[{key:"setViewMatrix",value:function(t){var e=(new ba).fromArray(t).invert().elements,n=new Wr(e[12],e[13],e[14]),i=new Wr(-e[8],-e[9],-e[10]),r=new Wr(e[4],e[5],e[6]),a=this._camera;a.position.copy(n),a.lookat.copy(n.clone().add(i)),a.up.copy(r);var o=.5/Math.tan(Math.PI/3);a.focal=o}}]),n}(Td),pk=function(t){kt(n,t);var e=Mt(n);function n(t){var i;Tt(this,n);var r=(i=e.call(this,t))._camera.position.clone(),a=i._camera.lookat.clone().sub(r).normalize(),o=Math.sqrt(a.x*a.x+a.y*a.y),s=Math.atan2(a.z,o),u=new Wr;if(s>-Math.PI/45)u.copy(r),r.add(new Wr(a.x,a.y,0).multiplyScalar(-50)),r.z=30;else{var l=r.clone(),c=new Wr(0,0,1),h=new Wr(0,0,-2),p=(new Wr).subVectors(h,l).dot(c)/a.dot(c),f=l.clone().add(a.clone().multiplyScalar(Math.min(1e4,p)));u.copy(f);var d=r.clone().sub(f).normalize();r.copy(f.add(d.multiplyScalar(Math.max(50,d.length()))))}return i._camera.position.copy(r),i._camera.lookat.copy(u),i._camera.up.set(0,0,1),i}return Ct(n,[{key:"dolly",value:function(t){var e=this._camera,n=e.position.clone().sub(e.lookat),i=n.length()*Math.pow(2,-t),r=Math.max(1,Math.min(i,4e3));n.normalize(),n.multiplyScalar(r),e.position.copy(e.lookat).add(n)}},{key:"orbit",value:function(t){var e=this._camera,n=(new qr).setFromUnitVectors(e.up,new Wr(0,0,1)),i=n.clone().invert(),r=e.position.clone().sub(e.lookat);r.applyQuaternion(n);var a=r.length(),o=Math.atan2(r.y,r.x);o+=t.phi;var s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=t.theta;var u=Math.PI/36;s=Math.max(u,Math.min(Math.PI/2-u,s)),r.x=Math.sin(s)*Math.cos(o),r.y=Math.sin(s)*Math.sin(o),r.z=Math.cos(s),r.applyQuaternion(i),e.position.copy(e.lookat).add(r.multiplyScalar(a))}},{key:"truck",value:function(t){var e=this._camera;e.position.add((new Wr).fromArray(t)),e.lookat.add((new Wr).fromArray(t))}},{key:"update",value:function(){}}]),n}(Td),fk=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._adjustCameras(),i._motionless=i._motionlessTransition(),i}return Ct(n,[{key:"prepend",value:function(t){xt(mt(n.prototype),"prepend",this).call(this,t),this._motionless=this._motionlessTransition()}},{key:"set",value:function(t){xt(mt(n.prototype),"set",this).call(this,t),this._motionless=this._motionlessTransition()}},{key:"move",value:function(t){this._alpha=Math.max(0,Math.min(1,this._alpha+t))}},{key:"moveTo",value:function(t){this._alpha=Math.max(0,Math.min(1,t))}},{key:"update",value:function(t){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation);var e=this._animationSpeed*(60/t);this._updateZoom(e),this._updateLookat(e),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.round(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){xt(mt(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){if(Zf(this._currentImage.cameraType)){var t=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}if(Zf(this._previousImage.cameraType)){var e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}]),n}(Cd),dk=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._zoom=0,i._adjustCameras(),i._motionless=i._motionlessTransition(),i}return Ct(n,[{key:"prepend",value:function(t){xt(mt(n.prototype),"prepend",this).call(this,t),this._motionless=this._motionlessTransition()}},{key:"set",value:function(t){xt(mt(n.prototype),"set",this).call(this,t),this._motionless=this._motionlessTransition()}},{key:"move",value:function(t){this._alpha=Math.max(0,Math.min(1,this._alpha+t))}},{key:"moveTo",value:function(t){this._alpha=Math.max(0,Math.min(1,t))}},{key:"update",value:function(t){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}},{key:"_getAlpha",value:function(){return this._motionless?Math.round(this._alpha):this._alpha}},{key:"_setCurrentCamera",value:function(){xt(mt(n.prototype),"_setCurrentCamera",this).call(this),this._adjustCameras()}},{key:"_adjustCameras",value:function(){if(null!=this._previousImage){if(Zf(this._currentImage.cameraType)){var t=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}if(Zf(this._previousImage.cameraType)){var e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}]),n}(Td),vk=function(){function t(){Tt(this,t);var e=Qm[Qm.Custom],n=Qm[Qm.Earth],i=Qm[Qm.Traversing],r=Qm[Qm.Waiting],a=Qm[Qm.WaitingInteractively];this._creators=new Map;var o=this._creators;o.set(e,hk),o.set(n,pk),o.set(i,Id),o.set(r,dk),o.set(a,fk),this._transitions=new Map;var s=this._transitions;s.set(e,[n,i]),s.set(n,[e,i]),s.set(i,[e,n,r,a]),s.set(r,[i,a]),s.set(a,[i,r])}return Ct(t,[{key:"getState",value:function(t){if(t instanceof hk)return Qm.Custom;if(t instanceof pk)return Qm.Earth;if(t instanceof Id)return Qm.Traversing;if(t instanceof dk)return Qm.Waiting;if(t instanceof fk)return Qm.WaitingInteractively;throw new Error("Invalid state instance")}},{key:"generate",value:function(t,e){return new(this._creators.get(Qm[t]))(e)}},{key:"transition",value:function(t,e){if(!this.validate(t,e))throw new Error("Invalid transition");return this.generate(e,t)}},{key:"validate",value:function(t,e){var n=Qm[this.getState(t)],i=Qm[e],r=this._transitions;return r.has(n)&&r.get(n).includes(i)}}]),t}(),mk=function(){function t(e,n){Tt(this,t),this._transitions=new vk,this._state=this._transitions.generate(e,{alpha:1,camera:new kd,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:null==n?bd.Default:n,zoom:0})}return Ct(t,[{key:"state",get:function(){return this._transitions.getState(this._state)}},{key:"reference",get:function(){return this._state.reference}},{key:"alpha",get:function(){return this._state.alpha}},{key:"camera",get:function(){return this._state.camera}},{key:"zoom",get:function(){return this._state.zoom}},{key:"currentImage",get:function(){return this._state.currentImage}},{key:"previousImage",get:function(){return this._state.previousImage}},{key:"currentCamera",get:function(){return this._state.currentCamera}},{key:"currentTransform",get:function(){return this._state.currentTransform}},{key:"previousTransform",get:function(){return this._state.previousTransform}},{key:"trajectory",get:function(){return this._state.trajectory}},{key:"currentIndex",get:function(){return this._state.currentIndex}},{key:"lastImage",get:function(){return this._state.trajectory[this._state.trajectory.length-1]}},{key:"imagesAhead",get:function(){return this._state.trajectory.length-1-this._state.currentIndex}},{key:"motionless",get:function(){return this._state.motionless}},{key:"custom",value:function(){this._transition(Qm.Custom)}},{key:"earth",value:function(){this._transition(Qm.Earth)}},{key:"traverse",value:function(){this._transition(Qm.Traversing)}},{key:"wait",value:function(){this._transition(Qm.Waiting)}},{key:"waitInteractively",value:function(){this._transition(Qm.WaitingInteractively)}},{key:"getCenter",value:function(){return this._state.getCenter()}},{key:"setCenter",value:function(t){this._state.setCenter(t)}},{key:"setZoom",value:function(t){this._state.setZoom(t)}},{key:"update",value:function(t){this._state.update(t)}},{key:"append",value:function(t){this._state.append(t)}},{key:"prepend",value:function(t){this._state.prepend(t)}},{key:"remove",value:function(t){this._state.remove(t)}},{key:"clear",value:function(){this._state.clear()}},{key:"clearPrior",value:function(){this._state.clearPrior()}},{key:"cut",value:function(){this._state.cut()}},{key:"set",value:function(t){this._state.set(t)}},{key:"setViewMatrix",value:function(t){this._state.setViewMatrix(t)}},{key:"rotate",value:function(t){this._state.rotate(t)}},{key:"rotateUnbounded",value:function(t){this._state.rotateUnbounded(t)}},{key:"rotateWithoutInertia",value:function(t){this._state.rotateWithoutInertia(t)}},{key:"rotateBasic",value:function(t){this._state.rotateBasic(t)}},{key:"rotateBasicUnbounded",value:function(t){this._state.rotateBasicUnbounded(t)}},{key:"rotateBasicWithoutInertia",value:function(t){this._state.rotateBasicWithoutInertia(t)}},{key:"rotateToBasic",value:function(t){this._state.rotateToBasic(t)}},{key:"move",value:function(t){this._state.move(t)}},{key:"moveTo",value:function(t){this._state.moveTo(t)}},{key:"zoomIn",value:function(t,e){this._state.zoomIn(t,e)}},{key:"setSpeed",value:function(t){this._state.setSpeed(t)}},{key:"setTransitionMode",value:function(t){this._state.setTransitionMode(t)}},{key:"dolly",value:function(t){this._state.dolly(t)}},{key:"orbit",value:function(t){this._state.orbit(t)}},{key:"truck",value:function(t){this._state.truck(t)}},{key:"_transition",value:function(t){if(this._transitions.validate(this._state,t)){var e=this._transitions.transition(this._state,t);this._state=e}else{var n=this._transitions.getState(this._state);console.warn("Transition not valid (".concat(Qm[n]," - ").concat(Qm[t],")"))}}}]),t}(),gk=function(){function t(e,n){var i=this;Tt(this,t),this._appendImage$=new te,this._subscriptions=new km;var r=this._subscriptions;this._start$=new te,this._frame$=new te,this._fpsSampleRate=30,this._contextOperation$=new ue((function(t){return t})),this._context$=this._contextOperation$.pipe(li((function(t,e){return e(t)}),new mk(e,n)),bi(1),ne()),this._state$=this._context$.pipe(De((function(t){return t.state})),Un(),bi(1),ne()),this._fps$=this._start$.pipe(zi((function(){return i._frame$.pipe(Mn(1,i._fpsSampleRate),De((function(){return(new Date).getTime()})),vi(),De((function(t){return Math.max(20,1e3*i._fpsSampleRate/(t[1]-t[0]))})),Di(60))})),Ei()),this._currentState$=this._frame$.pipe(Ki(this._fps$,this._context$,(function(t,e,n){return[t,e,n]})),hn((function(t){return null!=t[2].currentImage})),Hi((function(t){t[2].update(t[1])})),De((function(t){return{fps:t[1],id:t[0],state:t[2]}})),Ei()),this._lastState$=this._currentState$.pipe(bi(1),ne());var a=this._currentState$.pipe(Un(void 0,(function(t){return t.state.currentImage.id})),bi(1),ne()),o=new te;r.push(a.subscribe(o)),this._currentId$=new ue(null),r.push(o.pipe(De((function(t){return t.state.currentImage.id}))).subscribe(this._currentId$)),this._currentImage$=o.pipe(De((function(t){return t.state.currentImage})),bi(1),ne()),this._currentCamera$=o.pipe(De((function(t){return t.state.currentCamera})),bi(1),ne()),this._currentTransform$=o.pipe(De((function(t){return t.state.currentTransform})),bi(1),ne()),this._reference$=o.pipe(De((function(t){return t.state.reference})),Un((function(t,e){return t.lat===e.lat&&t.lng===e.lng}),(function(t){return{lat:t.lat,lng:t.lng}})),bi(1),ne()),this._currentImageExternal$=a.pipe(De((function(t){return t.state.currentImage})),bi(1),ne()),r.push(this._appendImage$.pipe(De((function(t){return function(e){return e.append([t]),e}}))).subscribe(this._contextOperation$)),this._inMotionOperation$=new te,r.push(a.pipe(De((function(){return!0}))).subscribe(this._inMotionOperation$)),r.push(this._inMotionOperation$.pipe(Un(),hn((function(t){return t})),zi((function(){return i._currentState$.pipe(hn((function(t){return 0===t.state.imagesAhead})),De((function(t){return[t.state.camera.clone(),t.state.zoom]})),vi(),De((function(t){var e=t[0][0],n=t[1][0],i=t[0][1],r=t[1][1];return e.diff(n)>1e-5||Math.abs(i-r)>1e-5})),ri((function(t){return!t})))}))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(Un(),bi(1),ne()),this._inTranslationOperation$=new te,r.push(a.pipe(De((function(){return!0}))).subscribe(this._inTranslationOperation$)),r.push(this._inTranslationOperation$.pipe(Un(),hn((function(t){return t})),zi((function(){return i._currentState$.pipe(hn((function(t){return 0===t.state.imagesAhead})),De((function(t){return t.state.camera.position.clone()})),vi(),De((function(t){return 0!==t[0].distanceToSquared(t[1])})),ri((function(t){return!t})))}))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(Un(),bi(1),ne()),r.push(this._state$.subscribe((function(){}))),r.push(this._currentImage$.subscribe((function(){}))),r.push(this._currentCamera$.subscribe((function(){}))),r.push(this._currentTransform$.subscribe((function(){}))),r.push(this._reference$.subscribe((function(){}))),r.push(this._currentImageExternal$.subscribe((function(){}))),r.push(this._lastState$.subscribe((function(){}))),r.push(this._inMotion$.subscribe((function(){}))),r.push(this._inTranslation$.subscribe((function(){}))),this._frameId=null,this._frameGenerator=new ck(window)}return Ct(t,[{key:"currentState$",get:function(){return this._currentState$}},{key:"currentImage$",get:function(){return this._currentImage$}},{key:"currentId$",get:function(){return this._currentId$}},{key:"currentImageExternal$",get:function(){return this._currentImageExternal$}},{key:"currentCamera$",get:function(){return this._currentCamera$}},{key:"currentTransform$",get:function(){return this._currentTransform$}},{key:"state$",get:function(){return this._state$}},{key:"reference$",get:function(){return this._reference$}},{key:"inMotion$",get:function(){return this._inMotion$}},{key:"inTranslation$",get:function(){return this._inTranslation$}},{key:"appendImage$",get:function(){return this._appendImage$}},{key:"dispose",value:function(){this.stop(),this._subscriptions.unsubscribe()}},{key:"custom",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.custom()}))}},{key:"earth",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.earth()}))}},{key:"traverse",value:function(){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(t){t.traverse()}))}},{key:"wait",value:function(){this._invokeContextOperation((function(t){t.wait()}))}},{key:"waitInteractively",value:function(){this._invokeContextOperation((function(t){t.waitInteractively()}))}},{key:"appendImagess",value:function(t){this._invokeContextOperation((function(e){e.append(t)}))}},{key:"prependImages",value:function(t){this._invokeContextOperation((function(e){e.prepend(t)}))}},{key:"removeImages",value:function(t){this._invokeContextOperation((function(e){e.remove(t)}))}},{key:"clearImages",value:function(){this._invokeContextOperation((function(t){t.clear()}))}},{key:"clearPriorImages",value:function(){this._invokeContextOperation((function(t){t.clearPrior()}))}},{key:"cutImages",value:function(){this._invokeContextOperation((function(t){t.cut()}))}},{key:"setImages",value:function(t){this._invokeContextOperation((function(e){e.set(t)}))}},{key:"setViewMatrix",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.setViewMatrix(t)}))}},{key:"rotate",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotate(t)}))}},{key:"rotateUnbounded",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotateUnbounded(t)}))}},{key:"rotateWithoutInertia",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotateWithoutInertia(t)}))}},{key:"rotateBasic",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotateBasic(t)}))}},{key:"rotateBasicUnbounded",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotateBasicUnbounded(t)}))}},{key:"rotateBasicWithoutInertia",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotateBasicWithoutInertia(t)}))}},{key:"rotateToBasic",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.rotateToBasic(t)}))}},{key:"move",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.move(t)}))}},{key:"moveTo",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.moveTo(t)}))}},{key:"dolly",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.dolly(t)}))}},{key:"orbit",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.orbit(t)}))}},{key:"truck",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.truck(t)}))}},{key:"zoomIn",value:function(t,e){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(n){n.zoomIn(t,e)}))}},{key:"getCenter",value:function(){return this._lastState$.pipe(ri(),De((function(t){return t.state.getCenter()})))}},{key:"getZoom",value:function(){return this._lastState$.pipe(ri(),De((function(t){return t.state.zoom})))}},{key:"setCenter",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.setCenter(t)}))}},{key:"setSpeed",value:function(t){this._invokeContextOperation((function(e){e.setSpeed(t)}))}},{key:"setTransitionMode",value:function(t){this._invokeContextOperation((function(e){e.setTransitionMode(t)}))}},{key:"setZoom",value:function(t){this._inMotionOperation$.next(!0),this._invokeContextOperation((function(e){e.setZoom(t)}))}},{key:"start",value:function(){null==this._frameId&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}},{key:"stop",value:function(){null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}},{key:"_invokeContextOperation",value:function(t){this._contextOperation$.next((function(e){return t(e),e}))}},{key:"_frame",value:function(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}]),t}();function yk(t){switch(t){case US.Custom:return Qm.Custom;case US.Earth:return Qm.Earth;case US.Street:return Qm.Traversing;default:return null}}var _k=function(){function t(e,n,i,r,a,o,s,u){var l;if(Tt(this,t),n)this._api=n;else if(e.dataProvider){if(!(e.dataProvider instanceof RS))throw new Error("Incorrect type: 'dataProvider' must extend the DataProviderBase class.");this._api=new uk(e.dataProvider)}else this._api=new uk(new BS({accessToken:e.accessToken}));this._graphService=null!==i&&void 0!==i?i:new lk(new td(this.api)),this._loadingName="navigator",this._loadingService=null!==r&&void 0!==r?r:new ok;var c=null!==(l=e.cameraControls)&&void 0!==l?l:US.Street;this._stateService=null!==a&&void 0!==a?a:new gk(yk(c),e.transitionMode),this._cacheService=null!==o&&void 0!==o?o:new ak(this._graphService,this._stateService,this._api),this._playService=null!==s&&void 0!==s?s:new Fg(this._graphService,this._stateService),this._panService=null!==u&&void 0!==u?u:new sk(this._graphService,this._stateService,e.combinedPanning),this._idRequested$=new ue(null),this._movedToId$=new ue(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}return Ct(t,[{key:"api",get:function(){return this._api}},{key:"cacheService",get:function(){return this._cacheService}},{key:"graphService",get:function(){return this._graphService}},{key:"loadingService",get:function(){return this._loadingService}},{key:"movedToId$",get:function(){return this._movedToId$}},{key:"panService",get:function(){return this._panService}},{key:"playService",get:function(){return this._playService}},{key:"stateService",get:function(){return this._stateService}},{key:"dispose",value:function(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}},{key:"moveTo$",value:function(t){this._abortRequest("to id ".concat(t)),this._loadingService.startLoading(this._loadingName);var e=this._moveTo$(t);return this._makeRequest$(e)}},{key:"moveDir$",value:function(t){var e=this;this._abortRequest("in dir ".concat(Of[t])),this._loadingService.startLoading(this._loadingName);var n=this.stateService.currentImage$.pipe(ri(),tn((function(e){return([Of.Next,Of.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(ri(),De((function(e){var n,i=wt(e.edges);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.data.direction===t)return r.target}}catch(Tx){i.e(Tx)}finally{i.f()}return null})))})),tn((function(n){return null==n?(e._loadingService.stopLoading(e._loadingName),we(new Error("Direction (".concat(t,") does not exist for current image.")))):e._moveTo$(n)})));return this._makeRequest$(n)}},{key:"setFilter$",value:function(t){var e=this;return this._stateService.clearImages(),this._movedToId$.pipe(ri(),tn((function(n){return null!=n?e._trajectoryIds$().pipe(tn((function(n){return e._graphService.setFilter$(t).pipe(tn((function(){return e._cacheIds$(n)})))})),ui()):e._idRequested$.pipe(ri(),tn((function(n){return null!=n?e._graphService.setFilter$(t).pipe(tn((function(){return e._graphService.cacheImage$(n)}))):e._graphService.setFilter$(t).pipe(De((function(){})))})))})),De((function(){})))}},{key:"setAccessToken$",value:function(t){var e=this;return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(ri(),Hi((function(){e._api.setAccessToken(t)})),tn((function(t){return null==t?e._graphService.reset$([]):e._trajectoryIds$().pipe(tn((function(t){return e._graphService.reset$(t).pipe(tn((function(){return e._cacheIds$(t)})))})),ui(),De((function(){})))})))}},{key:"_cacheIds$",value:function(t){var e=this;return Ye(t.map((function(t){return e._graphService.cacheImage$(t)}))).pipe(rn())}},{key:"_abortRequest",value:function(t){null!=this._requestSubscription&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),null!=this._imageRequestSubscription&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),null!=this._request$&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new Lm("Request aborted by a subsequent request ".concat(t,"."))),this._request$=null)}},{key:"_makeRequest$",value:function(t){var e=this,n=new Ee(1);return this._requestSubscription=n.subscribe(void 0,(function(){})),this._request$=n,this._imageRequestSubscription=t.subscribe((function(t){e._request$=null,n.next(t),n.complete()}),(function(t){e._request$=null,n.error(t)})),n}},{key:"_moveTo$",value:function(t){var e=this;return this._idRequested$.next(t),this._graphService.cacheImage$(t).pipe(Hi((function(t){e._stateService.setImages([t]),e._movedToId$.next(t.id)})),ei((function(){e._loadingService.stopLoading(e._loadingName)})))}},{key:"_trajectoryIds$",value:function(){return this._stateService.currentState$.pipe(ri(),De((function(t){return t.state.trajectory.map((function(t){return t.id}))})))}}]),t}(),bk=function(){function t(e,n){Tt(this,t),this._spatial=null!==n&&void 0!==n?n:new Wf,this._viewportCoords=null!==e&&void 0!==e?e:new Im}return Ct(t,[{key:"basicToCanvas",value:function(t,e,n,i){return this._viewportCoords.basicToCanvasSafe(t[0],t[1],e,i,n.perspective)}},{key:"canvasToBasic",value:function(t,e,n,i){var r=this._viewportCoords.canvasToBasic(t[0],t[1],e,i,n.perspective);return(r[0]<0||r[0]>1||r[1]<0||r[1]>1)&&(r=null),r}},{key:"eventToUnprojection",value:function(t,e,n,i,r){var a=this._viewportCoords.canvasPosition(t,e);return this.canvasToUnprojection(a,e,n,i,r)}},{key:"canvasToUnprojection",value:function(t,e,n,i,r){var a=t[0],o=t[1],s=rt(this._viewportCoords.canvasToViewport(a,o,e),2),u=s[0],l=s[1],c=new Wr(u,l,1).unproject(n.perspective),h=r.projectBasic(c.toArray());(h[0]<0||h[0]>1||h[1]<0||h[1]>1)&&(h=null);var p=c.clone().sub(n.camera.position).normalize(),f=-2/p.z,d=null;if(f>0&&f<100&&h){var v=p.clone().multiplyScalar(f).add(n.camera.position),m=rt(Df(v.x,v.y,v.z,i.lng,i.lat,i.alt),2),g=m[0];d={lat:m[1],lng:g}}return{basicPoint:h,lngLat:d,pixelPoint:[a,o]}}},{key:"cameraToLngLat",value:function(t,e){var n=t.camera.position,i=rt(Df(n.x,n.y,n.z,e.lng,e.lat,e.alt),2),r=i[0];return{lat:i[1],lng:r}}},{key:"lngLatToCanvas",value:function(t,e,n,i){var r=Rf(t.lng,t.lat,0,i.lng,i.lat,i.alt);return this._viewportCoords.projectToCanvasSafe(r,e,n.perspective)}},{key:"distanceBetweenLngLats",value:function(t,e){return this._spatial.distanceFromLngLat(t.lng,t.lat,e.lng,e.lat)}}]),t}(),xk=function(){function t(e,n,i){var r=this;Tt(this,t),this._subscriptions=new km,this._emitSubscriptions=new km,this._container=i,this._viewer=e,this._navigator=n,this._projection=new bk,this._started=!1,this._navigable$=new te;var a=this._subscriptions;a.push(this._navigable$.subscribe((function(t){var e="navigable",n={navigable:t,target:r._viewer,type:e};r._viewer.fire(e,n)}))),a.push(this._navigator.loadingService.loading$.subscribe((function(t){var e="dataloading",n={loading:t,target:r._viewer,type:e};r._viewer.fire(e,n)}))),a.push(this._container.glRenderer.opaqueRender$.pipe(ri()).subscribe((function(){var t="load",e={target:r._viewer,type:t};r._viewer.fire(t,e)})))}return Ct(t,[{key:"started",get:function(){return this._started}},{key:"navigable$",get:function(){return this._navigable$}},{key:"projection",get:function(){return this._projection}},{key:"dispose",value:function(){this.stopEmit(),this._subscriptions.unsubscribe()}},{key:"project$",value:function(t){var e=this;return We(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(ri(),De((function(n){var i=rt(n,3),r=i[0],a=i[1],o=i[2];if(e._projection.distanceBetweenLngLats(t,a.lngLat)>1e3)return null;var s=e._projection.lngLatToCanvas(t,e._container.container,r,o);return s?[Math.round(s[0]),Math.round(s[1])]:null})))}},{key:"projectBasic$",value:function(t){var e=this;return We(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(ri(),De((function(n){var i=rt(n,2),r=i[0],a=i[1],o=e._projection.basicToCanvas(t,e._container.container,r,a);return o?[Math.round(o[0]),Math.round(o[1])]:null})))}},{key:"startEmit",value:function(){var t=this;if(!this._started){this._started=!0;var e=this._emitSubscriptions;e.push(this._navigator.stateService.currentImageExternal$.subscribe((function(e){var n="image",i={image:e,target:t._viewer,type:n};t._viewer.fire(n,i)}))),e.push(this._navigator.stateService.currentImageExternal$.pipe(zi((function(t){return t.sequenceEdges$}))).subscribe((function(e){var n="sequenceedges",i={status:e,target:t._viewer,type:n};t._viewer.fire(n,i)}))),e.push(this._navigator.stateService.currentImageExternal$.pipe(zi((function(t){return t.spatialEdges$}))).subscribe((function(e){var n="spatialedges",i={status:e,target:t._viewer,type:n};t._viewer.fire(n,i)}))),e.push(We(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(De((function(t){return t[0]||t[1]||t[2]})),Un()).subscribe((function(e){var n=e?"movestart":"moveend",i={target:t._viewer,type:n};t._viewer.fire(n,i)}))),e.push(this._container.renderService.bearing$.pipe(kn(100),Un((function(t,e){return Math.abs(e-t)<1}))).subscribe((function(e){var n="bearing",i={bearing:e,target:t._viewer,type:n};t._viewer.fire(n,i)})));var n=this._container.mouseService.active$.pipe(zi((function(e){return e?me():t._container.mouseService.mouseMove$})));e.push(cn(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",n),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(Ki(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),De((function(e){var n=rt(e,5),i=rt(n[0],2),r=i[0],a=i[1],o=n[1],s=n[2],u=n[3],l=n[4],c=t._projection.eventToUnprojection(a,t._container.container,o,s,u);return{basicPoint:l===Qm.Traversing?c.basicPoint:null,lngLat:c.lngLat,originalEvent:a,pixelPoint:c.pixelPoint,target:t._viewer,type:r}}))).subscribe((function(e){t._viewer.fire(e.type,e)}))),e.push(this._container.renderService.renderCamera$.pipe(Un((function(e,n){var i=rt(e,2),r=i[0],a=i[1],o=rt(n,2),s=o[0],u=o[1];return t._closeTo(r,s,.01)&&t._closeTo(a,u,.01)}),(function(t){return t.camera.position.toArray()}))).subscribe((function(){var e="position",n={target:t._viewer,type:e};t._viewer.fire(e,n)}))),e.push(this._container.renderService.renderCamera$.pipe(Un((function(e,n){var i=rt(e,2),r=i[0],a=i[1],o=rt(n,2),s=o[0],u=o[1];return t._closeTo(r,s,.001)&&t._closeTo(a,u,.001)}),(function(t){return[t.rotation.phi,t.rotation.theta]}))).subscribe((function(){var e={target:t._viewer,type:"pov"};t._viewer.fire("pov",e)}))),e.push(this._container.renderService.renderCamera$.pipe(Un((function(e,n){return t._closeTo(e,n,.01)}),(function(t){return t.perspective.fov}))).subscribe((function(){var e={target:t._viewer,type:"fov"};t._viewer.fire("fov",e)})))}}},{key:"stopEmit",value:function(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}},{key:"unproject$",value:function(t){var e=this;return We(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(ri(),De((function(n){var i=rt(n,3),r=i[0],a=i[1],o=i[2];return e._projection.canvasToUnprojection(t,e._container.container,r,a,o).lngLat})))}},{key:"unprojectBasic$",value:function(t){var e=this;return We(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(ri(),De((function(n){var i=rt(n,2),r=i[0],a=i[1];return e._projection.canvasToBasic(t,e._container.container,r,a)})))}},{key:"_closeTo",value:function(t,e,n){return Math.abs(t-e)<=n}},{key:"_mapMouseEvent$",value:function(t,e){return e.pipe(De((function(e){return[t,e]})))}}]),t}(),wk=function(){function t(e,n){Tt(this,t),this._container=e,this._navigator=n,this._renderers={}}return Ct(t,[{key:"add",value:function(t,e){var n=new km;this._renderers[t.id]={subs:n,renderer:t},n.push(We([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe(Xn(1)).subscribe((function(n){var i=rt(n,2),r=i[0],a=i[1];t.onAdd(e,a,r.getContext())}))),n.push(this._container.glRenderer.opaqueRender$.pipe(Ki(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe((function(e){var n=rt(e,3),i=n[1],r=n[2].getContext(),a=i.perspective.matrixWorldInverse,o=i.perspective.projectionMatrix;t.render(r,a.toArray(),o.toArray())}))),n.push(this._navigator.stateService.reference$.pipe(Ci(1)).subscribe((function(n){t.onReference(e,n)})))}},{key:"dispose",value:function(t){for(var e=0,n=Object.keys(this._renderers);e<n.length;e++){var i=n[e];this.remove(i,t)}}},{key:"has",value:function(t){return t in this._renderers}},{key:"remove",value:function(t,e){this._renderers[t].subs.unsubscribe();var n=this._renderers[t].renderer;delete this._renderers[t],this._container.glRenderer.webGLRenderer$.subscribe((function(t){n.onRemove(e,t.getContext())}))}}]),t}(),Sk=function(){function t(e,n){Tt(this,t),this._container=e,this._navigator=n,this._controls=null,this._subscriptions=new km}return Ct(t,[{key:"attach",value:function(t,e){var n=this;if(this._controls)throw new Hf("Custom camera controls already attached");var i=new te,r=i.pipe(zi((function(){return n._navigator.stateService.state$})),De((function(t){return t===Qm.Custom})),Un()),a=this._subscriptions;a.push(r.pipe(Di(!1),vi(),Ki(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe((function(n){var i=rt(n,3),r=rt(i[0],2),a=r[0],o=r[1],s=i[1],u=i[2];o?t.onActivate(e,u.perspective.matrixWorldInverse.toArray(),u.perspective.projectionMatrix.toArray(),s):a&&t.onDeactivate(e)}))),a.push(r.pipe(zi((function(t){return t?n._navigator.stateService.currentState$.pipe(Ci(1)):me()}))).subscribe((function(n){t.onAnimationFrame(e,n.id)}))),a.push(r.pipe(zi((function(t){return t?n._navigator.stateService.reference$.pipe(Ci(1)):me()}))).subscribe((function(n){return t.onReference(e,n)}))),a.push(r.pipe(zi((function(t){return t?n._container.renderService.size$.pipe(Ci(1)):me()}))).subscribe((function(){return t.onResize(e)}))),a.push(We([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(ri()).subscribe((function(){t.onAttach(e,(function(e){n._controls&&t===n._controls&&n._updateViewMatrix(e)}),(function(e){n._controls&&t===n._controls&&n._updateProjectionMatrix(e)})),i.next(),i.complete()}))),this._controls=t}},{key:"dispose",value:function(t){this.detach(t)}},{key:"detach",value:function(t){var e=this;this._controls&&(this._subscriptions.unsubscribe(),this._navigator.stateService.state$.subscribe((function(n){n===Qm.Custom&&e._controls.onDeactivate(t),e._controls.onDetach(t),e._controls=null})))}},{key:"_updateProjectionMatrix",value:function(t){var e=this;this._navigator.stateService.state$.pipe(ri()).subscribe((function(n){if(n===Qm.Custom)e._container.renderService.projectionMatrix$.next(t);else{console.warn("Incorrect camera control mode for projection matrix update")}}))}},{key:"_updateViewMatrix",value:function(t){var e=this;this._navigator.stateService.state$.pipe(ri()).subscribe((function(n){if(n===Qm.Custom)e._navigator.stateService.setViewMatrix(t);else{console.warn("Incorrect camera control mode for view matrix update")}}))}}]),t}(),kk=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this))._navigator=new _k(t),i._container=new rk(t,i._navigator.stateService),i._observer=new xk(ft(i),i._navigator,i._container),i._componentController=new WS(i._container,i._navigator,i._observer,t.imageId,t.component),i._customRenderer=new wk(i._container,i._navigator),i._customCameraControls=new Sk(i._container,i._navigator),i}return Ct(n,[{key:"isNavigable",get:function(){return this._componentController.navigable}},{key:"activateCombinedPanning",value:function(){this._navigator.panService.enable()}},{key:"activateComponent",value:function(t){this._componentController.activate(t)}},{key:"activateCover",value:function(){this._componentController.activateCover()}},{key:"addCustomRenderer",value:function(t){this._customRenderer.add(t,this)}},{key:"attachCustomCameraControls",value:function(t){this._customCameraControls.attach(t,this)}},{key:"deactivateCombinedPanning",value:function(){this._navigator.panService.disable()}},{key:"deactivateComponent",value:function(t){this._componentController.deactivate(t)}},{key:"deactivateCover",value:function(){this._componentController.deactivateCover()}},{key:"detachCustomCameraControls",value:function(){this._customCameraControls.detach(this)}},{key:"fire",value:function(t,e){xt(mt(n.prototype),"fire",this).call(this,t,e)}},{key:"getBearing",value:function(){var t=this;return new Promise((function(e,n){t._container.renderService.bearing$.pipe(ri()).subscribe((function(t){e(t)}),(function(t){n(t)}))}))}},{key:"getCameraControls",value:function(){var t=this;return new Promise((function(e,n){t._navigator.stateService.state$.pipe(ri()).subscribe((function(t){switch(t){case Qm.Custom:e(US.Custom);break;case Qm.Earth:e(US.Earth);break;default:e(US.Street)}}),(function(t){n(t)}))}))}},{key:"getCanvas",value:function(){return this._container.canvas}},{key:"getCanvasContainer",value:function(){return this._container.canvasContainer}},{key:"getCenter",value:function(){var t=this;return new Promise((function(e,n){t._navigator.stateService.getCenter().subscribe((function(t){e(t)}),(function(t){n(t)}))}))}},{key:"getComponent",value:function(t){return this._componentController.get(t)}},{key:"getContainer",value:function(){return this._container.container}},{key:"getFieldOfView",value:function(){var t=this;return new Promise((function(e,n){t._container.renderService.renderCamera$.pipe(ri()).subscribe((function(t){e(t.perspective.fov)}),(function(t){n(t)}))}))}},{key:"getImage",value:function(){var t=this;return new Promise((function(e,n){t._navigator.stateService.currentImage$.pipe(ri()).subscribe((function(t){e(t)}),(function(t){n(t)}))}))}},{key:"getPointOfView",value:function(){var t=this;return new Promise((function(e,n){We(t._container.renderService.renderCamera$,t._container.renderService.bearing$).pipe(ri()).subscribe((function(t){var n=rt(t,2),i=n[0],r=n[1];e({bearing:r,tilt:i.getTilt()})}),(function(t){n(t)}))}))}},{key:"getPosition",value:function(){var t=this;return new Promise((function(e,n){We(t._container.renderService.renderCamera$,t._navigator.stateService.reference$).pipe(ri()).subscribe((function(n){var i=rt(n,2),r=i[0],a=i[1];e(t._observer.projection.cameraToLngLat(r,a))}),(function(t){n(t)}))}))}},{key:"getZoom",value:function(){var t=this;return new Promise((function(e,n){t._navigator.stateService.getZoom().subscribe((function(t){e(t)}),(function(t){n(t)}))}))}},{key:"hasCustomRenderer",value:function(t){return this._customRenderer.has(t)}},{key:"moveDir",value:function(t){var e=this.isNavigable?this._navigator.moveDir$(t):we(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise((function(t,n){e.subscribe((function(e){t(e)}),(function(t){n(t)}))}))}},{key:"moveTo",value:function(t){var e=this.isNavigable?this._navigator.moveTo$(t):we(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise((function(t,n){e.subscribe((function(e){t(e)}),(function(t){n(t)}))}))}},{key:"off",value:function(t,e){xt(mt(n.prototype),"off",this).call(this,t,e)}},{key:"on",value:function(t,e){xt(mt(n.prototype),"on",this).call(this,t,e)}},{key:"project",value:function(t){var e=this;return new Promise((function(n,i){e._observer.project$(t).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"projectFromBasic",value:function(t){var e=this;return new Promise((function(n,i){e._observer.projectBasic$(t).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"remove",value:function(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();var t="remove",e={target:this,type:t};this.fire(t,e)}},{key:"removeCustomRenderer",value:function(t){this._customRenderer.remove(t,this)}},{key:"resize",value:function(){this._container.renderService.resize$.next()}},{key:"setCameraControls",value:function(t){var e=yk(t);e===Qm.Traversing?this._navigator.stateService.traverse():e===Qm.Earth?this._navigator.stateService.earth():e===Qm.Custom?this._navigator.stateService.custom():console.warn("Unsupported camera control transition (".concat(t,")"))}},{key:"setCenter",value:function(t){this._navigator.stateService.setCenter(t)}},{key:"setFieldOfView",value:function(t){var e=this;this._container.renderService.renderCamera$.pipe(ri()).subscribe((function(n){var i=n.fovToZoom(t);e._navigator.stateService.setZoom(i)}))}},{key:"setFilter",value:function(t){var e=this;return new Promise((function(n,i){e._navigator.setFilter$(t).subscribe((function(){n(void 0)}),(function(t){i(t)}))}))}},{key:"setRenderMode",value:function(t){this._container.renderService.renderMode$.next(t)}},{key:"setTransitionMode",value:function(t){this._navigator.stateService.setTransitionMode(t)}},{key:"setAccessToken",value:function(t){var e=this.isNavigable?this._navigator.setAccessToken$(t):we(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise((function(t,n){e.subscribe((function(){t(void 0)}),(function(t){n(t)}))}))}},{key:"setZoom",value:function(t){this._navigator.stateService.setZoom(t)}},{key:"triggerRerender",value:function(){this._container.glRenderer.triggerRerender()}},{key:"unproject",value:function(t){var e=this;return new Promise((function(n,i){e._observer.unproject$(t).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}},{key:"unprojectToBasic",value:function(t){var e=this;return new Promise((function(n,i){e._observer.unprojectBasic$(t).subscribe((function(t){n(t)}),(function(t){i(t)}))}))}}]),n}(Sm);td.register(xd),ed.register(xd),Id.register(wd),Pd.registerCover(Tm),Pd.register(Em),Pd.register(Pm),Pd.register(Am),Pd.register(zm),Pd.register(eg),Pd.register(sg),Pd.register(lg),Pd.register(kg),Pd.register(Cg),Pd.register(Ag),Pd.register(Dg),Pd.register(ny),Pd.register(ab),Pd.register(ob),Pd.register(sb),Pd.register(ub);var Mk=Math.PI/180;function Tk(t,e){var n=3*Math.PI,i=2*Math.PI,r=Math.PI/180,a=t.lat*r,o=t.lng*r,s=Math.sin(a),u=Math.cos(a),l=Math.random()*i,c=e/6378137,h=Math.sin(l),p=Math.cos(l),f=Math.sin(c),d=Math.cos(c),v=Math.asin(s*d+u*f*p),m=o+Math.atan2(h*f*u,d-s*Math.sin(v));return[(m=(m+n)%i-Math.PI)/r,v/r]}function Ek(t,e,n,i){var r=Math.cos,a=.5-r((n-t)*Mk)/2+r(t*Mk)*r(n*Mk)*(1-r((i-e)*Mk))/2;return 12742*Math.asin(Math.sqrt(a))}function Ck(t,e,n){var i=t/360+.5,r=Math.sin(e*Mk),a=.5-.25*Math.log((1+r)/(1-r))/Math.PI,o=Math.pow(2,n);return[i<=0?0:i>=1?(0|o)-1:(i+1e-14)*o|0,a<=0?0:a>=1?(0|o)-1:(a+1e-14)*o|0,n]}var Ik=n(137),Pk=n(386),Ak=n.n(Pk);function Lk(t,e){return Rk.apply(this,arguments)}function Rk(){return Rk=ut(ht().mark((function t(e,n){var i,r,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,S,k,M=arguments;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=M.length>2&&void 0!==M[2]?M[2]:.1,r=Ck(e,n,14),a=rt(r,3),o=a[0],s=a[1],u=a[2],t.next=4,fetch("https://tiles.mapillary.com/maps/vtp/mly1_public/2/".concat(u,"/").concat(o,"/").concat(s,"?access_token=").concat("MLY|4920556504644439|205c8173420810cc93021c7a46464923"));case 4:return l=t.sent,t.next=7,l.arrayBuffer();case 7:if(c=t.sent,h=new Ik.VectorTile(new(Ak())(c)),p=h.layers.image){t.next=12;break}return t.abrupt("return",null);case 12:for(f=9999999,d=null,v=9999999,m=null,g=0,y=p._features.length;g<y;++g)_=p.feature(g),b=rt(_.toGeoJSON(o,s,u).geometry.coordinates,2),x=b[0],w=b[1],S=Ek(n,e,w,x),_.properties.is_pano?S<v&&(v=S,m=_):S<f&&(f=S,d=_);if(k=null===d?m:null===m?d:Math.abs(f-v)<i?m:d){t.next=20;break}return t.abrupt("return",null);case 20:return t.abrupt("return",k.properties.id);case 21:case"end":return t.stop()}}),t)}))),Rk.apply(this,arguments)}function Dk(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new kk({cameraControls:US.Street,container:t.current,renderMode:$S.Fill,component:{slider:!1,spatial:!1,cover:!1,sequence:!1,marker:!0},accessToken:"MLY|4920556504644439|205c8173420810cc93021c7a46464923"}),i=null,r=n.getComponent("marker");return n.on("mousemove",(function(t){i&&r.remove([i]),t.lngLat&&(i=new VS("hover",t.lngLat),r.add([i]))})),n.on("click",function(){var t=ut(ht().mark((function t(e){var i;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Lk(e.lngLat.lng,e.lngLat.lat);case 2:if(!(i=t.sent)){t.next=6;break}return t.next=6,n.moveTo(i);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e&&n.on("position",function(){var t=ut(ht().mark((function t(i){var r;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getPosition();case 2:r=t.sent,e([r.lng,r.lat]);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n}function zk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Ok(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zk(Object(n),!0).forEach((function(e){St(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Fk="undefined"===typeof window?function(t){return t()}:window.requestAnimationFrame;function Nk(t,e,n){var i=n||function(t){return Array.prototype.slice.call(t)},r=!1,a=[];return function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];a=i(o),r||(r=!0,Fk.call(window,(function(){r=!1,t.apply(e,a)})))}}var Bk=function(t){return"start"===t?"left":"end"===t?"right":"center"},jk=function(t,e,n){return"start"===t?e:"end"===t?n:(e+n)/2};function Vk(){}var Uk=function(){var t=0;return function(){return t++}}();function $k(t){return null===t||"undefined"===typeof t}function Hk(t){if(Array.isArray&&Array.isArray(t))return!0;var e=Object.prototype.toString.call(t);return"[object"===e.substr(0,7)&&"Array]"===e.substr(-6)}function qk(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}var Wk=function(t){return("number"===typeof t||t instanceof Number)&&isFinite(+t)};function Gk(t,e){return Wk(t)?t:e}function Zk(t,e){return"undefined"===typeof t?e:t}var Xk=function(t,e){return"string"===typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t};function Yk(t,e,n){if(t&&"function"===typeof t.call)return t.apply(n,e)}function Kk(t,e,n,i){var r,a,o;if(Hk(t))if(a=t.length,i)for(r=a-1;r>=0;r--)e.call(n,t[r],r);else for(r=0;r<a;r++)e.call(n,t[r],r);else if(qk(t))for(a=(o=Object.keys(t)).length,r=0;r<a;r++)e.call(n,t[o[r]],o[r])}function Jk(t,e){var n,i,r,a;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(r=t[n],a=e[n],r.datasetIndex!==a.datasetIndex||r.index!==a.index)return!1;return!0}function Qk(t){if(Hk(t))return t.map(Qk);if(qk(t)){for(var e=Object.create(null),n=Object.keys(t),i=n.length,r=0;r<i;++r)e[n[r]]=Qk(t[n[r]]);return e}return t}function tM(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function eM(t,e,n,i){if(tM(t)){var r=e[t],a=n[t];qk(r)&&qk(a)?nM(r,a,i):e[t]=Qk(a)}}function nM(t,e,n){var i=Hk(e)?e:[e],r=i.length;if(!qk(t))return t;for(var a=(n=n||{}).merger||eM,o=0;o<r;++o)if(qk(e=i[o]))for(var s=Object.keys(e),u=0,l=s.length;u<l;++u)a(s[u],t,e,n);return t}function iM(t,e){return nM(t,e,{merger:rM})}function rM(t,e,n){if(tM(t)){var i=e[t],r=n[t];qk(i)&&qk(r)?iM(i,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=Qk(r))}}function aM(t,e){var n=t.indexOf(".",e);return-1===n?t.length:n}function oM(t,e){if(""===e)return t;for(var n=0,i=aM(e,n);t&&i>n;)t=t[e.substr(n,i-n)],i=aM(e,n=i+1);return t}function sM(t){return t.charAt(0).toUpperCase()+t.slice(1)}var uM=function(t){return"undefined"!==typeof t},lM=function(t){return"function"===typeof t},cM=function(t,e){if(t.size!==e.size)return!1;var n,i=wt(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(!e.has(r))return!1}}catch(Tx){i.e(Tx)}finally{i.f()}return!0},hM=Math.PI,pM=2*hM,fM=pM+hM,dM=Number.POSITIVE_INFINITY,vM=hM/180,mM=hM/2,gM=hM/4,yM=2*hM/3,_M=Math.log10,bM=Math.sign;function xM(t){var e=Math.round(t);t=SM(t,e,t/1e3)?e:t;var n=Math.pow(10,Math.floor(_M(t))),i=t/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function wM(t){return!isNaN(parseFloat(t))&&isFinite(t)}function SM(t,e,n){return Math.abs(t-e)<n}function kM(t,e,n){var i,r,a;for(i=0,r=t.length;i<r;i++)a=t[i][n],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function MM(t){return t*(hM/180)}function TM(t){return t*(180/hM)}function EM(t){if(Wk(t)){for(var e=1,n=0;Math.round(t*e)/e!==t;)e*=10,n++;return n}}function CM(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function IM(t,e){return(t-e+fM)%pM-hM}function PM(t){return(t%pM+pM)%pM}function AM(t,e,n,i){var r=PM(t),a=PM(e),o=PM(n),s=PM(a-r),u=PM(o-r),l=PM(r-a),c=PM(r-o);return r===a||r===o||i&&a===o||s>u&&l<c}function LM(t,e,n){return Math.max(e,Math.min(n,t))}function RM(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return t>=Math.min(e,n)-i&&t<=Math.max(e,n)+i}var DM=function(t){return 0===t||1===t},zM=function(t,e,n){return-Math.pow(2,10*(t-=1))*Math.sin((t-e)*pM/n)},OM=function(t,e,n){return Math.pow(2,-10*t)*Math.sin((t-e)*pM/n)+1},FM={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-t*(t-2)},easeInOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return(t-=1)*t*t+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return-((t-=1)*t*t*t-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return(t-=1)*t*t*t*t+1},easeInOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},easeInSine:function(t){return 1-Math.cos(t*mM)},easeOutSine:function(t){return Math.sin(t*mM)},easeInOutSine:function(t){return-.5*(Math.cos(hM*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return DM(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1)))},easeInCirc:function(t){return t>=1?t:-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-(t-=1)*t)},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInElastic:function(t){return DM(t)?t:zM(t,.075,.3)},easeOutElastic:function(t){return DM(t)?t:OM(t,.075,.3)},easeInOutElastic:function(t){var e=.1125;return DM(t)?t:t<.5?.5*zM(2*t,e,.45):.5+.5*OM(2*t-1,e,.45)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:function(t){return 1-FM.easeOutBounce(1-t)},easeOutBounce:function(t){var e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:function(t){return t<.5?.5*FM.easeInBounce(2*t):.5*FM.easeOutBounce(2*t-1)+.5}},NM={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},BM="0123456789ABCDEF",jM=function(t){return BM[15&t]},VM=function(t){return BM[(240&t)>>4]+BM[15&t]},UM=function(t){return(240&t)>>4===(15&t)};function $M(t){var e=function(t){return UM(t.r)&&UM(t.g)&&UM(t.b)&&UM(t.a)}(t)?jM:VM;return t?"#"+e(t.r)+e(t.g)+e(t.b)+(t.a<255?e(t.a):""):t}function HM(t){return t+.5|0}var qM=function(t,e,n){return Math.max(Math.min(t,n),e)};function WM(t){return qM(HM(2.55*t),0,255)}function GM(t){return qM(HM(255*t),0,255)}function ZM(t){return qM(HM(t/2.55)/100,0,1)}function XM(t){return qM(HM(100*t),0,100)}var YM=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;var KM=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function JM(t,e,n){var i=e*Math.min(n,1-n),r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+t/30)%12;return n-i*Math.max(Math.min(r-3,9-r,1),-1)};return[r(0),r(8),r(4)]}function QM(t,e,n){var i=function(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(i+t/60)%6;return n-n*e*Math.max(Math.min(r,4-r,1),0)};return[i(5),i(3),i(1)]}function tT(t,e,n){var i,r=JM(t,1,.5);for(e+n>1&&(e*=i=1/(e+n),n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function eT(t){var e,n,i,r=t.r/255,a=t.g/255,o=t.b/255,s=Math.max(r,a,o),u=Math.min(r,a,o),l=(s+u)/2;return s!==u&&(i=s-u,n=l>.5?i/(2-s-u):i/(s+u),e=60*(e=s===r?(a-o)/i+(a<o?6:0):s===a?(o-r)/i+2:(r-a)/i+4)+.5),[0|e,n||0,l]}function nT(t,e,n,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,i)).map(GM)}function iT(t,e,n){return nT(JM,t,e,n)}function rT(t){return(t%360+360)%360}function aT(t){var e,n=KM.exec(t),i=255;if(n){n[5]!==e&&(i=n[6]?WM(+n[5]):GM(+n[5]));var r=rT(+n[2]),a=+n[3]/100,o=+n[4]/100;return{r:(e="hwb"===n[1]?function(t,e,n){return nT(tT,t,e,n)}(r,a,o):"hsv"===n[1]?function(t,e,n){return nT(QM,t,e,n)}(r,a,o):iT(r,a,o))[0],g:e[1],b:e[2],a:i}}}var oT,sT={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},uT={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function lT(t){oT||(oT=function(){var t,e,n,i,r,a={},o=Object.keys(uT),s=Object.keys(sT);for(t=0;t<o.length;t++){for(i=r=o[t],e=0;e<s.length;e++)n=s[e],r=r.replace(n,sT[n]);n=parseInt(uT[i],16),a[r]=[n>>16&255,n>>8&255,255&n]}return a}(),oT.transparent=[0,0,0,0]);var e=oT[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}function cT(t,e,n){if(t){var i=eT(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*n,0===e?360:1)),i=iT(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function hT(t,e){return t?Object.assign(e||{},t):t}function pT(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=GM(t[3]))):(e=hT(t,{r:0,g:0,b:0,a:1})).a=GM(e.a),e}function fT(t){return"r"===t.charAt(0)?function(t){var e,n,i,r=YM.exec(t),a=255;if(r){if(r[7]!==e){var o=+r[7];a=255&(r[8]?WM(o):255*o)}return e=+r[1],n=+r[3],i=+r[5],{r:e=255&(r[2]?WM(e):e),g:n=255&(r[4]?WM(n):n),b:i=255&(r[6]?WM(i):i),a:a}}}(t):aT(t)}var dT=function(){function t(e){if(Tt(this,t),e instanceof t)return e;var n,i=typeof e;"object"===i?n=pT(e):"string"===i&&(n=function(t){var e,n=t.length;return"#"===t[0]&&(4===n||5===n?e={r:255&17*NM[t[1]],g:255&17*NM[t[2]],b:255&17*NM[t[3]],a:5===n?17*NM[t[4]]:255}:7!==n&&9!==n||(e={r:NM[t[1]]<<4|NM[t[2]],g:NM[t[3]]<<4|NM[t[4]],b:NM[t[5]]<<4|NM[t[6]],a:9===n?NM[t[7]]<<4|NM[t[8]]:255})),e}(e)||lT(e)||fT(e)),this._rgb=n,this._valid=!!n}return Ct(t,[{key:"valid",get:function(){return this._valid}},{key:"rgb",get:function(){var t=hT(this._rgb);return t&&(t.a=ZM(t.a)),t},set:function(t){this._rgb=pT(t)}},{key:"rgbString",value:function(){return this._valid?(t=this._rgb)&&(t.a<255?"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(ZM(t.a),")"):"rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")")):this._rgb;var t}},{key:"hexString",value:function(){return this._valid?$M(this._rgb):this._rgb}},{key:"hslString",value:function(){return this._valid?function(t){if(t){var e=eT(t),n=e[0],i=XM(e[1]),r=XM(e[2]);return t.a<255?"hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(ZM(t.a),")"):"hsl(".concat(n,", ").concat(i,"%, ").concat(r,"%)")}}(this._rgb):this._rgb}},{key:"mix",value:function(t,e){var n=this;if(t){var i,r=n.rgb,a=t.rgb,o=e===i?.5:e,s=2*o-1,u=r.a-a.a,l=((s*u===-1?s:(s+u)/(1+s*u))+1)/2;i=1-l,r.r=255&l*r.r+i*a.r+.5,r.g=255&l*r.g+i*a.g+.5,r.b=255&l*r.b+i*a.b+.5,r.a=o*r.a+(1-o)*a.a,n.rgb=r}return n}},{key:"clone",value:function(){return new t(this.rgb)}},{key:"alpha",value:function(t){return this._rgb.a=GM(t),this}},{key:"clearer",value:function(t){return this._rgb.a*=1-t,this}},{key:"greyscale",value:function(){var t=this._rgb,e=HM(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}},{key:"opaquer",value:function(t){return this._rgb.a*=1+t,this}},{key:"negate",value:function(){var t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}},{key:"lighten",value:function(t){return cT(this._rgb,2,t),this}},{key:"darken",value:function(t){return cT(this._rgb,2,-t),this}},{key:"saturate",value:function(t){return cT(this._rgb,1,t),this}},{key:"desaturate",value:function(t){return cT(this._rgb,1,-t),this}},{key:"rotate",value:function(t){return function(t,e){var n=eT(t);n[0]=rT(n[0]+e),n=iT(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}]),t}();function vT(t){return new dT(t)}var mT=function(t){return t instanceof CanvasGradient||t instanceof CanvasPattern};function gT(t){return mT(t)?t:vT(t)}function yT(t){return mT(t)?t:vT(t).saturate(.5).darken(.1).hexString()}var _T=Object.create(null),bT=Object.create(null);function xT(t,e){if(!e)return t;for(var n=e.split("."),i=0,r=n.length;i<r;++i){var a=n[i];t=t[a]||(t[a]=Object.create(null))}return t}function wT(t,e,n){return"string"===typeof e?nM(xT(t,e),n):nM(xT(t,""),e)}var ST=function(){function t(e){Tt(this,t),this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=function(t){return t.chart.platform.getDevicePixelRatio()},this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=function(t,e){return yT(e.backgroundColor)},this.hoverBorderColor=function(t,e){return yT(e.borderColor)},this.hoverColor=function(t,e){return yT(e.color)},this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.describe(e)}return Ct(t,[{key:"set",value:function(t,e){return wT(this,t,e)}},{key:"get",value:function(t){return xT(this,t)}},{key:"describe",value:function(t,e){return wT(bT,t,e)}},{key:"override",value:function(t,e){return wT(_T,t,e)}},{key:"route",value:function(t,e,n,i){var r,a=xT(this,t),o=xT(this,n),s="_"+e;Object.defineProperties(a,(St(r={},s,{value:a[e],writable:!0}),St(r,e,{enumerable:!0,get:function(){var t=this[s],e=o[i];return qk(t)?Object.assign({},e,t):Zk(t,e)},set:function(t){this[s]=t}}),r))}}]),t}(),kT=new ST({_scriptable:function(t){return!t.startsWith("on")},_indexable:function(t){return"events"!==t},hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function MT(t,e,n,i,r){var a=e[r];return a||(a=e[r]=t.measureText(r).width,n.push(r)),a>i&&(i=a),i}function TT(t,e,n,i){var r=(i=i||{}).data=i.data||{},a=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(r=i.data={},a=i.garbageCollect=[],i.font=e),t.save(),t.font=e;var o,s,u,l,c,h=0,p=n.length;for(o=0;o<p;o++)if(void 0!==(l=n[o])&&null!==l&&!0!==Hk(l))h=MT(t,r,a,h,l);else if(Hk(l))for(s=0,u=l.length;s<u;s++)void 0===(c=l[s])||null===c||Hk(c)||(h=MT(t,r,a,h,c));t.restore();var f=a.length/2;if(f>n.length){for(o=0;o<f;o++)delete r[a[o]];a.splice(0,f)}return h}function ET(t,e,n){var i=t.currentDevicePixelRatio,r=0!==n?Math.max(n/2,.5):0;return Math.round((e-r)*i)/i+r}function CT(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function IT(t,e,n,i){var r,a,o,s,u,l=e.pointStyle,c=e.rotation,h=e.radius,p=(c||0)*vM;if(l&&"object"===typeof l&&("[object HTMLImageElement]"===(r=l.toString())||"[object HTMLCanvasElement]"===r))return t.save(),t.translate(n,i),t.rotate(p),t.drawImage(l,-l.width/2,-l.height/2,l.width,l.height),void t.restore();if(!(isNaN(h)||h<=0)){switch(t.beginPath(),l){default:t.arc(n,i,h,0,pM),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(p)*h,i-Math.cos(p)*h),p+=yM,t.lineTo(n+Math.sin(p)*h,i-Math.cos(p)*h),p+=yM,t.lineTo(n+Math.sin(p)*h,i-Math.cos(p)*h),t.closePath();break;case"rectRounded":s=h-(u=.516*h),a=Math.cos(p+gM)*s,o=Math.sin(p+gM)*s,t.arc(n-a,i-o,u,p-hM,p-mM),t.arc(n+o,i-a,u,p-mM,p),t.arc(n+a,i+o,u,p,p+mM),t.arc(n-o,i+a,u,p+mM,p+hM),t.closePath();break;case"rect":if(!c){s=Math.SQRT1_2*h,t.rect(n-s,i-s,2*s,2*s);break}p+=gM;case"rectRot":a=Math.cos(p)*h,o=Math.sin(p)*h,t.moveTo(n-a,i-o),t.lineTo(n+o,i-a),t.lineTo(n+a,i+o),t.lineTo(n-o,i+a),t.closePath();break;case"crossRot":p+=gM;case"cross":a=Math.cos(p)*h,o=Math.sin(p)*h,t.moveTo(n-a,i-o),t.lineTo(n+a,i+o),t.moveTo(n+o,i-a),t.lineTo(n-o,i+a);break;case"star":a=Math.cos(p)*h,o=Math.sin(p)*h,t.moveTo(n-a,i-o),t.lineTo(n+a,i+o),t.moveTo(n+o,i-a),t.lineTo(n-o,i+a),p+=gM,a=Math.cos(p)*h,o=Math.sin(p)*h,t.moveTo(n-a,i-o),t.lineTo(n+a,i+o),t.moveTo(n+o,i-a),t.lineTo(n-o,i+a);break;case"line":a=Math.cos(p)*h,o=Math.sin(p)*h,t.moveTo(n-a,i-o),t.lineTo(n+a,i+o);break;case"dash":t.moveTo(n,i),t.lineTo(n+Math.cos(p)*h,i+Math.sin(p)*h)}t.fill(),e.borderWidth>0&&t.stroke()}}function PT(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function AT(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function LT(t){t.restore()}function RT(t,e,n,i,r){if(!e)return t.lineTo(n.x,n.y);if("middle"===r){var a=(e.x+n.x)/2;t.lineTo(a,e.y),t.lineTo(a,n.y)}else"after"===r!==!!i?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function DT(t,e,n,i){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function zT(t,e,n,i,r){var a,o,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=Hk(e)?e:[e],l=s.strokeWidth>0&&""!==s.strokeColor;for(t.save(),t.font=r.string,OT(t,s),a=0;a<u.length;++a)o=u[a],l&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),$k(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(o,n,i,s.maxWidth)),t.fillText(o,n,i,s.maxWidth),FT(t,n,i,o,s),i+=r.lineHeight;t.restore()}function OT(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),$k(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function FT(t,e,n,i,r){if(r.strikethrough||r.underline){var a=t.measureText(i),o=e-a.actualBoundingBoxLeft,s=e+a.actualBoundingBoxRight,u=n-a.actualBoundingBoxAscent,l=n+a.actualBoundingBoxDescent,c=r.strikethrough?(u+l)/2:l;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(o,c),t.lineTo(s,c),t.stroke()}}function NT(t,e){var n=e.x,i=e.y,r=e.w,a=e.h,o=e.radius;t.arc(n+o.topLeft,i+o.topLeft,o.topLeft,-mM,hM,!0),t.lineTo(n,i+a-o.bottomLeft),t.arc(n+o.bottomLeft,i+a-o.bottomLeft,o.bottomLeft,hM,mM,!0),t.lineTo(n+r-o.bottomRight,i+a),t.arc(n+r-o.bottomRight,i+a-o.bottomRight,o.bottomRight,mM,0,!0),t.lineTo(n+r,i+o.topRight),t.arc(n+r-o.topRight,i+o.topRight,o.topRight,0,-mM,!0),t.lineTo(n+o.topLeft,i)}var BT=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),jT=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function VT(t,e){var n=(""+t).match(BT);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}function UT(t,e){var n,i={},r=qk(e),a=r?Object.keys(e):e,o=qk(t)?r?function(n){return Zk(t[n],t[e[n]])}:function(e){return t[e]}:function(){return t},s=wt(a);try{for(s.s();!(n=s.n()).done;){var u=n.value;i[u]=+o(u)||0}}catch(Tx){s.e(Tx)}finally{s.f()}return i}function $T(t){return UT(t,{top:"y",right:"x",bottom:"y",left:"x"})}function HT(t){return UT(t,["topLeft","topRight","bottomLeft","bottomRight"])}function qT(t){var e=$T(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function WT(t,e){t=t||{},e=e||kT.font;var n=Zk(t.size,e.size);"string"===typeof n&&(n=parseInt(n,10));var i=Zk(t.style,e.style);i&&!(""+i).match(jT)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");var r={family:Zk(t.family,e.family),lineHeight:VT(Zk(t.lineHeight,e.lineHeight),n),size:n,style:i,weight:Zk(t.weight,e.weight),string:""};return r.string=function(t){return!t||$k(t.size)||$k(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(r),r}function GT(t,e,n,i){var r,a,o,s=!0;for(r=0,a=t.length;r<a;++r)if(void 0!==(o=t[r])&&(void 0!==e&&"function"===typeof o&&(o=o(e),s=!1),void 0!==n&&Hk(o)&&(o=o[n%o.length],s=!1),void 0!==o))return i&&!s&&(i.cacheable=!1),o}function ZT(t,e){return Object.assign(Object.create(t),e)}function XT(t,e,n){n=n||function(n){return t[n]<e};for(var i,r=t.length-1,a=0;r-a>1;)n(i=a+r>>1)?a=i:r=i;return{lo:a,hi:r}}var YT=function(t,e,n){return XT(t,n,(function(i){return t[i][e]<n}))},KT=function(t,e,n){return XT(t,n,(function(i){return t[i][e]>=n}))};var JT=["push","pop","shift","splice","unshift"];function QT(t,e){var n=t._chartjs;if(n){var i=n.listeners,r=i.indexOf(e);-1!==r&&i.splice(r,1),i.length>0||(JT.forEach((function(e){delete t[e]})),delete t._chartjs)}}function tE(t){var e,n,i=new Set;for(e=0,n=t.length;e<n;++e)i.add(t[e]);return i.size===n?t:Array.from(i)}function eE(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return t[0]};uM(r)||(r=fE("_fallback",t));var o=(St(e={},Symbol.toStringTag,"Object"),St(e,"_cacheable",!0),St(e,"_scopes",t),St(e,"_rootScopes",i),St(e,"_fallback",r),St(e,"_getTarget",a),St(e,"override",(function(e){return eE([e].concat(vt(t)),n,i,r)})),e);return new Proxy(o,{deleteProperty:function(e,n){return delete e[n],delete e._keys,delete t[0][n],!0},get:function(e,i){return oE(e,i,(function(){return pE(i,n,t,e)}))},getOwnPropertyDescriptor:function(t,e){return Reflect.getOwnPropertyDescriptor(t._scopes[0],e)},getPrototypeOf:function(){return Reflect.getPrototypeOf(t[0])},has:function(t,e){return dE(t).includes(e)},ownKeys:function(t){return dE(t)},set:function(t,e,n){var i=t._storage||(t._storage=a());return t[e]=i[e]=n,delete t._keys,!0}})}function nE(t,e,n,i){var r={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:iE(t,i),setContext:function(e){return nE(t,e,n,i)},override:function(r){return nE(t.override(r),e,n,i)}};return new Proxy(r,{deleteProperty:function(e,n){return delete e[n],delete t[n],!0},get:function(t,e,n){return oE(t,e,(function(){return function(t,e,n){var i=t._proxy,r=t._context,a=t._subProxy,o=t._descriptors,s=i[e];lM(s)&&o.isScriptable(e)&&(s=function(t,e,n,i){var r=n._proxy,a=n._context,o=n._subProxy,s=n._stack;if(s.has(t))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+t);s.add(t),e=e(a,o||i),s.delete(t),aE(t,e)&&(e=cE(r._scopes,r,t,e));return e}(e,s,t,n));Hk(s)&&s.length&&(s=function(t,e,n,i){var r=n._proxy,a=n._context,o=n._subProxy,s=n._descriptors;if(uM(a.index)&&i(t))e=e[a.index%e.length];else if(qk(e[0])){var u=e,l=r._scopes.filter((function(t){return t!==u}));e=[];var c,h=wt(u);try{for(h.s();!(c=h.n()).done;){var p=cE(l,r,t,c.value);e.push(nE(p,a,o&&o[t],s))}}catch(Tx){h.e(Tx)}finally{h.f()}}return e}(e,s,t,o.isIndexable));aE(e,s)&&(s=nE(s,r,a&&a[e],o));return s}(t,e,n)}))},getOwnPropertyDescriptor:function(e,n){return e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n)},getPrototypeOf:function(){return Reflect.getPrototypeOf(t)},has:function(e,n){return Reflect.has(t,n)},ownKeys:function(){return Reflect.ownKeys(t)},set:function(e,n,i){return t[n]=i,delete e[n],!0}})}function iE(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0},n=t._scriptable,i=void 0===n?e.scriptable:n,r=t._indexable,a=void 0===r?e.indexable:r,o=t._allKeys,s=void 0===o?e.allKeys:o;return{allKeys:s,scriptable:i,indexable:a,isScriptable:lM(i)?i:function(){return i},isIndexable:lM(a)?a:function(){return a}}}var rE=function(t,e){return t?t+sM(e):e},aE=function(t,e){return qk(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object)};function oE(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];var i=n();return t[e]=i,i}function sE(t,e,n){return lM(t)?t(e,n):t}var uE=function(t,e){return!0===t?e:"string"===typeof t?oM(e,t):void 0};function lE(t,e,n,i){var r,a=wt(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=uE(n,o);if(s){t.add(s);var u=sE(s._fallback,n,s);if(uM(u)&&u!==n&&u!==i)return u}else if(!1===s&&uM(i)&&n!==i)return null}}catch(Tx){a.e(Tx)}finally{a.f()}return!1}function cE(t,e,n,i){var r=e._rootScopes,a=sE(e._fallback,n,i),o=[].concat(vt(t),vt(r)),s=new Set;s.add(i);var u=hE(s,o,n,a||n);return null!==u&&((!uM(a)||a===n||null!==(u=hE(s,o,a,u)))&&eE(Array.from(s),[""],r,a,(function(){return function(t,e,n){var i=t._getTarget();e in i||(i[e]={});var r=i[e];if(Hk(r)&&qk(n))return n;return r}(e,n,i)})))}function hE(t,e,n,i){for(;n;)n=lE(t,e,n,i);return n}function pE(t,e,n,i){var r,a,o=wt(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(r=fE(rE(s,t),n),uM(r))return aE(t,r)?cE(n,i,t,r):r}}catch(Tx){o.e(Tx)}finally{o.f()}}function fE(t,e){var n,i=wt(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r){var a=r[t];if(uM(a))return a}}}catch(Tx){i.e(Tx)}finally{i.f()}}function dE(t){var e=t._keys;return e||(e=t._keys=function(t){var e,n=new Set,i=wt(t);try{for(i.s();!(e=i.n()).done;){var r,a=e.value,o=wt(Object.keys(a).filter((function(t){return!t.startsWith("_")})));try{for(o.s();!(r=o.n()).done;){var s=r.value;n.add(s)}}catch(Tx){o.e(Tx)}finally{o.f()}}}catch(Tx){i.e(Tx)}finally{i.f()}return Array.from(n)}(t._scopes)),e}var vE=Number.EPSILON||1e-14,mE=function(t,e){return e<t.length&&!t[e].skip&&t[e]},gE=function(t){return"x"===t?"y":"x"};function yE(t,e,n,i){var r=t.skip?e:t,a=e,o=n.skip?e:n,s=CM(a,r),u=CM(o,a),l=s/(s+u),c=u/(s+u),h=i*(l=isNaN(l)?0:l),p=i*(c=isNaN(c)?0:c);return{previous:{x:a.x-h*(o.x-r.x),y:a.y-h*(o.y-r.y)},next:{x:a.x+p*(o.x-r.x),y:a.y+p*(o.y-r.y)}}}function _E(t,e,n){for(var i,r,a,o,s,u=t.length,l=mE(t,0),c=0;c<u-1;++c)s=l,l=mE(t,c+1),s&&l&&(SM(e[c],0,vE)?n[c]=n[c+1]=0:(i=n[c]/e[c],r=n[c+1]/e[c],(o=Math.pow(i,2)+Math.pow(r,2))<=9||(a=3/Math.sqrt(o),n[c]=i*a*e[c],n[c+1]=r*a*e[c])))}function bE(t,e){for(var n,i,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x",o=gE(a),s=t.length,u=mE(t,0),l=0;l<s;++l)if(i=r,r=u,u=mE(t,l+1),r){var c=r[a],h=r[o];i&&(n=(c-i[a])/3,r["cp1".concat(a)]=c-n,r["cp1".concat(o)]=h-n*e[l]),u&&(n=(u[a]-c)/3,r["cp2".concat(a)]=c+n,r["cp2".concat(o)]=h+n*e[l])}}function xE(t,e,n){return Math.max(Math.min(t,n),e)}function wE(t,e,n,i,r){var a,o,s,u;if(e.spanGaps&&(t=t.filter((function(t){return!t.skip}))),"monotone"===e.cubicInterpolationMode)!function(t){var e,n,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x",a=gE(r),o=t.length,s=Array(o).fill(0),u=Array(o),l=mE(t,0);for(e=0;e<o;++e)if(n=i,i=l,l=mE(t,e+1),i){if(l){var c=l[r]-i[r];s[e]=0!==c?(l[a]-i[a])/c:0}u[e]=n?l?bM(s[e-1])!==bM(s[e])?0:(s[e-1]+s[e])/2:s[e-1]:s[e]}_E(t,s,u),bE(t,u,r)}(t,r);else{var l=i?t[t.length-1]:t[0];for(a=0,o=t.length;a<o;++a)u=yE(l,s=t[a],t[Math.min(a+1,o-(i?0:1))%o],e.tension),s.cp1x=u.previous.x,s.cp1y=u.previous.y,s.cp2x=u.next.x,s.cp2y=u.next.y,l=s}e.capBezierPoints&&function(t,e){var n,i,r,a,o,s=PT(t[0],e);for(n=0,i=t.length;n<i;++n)o=a,a=s,s=n<i-1&&PT(t[n+1],e),a&&(r=t[n],o&&(r.cp1x=xE(r.cp1x,e.left,e.right),r.cp1y=xE(r.cp1y,e.top,e.bottom)),s&&(r.cp2x=xE(r.cp2x,e.left,e.right),r.cp2y=xE(r.cp2y,e.top,e.bottom)))}(t,n)}function SE(){return"undefined"!==typeof window&&"undefined"!==typeof document}function kE(t){var e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function ME(t,e,n){var i;return"string"===typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[n])):i=t,i}var TE=function(t){return window.getComputedStyle(t,null)};var EE=["top","right","bottom","left"];function CE(t,e,n){var i={};n=n?"-"+n:"";for(var r=0;r<4;r++){var a=EE[r];i[a]=parseFloat(t[e+"-"+a+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function IE(t,e){var n=e.canvas,i=e.currentDevicePixelRatio,r=TE(n),a="border-box"===r.boxSizing,o=CE(r,"padding"),s=CE(r,"border","width"),u=function(t,e){var n,i,r=t.native||t,a=r.touches,o=a&&a.length?a[0]:r,s=o.offsetX,u=o.offsetY,l=!1;if(function(t,e,n){return(t>0||e>0)&&(!n||!n.shadowRoot)}(s,u,r.target))n=s,i=u;else{var c=e.getBoundingClientRect();n=o.clientX-c.left,i=o.clientY-c.top,l=!0}return{x:n,y:i,box:l}}(t,n),l=u.x,c=u.y,h=u.box,p=o.left+(h&&s.left),f=o.top+(h&&s.top),d=e.width,v=e.height;return a&&(d-=o.width+s.width,v-=o.height+s.height),{x:Math.round((l-p)/d*n.width/i),y:Math.round((c-f)/v*n.height/i)}}var PE=function(t){return Math.round(10*t)/10};function AE(t,e,n,i){var r=TE(t),a=CE(r,"margin"),o=ME(r.maxWidth,t,"clientWidth")||dM,s=ME(r.maxHeight,t,"clientHeight")||dM,u=function(t,e,n){var i,r;if(void 0===e||void 0===n){var a=kE(t);if(a){var o=a.getBoundingClientRect(),s=TE(a),u=CE(s,"border","width"),l=CE(s,"padding");e=o.width-l.width-u.width,n=o.height-l.height-u.height,i=ME(s.maxWidth,a,"clientWidth"),r=ME(s.maxHeight,a,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:i||dM,maxHeight:r||dM}}(t,e,n),l=u.width,c=u.height;if("content-box"===r.boxSizing){var h=CE(r,"border","width"),p=CE(r,"padding");l-=p.width+h.width,c-=p.height+h.height}return l=Math.max(0,l-a.width),c=Math.max(0,i?Math.floor(l/i):c-a.height),l=PE(Math.min(l,o,u.maxWidth)),c=PE(Math.min(c,s,u.maxHeight)),l&&!c&&(c=PE(l/2)),{width:l,height:c}}function LE(t,e,n){var i=e||1,r=Math.floor(t.height*i),a=Math.floor(t.width*i);t.height=r/i,t.width=a/i;var o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height="".concat(t.height,"px"),o.style.width="".concat(t.width,"px")),(t.currentDevicePixelRatio!==i||o.height!==r||o.width!==a)&&(t.currentDevicePixelRatio=i,o.height=r,o.width=a,t.ctx.setTransform(i,0,0,i,0,0),!0)}var RE=function(){var t=!1;try{var e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(n){}return t}();function DE(t,e){var n=function(t,e){return TE(t).getPropertyValue(e)}(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function zE(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function OE(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:"middle"===i?n<.5?t.y:e.y:"after"===i?n<1?t.y:e.y:n>0?e.y:t.y}}function FE(t,e,n,i){var r={x:t.cp2x,y:t.cp2y},a={x:e.cp1x,y:e.cp1y},o=zE(t,r,n),s=zE(r,a,n),u=zE(a,e,n),l=zE(o,s,n),c=zE(s,u,n);return zE(l,c,n)}var NE=new Map;function BE(t,e,n){return function(t,e){e=e||{};var n=t+JSON.stringify(e),i=NE.get(n);return i||(i=new Intl.NumberFormat(t,e),NE.set(n,i)),i}(e,n).format(t)}function jE(t,e,n){return t?function(t,e){return{x:function(n){return t+t+e-n},setWidth:function(t){e=t},textAlign:function(t){return"center"===t?t:"right"===t?"left":"right"},xPlus:function(t,e){return t-e},leftForLtr:function(t,e){return t-e}}}(e,n):{x:function(t){return t},setWidth:function(t){},textAlign:function(t){return t},xPlus:function(t,e){return t+e},leftForLtr:function(t,e){return t}}}function VE(t,e){var n,i;"ltr"!==e&&"rtl"!==e||(i=[(n=t.canvas.style).getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=i)}function UE(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function $E(t){return"angle"===t?{between:AM,compare:IM,normalize:PM}:{between:RM,compare:function(t,e){return t-e},normalize:function(t){return t}}}function HE(t){var e=t.start,n=t.end,i=t.count;return{start:e%i,end:n%i,loop:t.loop&&(n-e+1)%i===0,style:t.style}}function qE(t,e,n){if(!n)return[t];for(var i,r,a,o=n.property,s=n.start,u=n.end,l=e.length,c=$E(o),h=c.compare,p=c.between,f=c.normalize,d=function(t,e,n){var i,r,a=n.property,o=n.start,s=n.end,u=$E(a),l=u.between,c=u.normalize,h=e.length,p=t.start,f=t.end,d=t.loop;if(d){for(p+=h,f+=h,i=0,r=h;i<r&&l(c(e[p%h][a]),o,s);++i)p--,f--;p%=h,f%=h}return f<p&&(f+=h),{start:p,end:f,loop:d,style:t.style}}(t,e,n),v=d.start,m=d.end,g=d.loop,y=d.style,_=[],b=!1,x=null,w=function(){return b||p(s,a,i)&&0!==h(s,a)},S=function(){return!b||0===h(u,i)||p(u,a,i)},k=v,M=v;k<=m;++k)(r=e[k%l]).skip||(i=f(r[o]))!==a&&(b=p(i,s,u),null===x&&w()&&(x=0===h(i,s)?k:M),null!==x&&S()&&(_.push(HE({start:x,end:k,loop:g,count:l,style:y})),x=null),M=k,a=i);return null!==x&&_.push(HE({start:x,end:m,loop:g,count:l,style:y})),_}function WE(t,e){for(var n=[],i=t.segments,r=0;r<i.length;r++){var a=qE(i[r],t.points,e);a.length&&n.push.apply(n,vt(a))}return n}function GE(t,e,n,i){return i&&i.setContext&&n?function(t,e,n,i){var r=t._chart.getContext(),a=ZE(t.options),o=t._datasetIndex,s=t.options.spanGaps,u=n.length,l=[],c=a,h=e[0].start,p=h;function f(t,e,i,r){var a=s?-1:1;if(t!==e){for(t+=u;n[t%u].skip;)t-=a;for(;n[e%u].skip;)e+=a;t%u!==e%u&&(l.push({start:t%u,end:e%u,loop:i,style:r}),c=r,h=e%u)}}var d,v=wt(e);try{for(v.s();!(d=v.n()).done;){var m=d.value;h=s?h:m.start;var g=n[h%u],y=void 0;for(p=h+1;p<=m.end;p++){var _=n[p%u];XE(y=ZE(i.setContext(ZT(r,{type:"segment",p0:g,p1:_,p0DataIndex:(p-1)%u,p1DataIndex:p%u,datasetIndex:o}))),c)&&f(h,p-1,m.loop,c),g=_,c=y}h<p-1&&f(h,p-1,m.loop,c)}}catch(Tx){v.e(Tx)}finally{v.f()}return l}(t,e,n,i):e}function ZE(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function XE(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}var YE=function(){function t(){Tt(this,t),this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}return Ct(t,[{key:"_notify",value:function(t,e,n,i){var r=e.listeners[i],a=e.duration;r.forEach((function(i){return i({chart:t,initial:e.initial,numSteps:a,currentStep:Math.min(n-e.start,a)})}))}},{key:"_refresh",value:function(){var t=this;this._request||(this._running=!0,this._request=Fk.call(window,(function(){t._update(),t._request=null,t._running&&t._refresh()})))}},{key:"_update",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),n=0;this._charts.forEach((function(i,r){if(i.running&&i.items.length){for(var a,o=i.items,s=o.length-1,u=!1;s>=0;--s)(a=o[s])._active?(a._total>i.duration&&(i.duration=a._total),a.tick(e),u=!0):(o[s]=o[o.length-1],o.pop());u&&(r.draw(),t._notify(r,i,e,"progress")),o.length||(i.running=!1,t._notify(r,i,e,"complete"),i.initial=!1),n+=o.length}})),this._lastDate=e,0===n&&(this._running=!1)}},{key:"_getAnims",value:function(t){var e=this._charts,n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}},{key:"listen",value:function(t,e,n){this._getAnims(t).listeners[e].push(n)}},{key:"add",value:function(t,e){var n;e&&e.length&&(n=this._getAnims(t).items).push.apply(n,vt(e))}},{key:"has",value:function(t){return this._getAnims(t).items.length>0}},{key:"start",value:function(t){var e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((function(t,e){return Math.max(t,e._duration)}),0),this._refresh())}},{key:"running",value:function(t){if(!this._running)return!1;var e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}},{key:"stop",value:function(t){var e=this._charts.get(t);if(e&&e.items.length){for(var n=e.items,i=n.length-1;i>=0;--i)n[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}}},{key:"remove",value:function(t){return this._charts.delete(t)}}]),t}(),KE=new YE,JE="transparent",QE={boolean:function(t,e,n){return n>.5?e:t},color:function(t,e,n){var i=gT(t||JE),r=i.valid&&gT(e||JE);return r&&r.valid?r.mix(i,n).hexString():e},number:function(t,e,n){return t+(e-t)*n}},tC=function(){function t(e,n,i,r){Tt(this,t);var a=n[i];r=GT([e.to,r,a,e.from]);var o=GT([e.from,a,r]);this._active=!0,this._fn=e.fn||QE[e.type||typeof o],this._easing=FM[e.easing]||FM.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=i,this._from=o,this._to=r,this._promises=void 0}return Ct(t,[{key:"active",value:function(){return this._active}},{key:"update",value:function(t,e,n){if(this._active){this._notify(!1);var i=this._target[this._prop],r=n-this._start,a=this._duration-r;this._start=n,this._duration=Math.floor(Math.max(a,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=GT([t.to,e,i,t.from]),this._from=GT([t.from,i,e])}}},{key:"cancel",value:function(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}},{key:"tick",value:function(t){var e,n=t-this._start,i=this._duration,r=this._prop,a=this._from,o=this._loop,s=this._to;if(this._active=a!==s&&(o||n<i),!this._active)return this._target[r]=s,void this._notify(!0);n<0?this._target[r]=a:(e=n/i%2,e=o&&e>1?2-e:e,e=this._easing(Math.min(1,Math.max(0,e))),this._target[r]=this._fn(a,s,e))}},{key:"wait",value:function(){var t=this._promises||(this._promises=[]);return new Promise((function(e,n){t.push({res:e,rej:n})}))}},{key:"_notify",value:function(t){for(var e=t?"res":"rej",n=this._promises||[],i=0;i<n.length;i++)n[i][e]()}}]),t}();kT.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});var eC=Object.keys(kT.animation);kT.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:function(t){return"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}}),kT.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),kT.describe("animations",{_fallback:"animation"}),kT.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:function(t){return 0|t}}}}});var nC=function(){function t(e,n){Tt(this,t),this._chart=e,this._properties=new Map,this.configure(n)}return Ct(t,[{key:"configure",value:function(t){if(qk(t)){var e=this._properties;Object.getOwnPropertyNames(t).forEach((function(n){var i=t[n];if(qk(i)){var r,a={},o=wt(eC);try{for(o.s();!(r=o.n()).done;){var s=r.value;a[s]=i[s]}}catch(Tx){o.e(Tx)}finally{o.f()}(Hk(i.properties)&&i.properties||[n]).forEach((function(t){t!==n&&e.has(t)||e.set(t,a)}))}}))}}},{key:"_animateOptions",value:function(t,e){var n=e.options,i=function(t,e){if(!e)return;var n=t.options;if(!n)return void(t.options=e);n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(t,n);if(!i)return[];var r=this._createAnimations(i,n);return n.$shared&&function(t,e){for(var n=[],i=Object.keys(e),r=0;r<i.length;r++){var a=t[i[r]];a&&a.active()&&n.push(a.wait())}return Promise.all(n)}(t.options.$animations,n).then((function(){t.options=n}),(function(){})),r}},{key:"_createAnimations",value:function(t,e){var n,i=this._properties,r=[],a=t.$animations||(t.$animations={}),o=Object.keys(e),s=Date.now();for(n=o.length-1;n>=0;--n){var u=o[n];if("$"!==u.charAt(0))if("options"!==u){var l=e[u],c=a[u],h=i.get(u);if(c){if(h&&c.active()){c.update(h,l,s);continue}c.cancel()}h&&h.duration?(a[u]=c=new tC(h,t,u,l),r.push(c)):t[u]=l}else r.push.apply(r,vt(this._animateOptions(t,e)))}return r}},{key:"update",value:function(t,e){if(0!==this._properties.size){var n=this._createAnimations(t,e);return n.length?(KE.add(this._chart,n),!0):void 0}Object.assign(t,e)}}]),t}();function iC(t,e){var n=t&&t.options||{},i=n.reverse,r=void 0===n.min?e:0,a=void 0===n.max?e:0;return{start:i?a:r,end:i?r:a}}function rC(t,e){var n,i,r=[],a=t._getSortedDatasetMetas(e);for(n=0,i=a.length;n<i;++n)r.push(a[n].index);return r}function aC(t,e,n){var i,r,a,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=t.keys,l="single"===s.mode;if(null!==e){for(i=0,r=u.length;i<r;++i){if((a=+u[i])===n){if(s.all)continue;break}o=t.values[a],Wk(o)&&(l||0===e||bM(e)===bM(o))&&(e+=o)}return e}}function oC(t,e){var n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function sC(t,e,n){var i=t[e]||(t[e]={});return i[n]||(i[n]={})}function uC(t,e,n,i){var r,a=wt(e.getMatchingVisibleMetas(i).reverse());try{for(a.s();!(r=a.n()).done;){var o=r.value,s=t[o.index];if(n&&s>0||!n&&s<0)return o.index}}catch(Tx){a.e(Tx)}finally{a.f()}return null}function lC(t,e){for(var n,i=t.chart,r=t._cachedMeta,a=i._stacks||(i._stacks={}),o=r.iScale,s=r.vScale,u=r.index,l=o.axis,c=s.axis,h=function(t,e,n){return"".concat(t.id,".").concat(e.id,".").concat(n.stack||n.type)}(o,s,r),p=e.length,f=0;f<p;++f){var d=e[f],v=d[l],m=d[c];(n=(d._stacks||(d._stacks={}))[c]=sC(a,h,v))[u]=m,n._top=uC(n,s,!0,r.type),n._bottom=uC(n,s,!1,r.type)}}function cC(t,e){var n=t.scales;return Object.keys(n).filter((function(t){return n[t].axis===e})).shift()}function hC(t,e){var n=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){var r,a=wt(e=e||t._parsed);try{for(a.s();!(r=a.n()).done;){var o=r.value._stacks;if(!o||void 0===o[i]||void 0===o[i][n])return;delete o[i][n]}}catch(Tx){a.e(Tx)}finally{a.f()}}}var pC=function(t){return"reset"===t||"none"===t},fC=function(t,e){return e?t:Object.assign({},t)},dC=function(){function t(e,n){Tt(this,t),this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.$context=void 0,this._syncList=[],this.initialize()}return Ct(t,[{key:"initialize",value:function(){var t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=oC(t.vScale,t),this.addElements()}},{key:"updateIndex",value:function(t){this.index!==t&&hC(this._cachedMeta),this.index=t}},{key:"linkScales",value:function(){var t=this.chart,e=this._cachedMeta,n=this.getDataset(),i=function(t,e,n,i){return"x"===t?e:"r"===t?i:n},r=e.xAxisID=Zk(n.xAxisID,cC(t,"x")),a=e.yAxisID=Zk(n.yAxisID,cC(t,"y")),o=e.rAxisID=Zk(n.rAxisID,cC(t,"r")),s=e.indexAxis,u=e.iAxisID=i(s,r,a,o),l=e.vAxisID=i(s,a,r,o);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(a),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(u),e.vScale=this.getScaleForId(l)}},{key:"getDataset",value:function(){return this.chart.data.datasets[this.index]}},{key:"getMeta",value:function(){return this.chart.getDatasetMeta(this.index)}},{key:"getScaleForId",value:function(t){return this.chart.scales[t]}},{key:"_getOtherScale",value:function(t){var e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}},{key:"reset",value:function(){this._update("reset")}},{key:"_destroy",value:function(){var t=this._cachedMeta;this._data&&QT(this._data,this),t._stacked&&hC(t)}},{key:"_dataCheck",value:function(){var t,e,n=this.getDataset(),i=n.data||(n.data=[]),r=this._data;if(qk(i))this._data=function(t){var e,n,i,r=Object.keys(t),a=new Array(r.length);for(e=0,n=r.length;e<n;++e)i=r[e],a[e]={x:i,y:t[i]};return a}(i);else if(r!==i){if(r){QT(r,this);var a=this._cachedMeta;hC(a),a._parsed=[]}i&&Object.isExtensible(i)&&(e=this,(t=i)._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),JT.forEach((function(e){var n="_onData"+sM(e),i=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var o=i.apply(this,r);return t._chartjs.listeners.forEach((function(t){"function"===typeof t[n]&&t[n].apply(t,r)})),o}})})))),this._syncList=[],this._data=i}}},{key:"addElements",value:function(){var t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}},{key:"buildOrUpdateElements",value:function(t){var e=this._cachedMeta,n=this.getDataset(),i=!1;this._dataCheck();var r=e._stacked;e._stacked=oC(e.vScale,e),e.stack!==n.stack&&(i=!0,hC(e),e.stack=n.stack),this._resyncElements(t),(i||r!==e._stacked)&&lC(this,e._parsed)}},{key:"configure",value:function(){var t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}},{key:"parse",value:function(t,e){var n,i,r,a=this._cachedMeta,o=this._data,s=a.iScale,u=a._stacked,l=s.axis,c=0===t&&e===o.length||a._sorted,h=t>0&&a._parsed[t-1];if(!1===this._parsing)a._parsed=o,a._sorted=!0,r=o;else{r=Hk(o[t])?this.parseArrayData(a,o,t,e):qk(o[t])?this.parseObjectData(a,o,t,e):this.parsePrimitiveData(a,o,t,e);for(n=0;n<e;++n)a._parsed[n+t]=i=r[n],c&&((null===i[l]||h&&i[l]<h[l])&&(c=!1),h=i);a._sorted=c}u&&lC(this,r)}},{key:"parsePrimitiveData",value:function(t,e,n,i){var r,a,o,s=t.iScale,u=t.vScale,l=s.axis,c=u.axis,h=s.getLabels(),p=s===u,f=new Array(i);for(r=0,a=i;r<a;++r){var d;o=r+n,f[r]=(St(d={},l,p||s.parse(h[o],o)),St(d,c,u.parse(e[o],o)),d)}return f}},{key:"parseArrayData",value:function(t,e,n,i){var r,a,o,s,u=t.xScale,l=t.yScale,c=new Array(i);for(r=0,a=i;r<a;++r)s=e[o=r+n],c[r]={x:u.parse(s[0],o),y:l.parse(s[1],o)};return c}},{key:"parseObjectData",value:function(t,e,n,i){var r,a,o,s,u=t.xScale,l=t.yScale,c=this._parsing,h=c.xAxisKey,p=void 0===h?"x":h,f=c.yAxisKey,d=void 0===f?"y":f,v=new Array(i);for(r=0,a=i;r<a;++r)s=e[o=r+n],v[r]={x:u.parse(oM(s,p),o),y:l.parse(oM(s,d),o)};return v}},{key:"getParsed",value:function(t){return this._cachedMeta._parsed[t]}},{key:"getDataElement",value:function(t){return this._cachedMeta.data[t]}},{key:"applyStack",value:function(t,e,n){var i=this.chart,r=this._cachedMeta,a=e[t.axis];return aC({keys:rC(i,!0),values:e._stacks[t.axis]},a,r.index,{mode:n})}},{key:"updateRangeFromParsed",value:function(t,e,n,i){var r=n[e.axis],a=null===r?NaN:r,o=i&&n._stacks[e.axis];i&&o&&(i.values=o,a=aC(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,a),t.max=Math.max(t.max,a)}},{key:"getMinMax",value:function(t,e){var n,i,r=this._cachedMeta,a=r._parsed,o=r._sorted&&t===r.iScale,s=a.length,u=this._getOtherScale(t),l=function(t,e,n){return t&&!e.hidden&&e._stacked&&{keys:rC(n,!0),values:null}}(e,r,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},h=function(t){var e=t.getUserBounds(),n=e.min,i=e.max,r=e.minDefined,a=e.maxDefined;return{min:r?n:Number.NEGATIVE_INFINITY,max:a?i:Number.POSITIVE_INFINITY}}(u),p=h.min,f=h.max;function d(){var e=(i=a[n])[u.axis];return!Wk(i[t.axis])||p>e||f<e}for(n=0;n<s&&(d()||(this.updateRangeFromParsed(c,t,i,l),!o));++n);if(o)for(n=s-1;n>=0;--n)if(!d()){this.updateRangeFromParsed(c,t,i,l);break}return c}},{key:"getAllParsedValues",value:function(t){var e,n,i,r=this._cachedMeta._parsed,a=[];for(e=0,n=r.length;e<n;++e)i=r[e][t.axis],Wk(i)&&a.push(i);return a}},{key:"getMaxOverflow",value:function(){return!1}},{key:"getLabelAndValue",value:function(t){var e=this._cachedMeta,n=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:n?""+n.getLabelForValue(r[n.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}},{key:"_update",value:function(t){var e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){var e,n,i,r;return qk(t)?(e=t.top,n=t.right,i=t.bottom,r=t.left):e=n=i=r=t,{top:e,right:n,bottom:i,left:r,disabled:!1===t}}(Zk(this.options.clip,function(t,e,n){if(!1===n)return!1;var i=iC(t,n),r=iC(e,n);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}},{key:"update",value:function(t){}},{key:"draw",value:function(){var t,e=this._ctx,n=this.chart,i=this._cachedMeta,r=i.data||[],a=n.chartArea,o=[],s=this._drawStart||0,u=this._drawCount||r.length-s;for(i.dataset&&i.dataset.draw(e,a,s,u),t=s;t<s+u;++t){var l=r[t];l.hidden||(l.active?o.push(l):l.draw(e,a))}for(t=0;t<o.length;++t)o[t].draw(e,a)}},{key:"getStyle",value:function(t,e){var n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}},{key:"getContext",value:function(t,e,n){var i,r=this.getDataset();if(t>=0&&t<this._cachedMeta.data.length){var a=this._cachedMeta.data[t];i=a.$context||(a.$context=function(t,e,n){return ZT(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,a)),i.parsed=this.getParsed(t),i.raw=r.data[t],i.index=i.dataIndex=t}else i=this.$context||(this.$context=function(t,e){return ZT(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),i.dataset=r,i.index=i.datasetIndex=this.index;return i.active=!!e,i.mode=n,i}},{key:"resolveDatasetElementOptions",value:function(t){return this._resolveElementOptions(this.datasetElementType.id,t)}},{key:"resolveDataElementOptions",value:function(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}},{key:"_resolveElementOptions",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",i=arguments.length>2?arguments[2]:void 0,r="active"===n,a=this._cachedDataOpts,o=t+"-"+n,s=a[o],u=this.enableOptionSharing&&uM(i);if(s)return fC(s,u);var l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),h=r?["".concat(t,"Hover"),"hover",t,""]:[t,""],p=l.getOptionScopes(this.getDataset(),c),f=Object.keys(kT.elements[t]),d=function(){return e.getContext(i,r)},v=l.resolveNamedOptions(p,f,d,h);return v.$shared&&(v.$shared=u,a[o]=Object.freeze(fC(v,u))),v}},{key:"_resolveAnimations",value:function(t,e,n){var i,r=this.chart,a=this._cachedDataOpts,o="animation-".concat(e),s=a[o];if(s)return s;if(!1!==r.options.animation){var u=this.chart.config,l=u.datasetAnimationScopeKeys(this._type,e),c=u.getOptionScopes(this.getDataset(),l);i=u.createResolver(c,this.getContext(t,n,e))}var h=new nC(r,i&&i.animations);return i&&i._cacheable&&(a[o]=Object.freeze(h)),h}},{key:"getSharedOptions",value:function(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}},{key:"includeOptions",value:function(t,e){return!e||pC(t)||this.chart._animationsDisabled}},{key:"updateElement",value:function(t,e,n,i){pC(i)?Object.assign(t,n):this._resolveAnimations(e,i).update(t,n)}},{key:"updateSharedOptions",value:function(t,e,n){t&&!pC(e)&&this._resolveAnimations(void 0,e).update(t,n)}},{key:"_setStyle",value:function(t,e,n,i){t.active=i;var r=this.getStyle(e,i);this._resolveAnimations(e,n,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}},{key:"removeHoverStyle",value:function(t,e,n){this._setStyle(t,n,"active",!1)}},{key:"setHoverStyle",value:function(t,e,n){this._setStyle(t,n,"active",!0)}},{key:"_removeDatasetHoverStyle",value:function(){var t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}},{key:"_setDatasetHoverStyle",value:function(){var t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}},{key:"_resyncElements",value:function(t){var e,n=this._data,i=this._cachedMeta.data,r=wt(this._syncList);try{for(r.s();!(e=r.n()).done;){var a=rt(e.value,3),o=a[0],s=a[1],u=a[2];this[o](s,u)}}catch(Tx){r.e(Tx)}finally{r.f()}this._syncList=[];var l=i.length,c=n.length,h=Math.min(c,l);h&&this.parse(0,h),c>l?this._insertElements(l,c-l,t):c<l&&this._removeElements(c,l-c)}},{key:"_insertElements",value:function(t,e){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this._cachedMeta,a=r.data,o=t+e,s=function(t){for(t.length+=e,n=t.length-1;n>=o;n--)t[n]=t[n-e]};for(s(a),n=t;n<o;++n)a[n]=new this.dataElementType;this._parsing&&s(r._parsed),this.parse(t,e),i&&this.updateElements(a,t,e,"reset")}},{key:"updateElements",value:function(t,e,n,i){}},{key:"_removeElements",value:function(t,e){var n=this._cachedMeta;if(this._parsing){var i=n._parsed.splice(t,e);n._stacked&&hC(n,i)}n.data.splice(t,e)}},{key:"_sync",value:function(t){if(this._parsing)this._syncList.push(t);else{var e=rt(t,3),n=e[0],i=e[1],r=e[2];this[n](i,r)}this.chart._dataChanges.push([this.index].concat(vt(t)))}},{key:"_onDataPush",value:function(){var t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}},{key:"_onDataPop",value:function(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}},{key:"_onDataShift",value:function(){this._sync(["_removeElements",0,1])}},{key:"_onDataSplice",value:function(t,e){e&&this._sync(["_removeElements",t,e]);var n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}},{key:"_onDataUnshift",value:function(){this._sync(["_insertElements",0,arguments.length])}}]),t}();function vC(t){var e,n,i,r,a=t.iScale,o=function(t,e){if(!t._cache.$bar){for(var n=t.getMatchingVisibleMetas(e),i=[],r=0,a=n.length;r<a;r++)i=i.concat(n[r].controller.getAllParsedValues(t));t._cache.$bar=tE(i.sort((function(t,e){return t-e})))}return t._cache.$bar}(a,t.type),s=a._length,u=function(){32767!==i&&-32768!==i&&(uM(r)&&(s=Math.min(s,Math.abs(i-r)||s)),r=i)};for(e=0,n=o.length;e<n;++e)i=a.getPixelForValue(o[e]),u();for(r=void 0,e=0,n=a.ticks.length;e<n;++e)i=a.getPixelForTick(e),u();return s}function mC(t,e,n,i){return Hk(t)?function(t,e,n,i){var r=n.parse(t[0],i),a=n.parse(t[1],i),o=Math.min(r,a),s=Math.max(r,a),u=o,l=s;Math.abs(o)>Math.abs(s)&&(u=s,l=o),e[n.axis]=l,e._custom={barStart:u,barEnd:l,start:r,end:a,min:o,max:s}}(t,e,n,i):e[n.axis]=n.parse(t,i),e}function gC(t,e,n,i){var r,a,o,s,u=t.iScale,l=t.vScale,c=u.getLabels(),h=u===l,p=[];for(r=n,a=n+i;r<a;++r)s=e[r],(o={})[u.axis]=h||u.parse(c[r],r),p.push(mC(s,o,l,r));return p}function yC(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function _C(t,e,n,i){var r=e.borderSkipped,a={};if(r){var o=function(t){var e,n,i,r,a;return t.horizontal?(e=t.base>t.x,n="left",i="right"):(e=t.base<t.y,n="bottom",i="top"),e?(r="end",a="start"):(r="start",a="end"),{start:n,end:i,reverse:e,top:r,bottom:a}}(t),s=o.start,u=o.end,l=o.reverse,c=o.top,h=o.bottom;"middle"===r&&n&&(t.enableBorderRadius=!0,(n._top||0)===i?r=c:(n._bottom||0)===i?r=h:(a[bC(h,s,u,l)]=!0,r=c)),a[bC(r,s,u,l)]=!0,t.borderSkipped=a}else t.borderSkipped=a}function bC(t,e,n,i){var r,a,o;return i?(o=n,t=xC(t=(r=t)===(a=e)?o:r===o?a:r,n,e)):t=xC(t,e,n),t}function xC(t,e,n){return"start"===t?e:"end"===t?n:t}function wC(t,e,n){var i=e.inflateAmount;t.inflateAmount="auto"===i?1===n?.33:0:i}dC.defaults={},dC.prototype.datasetElementType=null,dC.prototype.dataElementType=null;var SC=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"parsePrimitiveData",value:function(t,e,n,i){return gC(t,e,n,i)}},{key:"parseArrayData",value:function(t,e,n,i){return gC(t,e,n,i)}},{key:"parseObjectData",value:function(t,e,n,i){var r,a,o,s,u=t.iScale,l=t.vScale,c=this._parsing,h=c.xAxisKey,p=void 0===h?"x":h,f=c.yAxisKey,d=void 0===f?"y":f,v="x"===u.axis?p:d,m="x"===l.axis?p:d,g=[];for(r=n,a=n+i;r<a;++r)s=e[r],(o={})[u.axis]=u.parse(oM(s,v),r),g.push(mC(oM(s,m),o,l,r));return g}},{key:"updateRangeFromParsed",value:function(t,e,i,r){xt(mt(n.prototype),"updateRangeFromParsed",this).call(this,t,e,i,r);var a=i._custom;a&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,a.min),t.max=Math.max(t.max,a.max))}},{key:"getMaxOverflow",value:function(){return 0}},{key:"getLabelAndValue",value:function(t){var e=this._cachedMeta,n=e.iScale,i=e.vScale,r=this.getParsed(t),a=r._custom,o=yC(a)?"["+a.start+", "+a.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+n.getLabelForValue(r[n.axis]),value:o}}},{key:"initialize",value:function(){this.enableOptionSharing=!0,xt(mt(n.prototype),"initialize",this).call(this),this._cachedMeta.stack=this.getDataset().stack}},{key:"update",value:function(t){var e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}},{key:"updateElements",value:function(t,e,n,i){var r="reset"===i,a=this.index,o=this._cachedMeta.vScale,s=o.getBasePixel(),u=o.isHorizontal(),l=this._getRuler(),c=this.resolveDataElementOptions(e,i),h=this.getSharedOptions(c),p=this.includeOptions(i,h);this.updateSharedOptions(h,i,c);for(var f=e;f<e+n;f++){var d=this.getParsed(f),v=r||$k(d[o.axis])?{base:s,head:s}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,l),g=(d._stacks||{})[o.axis],y={horizontal:u,base:v.base,enableBorderRadius:!g||yC(d._custom)||a===g._top||a===g._bottom,x:u?v.head:m.center,y:u?m.center:v.head,height:u?m.size:Math.abs(v.size),width:u?Math.abs(v.size):m.size};p&&(y.options=h||this.resolveDataElementOptions(f,t[f].active?"active":i));var _=y.options||t[f].options;_C(y,_,g,a),wC(y,_,l.ratio),this.updateElement(t[f],f,y,i)}}},{key:"_getStacks",value:function(t,e){var n,i,r=this._cachedMeta.iScale,a=r.getMatchingVisibleMetas(this._type),o=r.options.stacked,s=a.length,u=[];for(n=0;n<s;++n)if((i=a[n]).controller.options.grouped){if("undefined"!==typeof e){var l=i.controller.getParsed(e)[i.controller._cachedMeta.vScale.axis];if($k(l)||isNaN(l))continue}if((!1===o||-1===u.indexOf(i.stack)||void 0===o&&void 0===i.stack)&&u.push(i.stack),i.index===t)break}return u.length||u.push(void 0),u}},{key:"_getStackCount",value:function(t){return this._getStacks(void 0,t).length}},{key:"_getStackIndex",value:function(t,e,n){var i=this._getStacks(t,n),r=void 0!==e?i.indexOf(e):-1;return-1===r?i.length-1:r}},{key:"_getRuler",value:function(){var t,e,n=this.options,i=this._cachedMeta,r=i.iScale,a=[];for(t=0,e=i.data.length;t<e;++t)a.push(r.getPixelForValue(this.getParsed(t)[r.axis],t));var o=n.barThickness;return{min:o||vC(i),pixels:a,start:r._startPixel,end:r._endPixel,stackCount:this._getStackCount(),scale:r,grouped:n.grouped,ratio:o?1:n.categoryPercentage*n.barPercentage}}},{key:"_calculateBarValuePixels",value:function(t){var e,n,i=this._cachedMeta,r=i.vScale,a=i._stacked,o=this.options,s=o.base,u=o.minBarLength,l=s||0,c=this.getParsed(t),h=c._custom,p=yC(h),f=c[r.axis],d=0,v=a?this.applyStack(r,c,a):f;v!==f&&(d=v-f,v=f),p&&(f=h.barStart,v=h.barEnd-h.barStart,0!==f&&bM(f)!==bM(h.barEnd)&&(d=0),d+=f);var m=$k(s)||p?d:s,g=r.getPixelForValue(m);if(n=(e=this.chart.getDataVisibility(t)?r.getPixelForValue(d+v):g)-g,Math.abs(n)<u&&(n=function(t,e,n){return 0!==t?bM(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(n,r,l)*u,f===l&&(g-=n/2),e=g+n),g===r.getPixelForValue(l)){var y=bM(n)*r.getLineWidthForValue(l)/2;g+=y,n-=y}return{size:n,base:g,head:e,center:e+n/2}}},{key:"_calculateBarIndexPixels",value:function(t,e){var n,i,r=e.scale,a=this.options,o=a.skipNull,s=Zk(a.maxBarThickness,1/0);if(e.grouped){var u=o?this._getStackCount(t):e.stackCount,l="flex"===a.barThickness?function(t,e,n,i){var r=e.pixels,a=r[t],o=t>0?r[t-1]:null,s=t<r.length-1?r[t+1]:null,u=n.categoryPercentage;null===o&&(o=a-(null===s?e.end-e.start:s-a)),null===s&&(s=a+a-o);var l=a-(a-Math.min(o,s))/2*u;return{chunk:Math.abs(s-o)/2*u/i,ratio:n.barPercentage,start:l}}(t,e,a,u):function(t,e,n,i){var r,a,o=n.barThickness;return $k(o)?(r=e.min*n.categoryPercentage,a=n.barPercentage):(r=o*i,a=1),{chunk:r/i,ratio:a,start:e.pixels[t]-r/2}}(t,e,a,u),c=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0);n=l.start+l.chunk*c+l.chunk/2,i=Math.min(s,l.chunk*l.ratio)}else n=r.getPixelForValue(this.getParsed(t)[r.axis],t),i=Math.min(s,e.min*e.ratio);return{base:n-i/2,head:n+i/2,center:n,size:i}}},{key:"draw",value:function(){for(var t=this._cachedMeta,e=t.vScale,n=t.data,i=n.length,r=0;r<i;++r)null!==this.getParsed(r)[e.axis]&&n[r].draw(this._ctx)}}]),n}(dC);SC.id="bar",SC.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},SC.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};var kC=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"initialize",value:function(){this.enableOptionSharing=!0,xt(mt(n.prototype),"initialize",this).call(this)}},{key:"parsePrimitiveData",value:function(t,e,i,r){for(var a=xt(mt(n.prototype),"parsePrimitiveData",this).call(this,t,e,i,r),o=0;o<a.length;o++)a[o]._custom=this.resolveDataElementOptions(o+i).radius;return a}},{key:"parseArrayData",value:function(t,e,i,r){for(var a=xt(mt(n.prototype),"parseArrayData",this).call(this,t,e,i,r),o=0;o<a.length;o++){var s=e[i+o];a[o]._custom=Zk(s[2],this.resolveDataElementOptions(o+i).radius)}return a}},{key:"parseObjectData",value:function(t,e,i,r){for(var a=xt(mt(n.prototype),"parseObjectData",this).call(this,t,e,i,r),o=0;o<a.length;o++){var s=e[i+o];a[o]._custom=Zk(s&&s.r&&+s.r,this.resolveDataElementOptions(o+i).radius)}return a}},{key:"getMaxOverflow",value:function(){for(var t=this._cachedMeta.data,e=0,n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}},{key:"getLabelAndValue",value:function(t){var e=this._cachedMeta,n=e.xScale,i=e.yScale,r=this.getParsed(t),a=n.getLabelForValue(r.x),o=i.getLabelForValue(r.y),s=r._custom;return{label:e.label,value:"("+a+", "+o+(s?", "+s:"")+")"}}},{key:"update",value:function(t){var e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}},{key:"updateElements",value:function(t,e,n,i){for(var r="reset"===i,a=this._cachedMeta,o=a.iScale,s=a.vScale,u=this.resolveDataElementOptions(e,i),l=this.getSharedOptions(u),c=this.includeOptions(i,l),h=o.axis,p=s.axis,f=e;f<e+n;f++){var d=t[f],v=!r&&this.getParsed(f),m={},g=m[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(v[h]),y=m[p]=r?s.getBasePixel():s.getPixelForValue(v[p]);m.skip=isNaN(g)||isNaN(y),c&&(m.options=this.resolveDataElementOptions(f,d.active?"active":i),r&&(m.options.radius=0)),this.updateElement(d,f,m,i)}this.updateSharedOptions(l,i,u)}},{key:"resolveDataElementOptions",value:function(t,e){var i=this.getParsed(t),r=xt(mt(n.prototype),"resolveDataElementOptions",this).call(this,t,e);r.$shared&&(r=Object.assign({},r,{$shared:!1}));var a=r.radius;return"active"!==e&&(r.radius=0),r.radius+=Zk(i&&i._custom,a),r}}]),n}(dC);kC.id="bubble",kC.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},kC.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:function(){return""}}}}};var MC=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;return Tt(this,n),(r=e.call(this,t,i)).enableOptionSharing=!0,r.innerRadius=void 0,r.outerRadius=void 0,r.offsetX=void 0,r.offsetY=void 0,r}return Ct(n,[{key:"linkScales",value:function(){}},{key:"parse",value:function(t,e){var n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{var r,a,o=function(t){return+n[t]};if(qk(n[t])){var s=this._parsing.key,u=void 0===s?"value":s;o=function(t){return+oM(n[t],u)}}for(r=t,a=t+e;r<a;++r)i._parsed[r]=o(r)}}},{key:"_getRotation",value:function(){return MM(this.options.rotation-90)}},{key:"_getCircumference",value:function(){return MM(this.options.circumference)}},{key:"_getRotationExtents",value:function(){for(var t=pM,e=-pM,n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)){var i=this.chart.getDatasetMeta(n).controller,r=i._getRotation(),a=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+a)}return{rotation:t,circumference:e-t}}},{key:"update",value:function(t){var e,n,i=this.chart.chartArea,r=this._cachedMeta,a=r.data,o=this.getMaxBorderWidth()+this.getMaxOffset(a)+this.options.spacing,s=Math.max((Math.min(i.width,i.height)-o)/2,0),u=Math.min((e=this.options.cutout,n=s,"string"===typeof e&&e.endsWith("%")?parseFloat(e)/100:e/n),1),l=this._getRingWeight(this.index),c=this._getRotationExtents(),h=c.circumference,p=function(t,e,n){var i=1,r=1,a=0,o=0;if(e<pM){var s=t,u=s+e,l=Math.cos(s),c=Math.sin(s),h=Math.cos(u),p=Math.sin(u),f=function(t,e,i){return AM(t,s,u,!0)?1:Math.max(e,e*n,i,i*n)},d=function(t,e,i){return AM(t,s,u,!0)?-1:Math.min(e,e*n,i,i*n)},v=f(0,l,h),m=f(mM,c,p),g=d(hM,l,h),y=d(hM+mM,c,p);i=(v-g)/2,r=(m-y)/2,a=-(v+g)/2,o=-(m+y)/2}return{ratioX:i,ratioY:r,offsetX:a,offsetY:o}}(c.rotation,h,u),f=p.ratioX,d=p.ratioY,v=p.offsetX,m=p.offsetY,g=(i.width-o)/f,y=(i.height-o)/d,_=Math.max(Math.min(g,y)/2,0),b=Xk(this.options.radius,_),x=(b-Math.max(b*u,0))/this._getVisibleDatasetWeightTotal();this.offsetX=v*b,this.offsetY=m*b,r.total=this.calculateTotal(),this.outerRadius=b-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*l,0),this.updateElements(a,0,a.length,t)}},{key:"_circumference",value:function(t,e){var n=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===i._parsed[t]||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/pM)}},{key:"updateElements",value:function(t,e,n,i){var r,a="reset"===i,o=this.chart,s=o.chartArea,u=o.options.animation,l=(s.left+s.right)/2,c=(s.top+s.bottom)/2,h=a&&u.animateScale,p=h?0:this.innerRadius,f=h?0:this.outerRadius,d=this.resolveDataElementOptions(e,i),v=this.getSharedOptions(d),m=this.includeOptions(i,v),g=this._getRotation();for(r=0;r<e;++r)g+=this._circumference(r,a);for(r=e;r<e+n;++r){var y=this._circumference(r,a),_=t[r],b={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+y,circumference:y,outerRadius:f,innerRadius:p};m&&(b.options=v||this.resolveDataElementOptions(r,_.active?"active":i)),g+=y,this.updateElement(_,r,b,i)}this.updateSharedOptions(v,i,d)}},{key:"calculateTotal",value:function(){var t,e=this._cachedMeta,n=e.data,i=0;for(t=0;t<n.length;t++){var r=e._parsed[t];null===r||isNaN(r)||!this.chart.getDataVisibility(t)||n[t].hidden||(i+=Math.abs(r))}return i}},{key:"calculateCircumference",value:function(t){var e=this._cachedMeta.total;return e>0&&!isNaN(t)?pM*(Math.abs(t)/e):0}},{key:"getLabelAndValue",value:function(t){var e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=BE(e._parsed[t],n.options.locale);return{label:i[t]||"",value:r}}},{key:"getMaxBorderWidth",value:function(t){var e,n,i,r,a,o=0,s=this.chart;if(!t)for(e=0,n=s.data.datasets.length;e<n;++e)if(s.isDatasetVisible(e)){t=(i=s.getDatasetMeta(e)).data,r=i.controller;break}if(!t)return 0;for(e=0,n=t.length;e<n;++e)"inner"!==(a=r.resolveDataElementOptions(e)).borderAlign&&(o=Math.max(o,a.borderWidth||0,a.hoverBorderWidth||0));return o}},{key:"getMaxOffset",value:function(t){for(var e=0,n=0,i=t.length;n<i;++n){var r=this.resolveDataElementOptions(n);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}},{key:"_getRingWeightOffset",value:function(t){for(var e=0,n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}},{key:"_getRingWeight",value:function(t){return Math.max(Zk(this.chart.data.datasets[t].weight,1),0)}},{key:"_getVisibleDatasetWeightTotal",value:function(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}]),n}(dC);MC.id="doughnut",MC.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},MC.descriptors={_scriptable:function(t){return"spacing"!==t},_indexable:function(t){return"spacing"!==t}},MC.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels:function(t){var e=t.data;if(e.labels.length&&e.datasets.length){var n=t.legend.options.labels.pointStyle;return e.labels.map((function(e,i){var r=t.getDatasetMeta(0).controller.getStyle(i);return{text:e,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,lineWidth:r.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}}))}return[]}},onClick:function(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:function(){return""},label:function(t){var e=t.label,n=": "+t.formattedValue;return Hk(e)?(e=e.slice())[0]+=n:e+=n,e}}}}};var TC=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"initialize",value:function(){this.enableOptionSharing=!0,xt(mt(n.prototype),"initialize",this).call(this)}},{key:"update",value:function(t){var e=this._cachedMeta,n=e.dataset,i=e.data,r=void 0===i?[]:i,a=e._dataset,o=this.chart._animationsDisabled,s=function(t,e,n){var i=e.length,r=0,a=i;if(t._sorted){var o=t.iScale,s=t._parsed,u=o.axis,l=o.getUserBounds(),c=l.min,h=l.max,p=l.minDefined,f=l.maxDefined;p&&(r=LM(Math.min(YT(s,o.axis,c).lo,n?i:YT(e,u,o.getPixelForValue(c)).lo),0,i-1)),a=f?LM(Math.max(YT(s,o.axis,h).hi+1,n?0:YT(e,u,o.getPixelForValue(h)).hi+1),r,i)-r:i-r}return{start:r,count:a}}(e,r,o),u=s.start,l=s.count;this._drawStart=u,this._drawCount=l,function(t){var e=t.xScale,n=t.yScale,i=t._scaleRanges,r={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!i)return t._scaleRanges=r,!0;var a=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,r),a}(e)&&(u=0,l=r.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!a._decimated,n.points=r;var c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(n,void 0,{animated:!o,options:c},t),this.updateElements(r,u,l,t)}},{key:"updateElements",value:function(t,e,n,i){for(var r="reset"===i,a=this._cachedMeta,o=a.iScale,s=a.vScale,u=a._stacked,l=a._dataset,c=this.resolveDataElementOptions(e,i),h=this.getSharedOptions(c),p=this.includeOptions(i,h),f=o.axis,d=s.axis,v=this.options,m=v.spanGaps,g=v.segment,y=wM(m)?m:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||r||"none"===i,b=e>0&&this.getParsed(e-1),x=e;x<e+n;++x){var w=t[x],S=this.getParsed(x),k=_?w:{},M=$k(S[d]),T=k[f]=o.getPixelForValue(S[f],x),E=k[d]=r||M?s.getBasePixel():s.getPixelForValue(u?this.applyStack(s,S,u):S[d],x);k.skip=isNaN(T)||isNaN(E)||M,k.stop=x>0&&S[f]-b[f]>y,g&&(k.parsed=S,k.raw=l.data[x]),p&&(k.options=h||this.resolveDataElementOptions(x,w.active?"active":i)),_||this.updateElement(w,x,k,i),b=S}this.updateSharedOptions(h,i,c)}},{key:"getMaxOverflow",value:function(){var t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return n;var r=i[0].size(this.resolveDataElementOptions(0)),a=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,r,a)/2}},{key:"draw",value:function(){var t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),xt(mt(n.prototype),"draw",this).call(this)}}]),n}(dC);TC.id="line",TC.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},TC.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};var EC=function(t){kt(n,t);var e=Mt(n);function n(t,i){var r;return Tt(this,n),(r=e.call(this,t,i)).innerRadius=void 0,r.outerRadius=void 0,r}return Ct(n,[{key:"getLabelAndValue",value:function(t){var e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=BE(e._parsed[t].r,n.options.locale);return{label:i[t]||"",value:r}}},{key:"update",value:function(t){var e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}},{key:"_updateRadius",value:function(){var t=this.chart,e=t.chartArea,n=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),a=(r-Math.max(n.cutoutPercentage?r/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}},{key:"updateElements",value:function(t,e,n,i){var r,a="reset"===i,o=this.chart,s=this.getDataset(),u=o.options.animation,l=this._cachedMeta.rScale,c=l.xCenter,h=l.yCenter,p=l.getIndexAngle(0)-.5*hM,f=p,d=360/this.countVisibleElements();for(r=0;r<e;++r)f+=this._computeAngle(r,i,d);for(r=e;r<e+n;r++){var v=t[r],m=f,g=f+this._computeAngle(r,i,d),y=o.getDataVisibility(r)?l.getDistanceFromCenterForValue(s.data[r]):0;f=g,a&&(u.animateScale&&(y=0),u.animateRotate&&(m=g=p));var _={x:c,y:h,innerRadius:0,outerRadius:y,startAngle:m,endAngle:g,options:this.resolveDataElementOptions(r,v.active?"active":i)};this.updateElement(v,r,_,i)}}},{key:"countVisibleElements",value:function(){var t=this,e=this.getDataset(),n=this._cachedMeta,i=0;return n.data.forEach((function(n,r){!isNaN(e.data[r])&&t.chart.getDataVisibility(r)&&i++})),i}},{key:"_computeAngle",value:function(t,e,n){return this.chart.getDataVisibility(t)?MM(this.resolveDataElementOptions(t,e).angle||n):0}}]),n}(dC);EC.id="polarArea",EC.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},EC.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels:function(t){var e=t.data;if(e.labels.length&&e.datasets.length){var n=t.legend.options.labels.pointStyle;return e.labels.map((function(e,i){var r=t.getDatasetMeta(0).controller.getStyle(i);return{text:e,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,lineWidth:r.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}}))}return[]}},onClick:function(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:function(){return""},label:function(t){return t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};var CC=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n)}(MC);CC.id="pie",CC.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};var IC=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"getLabelAndValue",value:function(t){var e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}},{key:"update",value:function(t){var e=this._cachedMeta,n=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(n.points=i,"resize"!==t){var a=this.resolveDatasetElementOptions(t);this.options.showLine||(a.borderWidth=0);var o={_loop:!0,_fullLoop:r.length===i.length,options:a};this.updateElement(n,void 0,o,t)}this.updateElements(i,0,i.length,t)}},{key:"updateElements",value:function(t,e,n,i){for(var r=this.getDataset(),a=this._cachedMeta.rScale,o="reset"===i,s=e;s<e+n;s++){var u=t[s],l=this.resolveDataElementOptions(s,u.active?"active":i),c=a.getPointPositionForValue(s,r.data[s]),h=o?a.xCenter:c.x,p=o?a.yCenter:c.y,f={x:h,y:p,angle:c.angle,skip:isNaN(h)||isNaN(p),options:l};this.updateElement(u,s,f,i)}}}]),n}(dC);IC.id="radar",IC.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},IC.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};var PC=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n)}(TC);PC.id="scatter",PC.defaults={showLine:!1,fill:!1},PC.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:function(){return""},label:function(t){return"("+t.label+", "+t.formattedValue+")"}}}},scales:{x:{type:"linear"},y:{type:"linear"}}};function AC(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var LC=function(){function t(e){Tt(this,t),this.options=e||{}}return Ct(t,[{key:"formats",value:function(){return AC()}},{key:"parse",value:function(t,e){return AC()}},{key:"format",value:function(t,e){return AC()}},{key:"add",value:function(t,e,n){return AC()}},{key:"diff",value:function(t,e,n){return AC()}},{key:"startOf",value:function(t,e,n){return AC()}},{key:"endOf",value:function(t,e){return AC()}}]),t}();LC.override=function(t){Object.assign(LC.prototype,t)};var RC={_date:LC};function DC(t,e){return"native"in t?{x:t.x,y:t.y}:IE(t,e)}function zC(t,e,n,i){var r=t.controller,a=t.data,o=t._sorted,s=r._cachedMeta.iScale;if(s&&e===s.axis&&o&&a.length){var u=s._reversePixels?KT:YT;if(!i)return u(a,e,n);if(r._sharedOptions){var l=a[0],c="function"===typeof l.getRange&&l.getRange(e);if(c){var h=u(a,e,n-c),p=u(a,e,n+c);return{lo:h.lo,hi:p.hi}}}}return{lo:0,hi:a.length-1}}function OC(t,e,n,i,r){for(var a=t.getSortedVisibleDatasetMetas(),o=n[e],s=0,u=a.length;s<u;++s)for(var l=a[s],c=l.index,h=l.data,p=zC(a[s],e,o,r),f=p.lo,d=p.hi,v=f;v<=d;++v){var m=h[v];m.skip||i(m,c,v)}}function FC(t,e,n,i){var r=[];if(!PT(e,t.chartArea,t._minPadding))return r;return OC(t,n,e,(function(t,n,a){t.inRange(e.x,e.y,i)&&r.push({element:t,datasetIndex:n,index:a})}),!0),r}function NC(t,e,n,i,r){var a=function(t){var e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,i){var r=e?Math.abs(t.x-i.x):0,a=n?Math.abs(t.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(a,2))}}(n),o=Number.POSITIVE_INFINITY,s=[];if(!PT(e,t.chartArea,t._minPadding))return s;return OC(t,n,e,(function(n,u,l){if(!i||n.inRange(e.x,e.y,r)){var c=n.getCenterPoint(r);if(PT(c,t.chartArea,t._minPadding)||n.inRange(e.x,e.y,r)){var h=a(e,c);h<o?(s=[{element:n,datasetIndex:u,index:l}],o=h):h===o&&s.push({element:n,datasetIndex:u,index:l})}}})),s}function BC(t,e,n,i){var r=DC(e,t),a=[],o=n.axis,s="x"===o?"inXRange":"inYRange",u=!1;return function(t,e){for(var n,i,r,a=t.getSortedVisibleDatasetMetas(),o=0,s=a.length;o<s;++o){var u=a[o];n=u.index;for(var l=0,c=(i=u.data).length;l<c;++l)(r=i[l]).skip||e(r,n,l)}}(t,(function(t,e,n){t[s](r[o],i)&&a.push({element:t,datasetIndex:e,index:n}),t.inRange(r.x,r.y,i)&&(u=!0)})),n.intersect&&!u?[]:a}var jC={modes:{index:function(t,e,n,i){var r=DC(e,t),a=n.axis||"x",o=n.intersect?FC(t,r,a,i):NC(t,r,a,!1,i),s=[];return o.length?(t.getSortedVisibleDatasetMetas().forEach((function(t){var e=o[0].index,n=t.data[e];n&&!n.skip&&s.push({element:n,datasetIndex:t.index,index:e})})),s):[]},dataset:function(t,e,n,i){var r=DC(e,t),a=n.axis||"xy",o=n.intersect?FC(t,r,a,i):NC(t,r,a,!1,i);if(o.length>0){var s=o[0].datasetIndex,u=t.getDatasetMeta(s).data;o=[];for(var l=0;l<u.length;++l)o.push({element:u[l],datasetIndex:s,index:l})}return o},point:function(t,e,n,i){return FC(t,DC(e,t),n.axis||"xy",i)},nearest:function(t,e,n,i){return NC(t,DC(e,t),n.axis||"xy",n.intersect,i)},x:function(t,e,n,i){return BC(t,e,{axis:"x",intersect:n.intersect},i)},y:function(t,e,n,i){return BC(t,e,{axis:"y",intersect:n.intersect},i)}}},VC=["left","top","right","bottom"];function UC(t,e){return t.filter((function(t){return t.pos===e}))}function $C(t,e){return t.filter((function(t){return-1===VC.indexOf(t.pos)&&t.box.axis===e}))}function HC(t,e){return t.sort((function(t,n){var i=e?n:t,r=e?t:n;return i.weight===r.weight?i.index-r.index:i.weight-r.weight}))}function qC(t,e){var n,i,r,a=function(t){var e,n={},i=wt(t);try{for(i.s();!(e=i.n()).done;){var r=e.value,a=r.stack,o=r.pos,s=r.stackWeight;if(a&&VC.includes(o)){var u=n[a]||(n[a]={count:0,placed:0,weight:0,size:0});u.count++,u.weight+=s}}}catch(Tx){i.e(Tx)}finally{i.f()}return n}(t),o=e.vBoxMaxWidth,s=e.hBoxMaxHeight;for(n=0,i=t.length;n<i;++n){var u=(r=t[n]).box.fullSize,l=a[r.stack],c=l&&r.stackWeight/l.weight;r.horizontal?(r.width=c?c*o:u&&e.availableWidth,r.height=s):(r.width=o,r.height=c?c*s:u&&e.availableHeight)}return a}function WC(t,e,n,i){return Math.max(t[n],e[n])+Math.max(t[i],e[i])}function GC(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function ZC(t,e,n,i){var r=n.pos,a=n.box,o=t.maxPadding;if(!qk(r)){n.size&&(t[r]-=n.size);var s=i[n.stack]||{size:0,count:1};s.size=Math.max(s.size,n.horizontal?a.height:a.width),n.size=s.size/s.count,t[r]+=n.size}a.getPadding&&GC(o,a.getPadding());var u=Math.max(0,e.outerWidth-WC(o,t,"left","right")),l=Math.max(0,e.outerHeight-WC(o,t,"top","bottom")),c=u!==t.w,h=l!==t.h;return t.w=u,t.h=l,n.horizontal?{same:c,other:h}:{same:h,other:c}}function XC(t,e){var n=e.maxPadding;function i(t){var i={left:0,top:0,right:0,bottom:0};return t.forEach((function(t){i[t]=Math.max(e[t],n[t])})),i}return i(t?["left","right"]:["top","bottom"])}function YC(t,e,n,i){var r,a,o,s,u,l,c=[];for(r=0,a=t.length,u=0;r<a;++r){(s=(o=t[r]).box).update(o.width||e.w,o.height||e.h,XC(o.horizontal,e));var h=ZC(e,n,o,i),p=h.same,f=h.other;u|=p&&c.length,l=l||f,s.fullSize||c.push(o)}return u&&YC(c,e,n,i)||l}function KC(t,e,n,i,r){t.top=n,t.left=e,t.right=e+i,t.bottom=n+r,t.width=i,t.height=r}function JC(t,e,n,i){var r,a=n.padding,o=e.x,s=e.y,u=wt(t);try{for(u.s();!(r=u.n()).done;){var l=r.value,c=l.box,h=i[l.stack]||{count:1,placed:0,weight:1},p=l.stackWeight/h.weight||1;if(l.horizontal){var f=e.w*p,d=h.size||c.height;uM(h.start)&&(s=h.start),c.fullSize?KC(c,a.left,s,n.outerWidth-a.right-a.left,d):KC(c,e.left+h.placed,s,f,d),h.start=s,h.placed+=f,s=c.bottom}else{var v=e.h*p,m=h.size||c.width;uM(h.start)&&(o=h.start),c.fullSize?KC(c,o,a.top,m,n.outerHeight-a.bottom-a.top):KC(c,o,e.top+h.placed,m,v),h.start=o,h.placed+=v,o=c.right}}}catch(Tx){u.e(Tx)}finally{u.f()}e.x=o,e.y=s}kT.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var QC=function(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw:function(t){e.draw(t)}}]},t.boxes.push(e)},tI=function(t,e){var n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},eI=function(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},nI=function(t,e,n,i){if(t){var r=qT(t.options.layout.padding),a=Math.max(e-r.width,0),o=Math.max(n-r.height,0),s=function(t){var e=function(t){var e,n,i,r,a,o,s=[];for(e=0,n=(t||[]).length;e<n;++e){var u=i=t[e];r=u.position;var l=u.options;a=l.stack;var c=l.stackWeight;o=void 0===c?1:c,s.push({index:e,box:i,pos:r,horizontal:i.isHorizontal(),weight:i.weight,stack:a&&r+a,stackWeight:o})}return s}(t),n=HC(e.filter((function(t){return t.box.fullSize})),!0),i=HC(UC(e,"left"),!0),r=HC(UC(e,"right")),a=HC(UC(e,"top"),!0),o=HC(UC(e,"bottom")),s=$C(e,"x"),u=$C(e,"y");return{fullSize:n,leftAndTop:i.concat(a),rightAndBottom:r.concat(u).concat(o).concat(s),chartArea:UC(e,"chartArea"),vertical:i.concat(r).concat(u),horizontal:a.concat(o).concat(s)}}(t.boxes),u=s.vertical,l=s.horizontal;Kk(t.boxes,(function(t){"function"===typeof t.beforeLayout&&t.beforeLayout()}));var c=u.reduce((function(t,e){return e.box.options&&!1===e.box.options.display?t:t+1}),0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:r,availableWidth:a,availableHeight:o,vBoxMaxWidth:a/2/c,hBoxMaxHeight:o/2}),p=Object.assign({},r);GC(p,qT(i));var f=Object.assign({maxPadding:p,w:a,h:o,x:r.left,y:r.top},r),d=qC(u.concat(l),h);YC(s.fullSize,f,h,d),YC(u,f,h,d),YC(l,f,h,d)&&YC(u,f,h,d),function(t){var e=t.maxPadding;function n(n){var i=Math.max(e[n]-t[n],0);return t[n]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(f),JC(s.leftAndTop,f,h,d),f.x+=f.w,f.y+=f.h,JC(s.rightAndBottom,f,h,d),t.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Kk(s.chartArea,(function(e){var n=e.box;Object.assign(n,t.chartArea),n.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})}))}},iI=function(){function t(){Tt(this,t)}return Ct(t,[{key:"acquireContext",value:function(t,e){}},{key:"releaseContext",value:function(t){return!1}},{key:"addEventListener",value:function(t,e,n){}},{key:"removeEventListener",value:function(t,e,n){}},{key:"getDevicePixelRatio",value:function(){return 1}},{key:"getMaximumSize",value:function(t,e,n,i){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):n)}}},{key:"isAttached",value:function(t){return!0}},{key:"updateConfig",value:function(t){}}]),t}(),rI=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"acquireContext",value:function(t){return t&&t.getContext&&t.getContext("2d")||null}},{key:"updateConfig",value:function(t){t.options.animation=!1}}]),n}(iI),aI={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},oI=function(t){return null===t||""===t};var sI=!!RE&&{passive:!0};function uI(t,e,n){t.canvas.removeEventListener(e,n,sI)}function lI(t,e){var n,i=wt(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r===e||r.contains(e))return!0}}catch(Tx){i.e(Tx)}finally{i.f()}}function cI(t,e,n){var i=t.canvas,r=new MutationObserver((function(t){var e,r=!1,a=wt(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;r=(r=r||lI(o.addedNodes,i))&&!lI(o.removedNodes,i)}}catch(Tx){a.e(Tx)}finally{a.f()}r&&n()}));return r.observe(document,{childList:!0,subtree:!0}),r}function hI(t,e,n){var i=t.canvas,r=new MutationObserver((function(t){var e,r=!1,a=wt(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;r=(r=r||lI(o.removedNodes,i))&&!lI(o.addedNodes,i)}}catch(Tx){a.e(Tx)}finally{a.f()}r&&n()}));return r.observe(document,{childList:!0,subtree:!0}),r}var pI=new Map,fI=0;function dI(){var t=window.devicePixelRatio;t!==fI&&(fI=t,pI.forEach((function(e,n){n.currentDevicePixelRatio!==t&&e()})))}function vI(t,e,n){var i=t.canvas,r=i&&kE(i);if(r){var a=Nk((function(t,e){var i=r.clientWidth;n(t,e),i<r.clientWidth&&n()}),window),o=new ResizeObserver((function(t){var e=t[0],n=e.contentRect.width,i=e.contentRect.height;0===n&&0===i||a(n,i)}));return o.observe(r),function(t,e){pI.size||window.addEventListener("resize",dI),pI.set(t,e)}(t,a),o}}function mI(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){pI.delete(t),pI.size||window.removeEventListener("resize",dI)}(t)}function gI(t,e,n){var i=t.canvas,r=Nk((function(e){null!==t.ctx&&n(function(t,e){var n=aI[t.type]||t.type,i=IE(t,e),r=i.x,a=i.y;return{type:n,chart:e,native:t,x:void 0!==r?r:null,y:void 0!==a?a:null}}(e,t))}),t,(function(t){var e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,n){t.addEventListener(e,n,sI)}(i,e,r),r}var yI=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"acquireContext",value:function(t,e){var n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){var n=t.style,i=t.getAttribute("height"),r=t.getAttribute("width");if(t.$chartjs={initial:{height:i,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",oI(r)){var a=DE(t,"width");void 0!==a&&(t.width=a)}if(oI(i))if(""===t.style.height)t.height=t.width/(e||2);else{var o=DE(t,"height");void 0!==o&&(t.height=o)}}(t,e),n):null}},{key:"releaseContext",value:function(t){var e=t.canvas;if(!e.$chartjs)return!1;var n=e.$chartjs.initial;["height","width"].forEach((function(t){var i=n[t];$k(i)?e.removeAttribute(t):e.setAttribute(t,i)}));var i=n.style||{};return Object.keys(i).forEach((function(t){e.style[t]=i[t]})),e.width=e.width,delete e.$chartjs,!0}},{key:"addEventListener",value:function(t,e,n){this.removeEventListener(t,e);var i=t.$proxies||(t.$proxies={}),r={attach:cI,detach:hI,resize:vI}[e]||gI;i[e]=r(t,e,n)}},{key:"removeEventListener",value:function(t,e){var n=t.$proxies||(t.$proxies={}),i=n[e];i&&(({attach:mI,detach:mI,resize:mI}[e]||uI)(t,e,i),n[e]=void 0)}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio}},{key:"getMaximumSize",value:function(t,e,n,i){return AE(t,e,n,i)}},{key:"isAttached",value:function(t){var e=kE(t);return!(!e||!e.isConnected)}}]),n}(iI);var _I=function(){function t(){Tt(this,t),this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}return Ct(t,[{key:"tooltipPosition",value:function(t){var e=this.getProps(["x","y"],t);return{x:e.x,y:e.y}}},{key:"hasValue",value:function(){return wM(this.x)&&wM(this.y)}},{key:"getProps",value:function(t,e){var n=this,i=this.$animations;if(!e||!i)return this;var r={};return t.forEach((function(t){r[t]=i[t]&&i[t].active()?i[t]._to:n[t]})),r}}]),t}();_I.defaults={},_I.defaultRoutes=void 0;var bI={values:function(t){return Hk(t)?t:""+t},numeric:function(t,e,n){if(0===t)return"0";var i,r=this.chart.options.locale,a=t;if(n.length>1){var o=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(o<1e-4||o>1e15)&&(i="scientific"),a=function(t,e){var n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t));return n}(t,n)}var s=_M(Math.abs(a)),u=Math.max(Math.min(-1*Math.floor(s),20),0),l={notation:i,minimumFractionDigits:u,maximumFractionDigits:u};return Object.assign(l,this.options.ticks.format),BE(t,r,l)},logarithmic:function(t,e,n){if(0===t)return"0";var i=t/Math.pow(10,Math.floor(_M(t)));return 1===i||2===i||5===i?bI.numeric.call(this,t,e,n):""}};var xI={formatters:bI};function wI(t,e){var n=t.options.ticks,i=n.maxTicksLimit||function(t){var e=t.options.offset,n=t._tickSize(),i=t._length/n+(e?0:1),r=t._maxLength/n;return Math.floor(Math.min(i,r))}(t),r=n.major.enabled?function(t){var e,n,i=[];for(e=0,n=t.length;e<n;e++)t[e].major&&i.push(e);return i}(e):[],a=r.length,o=r[0],s=r[a-1],u=[];if(a>i)return function(t,e,n,i){var r,a=0,o=n[0];for(i=Math.ceil(i),r=0;r<t.length;r++)r===o&&(e.push(t[r]),o=n[++a*i])}(e,u,r,a/i),u;var l=function(t,e,n){var i=function(t){var e,n,i=t.length;if(i<2)return!1;for(n=t[0],e=1;e<i;++e)if(t[e]-t[e-1]!==n)return!1;return n}(t),r=e.length/n;if(!i)return Math.max(r,1);for(var a=function(t){var e,n=[],i=Math.sqrt(t);for(e=1;e<i;e++)t%e===0&&(n.push(e),n.push(t/e));return i===(0|i)&&n.push(i),n.sort((function(t,e){return t-e})).pop(),n}(i),o=0,s=a.length-1;o<s;o++){var u=a[o];if(u>r)return u}return Math.max(r,1)}(r,e,i);if(a>0){var c,h,p=a>1?Math.round((s-o)/(a-1)):null;for(SI(e,u,l,$k(p)?0:o-p,o),c=0,h=a-1;c<h;c++)SI(e,u,l,r[c],r[c+1]);return SI(e,u,l,s,$k(p)?e.length:s+p),u}return SI(e,u,l),u}function SI(t,e,n,i,r){var a,o,s,u=Zk(i,0),l=Math.min(Zk(r,t.length),t.length),c=0;for(n=Math.ceil(n),r&&(n=(a=r-i)/Math.floor(a/n)),s=u;s<0;)c++,s=Math.round(u+c*n);for(o=Math.max(u,0);o<l;o++)o===s&&(e.push(t[o]),c++,s=Math.round(u+c*n))}kT.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:function(t,e){return e.lineWidth},tickColor:function(t,e){return e.color},offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:xI.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),kT.route("scale.ticks","color","","color"),kT.route("scale.grid","color","","borderColor"),kT.route("scale.grid","borderColor","","borderColor"),kT.route("scale.title","color","","color"),kT.describe("scale",{_fallback:!1,_scriptable:function(t){return!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t},_indexable:function(t){return"borderDash"!==t&&"tickBorderDash"!==t}}),kT.describe("scales",{_fallback:"scale"}),kT.describe("scale.ticks",{_scriptable:function(t){return"backdropPadding"!==t&&"callback"!==t},_indexable:function(t){return"backdropPadding"!==t}});var kI=function(t,e,n){return"top"===e||"left"===e?t[e]+n:t[e]-n};function MI(t,e){for(var n=[],i=t.length/e,r=t.length,a=0;a<r;a+=i)n.push(t[Math.floor(a)]);return n}function TI(t,e,n){var i,r=t.ticks.length,a=Math.min(e,r-1),o=t._startPixel,s=t._endPixel,u=1e-6,l=t.getPixelForTick(a);if(!(n&&(i=1===r?Math.max(l-o,s-l):0===e?(t.getPixelForTick(1)-l)/2:(l-t.getPixelForTick(a-1))/2,(l+=a<e?i:-i)<o-u||l>s+u)))return l}function EI(t){return t.drawTicks?t.tickLength:0}function CI(t,e){if(!t.display)return 0;var n=WT(t.font,e),i=qT(t.padding);return(Hk(t.text)?t.text.length:1)*n.lineHeight+i.height}function II(t,e,n){var i=Bk(t);return(n&&"right"!==e||!n&&"right"===e)&&(i=function(t){return"left"===t?"right":"right"===t?"left":t}(i)),i}var PI=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).id=t.id,i.type=t.type,i.options=void 0,i.ctx=t.ctx,i.chart=t.chart,i.top=void 0,i.bottom=void 0,i.left=void 0,i.right=void 0,i.width=void 0,i.height=void 0,i._margins={left:0,right:0,top:0,bottom:0},i.maxWidth=void 0,i.maxHeight=void 0,i.paddingTop=void 0,i.paddingBottom=void 0,i.paddingLeft=void 0,i.paddingRight=void 0,i.axis=void 0,i.labelRotation=void 0,i.min=void 0,i.max=void 0,i._range=void 0,i.ticks=[],i._gridLineItems=null,i._labelItems=null,i._labelSizes=null,i._length=0,i._maxLength=0,i._longestTextCache={},i._startPixel=void 0,i._endPixel=void 0,i._reversePixels=!1,i._userMax=void 0,i._userMin=void 0,i._suggestedMax=void 0,i._suggestedMin=void 0,i._ticksLength=0,i._borderValue=0,i._cache={},i._dataLimitsCached=!1,i.$context=void 0,i}return Ct(n,[{key:"init",value:function(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}},{key:"parse",value:function(t,e){return t}},{key:"getUserBounds",value:function(){var t=this._userMin,e=this._userMax,n=this._suggestedMin,i=this._suggestedMax;return t=Gk(t,Number.POSITIVE_INFINITY),e=Gk(e,Number.NEGATIVE_INFINITY),n=Gk(n,Number.POSITIVE_INFINITY),i=Gk(i,Number.NEGATIVE_INFINITY),{min:Gk(t,n),max:Gk(e,i),minDefined:Wk(t),maxDefined:Wk(e)}}},{key:"getMinMax",value:function(t){var e,n=this.getUserBounds(),i=n.min,r=n.max,a=n.minDefined,o=n.maxDefined;if(a&&o)return{min:i,max:r};for(var s=this.getMatchingVisibleMetas(),u=0,l=s.length;u<l;++u)e=s[u].controller.getMinMax(this,t),a||(i=Math.min(i,e.min)),o||(r=Math.max(r,e.max));return{min:Gk(i=o&&i>r?r:i,Gk(r=a&&i>r?i:r,i)),max:Gk(r,Gk(i,r))}}},{key:"getPadding",value:function(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}},{key:"getTicks",value:function(){return this.ticks}},{key:"getLabels",value:function(){var t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}},{key:"beforeLayout",value:function(){this._cache={},this._dataLimitsCached=!1}},{key:"beforeUpdate",value:function(){Yk(this.options.beforeUpdate,[this])}},{key:"update",value:function(t,e,n){var i=this.options,r=i.beginAtZero,a=i.grace,o=i.ticks,s=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){var i=t.min,r=t.max,a=Xk(e,(r-i)/2),o=function(t,e){return n&&0===t?0:t+e};return{min:o(i,-Math.abs(a)),max:o(r,a)}}(this,a,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();var u=s<this.ticks.length;this._convertTicksToLabels(u?MI(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=wI(this,this.ticks),this._labelSizes=null),u&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}},{key:"configure",value:function(){var t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}},{key:"afterUpdate",value:function(){Yk(this.options.afterUpdate,[this])}},{key:"beforeSetDimensions",value:function(){Yk(this.options.beforeSetDimensions,[this])}},{key:"setDimensions",value:function(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}},{key:"afterSetDimensions",value:function(){Yk(this.options.afterSetDimensions,[this])}},{key:"_callHooks",value:function(t){this.chart.notifyPlugins(t,this.getContext()),Yk(this.options[t],[this])}},{key:"beforeDataLimits",value:function(){this._callHooks("beforeDataLimits")}},{key:"determineDataLimits",value:function(){}},{key:"afterDataLimits",value:function(){this._callHooks("afterDataLimits")}},{key:"beforeBuildTicks",value:function(){this._callHooks("beforeBuildTicks")}},{key:"buildTicks",value:function(){return[]}},{key:"afterBuildTicks",value:function(){this._callHooks("afterBuildTicks")}},{key:"beforeTickToLabelConversion",value:function(){Yk(this.options.beforeTickToLabelConversion,[this])}},{key:"generateTickLabels",value:function(t){var e,n,i,r=this.options.ticks;for(e=0,n=t.length;e<n;e++)(i=t[e]).label=Yk(r.callback,[i.value,e,t],this)}},{key:"afterTickToLabelConversion",value:function(){Yk(this.options.afterTickToLabelConversion,[this])}},{key:"beforeCalculateLabelRotation",value:function(){Yk(this.options.beforeCalculateLabelRotation,[this])}},{key:"calculateLabelRotation",value:function(){var t,e,n,i=this.options,r=i.ticks,a=this.ticks.length,o=r.minRotation||0,s=r.maxRotation,u=o;if(!this._isVisible()||!r.display||o>=s||a<=1||!this.isHorizontal())this.labelRotation=o;else{var l=this._getLabelSizes(),c=l.widest.width,h=l.highest.height,p=LM(this.chart.width-c,0,this.maxWidth);c+6>(t=i.offset?this.maxWidth/a:p/(a-1))&&(t=p/(a-(i.offset?.5:1)),e=this.maxHeight-EI(i.grid)-r.padding-CI(i.title,this.chart.options.font),n=Math.sqrt(c*c+h*h),u=TM(Math.min(Math.asin(LM((l.highest.height+6)/t,-1,1)),Math.asin(LM(e/n,-1,1))-Math.asin(LM(h/n,-1,1)))),u=Math.max(o,Math.min(s,u))),this.labelRotation=u}}},{key:"afterCalculateLabelRotation",value:function(){Yk(this.options.afterCalculateLabelRotation,[this])}},{key:"beforeFit",value:function(){Yk(this.options.beforeFit,[this])}},{key:"fit",value:function(){var t={width:0,height:0},e=this.chart,n=this.options,i=n.ticks,r=n.title,a=n.grid,o=this._isVisible(),s=this.isHorizontal();if(o){var u=CI(r,e.options.font);if(s?(t.width=this.maxWidth,t.height=EI(a)+u):(t.height=this.maxHeight,t.width=EI(a)+u),i.display&&this.ticks.length){var l=this._getLabelSizes(),c=l.first,h=l.last,p=l.widest,f=l.highest,d=2*i.padding,v=MM(this.labelRotation),m=Math.cos(v),g=Math.sin(v);if(s){var y=i.mirror?0:g*p.width+m*f.height;t.height=Math.min(this.maxHeight,t.height+y+d)}else{var _=i.mirror?0:m*p.width+g*f.height;t.width=Math.min(this.maxWidth,t.width+_+d)}this._calculatePadding(c,h,g,m)}}this._handleMargins(),s?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}},{key:"_calculatePadding",value:function(t,e,n,i){var r=this.options,a=r.ticks,o=a.align,s=a.padding,u=r.position,l=0!==this.labelRotation,c="top"!==u&&"x"===this.axis;if(this.isHorizontal()){var h=this.getPixelForTick(0)-this.left,p=this.right-this.getPixelForTick(this.ticks.length-1),f=0,d=0;l?c?(f=i*t.width,d=n*e.height):(f=n*t.height,d=i*e.width):"start"===o?d=e.width:"end"===o?f=t.width:(f=t.width/2,d=e.width/2),this.paddingLeft=Math.max((f-h+s)*this.width/(this.width-h),0),this.paddingRight=Math.max((d-p+s)*this.width/(this.width-p),0)}else{var v=e.height/2,m=t.height/2;"start"===o?(v=0,m=t.height):"end"===o&&(v=e.height,m=0),this.paddingTop=v+s,this.paddingBottom=m+s}}},{key:"_handleMargins",value:function(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}},{key:"afterFit",value:function(){Yk(this.options.afterFit,[this])}},{key:"isHorizontal",value:function(){var t=this.options,e=t.axis,n=t.position;return"top"===n||"bottom"===n||"x"===e}},{key:"isFullSize",value:function(){return this.options.fullSize}},{key:"_convertTicksToLabels",value:function(t){var e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)$k(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}},{key:"_getLabelSizes",value:function(){var t=this._labelSizes;if(!t){var e=this.options.ticks.sampleSize,n=this.ticks;e<n.length&&(n=MI(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length)}return t}},{key:"_computeLabelSizes",value:function(t,e){var n,i,r,a,o,s,u,l,c,h,p,f=this.ctx,d=this._longestTextCache,v=[],m=[],g=0,y=0;for(n=0;n<e;++n){if(a=t[n].label,o=this._resolveTickFontOptions(n),f.font=s=o.string,u=d[s]=d[s]||{data:{},gc:[]},l=o.lineHeight,c=h=0,$k(a)||Hk(a)){if(Hk(a))for(i=0,r=a.length;i<r;++i)$k(p=a[i])||Hk(p)||(c=MT(f,u.data,u.gc,c,p),h+=l)}else c=MT(f,u.data,u.gc,c,a),h=l;v.push(c),m.push(h),g=Math.max(c,g),y=Math.max(h,y)}!function(t,e){Kk(t,(function(t){var n,i=t.gc,r=i.length/2;if(r>e){for(n=0;n<r;++n)delete t.data[i[n]];i.splice(0,r)}}))}(d,e);var _=v.indexOf(g),b=m.indexOf(y),x=function(t){return{width:v[t]||0,height:m[t]||0}};return{first:x(0),last:x(e-1),widest:x(_),highest:x(b),widths:v,heights:m}}},{key:"getLabelForValue",value:function(t){return t}},{key:"getPixelForValue",value:function(t,e){return NaN}},{key:"getValueForPixel",value:function(t){}},{key:"getPixelForTick",value:function(t){var e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}},{key:"getPixelForDecimal",value:function(t){this._reversePixels&&(t=1-t);var e=this._startPixel+t*this._length;return LM(this._alignToPixels?ET(this.chart,e,0):e,-32768,32767)}},{key:"getDecimalForPixel",value:function(t){var e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}},{key:"getBasePixel",value:function(){return this.getPixelForValue(this.getBaseValue())}},{key:"getBaseValue",value:function(){var t=this.min,e=this.max;return t<0&&e<0?e:t>0&&e>0?t:0}},{key:"getContext",value:function(t){var e=this.ticks||[];if(t>=0&&t<e.length){var n=e[t];return n.$context||(n.$context=function(t,e,n){return ZT(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=ZT(this.chart.getContext(),{scale:this,type:"scale"}))}},{key:"_tickSize",value:function(){var t=this.options.ticks,e=MM(this.labelRotation),n=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),a=t.autoSkipPadding||0,o=r?r.widest.width+a:0,s=r?r.highest.height+a:0;return this.isHorizontal()?s*n>o*i?o/n:s/i:s*i<o*n?s/n:o/i}},{key:"_isVisible",value:function(){var t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}},{key:"_computeGridLineItems",value:function(t){var e,n,i,r,a,o,s,u,l,c,h,p,f=this.axis,d=this.chart,v=this.options,m=v.grid,g=v.position,y=m.offset,_=this.isHorizontal(),b=this.ticks.length+(y?1:0),x=EI(m),w=[],S=m.setContext(this.getContext()),k=S.drawBorder?S.borderWidth:0,M=k/2,T=function(t){return ET(d,t,k)};if("top"===g)e=T(this.bottom),o=this.bottom-x,u=e-M,c=T(t.top)+M,p=t.bottom;else if("bottom"===g)e=T(this.top),c=t.top,p=T(t.bottom)-M,o=e+M,u=this.top+x;else if("left"===g)e=T(this.right),a=this.right-x,s=e-M,l=T(t.left)+M,h=t.right;else if("right"===g)e=T(this.left),l=t.left,h=T(t.right)-M,a=e+M,s=this.left+x;else if("x"===f){if("center"===g)e=T((t.top+t.bottom)/2+.5);else if(qk(g)){var E=Object.keys(g)[0],C=g[E];e=T(this.chart.scales[E].getPixelForValue(C))}c=t.top,p=t.bottom,u=(o=e+M)+x}else if("y"===f){if("center"===g)e=T((t.left+t.right)/2);else if(qk(g)){var I=Object.keys(g)[0],P=g[I];e=T(this.chart.scales[I].getPixelForValue(P))}s=(a=e-M)-x,l=t.left,h=t.right}var A=Zk(v.ticks.maxTicksLimit,b),L=Math.max(1,Math.ceil(b/A));for(n=0;n<b;n+=L){var R=m.setContext(this.getContext(n)),D=R.lineWidth,z=R.color,O=m.borderDash||[],F=R.borderDashOffset,N=R.tickWidth,B=R.tickColor,j=R.tickBorderDash||[],V=R.tickBorderDashOffset;void 0!==(i=TI(this,n,y))&&(r=ET(d,i,D),_?a=s=l=h=r:o=u=c=p=r,w.push({tx1:a,ty1:o,tx2:s,ty2:u,x1:l,y1:c,x2:h,y2:p,width:D,color:z,borderDash:O,borderDashOffset:F,tickWidth:N,tickColor:B,tickBorderDash:j,tickBorderDashOffset:V}))}return this._ticksLength=b,this._borderValue=e,w}},{key:"_computeLabelItems",value:function(t){var e,n,i,r,a,o,s,u,l,c,h,p=this.axis,f=this.options,d=f.position,v=f.ticks,m=this.isHorizontal(),g=this.ticks,y=v.align,_=v.crossAlign,b=v.padding,x=v.mirror,w=EI(f.grid),S=w+b,k=x?-b:S,M=-MM(this.labelRotation),T=[],E="middle";if("top"===d)a=this.bottom-k,o=this._getXAxisLabelAlignment();else if("bottom"===d)a=this.top+k,o=this._getXAxisLabelAlignment();else if("left"===d){var C=this._getYAxisLabelAlignment(w);o=C.textAlign,r=C.x}else if("right"===d){var I=this._getYAxisLabelAlignment(w);o=I.textAlign,r=I.x}else if("x"===p){if("center"===d)a=(t.top+t.bottom)/2+S;else if(qk(d)){var P=Object.keys(d)[0],A=d[P];a=this.chart.scales[P].getPixelForValue(A)+S}o=this._getXAxisLabelAlignment()}else if("y"===p){if("center"===d)r=(t.left+t.right)/2-S;else if(qk(d)){var L=Object.keys(d)[0],R=d[L];r=this.chart.scales[L].getPixelForValue(R)}o=this._getYAxisLabelAlignment(w).textAlign}"y"===p&&("start"===y?E="top":"end"===y&&(E="bottom"));var D=this._getLabelSizes();for(e=0,n=g.length;e<n;++e){i=g[e].label;var z=v.setContext(this.getContext(e));s=this.getPixelForTick(e)+v.labelOffset,l=(u=this._resolveTickFontOptions(e)).lineHeight;var O=(c=Hk(i)?i.length:1)/2,F=z.color,N=z.textStrokeColor,B=z.textStrokeWidth;m?(r=s,h="top"===d?"near"===_||0!==M?-c*l+l/2:"center"===_?-D.highest.height/2-O*l+l:-D.highest.height+l/2:"near"===_||0!==M?l/2:"center"===_?D.highest.height/2-O*l:D.highest.height-c*l,x&&(h*=-1)):(a=s,h=(1-c)*l/2);var j=void 0;if(z.showLabelBackdrop){var V=qT(z.backdropPadding),U=D.heights[e],$=D.widths[e],H=a+h-V.top,q=r-V.left;switch(E){case"middle":H-=U/2;break;case"bottom":H-=U}switch(o){case"center":q-=$/2;break;case"right":q-=$}j={left:q,top:H,width:$+V.width,height:U+V.height,color:z.backdropColor}}T.push({rotation:M,label:i,font:u,color:F,strokeColor:N,strokeWidth:B,textOffset:h,textAlign:o,textBaseline:E,translation:[r,a],backdrop:j})}return T}},{key:"_getXAxisLabelAlignment",value:function(){var t=this.options,e=t.position,n=t.ticks;if(-MM(this.labelRotation))return"top"===e?"left":"right";var i="center";return"start"===n.align?i="left":"end"===n.align&&(i="right"),i}},{key:"_getYAxisLabelAlignment",value:function(t){var e,n,i=this.options,r=i.position,a=i.ticks,o=a.crossAlign,s=a.mirror,u=a.padding,l=t+u,c=this._getLabelSizes().widest.width;return"left"===r?s?(n=this.right+u,"near"===o?e="left":"center"===o?(e="center",n+=c/2):(e="right",n+=c)):(n=this.right-l,"near"===o?e="right":"center"===o?(e="center",n-=c/2):(e="left",n=this.left)):"right"===r?s?(n=this.left+u,"near"===o?e="right":"center"===o?(e="center",n-=c/2):(e="left",n-=c)):(n=this.left+l,"near"===o?e="left":"center"===o?(e="center",n+=c/2):(e="right",n=this.right)):e="right",{textAlign:e,x:n}}},{key:"_computeLabelArea",value:function(){if(!this.options.ticks.mirror){var t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}}},{key:"drawBackground",value:function(){var t=this.ctx,e=this.options.backgroundColor,n=this.left,i=this.top,r=this.width,a=this.height;e&&(t.save(),t.fillStyle=e,t.fillRect(n,i,r,a),t.restore())}},{key:"getLineWidthForValue",value:function(t){var e=this.options.grid;if(!this._isVisible()||!e.display)return 0;var n=this.ticks.findIndex((function(e){return e.value===t}));return n>=0?e.setContext(this.getContext(n)).lineWidth:0}},{key:"drawGrid",value:function(t){var e,n,i=this.options.grid,r=this.ctx,a=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t)),o=function(t,e,n){n.width&&n.color&&(r.save(),r.lineWidth=n.width,r.strokeStyle=n.color,r.setLineDash(n.borderDash||[]),r.lineDashOffset=n.borderDashOffset,r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.stroke(),r.restore())};if(i.display)for(e=0,n=a.length;e<n;++e){var s=a[e];i.drawOnChartArea&&o({x:s.x1,y:s.y1},{x:s.x2,y:s.y2},s),i.drawTicks&&o({x:s.tx1,y:s.ty1},{x:s.tx2,y:s.ty2},{color:s.tickColor,width:s.tickWidth,borderDash:s.tickBorderDash,borderDashOffset:s.tickBorderDashOffset})}}},{key:"drawBorder",value:function(){var t=this.chart,e=this.ctx,n=this.options.grid,i=n.setContext(this.getContext()),r=n.drawBorder?i.borderWidth:0;if(r){var a,o,s,u,l=n.setContext(this.getContext(0)).lineWidth,c=this._borderValue;this.isHorizontal()?(a=ET(t,this.left,r)-r/2,o=ET(t,this.right,l)+l/2,s=u=c):(s=ET(t,this.top,r)-r/2,u=ET(t,this.bottom,l)+l/2,a=o=c),e.save(),e.lineWidth=i.borderWidth,e.strokeStyle=i.borderColor,e.beginPath(),e.moveTo(a,s),e.lineTo(o,u),e.stroke(),e.restore()}}},{key:"drawLabels",value:function(t){if(this.options.ticks.display){var e=this.ctx,n=this._computeLabelArea();n&&AT(e,n);var i,r,a=this._labelItems||(this._labelItems=this._computeLabelItems(t));for(i=0,r=a.length;i<r;++i){var o=a[i],s=o.font,u=o.label;o.backdrop&&(e.fillStyle=o.backdrop.color,e.fillRect(o.backdrop.left,o.backdrop.top,o.backdrop.width,o.backdrop.height)),zT(e,u,0,o.textOffset,s,o)}n&&LT(e)}}},{key:"drawTitle",value:function(){var t=this.ctx,e=this.options,n=e.position,i=e.title,r=e.reverse;if(i.display){var a=WT(i.font),o=qT(i.padding),s=i.align,u=a.lineHeight/2;"bottom"===n||"center"===n||qk(n)?(u+=o.bottom,Hk(i.text)&&(u+=a.lineHeight*(i.text.length-1))):u+=o.top;var l=function(t,e,n,i){var r,a,o,s=t.top,u=t.left,l=t.bottom,c=t.right,h=t.chart,p=h.chartArea,f=h.scales,d=0,v=l-s,m=c-u;if(t.isHorizontal()){if(a=jk(i,u,c),qk(n)){var g=Object.keys(n)[0],y=n[g];o=f[g].getPixelForValue(y)+v-e}else o="center"===n?(p.bottom+p.top)/2+v-e:kI(t,n,e);r=c-u}else{if(qk(n)){var _=Object.keys(n)[0],b=n[_];a=f[_].getPixelForValue(b)-m+e}else a="center"===n?(p.left+p.right)/2-m+e:kI(t,n,e);o=jk(i,l,s),d="left"===n?-mM:mM}return{titleX:a,titleY:o,maxWidth:r,rotation:d}}(this,u,n,s),c=l.titleX,h=l.titleY,p=l.maxWidth,f=l.rotation;zT(t,i.text,0,0,a,{color:i.color,maxWidth:p,rotation:f,textAlign:II(s,n,r),textBaseline:"middle",translation:[c,h]})}}},{key:"draw",value:function(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}},{key:"_layers",value:function(){var t=this,e=this.options,i=e.ticks&&e.ticks.z||0,r=Zk(e.grid&&e.grid.z,-1);return this._isVisible()&&this.draw===n.prototype.draw?[{z:r,draw:function(e){t.drawBackground(),t.drawGrid(e),t.drawTitle()}},{z:r+1,draw:function(){t.drawBorder()}},{z:i,draw:function(e){t.drawLabels(e)}}]:[{z:i,draw:function(e){t.draw(e)}}]}},{key:"getMatchingVisibleMetas",value:function(t){var e,n,i=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",a=[];for(e=0,n=i.length;e<n;++e){var o=i[e];o[r]!==this.id||t&&o.type!==t||a.push(o)}return a}},{key:"_resolveTickFontOptions",value:function(t){return WT(this.options.ticks.setContext(this.getContext(t)).font)}},{key:"_maxDigits",value:function(){var t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}]),n}(_I),AI=function(){function t(e,n,i){Tt(this,t),this.type=e,this.scope=n,this.override=i,this.items=Object.create(null)}return Ct(t,[{key:"isForType",value:function(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}},{key:"register",value:function(t){var e,n=Object.getPrototypeOf(t);(function(t){return"id"in t&&"defaults"in t})(n)&&(e=this.register(n));var i=this.items,r=t.id,a=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,function(t,e,n){var i=nM(Object.create(null),[n?kT.get(n):{},kT.get(e),t.defaults]);kT.set(e,i),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((function(n){var i=n.split("."),r=i.pop(),a=[t].concat(i).join("."),o=e[n].split("."),s=o.pop(),u=o.join(".");kT.route(a,r,u,s)}))}(e,t.defaultRoutes);t.descriptors&&kT.describe(e,t.descriptors)}(t,a,e),this.override&&kT.override(t.id,t.overrides)),a}},{key:"get",value:function(t){return this.items[t]}},{key:"unregister",value:function(t){var e=this.items,n=t.id,i=this.scope;n in e&&delete e[n],i&&n in kT[i]&&(delete kT[i][n],this.override&&delete _T[n])}}]),t}();var LI=function(){function t(){Tt(this,t),this.controllers=new AI(dC,"datasets",!0),this.elements=new AI(_I,"elements"),this.plugins=new AI(Object,"plugins"),this.scales=new AI(PI,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}return Ct(t,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e)}},{key:"remove",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e)}},{key:"addControllers",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.controllers)}},{key:"addElements",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.elements)}},{key:"addPlugins",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.plugins)}},{key:"addScales",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.scales)}},{key:"getController",value:function(t){return this._get(t,this.controllers,"controller")}},{key:"getElement",value:function(t){return this._get(t,this.elements,"element")}},{key:"getPlugin",value:function(t){return this._get(t,this.plugins,"plugin")}},{key:"getScale",value:function(t){return this._get(t,this.scales,"scale")}},{key:"removeControllers",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.controllers)}},{key:"removeElements",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.elements)}},{key:"removePlugins",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.plugins)}},{key:"removeScales",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.scales)}},{key:"_each",value:function(t,e,n){var i=this;vt(e).forEach((function(e){var r=n||i._getRegistryForType(e);n||r.isForType(e)||r===i.plugins&&e.id?i._exec(t,r,e):Kk(e,(function(e){var r=n||i._getRegistryForType(e);i._exec(t,r,e)}))}))}},{key:"_exec",value:function(t,e,n){var i=sM(t);Yk(n["before"+i],[],n),e[t](n),Yk(n["after"+i],[],n)}},{key:"_getRegistryForType",value:function(t){for(var e=0;e<this._typedRegistries.length;e++){var n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}},{key:"_get",value:function(t,e,n){var i=e.get(t);if(void 0===i)throw new Error('"'+t+'" is not a registered '+n+".");return i}}]),t}(),RI=new LI,DI=function(){function t(){Tt(this,t),this._init=[]}return Ct(t,[{key:"notify",value:function(t,e,n,i){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));var r=i?this._descriptors(t).filter(i):this._descriptors(t),a=this._notify(r,t,e,n);return"destroy"===e&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),a}},{key:"_notify",value:function(t,e,n,i){i=i||{};var r,a=wt(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.plugin;if(!1===Yk(s[n],[e,i,o.options],s)&&i.cancelable)return!1}}catch(Tx){a.e(Tx)}finally{a.f()}return!0}},{key:"invalidate",value:function(){$k(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}},{key:"_descriptors",value:function(t){if(this._cache)return this._cache;var e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}},{key:"_createDescriptors",value:function(t,e){var n=t&&t.config,i=Zk(n.options&&n.options.plugins,{}),r=function(t){for(var e=[],n=Object.keys(RI.plugins.items),i=0;i<n.length;i++)e.push(RI.getPlugin(n[i]));for(var r=t.plugins||[],a=0;a<r.length;a++){var o=r[a];-1===e.indexOf(o)&&e.push(o)}return e}(n);return!1!==i||e?function(t,e,n,i){for(var r=[],a=t.getContext(),o=0;o<e.length;o++){var s=e[o],u=zI(n[s.id],i);null!==u&&r.push({plugin:s,options:OI(t.config,s,u,a)})}return r}(t,r,i,e):[]}},{key:"_notifyStateChanges",value:function(t){var e=this._oldCache||[],n=this._cache,i=function(t,e){return t.filter((function(t){return!e.some((function(e){return t.plugin.id===e.plugin.id}))}))};this._notify(i(e,n),t,"stop"),this._notify(i(n,e),t,"start")}}]),t}();function zI(t,e){return e||!1!==t?!0===t?{}:t:null}function OI(t,e,n,i){var r=t.pluginScopeKeys(e),a=t.getOptionScopes(n,r);return t.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function FI(t,e){var n=kT.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function NI(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(n=e.position)||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0)||t.charAt(0).toLowerCase();var n}function BI(t){var e=t.options||(t.options={});e.plugins=Zk(e.plugins,{}),e.scales=function(t,e){var n=_T[t.type]||{scales:{}},i=e.scales||{},r=FI(t.type,e),a=Object.create(null),o=Object.create(null);return Object.keys(i).forEach((function(t){var e=i[t];if(!qk(e))return console.error("Invalid scale configuration for scale: ".concat(t));if(e._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(t));var s=NI(t,e),u=function(t,e){return t===e?"_index_":"_value_"}(s,r),l=n.scales||{};a[s]=a[s]||t,o[t]=iM(Object.create(null),[{axis:s},e,l[s],l[u]])})),t.data.datasets.forEach((function(n){var r=n.type||t.type,s=n.indexAxis||FI(r,e),u=(_T[r]||{}).scales||{};Object.keys(u).forEach((function(t){var e=function(t,e){var n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,s),r=n[e+"AxisID"]||a[e]||e;o[r]=o[r]||Object.create(null),iM(o[r],[{axis:e},i[r],u[t]])}))})),Object.keys(o).forEach((function(t){var e=o[t];iM(e,[kT.scales[e.type],kT.scale])})),o}(t,e)}function jI(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}var VI=new Map,UI=new Set;function $I(t,e){var n=VI.get(t);return n||(n=e(),VI.set(t,n),UI.add(n)),n}var HI=function(t,e,n){var i=oM(e,n);void 0!==i&&t.add(i)},qI=function(){function t(e){Tt(this,t),this._config=function(t){return(t=t||{}).data=jI(t.data),BI(t),t}(e),this._scopeCache=new Map,this._resolverCache=new Map}return Ct(t,[{key:"platform",get:function(){return this._config.platform}},{key:"type",get:function(){return this._config.type},set:function(t){this._config.type=t}},{key:"data",get:function(){return this._config.data},set:function(t){this._config.data=jI(t)}},{key:"options",get:function(){return this._config.options},set:function(t){this._config.options=t}},{key:"plugins",get:function(){return this._config.plugins}},{key:"update",value:function(){var t=this._config;this.clearCache(),BI(t)}},{key:"clearCache",value:function(){this._scopeCache.clear(),this._resolverCache.clear()}},{key:"datasetScopeKeys",value:function(t){return $I(t,(function(){return[["datasets.".concat(t),""]]}))}},{key:"datasetAnimationScopeKeys",value:function(t,e){return $I("".concat(t,".transition.").concat(e),(function(){return[["datasets.".concat(t,".transitions.").concat(e),"transitions.".concat(e)],["datasets.".concat(t),""]]}))}},{key:"datasetElementScopeKeys",value:function(t,e){return $I("".concat(t,"-").concat(e),(function(){return[["datasets.".concat(t,".elements.").concat(e),"datasets.".concat(t),"elements.".concat(e),""]]}))}},{key:"pluginScopeKeys",value:function(t){var e=t.id,n=this.type;return $I("".concat(n,"-plugin-").concat(e),(function(){return[["plugins.".concat(e)].concat(vt(t.additionalOptionScopes||[]))]}))}},{key:"_cachedScopes",value:function(t,e){var n=this._scopeCache,i=n.get(t);return i&&!e||(i=new Map,n.set(t,i)),i}},{key:"getOptionScopes",value:function(t,e,n){var i=this.options,r=this.type,a=this._cachedScopes(t,n),o=a.get(e);if(o)return o;var s=new Set;e.forEach((function(e){t&&(s.add(t),e.forEach((function(e){return HI(s,t,e)}))),e.forEach((function(t){return HI(s,i,t)})),e.forEach((function(t){return HI(s,_T[r]||{},t)})),e.forEach((function(t){return HI(s,kT,t)})),e.forEach((function(t){return HI(s,bT,t)}))}));var u=Array.from(s);return 0===u.length&&u.push(Object.create(null)),UI.has(e)&&a.set(e,u),u}},{key:"chartOptionScopes",value:function(){var t=this.options,e=this.type;return[t,_T[e]||{},kT.datasets[e]||{},{type:e},kT,bT]}},{key:"resolveNamedOptions",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""],r={$shared:!0},a=WI(this._resolverCache,t,i),o=a.resolver,s=a.subPrefixes,u=o;if(ZI(o,e)){r.$shared=!1,n=lM(n)?n():n;var l=this.createResolver(t,n,s);u=nE(o,n,l)}var c,h=wt(e);try{for(h.s();!(c=h.n()).done;){var p=c.value;r[p]=u[p]}}catch(Tx){h.e(Tx)}finally{h.f()}return r}},{key:"createResolver",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],i=arguments.length>3?arguments[3]:void 0,r=WI(this._resolverCache,t,n),a=r.resolver;return qk(e)?nE(a,e,void 0,i):a}}]),t}();function WI(t,e,n){var i=t.get(e);i||(i=new Map,t.set(e,i));var r=n.join(),a=i.get(r);a||(a={resolver:eE(e,n),subPrefixes:n.filter((function(t){return!t.toLowerCase().includes("hover")}))},i.set(r,a));return a}var GI=function(t){return qk(t)&&Object.getOwnPropertyNames(t).reduce((function(e,n){return e||lM(t[n])}),!1)};function ZI(t,e){var n,i=iE(t),r=i.isScriptable,a=i.isIndexable,o=wt(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=r(s),l=a(s),c=(l||u)&&t[s];if(u&&(lM(c)||GI(c))||l&&Hk(c))return!0}}catch(Tx){o.e(Tx)}finally{o.f()}return!1}var XI=["top","bottom","left","right","chartArea"];function YI(t,e){return"top"===t||"bottom"===t||-1===XI.indexOf(t)&&"x"===e}function KI(t,e){return function(n,i){return n[t]===i[t]?n[e]-i[e]:n[t]-i[t]}}function JI(t){var e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),Yk(n&&n.onComplete,[t],e)}function QI(t){var e=t.chart,n=e.options.animation;Yk(n&&n.onProgress,[t],e)}function tP(t){return SE()&&"string"===typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}var eP={},nP=function(t){var e=tP(t);return Object.values(eP).filter((function(t){return t.canvas===e})).pop()};function iP(t,e,n){for(var i=0,r=Object.keys(t);i<r.length;i++){var a=r[i],o=+a;if(o>=e){var s=t[a];delete t[a],(n>0||o>e)&&(t[o+n]=s)}}}var rP=function(){function t(e,n){var i=this;Tt(this,t);var r=this.config=new qI(n),a=tP(e),o=nP(a);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas can be reused.");var s=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||function(t){return!SE()||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas?rI:yI}(a)),this.platform.updateConfig(r);var u=this.platform.acquireContext(a,s.aspectRatio),l=u&&u.canvas,c=l&&l.height,h=l&&l.width;this.id=Uk(),this.ctx=u,this.canvas=l,this.width=h,this.height=c,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new DI,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){var n;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}((function(t){return i.update(t)}),s.resizeDelay||0),this._dataChanges=[],eP[this.id]=this,u&&l?(KE.listen(this,"complete",JI),KE.listen(this,"progress",QI),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}return Ct(t,[{key:"aspectRatio",get:function(){var t=this.options,e=t.aspectRatio,n=t.maintainAspectRatio,i=this.width,r=this.height,a=this._aspectRatio;return $k(e)?n&&a?a:r?i/r:null:e}},{key:"data",get:function(){return this.config.data},set:function(t){this.config.data=t}},{key:"options",get:function(){return this._options},set:function(t){this.config.options=t}},{key:"_initialize",value:function(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():LE(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}},{key:"clear",value:function(){return CT(this.canvas,this.ctx),this}},{key:"stop",value:function(){return KE.stop(this),this}},{key:"resize",value:function(t,e){KE.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}},{key:"_resize",value:function(t,e){var n=this.options,i=this.canvas,r=n.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(i,t,e,r),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,LE(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),Yk(n.onResize,[this,a],this),this.attached&&this._doResize(s)&&this.render())}},{key:"ensureScalesHaveIDs",value:function(){Kk(this.options.scales||{},(function(t,e){t.id=e}))}},{key:"buildOrUpdateScales",value:function(){var t=this,e=this.options,n=e.scales,i=this.scales,r=Object.keys(i).reduce((function(t,e){return t[e]=!1,t}),{}),a=[];n&&(a=a.concat(Object.keys(n).map((function(t){var e=n[t],i=NI(t,e),r="r"===i,a="x"===i;return{options:e,dposition:r?"chartArea":a?"bottom":"left",dtype:r?"radialLinear":a?"category":"linear"}})))),Kk(a,(function(n){var a=n.options,o=a.id,s=NI(o,a),u=Zk(a.type,n.dtype);void 0!==a.position&&YI(a.position,s)===YI(n.dposition)||(a.position=n.dposition),r[o]=!0;var l=null;o in i&&i[o].type===u?l=i[o]:(l=new(RI.getScale(u))({id:o,type:u,ctx:t.ctx,chart:t}),i[l.id]=l);l.init(a,e)})),Kk(r,(function(t,e){t||delete i[e]})),Kk(i,(function(e){eI(t,e,e.options),QC(t,e)}))}},{key:"_updateMetasets",value:function(){var t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort((function(t,e){return t.index-e.index})),n>e){for(var i=e;i<n;++i)this._destroyDatasetMeta(i);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(KI("order","index"))}},{key:"_removeUnreferencedMetasets",value:function(){var t=this,e=this._metasets,n=this.data.datasets;e.length>n.length&&delete this._stacks,e.forEach((function(e,i){0===n.filter((function(t){return t===e._dataset})).length&&t._destroyDatasetMeta(i)}))}},{key:"buildOrUpdateControllers",value:function(){var t,e,n=[],i=this.data.datasets;for(this._removeUnreferencedMetasets(),t=0,e=i.length;t<e;t++){var r=i[t],a=this.getDatasetMeta(t),o=r.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(t),a=this.getDatasetMeta(t)),a.type=o,a.indexAxis=r.indexAxis||FI(o,this.options),a.order=r.order||0,a.index=t,a.label=""+r.label,a.visible=this.isDatasetVisible(t),a.controller)a.controller.updateIndex(t),a.controller.linkScales();else{var s=RI.getController(o),u=kT.datasets[o],l=u.datasetElementType,c=u.dataElementType;Object.assign(s.prototype,{dataElementType:RI.getElement(c),datasetElementType:l&&RI.getElement(l)}),a.controller=new s(this,t),n.push(a.controller)}}return this._updateMetasets(),n}},{key:"_resetElements",value:function(){var t=this;Kk(this.data.datasets,(function(e,n){t.getDatasetMeta(n).controller.reset()}),this)}},{key:"reset",value:function(){this._resetElements(),this.notifyPlugins("reset")}},{key:"update",value:function(t){var e=this.config;e.update();var n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1!==this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})){var r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");for(var a=0,o=0,s=this.data.datasets.length;o<s;o++){var u=this.getDatasetMeta(o).controller,l=!i&&-1===r.indexOf(u);u.buildOrUpdateElements(l),a=Math.max(+u.getMaxOverflow(),a)}a=this._minPadding=n.layout.autoPadding?a:0,this._updateLayout(a),i||Kk(r,(function(t){t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(KI("z","_idx")),this._lastEvent&&this._eventHandler(this._lastEvent,!0),this.render()}}},{key:"_updateScales",value:function(){var t=this;Kk(this.scales,(function(e){tI(t,e)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}},{key:"_checkEventBindings",value:function(){var t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);cM(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}},{key:"_updateHiddenIndices",value:function(){var t,e=this._hiddenIndices,n=wt(this._getUniformDataChanges()||[]);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.method,a=i.start,o=i.count;iP(e,a,"_removeElements"===r?-o:o)}}catch(Tx){n.e(Tx)}finally{n.f()}}},{key:"_getUniformDataChanges",value:function(){var t=this._dataChanges;if(t&&t.length){this._dataChanges=[];for(var e=this.data.datasets.length,n=function(e){return new Set(t.filter((function(t){return t[0]===e})).map((function(t,e){return e+","+t.splice(1).join(",")})))},i=n(0),r=1;r<e;r++)if(!cM(i,n(r)))return;return Array.from(i).map((function(t){return t.split(",")})).map((function(t){return{method:t[1],start:+t[2],count:+t[3]}}))}}},{key:"_updateLayout",value:function(t){var e=this;if(!1!==this.notifyPlugins("beforeLayout",{cancelable:!0})){nI(this,this.width,this.height,t);var n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],Kk(this.boxes,(function(t){var n;i&&"chartArea"===t.position||(t.configure&&t.configure(),(n=e._layers).push.apply(n,vt(t._layers())))}),this),this._layers.forEach((function(t,e){t._idx=e})),this.notifyPlugins("afterLayout")}}},{key:"_updateDatasets",value:function(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(var e=0,n=this.data.datasets.length;e<n;++e)this.getDatasetMeta(e).controller.configure();for(var i=0,r=this.data.datasets.length;i<r;++i)this._updateDataset(i,lM(t)?t({datasetIndex:i}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}},{key:"_updateDataset",value:function(t,e){var n=this.getDatasetMeta(t),i={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}},{key:"render",value:function(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(KE.has(this)?this.attached&&!KE.running(this)&&KE.start(this):(this.draw(),JI({chart:this})))}},{key:"draw",value:function(){var t;if(this._resizeBeforeDraw){var e=this._resizeBeforeDraw,n=e.width,i=e.height;this._resize(n,i),this._resizeBeforeDraw=null}if(this.clear(),!(this.width<=0||this.height<=0)&&!1!==this.notifyPlugins("beforeDraw",{cancelable:!0})){var r=this._layers;for(t=0;t<r.length&&r[t].z<=0;++t)r[t].draw(this.chartArea);for(this._drawDatasets();t<r.length;++t)r[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}}},{key:"_getSortedDatasetMetas",value:function(t){var e,n,i=this._sortedMetasets,r=[];for(e=0,n=i.length;e<n;++e){var a=i[e];t&&!a.visible||r.push(a)}return r}},{key:"getSortedVisibleDatasetMetas",value:function(){return this._getSortedDatasetMetas(!0)}},{key:"_drawDatasets",value:function(){if(!1!==this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})){for(var t=this.getSortedVisibleDatasetMetas(),e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}}},{key:"_drawDataset",value:function(t){var e=this.ctx,n=t._clip,i=!n.disabled,r=this.chartArea,a={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",a)&&(i&&AT(e,{left:!1===n.left?0:r.left-n.left,right:!1===n.right?this.width:r.right+n.right,top:!1===n.top?0:r.top-n.top,bottom:!1===n.bottom?this.height:r.bottom+n.bottom}),t.controller.draw(),i&&LT(e),a.cancelable=!1,this.notifyPlugins("afterDatasetDraw",a))}},{key:"getElementsAtEventForMode",value:function(t,e,n,i){var r=jC.modes[e];return"function"===typeof r?r(this,t,n,i):[]}},{key:"getDatasetMeta",value:function(t){var e=this.data.datasets[t],n=this._metasets,i=n.filter((function(t){return t&&t._dataset===e})).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(i)),i}},{key:"getContext",value:function(){return this.$context||(this.$context=ZT(null,{chart:this,type:"chart"}))}},{key:"getVisibleDatasetCount",value:function(){return this.getSortedVisibleDatasetMetas().length}},{key:"isDatasetVisible",value:function(t){var e=this.data.datasets[t];if(!e)return!1;var n=this.getDatasetMeta(t);return"boolean"===typeof n.hidden?!n.hidden:!e.hidden}},{key:"setDatasetVisibility",value:function(t,e){this.getDatasetMeta(t).hidden=!e}},{key:"toggleDataVisibility",value:function(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}},{key:"getDataVisibility",value:function(t){return!this._hiddenIndices[t]}},{key:"_updateVisibility",value:function(t,e,n){var i=n?"show":"hide",r=this.getDatasetMeta(t),a=r.controller._resolveAnimations(void 0,i);uM(e)?(r.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),a.update(r,{visible:n}),this.update((function(e){return e.datasetIndex===t?i:void 0})))}},{key:"hide",value:function(t,e){this._updateVisibility(t,e,!1)}},{key:"show",value:function(t,e){this._updateVisibility(t,e,!0)}},{key:"_destroyDatasetMeta",value:function(t){var e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}},{key:"_stop",value:function(){var t,e;for(this.stop(),KE.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}},{key:"destroy",value:function(){var t=this.canvas,e=this.ctx;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),CT(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete eP[this.id]}},{key:"toBase64Image",value:function(){var t;return(t=this.canvas).toDataURL.apply(t,arguments)}},{key:"bindEvents",value:function(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}},{key:"bindUserEvents",value:function(){var t=this,e=this._listeners,n=this.platform,i=function(e,n,i){e.offsetX=n,e.offsetY=i,t._eventHandler(e)};Kk(this.options.events,(function(r){return function(i,r){n.addEventListener(t,i,r),e[i]=r}(r,i)}))}},{key:"bindResponsiveEvents",value:function(){var t=this;this._responsiveListeners||(this._responsiveListeners={});var e,n=this._responsiveListeners,i=this.platform,r=function(e,r){i.addEventListener(t,e,r),n[e]=r},a=function(e,r){n[e]&&(i.removeEventListener(t,e,r),delete n[e])},o=function(e,n){t.canvas&&t.resize(e,n)},s=function n(){a("attach",n),t.attached=!0,t.resize(),r("resize",o),r("detach",e)};e=function(){t.attached=!1,a("resize",o),t._stop(),t._resize(0,0),r("attach",s)},i.isAttached(this.canvas)?s():e()}},{key:"unbindEvents",value:function(){var t=this;Kk(this._listeners,(function(e,n){t.platform.removeEventListener(t,n,e)})),this._listeners={},Kk(this._responsiveListeners,(function(e,n){t.platform.removeEventListener(t,n,e)})),this._responsiveListeners=void 0}},{key:"updateHoverStyle",value:function(t,e,n){var i,r,a,o=n?"set":"remove";for("dataset"===e&&this.getDatasetMeta(t[0].datasetIndex).controller["_"+o+"DatasetHoverStyle"](),r=0,a=t.length;r<a;++r){var s=(i=t[r])&&this.getDatasetMeta(i.datasetIndex).controller;s&&s[o+"HoverStyle"](i.element,i.datasetIndex,i.index)}}},{key:"getActiveElements",value:function(){return this._active||[]}},{key:"setActiveElements",value:function(t){var e=this,n=this._active||[],i=t.map((function(t){var n=t.datasetIndex,i=t.index,r=e.getDatasetMeta(n);if(!r)throw new Error("No dataset found at index "+n);return{datasetIndex:n,element:r.data[i],index:i}}));!Jk(i,n)&&(this._active=i,this._updateHoverStyles(i,n))}},{key:"notifyPlugins",value:function(t,e,n){return this._plugins.notify(this,t,e,n)}},{key:"_updateHoverStyles",value:function(t,e,n){var i=this.options.hover,r=function(t,e){return t.filter((function(t){return!e.some((function(e){return t.datasetIndex===e.datasetIndex&&t.index===e.index}))}))},a=r(e,t),o=n?t:r(t,e);a.length&&this.updateHoverStyle(a,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}},{key:"_eventHandler",value:function(t,e){var n=this,i={event:t,replay:e,cancelable:!0},r=function(e){return(e.options.events||n.options.events).includes(t.native.type)};if(!1!==this.notifyPlugins("beforeEvent",i,r)){var a=this._handleEvent(t,e);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,r),(a||i.changed)&&this.render(),this}}},{key:"_handleEvent",value:function(t,e){var n,i=this._active,r=void 0===i?[]:i,a=this.options,o=a.hover,s=e,u=[],l=null;return"mouseout"!==t.type&&(u=this.getElementsAtEventForMode(t,o.mode,o,s),l="click"===t.type?this._lastEvent:t),this._lastEvent=null,PT(t,this.chartArea,this._minPadding)&&(Yk(a.onHover,[t,u,this],this),"mouseup"!==t.type&&"click"!==t.type&&"contextmenu"!==t.type||Yk(a.onClick,[t,u,this],this)),((n=!Jk(u,r))||e)&&(this._active=u,this._updateHoverStyles(u,r,e)),this._lastEvent=l,n}}]),t}(),aP=function(){return Kk(rP.instances,(function(t){return t._plugins.invalidate()}))},oP=!0;function sP(t,e,n){var i=e.startAngle,r=e.pixelMargin,a=e.x,o=e.y,s=e.outerRadius,u=e.innerRadius,l=r/s;t.beginPath(),t.arc(a,o,s,i-l,n+l),u>r?(l=r/u,t.arc(a,o,u,n+l,i-l,!0)):t.arc(a,o,r,n+mM,i-mM),t.closePath(),t.clip()}function uP(t,e,n,i){var r=UT(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),a=(n-e)/2,o=Math.min(a,i*e/2),s=function(t){var e=(n-Math.min(a,t))*i/2;return LM(t,0,Math.min(a,e))};return{outerStart:s(r.outerStart),outerEnd:s(r.outerEnd),innerStart:LM(r.innerStart,0,o),innerEnd:LM(r.innerEnd,0,o)}}function lP(t,e,n,i){return{x:n+t*Math.cos(e),y:i+t*Math.sin(e)}}function cP(t,e,n,i,r){var a=e.x,o=e.y,s=e.startAngle,u=e.pixelMargin,l=e.innerRadius,c=Math.max(e.outerRadius+i+n-u,0),h=l>0?l+i+n+u:0,p=0,f=r-s;if(i){var d=((l>0?l-i:0)+(c>0?c-i:0))/2;p=(f-(0!==d?f*d/(d+i):f))/2}var v=(f-Math.max(.001,f*c-n/hM)/c)/2,m=s+v+p,g=r-v-p,y=uP(e,h,c,g-m),_=y.outerStart,b=y.outerEnd,x=y.innerStart,w=y.innerEnd,S=c-_,k=c-b,M=m+_/S,T=g-b/k,E=h+x,C=h+w,I=m+x/E,P=g-w/C;if(t.beginPath(),t.arc(a,o,c,M,T),b>0){var A=lP(k,T,a,o);t.arc(A.x,A.y,b,T,g+mM)}var L=lP(C,g,a,o);if(t.lineTo(L.x,L.y),w>0){var R=lP(C,P,a,o);t.arc(R.x,R.y,w,g+mM,P+Math.PI)}if(t.arc(a,o,h,g-w/h,m+x/h,!0),x>0){var D=lP(E,I,a,o);t.arc(D.x,D.y,x,I+Math.PI,m-mM)}var z=lP(S,m,a,o);if(t.lineTo(z.x,z.y),_>0){var O=lP(S,M,a,o);t.arc(O.x,O.y,_,m-mM,M)}t.closePath()}function hP(t,e,n,i,r){var a=e.options,o="inner"===a.borderAlign;a.borderWidth&&(o?(t.lineWidth=2*a.borderWidth,t.lineJoin="round"):(t.lineWidth=a.borderWidth,t.lineJoin="bevel"),e.fullCircles&&function(t,e,n){var i,r=e.x,a=e.y,o=e.startAngle,s=e.pixelMargin,u=e.fullCircles,l=Math.max(e.outerRadius-s,0),c=e.innerRadius+s;for(n&&sP(t,e,o+pM),t.beginPath(),t.arc(r,a,c,o+pM,o,!0),i=0;i<u;++i)t.stroke();for(t.beginPath(),t.arc(r,a,l,o,o+pM),i=0;i<u;++i)t.stroke()}(t,e,o),o&&sP(t,e,r),cP(t,e,n,i,r),t.stroke())}Object.defineProperties(rP,{defaults:{enumerable:oP,value:kT},instances:{enumerable:oP,value:eP},overrides:{enumerable:oP,value:_T},registry:{enumerable:oP,value:RI},version:{enumerable:oP,value:"3.6.2"},getChart:{enumerable:oP,value:nP},register:{enumerable:oP,value:function(){RI.add.apply(RI,arguments),aP()}},unregister:{enumerable:oP,value:function(){RI.remove.apply(RI,arguments),aP()}}});var pP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).options=void 0,i.circumference=void 0,i.startAngle=void 0,i.endAngle=void 0,i.innerRadius=void 0,i.outerRadius=void 0,i.pixelMargin=0,i.fullCircles=0,t&&Object.assign(ft(i),t),i}return Ct(n,[{key:"inRange",value:function(t,e,n){var i=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=Math.sqrt(n*n+i*i),a=Math.atan2(i,n);return a<-.5*hM&&(a+=pM),{angle:a,distance:r}}(this.getProps(["x","y"],n),{x:t,y:e}),r=i.angle,a=i.distance,o=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),s=o.startAngle,u=o.endAngle,l=o.innerRadius,c=o.outerRadius,h=o.circumference,p=this.options.spacing/2,f=Zk(h,u-s)>=pM||AM(r,s,u),d=RM(a,l+p,c+p);return f&&d}},{key:"getCenterPoint",value:function(t){var e=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),n=e.x,i=e.y,r=e.startAngle,a=e.endAngle,o=e.innerRadius,s=e.outerRadius,u=this.options,l=u.offset,c=(r+a)/2,h=(o+s+u.spacing+l)/2;return{x:n+Math.cos(c)*h,y:i+Math.sin(c)*h}}},{key:"tooltipPosition",value:function(t){return this.getCenterPoint(t)}},{key:"draw",value:function(t){var e=this.options,n=this.circumference,i=(e.offset||0)/2,r=(e.spacing||0)/2;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>pM?Math.floor(n/pM):0,!(0===n||this.innerRadius<0||this.outerRadius<0)){t.save();var a=0;if(i){a=i/2;var o=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(o)*a,Math.sin(o)*a),this.circumference>=hM&&(a=i)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;var s=function(t,e,n,i){var r=e.fullCircles,a=e.startAngle,o=e.circumference,s=e.endAngle;if(r){cP(t,e,n,i,a+pM);for(var u=0;u<r;++u)t.fill();isNaN(o)||(s=a+o%pM,o%pM===0&&(s+=pM))}return cP(t,e,n,i,s),t.fill(),s}(t,this,a,r);hP(t,this,a,r,s),t.restore()}}}]),n}(_I);function fP(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;t.lineCap=Zk(n.borderCapStyle,e.borderCapStyle),t.setLineDash(Zk(n.borderDash,e.borderDash)),t.lineDashOffset=Zk(n.borderDashOffset,e.borderDashOffset),t.lineJoin=Zk(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=Zk(n.borderWidth,e.borderWidth),t.strokeStyle=Zk(n.borderColor,e.borderColor)}function dP(t,e,n){t.lineTo(n.x,n.y)}function vP(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.length,r=n.start,a=void 0===r?0:r,o=n.end,s=void 0===o?i-1:o,u=e.start,l=e.end,c=Math.max(a,u),h=Math.min(s,l),p=a<u&&s<u||a>l&&s>l;return{count:i,start:c,loop:e.loop,ilen:h<c&&!p?i+h-c:h-c}}function mP(t,e,n,i){var r,a,o,s=e.points,u=e.options,l=vP(s,n,i),c=l.count,h=l.start,p=l.loop,f=l.ilen,d=function(t){return t.stepped?RT:t.tension||"monotone"===t.cubicInterpolationMode?DT:dP}(u),v=i||{},m=v.move,g=void 0===m||m,y=v.reverse;for(r=0;r<=f;++r)(a=s[(h+(y?f-r:r))%c]).skip||(g?(t.moveTo(a.x,a.y),g=!1):d(t,o,a,y,u.stepped),o=a);return p&&d(t,o,a=s[(h+(y?f:0))%c],y,u.stepped),!!p}function gP(t,e,n,i){var r,a,o,s,u,l,c=e.points,h=vP(c,n,i),p=h.count,f=h.start,d=h.ilen,v=i||{},m=v.move,g=void 0===m||m,y=v.reverse,_=0,b=0,x=function(t){return(f+(y?d-t:t))%p},w=function(){s!==u&&(t.lineTo(_,u),t.lineTo(_,s),t.lineTo(_,l))};for(g&&(a=c[x(0)],t.moveTo(a.x,a.y)),r=0;r<=d;++r)if(!(a=c[x(r)]).skip){var S=a.x,k=a.y,M=0|S;M===o?(k<s?s=k:k>u&&(u=k),_=(b*_+S)/++b):(w(),t.lineTo(S,k),o=M,b=0,s=u=k),l=k}w()}function yP(t){var e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&"monotone"!==e.cubicInterpolationMode&&!e.stepped&&!n?gP:mP}pP.id="arc",pP.defaults={borderAlign:"center",borderColor:"#fff",borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},pP.defaultRoutes={backgroundColor:"backgroundColor"};var _P="function"===typeof Path2D;function bP(t,e,n,i){_P&&!e.options.segment?function(t,e,n,i){var r=e._path;r||(r=e._path=new Path2D,e.path(r,n,i)&&r.closePath()),fP(t,e.options),t.stroke(r)}(t,e,n,i):function(t,e,n,i){var r,a=e.segments,o=e.options,s=yP(e),u=wt(a);try{for(u.s();!(r=u.n()).done;){var l=r.value;fP(t,o,l.style),t.beginPath(),s(t,e,l,{start:n,end:n+i-1})&&t.closePath(),t.stroke()}}catch(Tx){u.e(Tx)}finally{u.f()}}(t,e,n,i)}var xP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).animated=!0,i.options=void 0,i._chart=void 0,i._loop=void 0,i._fullLoop=void 0,i._path=void 0,i._points=void 0,i._segments=void 0,i._decimated=!1,i._pointsUpdated=!1,i._datasetIndex=void 0,t&&Object.assign(ft(i),t),i}return Ct(n,[{key:"updateControlPoints",value:function(t,e){var n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){var i=n.spanGaps?this._loop:this._fullLoop;wE(this._points,n,t,i,e),this._pointsUpdated=!0}}},{key:"points",get:function(){return this._points},set:function(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}},{key:"segments",get:function(){return this._segments||(this._segments=function(t,e){var n=t.points,i=t.options.spanGaps,r=n.length;if(!r)return[];var a=!!t._loop,o=function(t,e,n,i){var r=0,a=e-1;if(n&&!i)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,n&&(a+=r);a>r&&t[a%e].skip;)a--;return{start:r,end:a%=e}}(n,r,a,i),s=o.start,u=o.end;return GE(t,!0===i?[{start:s,end:u,loop:a}]:function(t,e,n,i){var r,a=t.length,o=[],s=e,u=t[e];for(r=e+1;r<=n;++r){var l=t[r%a];l.skip||l.stop?u.skip||(i=!1,o.push({start:e%a,end:(r-1)%a,loop:i}),e=s=l.stop?r:null):(s=r,u.skip&&(e=r)),u=l}return null!==s&&o.push({start:e%a,end:s%a,loop:i}),o}(n,s,u<s?u+r:u,!!t._fullLoop&&0===s&&u===r-1),n,e)}(this,this.options.segment))}},{key:"first",value:function(){var t=this.segments,e=this.points;return t.length&&e[t[0].start]}},{key:"last",value:function(){var t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}},{key:"interpolate",value:function(t,e){var n=this.options,i=t[e],r=this.points,a=WE(this,{property:e,start:i,end:i});if(a.length){var o,s,u=[],l=function(t){return t.stepped?OE:t.tension||"monotone"===t.cubicInterpolationMode?FE:zE}(n);for(o=0,s=a.length;o<s;++o){var c=a[o],h=c.start,p=c.end,f=r[h],d=r[p];if(f!==d){var v=l(f,d,Math.abs((i-f[e])/(d[e]-f[e])),n.stepped);v[e]=t[e],u.push(v)}else u.push(f)}return 1===u.length?u[0]:u}}},{key:"pathSegment",value:function(t,e,n){return yP(this)(t,this,e,n)}},{key:"path",value:function(t,e,n){var i=this.segments,r=yP(this),a=this._loop;e=e||0,n=n||this.points.length-e;var o,s=wt(i);try{for(s.s();!(o=s.n()).done;){a&=r(t,this,o.value,{start:e,end:e+n-1})}}catch(Tx){s.e(Tx)}finally{s.f()}return!!a}},{key:"draw",value:function(t,e,n,i){var r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),bP(t,this,n,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}]),n}(_I);function wP(t,e,n,i){var r=t.options,a=t.getProps([n],i)[n];return Math.abs(e-a)<r.radius+r.hitRadius}xP.id="line",xP.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},xP.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},xP.descriptors={_scriptable:!0,_indexable:function(t){return"borderDash"!==t&&"fill"!==t}};var SP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).options=void 0,i.parsed=void 0,i.skip=void 0,i.stop=void 0,t&&Object.assign(ft(i),t),i}return Ct(n,[{key:"inRange",value:function(t,e,n){var i=this.options,r=this.getProps(["x","y"],n),a=r.x,o=r.y;return Math.pow(t-a,2)+Math.pow(e-o,2)<Math.pow(i.hitRadius+i.radius,2)}},{key:"inXRange",value:function(t,e){return wP(this,t,"x",e)}},{key:"inYRange",value:function(t,e){return wP(this,t,"y",e)}},{key:"getCenterPoint",value:function(t){var e=this.getProps(["x","y"],t);return{x:e.x,y:e.y}}},{key:"size",value:function(t){var e=(t=t||this.options||{}).radius||0;return 2*((e=Math.max(e,e&&t.hoverRadius||0))+(e&&t.borderWidth||0))}},{key:"draw",value:function(t,e){var n=this.options;this.skip||n.radius<.1||!PT(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,IT(t,n,this.x,this.y))}},{key:"getRange",value:function(){var t=this.options||{};return t.radius+t.hitRadius}}]),n}(_I);function kP(t,e){var n,i,r,a,o,s=t.getProps(["x","y","base","width","height"],e),u=s.x,l=s.y,c=s.base,h=s.width,p=s.height;return t.horizontal?(o=p/2,n=Math.min(u,c),i=Math.max(u,c),r=l-o,a=l+o):(n=u-(o=h/2),i=u+o,r=Math.min(l,c),a=Math.max(l,c)),{left:n,top:r,right:i,bottom:a}}function MP(t,e,n,i){return t?0:LM(e,n,i)}function TP(t){var e=kP(t),n=e.right-e.left,i=e.bottom-e.top,r=function(t,e,n){var i=t.options.borderWidth,r=t.borderSkipped,a=$T(i);return{t:MP(r.top,a.top,0,n),r:MP(r.right,a.right,0,e),b:MP(r.bottom,a.bottom,0,n),l:MP(r.left,a.left,0,e)}}(t,n/2,i/2),a=function(t,e,n){var i=t.getProps(["enableBorderRadius"]).enableBorderRadius,r=t.options.borderRadius,a=HT(r),o=Math.min(e,n),s=t.borderSkipped,u=i||qk(r);return{topLeft:MP(!u||s.top||s.left,a.topLeft,0,o),topRight:MP(!u||s.top||s.right,a.topRight,0,o),bottomLeft:MP(!u||s.bottom||s.left,a.bottomLeft,0,o),bottomRight:MP(!u||s.bottom||s.right,a.bottomRight,0,o)}}(t,n/2,i/2);return{outer:{x:e.left,y:e.top,w:n,h:i,radius:a},inner:{x:e.left+r.l,y:e.top+r.t,w:n-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,a.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(r.b,r.r))}}}}function EP(t,e,n,i){var r=null===e,a=null===n,o=t&&!(r&&a)&&kP(t,i);return o&&(r||RM(e,o.left,o.right))&&(a||RM(n,o.top,o.bottom))}function CP(t,e){t.rect(e.x,e.y,e.w,e.h)}function IP(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.x!==n.x?-e:0,r=t.y!==n.y?-e:0,a=(t.x+t.w!==n.x+n.w?e:0)-i,o=(t.y+t.h!==n.y+n.h?e:0)-r;return{x:t.x+i,y:t.y+r,w:t.w+a,h:t.h+o,radius:t.radius}}SP.id="point",SP.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},SP.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var PP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).options=void 0,i.horizontal=void 0,i.base=void 0,i.width=void 0,i.height=void 0,i.inflateAmount=void 0,t&&Object.assign(ft(i),t),i}return Ct(n,[{key:"draw",value:function(t){var e,n=this.inflateAmount,i=this.options,r=i.borderColor,a=i.backgroundColor,o=TP(this),s=o.inner,u=o.outer,l=(e=u.radius).topLeft||e.topRight||e.bottomLeft||e.bottomRight?NT:CP;t.save(),u.w===s.w&&u.h===s.h||(t.beginPath(),l(t,IP(u,n,s)),t.clip(),l(t,IP(s,-n,u)),t.fillStyle=r,t.fill("evenodd")),t.beginPath(),l(t,IP(s,n)),t.fillStyle=a,t.fill(),t.restore()}},{key:"inRange",value:function(t,e,n){return EP(this,t,e,n)}},{key:"inXRange",value:function(t,e){return EP(this,t,null,e)}},{key:"inYRange",value:function(t,e){return EP(this,null,t,e)}},{key:"getCenterPoint",value:function(t){var e=this.getProps(["x","y","base","horizontal"],t),n=e.x,i=e.y,r=e.base,a=e.horizontal;return{x:a?(n+r)/2:n,y:a?i:(i+r)/2}}},{key:"getRange",value:function(t){return"x"===t?this.width/2:this.height/2}}]),n}(_I);PP.id="bar",PP.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},PP.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var AP=function(t,e){var n=t.boxHeight,i=void 0===n?e:n,r=t.boxWidth,a=void 0===r?e:r;return t.usePointStyle&&(i=Math.min(i,e),a=Math.min(a,e)),{boxWidth:a,boxHeight:i,itemHeight:Math.max(e,i)}},LP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this))._added=!1,i.legendHitBoxes=[],i._hoveredItem=null,i.doughnutMode=!1,i.chart=t.chart,i.options=t.options,i.ctx=t.ctx,i.legendItems=void 0,i.columnSizes=void 0,i.lineWidths=void 0,i.maxHeight=void 0,i.maxWidth=void 0,i.top=void 0,i.bottom=void 0,i.left=void 0,i.right=void 0,i.height=void 0,i.width=void 0,i._margins=void 0,i.position=void 0,i.weight=void 0,i.fullSize=void 0,i}return Ct(n,[{key:"update",value:function(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}},{key:"setDimensions",value:function(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}},{key:"buildLabels",value:function(){var t=this,e=this.options.labels||{},n=Yk(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter((function(n){return e.filter(n,t.chart.data)}))),e.sort&&(n=n.sort((function(n,i){return e.sort(n,i,t.chart.data)}))),this.options.reverse&&n.reverse(),this.legendItems=n}},{key:"fit",value:function(){var t=this.options,e=this.ctx;if(t.display){var n,i,r=t.labels,a=WT(r.font),o=a.size,s=this._computeTitleHeight(),u=AP(r,o),l=u.boxWidth,c=u.itemHeight;e.font=a.string,this.isHorizontal()?(n=this.maxWidth,i=this._fitRows(s,o,l,c)+10):(i=this.maxHeight,n=this._fitCols(s,o,l,c)+10),this.width=Math.min(n,t.maxWidth||this.maxWidth),this.height=Math.min(i,t.maxHeight||this.maxHeight)}else this.width=this.height=0}},{key:"_fitRows",value:function(t,e,n,i){var r=this.ctx,a=this.maxWidth,o=this.options.labels.padding,s=this.legendHitBoxes=[],u=this.lineWidths=[0],l=i+o,c=t;r.textAlign="left",r.textBaseline="middle";var h=-1,p=-l;return this.legendItems.forEach((function(t,f){var d=n+e/2+r.measureText(t.text).width;(0===f||u[u.length-1]+d+2*o>a)&&(c+=l,u[u.length-(f>0?0:1)]=0,p+=l,h++),s[f]={left:0,top:p,row:h,width:d,height:i},u[u.length-1]+=d+o})),c}},{key:"_fitCols",value:function(t,e,n,i){var r=this.ctx,a=this.maxHeight,o=this.options.labels.padding,s=this.legendHitBoxes=[],u=this.columnSizes=[],l=a-t,c=o,h=0,p=0,f=0,d=0;return this.legendItems.forEach((function(t,a){var v=n+e/2+r.measureText(t.text).width;a>0&&p+i+2*o>l&&(c+=h+o,u.push({width:h,height:p}),f+=h+o,d++,h=p=0),s[a]={left:f,top:p,col:d,width:v,height:i},h=Math.max(h,v),p+=i+o})),c+=h,u.push({width:h,height:p}),c}},{key:"adjustHitBoxes",value:function(){if(this.options.display){var t=this._computeTitleHeight(),e=this.legendHitBoxes,n=this.options,i=n.align,r=n.labels.padding,a=jE(n.rtl,this.left,this.width);if(this.isHorizontal()){var o,s=0,u=jk(i,this.left+r,this.right-this.lineWidths[s]),l=wt(e);try{for(l.s();!(o=l.n()).done;){var c=o.value;s!==c.row&&(s=c.row,u=jk(i,this.left+r,this.right-this.lineWidths[s])),c.top+=this.top+t+r,c.left=a.leftForLtr(a.x(u),c.width),u+=c.width+r}}catch(Tx){l.e(Tx)}finally{l.f()}}else{var h,p=0,f=jk(i,this.top+t+r,this.bottom-this.columnSizes[p].height),d=wt(e);try{for(d.s();!(h=d.n()).done;){var v=h.value;v.col!==p&&(p=v.col,f=jk(i,this.top+t+r,this.bottom-this.columnSizes[p].height)),v.top=f,v.left+=this.left+r,v.left=a.leftForLtr(a.x(v.left),v.width),f+=v.height+r}}catch(Tx){d.e(Tx)}finally{d.f()}}}}},{key:"isHorizontal",value:function(){return"top"===this.options.position||"bottom"===this.options.position}},{key:"draw",value:function(){if(this.options.display){var t=this.ctx;AT(t,this),this._draw(),LT(t)}}},{key:"_draw",value:function(){var t,e=this,n=this.options,i=this.columnSizes,r=this.lineWidths,a=this.ctx,o=n.align,s=n.labels,u=kT.color,l=jE(n.rtl,this.left,this.width),c=WT(s.font),h=s.color,p=s.padding,f=c.size,d=f/2;this.drawTitle(),a.textAlign=l.textAlign("left"),a.textBaseline="middle",a.lineWidth=.5,a.font=c.string;var v=AP(s,f),m=v.boxWidth,g=v.boxHeight,y=v.itemHeight,_=this.isHorizontal(),b=this._computeTitleHeight();t=_?{x:jk(o,this.left+p,this.right-r[0]),y:this.top+p+b,line:0}:{x:this.left+p,y:jk(o,this.top+b+p,this.bottom-i[0].height),line:0},VE(this.ctx,n.textDirection);var x=y+p;this.legendItems.forEach((function(v,w){a.strokeStyle=v.fontColor||h,a.fillStyle=v.fontColor||h;var S=a.measureText(v.text).width,k=l.textAlign(v.textAlign||(v.textAlign=s.textAlign)),M=m+d+S,T=t.x,E=t.y;l.setWidth(e.width),_?w>0&&T+M+p>e.right&&(E=t.y+=x,t.line++,T=t.x=jk(o,e.left+p,e.right-r[t.line])):w>0&&E+x>e.bottom&&(T=t.x=T+i[t.line].width+p,t.line++,E=t.y=jk(o,e.top+b+p,e.bottom-i[t.line].height)),function(t,e,n){if(!(isNaN(m)||m<=0||isNaN(g)||g<0)){a.save();var i=Zk(n.lineWidth,1);if(a.fillStyle=Zk(n.fillStyle,u),a.lineCap=Zk(n.lineCap,"butt"),a.lineDashOffset=Zk(n.lineDashOffset,0),a.lineJoin=Zk(n.lineJoin,"miter"),a.lineWidth=i,a.strokeStyle=Zk(n.strokeStyle,u),a.setLineDash(Zk(n.lineDash,[])),s.usePointStyle){var r={radius:m*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:i},o=l.xPlus(t,m/2);IT(a,r,o,e+d)}else{var c=e+Math.max((f-g)/2,0),h=l.leftForLtr(t,m),p=HT(n.borderRadius);a.beginPath(),Object.values(p).some((function(t){return 0!==t}))?NT(a,{x:h,y:c,w:m,h:g,radius:p}):a.rect(h,c,m,g),a.fill(),0!==i&&a.stroke()}a.restore()}}(l.x(T),E,v),T=function(t,e,n,i){return t===(i?"left":"right")?n:"center"===t?(e+n)/2:e}(k,T+m+d,_?T+M:e.right,n.rtl),function(t,e,n){zT(a,n.text,t,e+y/2,c,{strikethrough:n.hidden,textAlign:l.textAlign(n.textAlign)})}(l.x(T),E,v),_?t.x+=M+p:t.y+=x})),UE(this.ctx,n.textDirection)}},{key:"drawTitle",value:function(){var t=this.options,e=t.title,n=WT(e.font),i=qT(e.padding);if(e.display){var r,a=jE(t.rtl,this.left,this.width),o=this.ctx,s=e.position,u=n.size/2,l=i.top+u,c=this.left,h=this.width;if(this.isHorizontal())h=Math.max.apply(Math,vt(this.lineWidths)),r=this.top+l,c=jk(t.align,c,this.right-h);else{var p=this.columnSizes.reduce((function(t,e){return Math.max(t,e.height)}),0);r=l+jk(t.align,this.top,this.bottom-p-t.labels.padding-this._computeTitleHeight())}var f=jk(s,c,c+h);o.textAlign=a.textAlign(Bk(s)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=n.string,zT(o,e.text,f,r,n)}}},{key:"_computeTitleHeight",value:function(){var t=this.options.title,e=WT(t.font),n=qT(t.padding);return t.display?e.lineHeight+n.height:0}},{key:"_getLegendItemAt",value:function(t,e){var n,i,r;if(RM(t,this.left,this.right)&&RM(e,this.top,this.bottom))for(r=this.legendHitBoxes,n=0;n<r.length;++n)if(RM(t,(i=r[n]).left,i.left+i.width)&&RM(e,i.top,i.top+i.height))return this.legendItems[n];return null}},{key:"handleEvent",value:function(t){var e=this.options;if(function(t,e){if("mousemove"===t&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e)){var n,i,r=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type){var a=this._hoveredItem,o=(i=r,null!==(n=a)&&null!==i&&n.datasetIndex===i.datasetIndex&&n.index===i.index);a&&!o&&Yk(e.onLeave,[t,a,this],this),this._hoveredItem=r,r&&!o&&Yk(e.onHover,[t,r,this],this)}else r&&Yk(e.onClick,[t,r,this],this)}}}]),n}(_I);var RP={id:"legend",_element:LP,start:function(t,e,n){var i=t.legend=new LP({ctx:t.ctx,options:n,chart:t});eI(t,i,n),QC(t,i)},stop:function(t){tI(t,t.legend),delete t.legend},beforeUpdate:function(t,e,n){var i=t.legend;eI(t,i,n),i.options=n},afterUpdate:function(t){var e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent:function(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick:function(t,e,n){var i=e.datasetIndex,r=n.chart;r.isDatasetVisible(i)?(r.hide(i),e.hidden=!0):(r.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:function(t){return t.chart.options.color},boxWidth:40,padding:10,generateLabels:function(t){var e=t.data.datasets,n=t.legend.options.labels,i=n.usePointStyle,r=n.pointStyle,a=n.textAlign,o=n.color;return t._getSortedDatasetMetas().map((function(t){var n=t.controller.getStyle(i?0:void 0),s=qT(n.borderWidth);return{text:e[t.index].label,fillStyle:n.backgroundColor,fontColor:o,hidden:!t.visible,lineCap:n.borderCapStyle,lineDash:n.borderDash,lineDashOffset:n.borderDashOffset,lineJoin:n.borderJoinStyle,lineWidth:(s.width+s.height)/4,strokeStyle:n.borderColor,pointStyle:r||n.pointStyle,rotation:n.rotation,textAlign:a||n.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:function(t){return t.chart.options.color},display:!1,position:"center",text:""}},descriptors:{_scriptable:function(t){return!t.startsWith("on")},labels:{_scriptable:function(t){return!["generateLabels","filter","sort"].includes(t)}}}},DP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).chart=t.chart,i.options=t.options,i.ctx=t.ctx,i._padding=void 0,i.top=void 0,i.bottom=void 0,i.left=void 0,i.right=void 0,i.width=void 0,i.height=void 0,i.position=void 0,i.weight=void 0,i.fullSize=void 0,i}return Ct(n,[{key:"update",value:function(t,e){var n=this.options;if(this.left=0,this.top=0,n.display){this.width=this.right=t,this.height=this.bottom=e;var i=Hk(n.text)?n.text.length:1;this._padding=qT(n.padding);var r=i*WT(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}else this.width=this.height=this.right=this.bottom=0}},{key:"isHorizontal",value:function(){var t=this.options.position;return"top"===t||"bottom"===t}},{key:"_drawArgs",value:function(t){var e,n,i,r=this.top,a=this.left,o=this.bottom,s=this.right,u=this.options,l=u.align,c=0;return this.isHorizontal()?(n=jk(l,a,s),i=r+t,e=s-a):("left"===u.position?(n=a+t,i=jk(l,o,r),c=-.5*hM):(n=s-t,i=jk(l,r,o),c=.5*hM),e=o-r),{titleX:n,titleY:i,maxWidth:e,rotation:c}}},{key:"draw",value:function(){var t=this.ctx,e=this.options;if(e.display){var n=WT(e.font),i=n.lineHeight/2+this._padding.top,r=this._drawArgs(i),a=r.titleX,o=r.titleY,s=r.maxWidth,u=r.rotation;zT(t,e.text,0,0,n,{color:e.color,maxWidth:s,rotation:u,textAlign:Bk(e.align),textBaseline:"middle",translation:[a,o]})}}}]),n}(_I);var zP={id:"title",_element:DP,start:function(t,e,n){!function(t,e){var n=new DP({ctx:t.ctx,options:e,chart:t});eI(t,n,e),QC(t,n),t.titleBlock=n}(t,n)},stop:function(t){var e=t.titleBlock;tI(t,e),delete t.titleBlock},beforeUpdate:function(t,e,n){var i=t.titleBlock;eI(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},OP=(new WeakMap,{average:function(t){if(!t.length)return!1;var e,n,i=0,r=0,a=0;for(e=0,n=t.length;e<n;++e){var o=t[e].element;if(o&&o.hasValue()){var s=o.tooltipPosition();i+=s.x,r+=s.y,++a}}return{x:i/a,y:r/a}},nearest:function(t,e){if(!t.length)return!1;var n,i,r,a=e.x,o=e.y,s=Number.POSITIVE_INFINITY;for(n=0,i=t.length;n<i;++n){var u=t[n].element;if(u&&u.hasValue()){var l=CM(e,u.getCenterPoint());l<s&&(s=l,r=u)}}if(r){var c=r.tooltipPosition();a=c.x,o=c.y}return{x:a,y:o}}});function FP(t,e){return e&&(Hk(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function NP(t){return("string"===typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function BP(t,e){var n=e.element,i=e.datasetIndex,r=e.index,a=t.getDatasetMeta(i).controller,o=a.getLabelAndValue(r),s=o.label,u=o.value;return{chart:t,label:s,parsed:a.getParsed(r),raw:t.data.datasets[i].data[r],formattedValue:u,dataset:a.getDataset(),dataIndex:r,datasetIndex:i,element:n}}function jP(t,e){var n=t._chart.ctx,i=t.body,r=t.footer,a=t.title,o=e.boxWidth,s=e.boxHeight,u=WT(e.bodyFont),l=WT(e.titleFont),c=WT(e.footerFont),h=a.length,p=r.length,f=i.length,d=qT(e.padding),v=d.height,m=0,g=i.reduce((function(t,e){return t+e.before.length+e.lines.length+e.after.length}),0);(g+=t.beforeBody.length+t.afterBody.length,h&&(v+=h*l.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),g)&&(v+=f*(e.displayColors?Math.max(s,u.lineHeight):u.lineHeight)+(g-f)*u.lineHeight+(g-1)*e.bodySpacing);p&&(v+=e.footerMarginTop+p*c.lineHeight+(p-1)*e.footerSpacing);var y=0,_=function(t){m=Math.max(m,n.measureText(t).width+y)};return n.save(),n.font=l.string,Kk(t.title,_),n.font=u.string,Kk(t.beforeBody.concat(t.afterBody),_),y=e.displayColors?o+2+e.boxPadding:0,Kk(i,(function(t){Kk(t.before,_),Kk(t.lines,_),Kk(t.after,_)})),y=0,n.font=c.string,Kk(t.footer,_),n.restore(),{width:m+=d.width,height:v}}function VP(t,e,n,i){var r=n.x,a=n.width,o=t.width,s=t.chartArea,u=s.left,l=s.right,c="center";return"center"===i?c=r<=(u+l)/2?"left":"right":r<=a/2?c="left":r>=o-a/2&&(c="right"),function(t,e,n,i){var r=i.x,a=i.width,o=n.caretSize+n.caretPadding;return"left"===t&&r+a+o>e.width||"right"===t&&r-a-o<0||void 0}(c,t,e,n)&&(c="center"),c}function UP(t,e,n){var i=e.yAlign||function(t,e){var n=e.y,i=e.height;return n<i/2?"top":n>t.height-i/2?"bottom":"center"}(t,n);return{xAlign:e.xAlign||VP(t,e,n,i),yAlign:i}}function $P(t,e,n,i){var r=t.caretSize,a=t.caretPadding,o=t.cornerRadius,s=n.xAlign,u=n.yAlign,l=r+a,c=HT(o),h=c.topLeft,p=c.topRight,f=c.bottomLeft,d=c.bottomRight,v=function(t,e){var n=t.x,i=t.width;return"right"===e?n-=i:"center"===e&&(n-=i/2),n}(e,s),m=function(t,e,n){var i=t.y,r=t.height;return"top"===e?i+=n:i-="bottom"===e?r+n:r/2,i}(e,u,l);return"center"===u?"left"===s?v+=l:"right"===s&&(v-=l):"left"===s?v-=Math.max(h,f)+r:"right"===s&&(v+=Math.max(p,d)+r),{x:LM(v,0,i.width-e.width),y:LM(m,0,i.height-e.height)}}function HP(t,e,n){var i=qT(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-i.right:t.x+i.left}function qP(t){return FP([],NP(t))}function WP(t,e){var n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}var GP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this)).opacity=0,i._active=[],i._chart=t._chart,i._eventPosition=void 0,i._size=void 0,i._cachedAnimations=void 0,i._tooltipItems=[],i.$animations=void 0,i.$context=void 0,i.options=t.options,i.dataPoints=void 0,i.title=void 0,i.beforeBody=void 0,i.body=void 0,i.afterBody=void 0,i.footer=void 0,i.xAlign=void 0,i.yAlign=void 0,i.x=void 0,i.y=void 0,i.height=void 0,i.width=void 0,i.caretX=void 0,i.caretY=void 0,i.labelColors=void 0,i.labelPointStyles=void 0,i.labelTextColors=void 0,i}return Ct(n,[{key:"initialize",value:function(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}},{key:"_resolveAnimations",value:function(){var t=this._cachedAnimations;if(t)return t;var e=this._chart,n=this.options.setContext(this.getContext()),i=n.enabled&&e.options.animation&&n.animations,r=new nC(this._chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}},{key:"getContext",value:function(){return this.$context||(this.$context=(t=this._chart.getContext(),e=this,n=this._tooltipItems,ZT(t,{tooltip:e,tooltipItems:n,type:"tooltip"})));var t,e,n}},{key:"getTitle",value:function(t,e){var n=e.callbacks,i=n.beforeTitle.apply(this,[t]),r=n.title.apply(this,[t]),a=n.afterTitle.apply(this,[t]),o=[];return o=FP(o,NP(i)),o=FP(o,NP(r)),o=FP(o,NP(a))}},{key:"getBeforeBody",value:function(t,e){return qP(e.callbacks.beforeBody.apply(this,[t]))}},{key:"getBody",value:function(t,e){var n=this,i=e.callbacks,r=[];return Kk(t,(function(t){var e={before:[],lines:[],after:[]},a=WP(i,t);FP(e.before,NP(a.beforeLabel.call(n,t))),FP(e.lines,a.label.call(n,t)),FP(e.after,NP(a.afterLabel.call(n,t))),r.push(e)})),r}},{key:"getAfterBody",value:function(t,e){return qP(e.callbacks.afterBody.apply(this,[t]))}},{key:"getFooter",value:function(t,e){var n=e.callbacks,i=n.beforeFooter.apply(this,[t]),r=n.footer.apply(this,[t]),a=n.afterFooter.apply(this,[t]),o=[];return o=FP(o,NP(i)),o=FP(o,NP(r)),o=FP(o,NP(a))}},{key:"_createItems",value:function(t){var e,n,i=this,r=this._active,a=this._chart.data,o=[],s=[],u=[],l=[];for(e=0,n=r.length;e<n;++e)l.push(BP(this._chart,r[e]));return t.filter&&(l=l.filter((function(e,n,i){return t.filter(e,n,i,a)}))),t.itemSort&&(l=l.sort((function(e,n){return t.itemSort(e,n,a)}))),Kk(l,(function(e){var n=WP(t.callbacks,e);o.push(n.labelColor.call(i,e)),s.push(n.labelPointStyle.call(i,e)),u.push(n.labelTextColor.call(i,e))})),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=u,this.dataPoints=l,l}},{key:"update",value:function(t,e){var n,i=this.options.setContext(this.getContext()),r=this._active,a=[];if(r.length){var o=OP[i.position].call(this,r,this._eventPosition);a=this._createItems(i),this.title=this.getTitle(a,i),this.beforeBody=this.getBeforeBody(a,i),this.body=this.getBody(a,i),this.afterBody=this.getAfterBody(a,i),this.footer=this.getFooter(a,i);var s=this._size=jP(this,i),u=Object.assign({},o,s),l=UP(this._chart,i,u),c=$P(i,u,l,this._chart);this.xAlign=l.xAlign,this.yAlign=l.yAlign,n={opacity:1,x:c.x,y:c.y,width:s.width,height:s.height,caretX:o.x,caretY:o.y}}else 0!==this.opacity&&(n={opacity:0});this._tooltipItems=a,this.$context=void 0,n&&this._resolveAnimations().update(this,n),t&&i.external&&i.external.call(this,{chart:this._chart,tooltip:this,replay:e})}},{key:"drawCaret",value:function(t,e,n,i){var r=this.getCaretPosition(t,n,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}},{key:"getCaretPosition",value:function(t,e,n){var i,r,a,o,s,u,l=this.xAlign,c=this.yAlign,h=n.caretSize,p=HT(n.cornerRadius),f=p.topLeft,d=p.topRight,v=p.bottomLeft,m=p.bottomRight,g=t.x,y=t.y,_=e.width,b=e.height;return"center"===c?(s=y+b/2,"left"===l?(r=(i=g)-h,o=s+h,u=s-h):(r=(i=g+_)+h,o=s-h,u=s+h),a=i):(r="left"===l?g+Math.max(f,v)+h:"right"===l?g+_-Math.max(d,m)-h:this.caretX,"top"===c?(s=(o=y)-h,i=r-h,a=r+h):(s=(o=y+b)+h,i=r+h,a=r-h),u=o),{x1:i,x2:r,x3:a,y1:o,y2:s,y3:u}}},{key:"drawTitle",value:function(t,e,n){var i,r,a,o=this.title,s=o.length;if(s){var u=jE(n.rtl,this.x,this.width);for(t.x=HP(this,n.titleAlign,n),e.textAlign=u.textAlign(n.titleAlign),e.textBaseline="middle",i=WT(n.titleFont),r=n.titleSpacing,e.fillStyle=n.titleColor,e.font=i.string,a=0;a<s;++a)e.fillText(o[a],u.x(t.x),t.y+i.lineHeight/2),t.y+=i.lineHeight+r,a+1===s&&(t.y+=n.titleMarginBottom-r)}}},{key:"_drawColorBox",value:function(t,e,n,i,r){var a=this.labelColors[n],o=this.labelPointStyles[n],s=r.boxHeight,u=r.boxWidth,l=r.boxPadding,c=WT(r.bodyFont),h=HP(this,"left",r),p=i.x(h),f=s<c.lineHeight?(c.lineHeight-s)/2:0,d=e.y+f;if(r.usePointStyle){var v={radius:Math.min(u,s)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},m=i.leftForLtr(p,u)+u/2,g=d+s/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,IT(t,v,m,g),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,IT(t,v,m,g)}else{t.lineWidth=a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;var y=i.leftForLtr(p,u-l),_=i.leftForLtr(i.xPlus(p,1),u-l-2),b=HT(a.borderRadius);Object.values(b).some((function(t){return 0!==t}))?(t.beginPath(),t.fillStyle=r.multiKeyBackground,NT(t,{x:y,y:d,w:u,h:s,radius:b}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),NT(t,{x:_,y:d+1,w:u-2,h:s-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(y,d,u,s),t.strokeRect(y,d,u,s),t.fillStyle=a.backgroundColor,t.fillRect(_,d+1,u-2,s-2))}t.fillStyle=this.labelTextColors[n]}},{key:"drawBody",value:function(t,e,n){var i,r,a,o,s,u,l,c=this.body,h=n.bodySpacing,p=n.bodyAlign,f=n.displayColors,d=n.boxHeight,v=n.boxWidth,m=n.boxPadding,g=WT(n.bodyFont),y=g.lineHeight,_=0,b=jE(n.rtl,this.x,this.width),x=function(n){e.fillText(n,b.x(t.x+_),t.y+y/2),t.y+=y+h},w=b.textAlign(p);for(e.textAlign=p,e.textBaseline="middle",e.font=g.string,t.x=HP(this,w,n),e.fillStyle=n.bodyColor,Kk(this.beforeBody,x),_=f&&"right"!==w?"center"===p?v/2+m:v+2+m:0,o=0,u=c.length;o<u;++o){for(i=c[o],r=this.labelTextColors[o],e.fillStyle=r,Kk(i.before,x),a=i.lines,f&&a.length&&(this._drawColorBox(e,t,o,b,n),y=Math.max(g.lineHeight,d)),s=0,l=a.length;s<l;++s)x(a[s]),y=g.lineHeight;Kk(i.after,x)}_=0,y=g.lineHeight,Kk(this.afterBody,x),t.y-=h}},{key:"drawFooter",value:function(t,e,n){var i,r,a=this.footer,o=a.length;if(o){var s=jE(n.rtl,this.x,this.width);for(t.x=HP(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=s.textAlign(n.footerAlign),e.textBaseline="middle",i=WT(n.footerFont),e.fillStyle=n.footerColor,e.font=i.string,r=0;r<o;++r)e.fillText(a[r],s.x(t.x),t.y+i.lineHeight/2),t.y+=i.lineHeight+n.footerSpacing}}},{key:"drawBackground",value:function(t,e,n,i){var r=this.xAlign,a=this.yAlign,o=t.x,s=t.y,u=n.width,l=n.height,c=HT(i.cornerRadius),h=c.topLeft,p=c.topRight,f=c.bottomLeft,d=c.bottomRight;e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(o+h,s),"top"===a&&this.drawCaret(t,e,n,i),e.lineTo(o+u-p,s),e.quadraticCurveTo(o+u,s,o+u,s+p),"center"===a&&"right"===r&&this.drawCaret(t,e,n,i),e.lineTo(o+u,s+l-d),e.quadraticCurveTo(o+u,s+l,o+u-d,s+l),"bottom"===a&&this.drawCaret(t,e,n,i),e.lineTo(o+f,s+l),e.quadraticCurveTo(o,s+l,o,s+l-f),"center"===a&&"left"===r&&this.drawCaret(t,e,n,i),e.lineTo(o,s+h),e.quadraticCurveTo(o,s,o+h,s),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}},{key:"_updateAnimationTarget",value:function(t){var e=this._chart,n=this.$animations,i=n&&n.x,r=n&&n.y;if(i||r){var a=OP[t.position].call(this,this._active,this._eventPosition);if(!a)return;var o=this._size=jP(this,t),s=Object.assign({},a,this._size),u=UP(e,t,s),l=$P(t,s,u,e);i._to===l.x&&r._to===l.y||(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,l))}}},{key:"draw",value:function(t){var e=this.options.setContext(this.getContext()),n=this.opacity;if(n){this._updateAnimationTarget(e);var i={width:this.width,height:this.height},r={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;var a=qT(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(r,t,i,e),VE(t,e.textDirection),r.y+=a.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),UE(t,e.textDirection),t.restore())}}},{key:"getActiveElements",value:function(){return this._active||[]}},{key:"setActiveElements",value:function(t,e){var n=this,i=this._active,r=t.map((function(t){var e=t.datasetIndex,i=t.index,r=n._chart.getDatasetMeta(e);if(!r)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:r.data[i],index:i}})),a=!Jk(i,r),o=this._positionChanged(r,e);(a||o)&&(this._active=r,this._eventPosition=e,this.update(!0))}},{key:"handleEvent",value:function(t,e){var n,i=this.options,r=this._active||[],a=[];"mouseout"!==t.type&&(a=this._chart.getElementsAtEventForMode(t,i.mode,i,e),i.reverse&&a.reverse());var o=this._positionChanged(a,t);return(n=e||!Jk(a,r)||o)&&(this._active=a,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),n}},{key:"_positionChanged",value:function(t,e){var n=this.caretX,i=this.caretY,r=this.options,a=OP[r.position].call(this,t,e);return!1!==a&&(n!==a.x||i!==a.y)}}]),n}(_I);GP.positioners=OP;var ZP={id:"tooltip",_element:GP,positioners:OP,afterInit:function(t,e,n){n&&(t.tooltip=new GP({_chart:t,options:n}))},beforeUpdate:function(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset:function(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw:function(t){var e=t.tooltip,n={tooltip:e};!1!==t.notifyPlugins("beforeTooltipDraw",n)&&(e&&e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n))},afterEvent:function(t,e){if(t.tooltip){var n=e.replay;t.tooltip.handleEvent(e.event,n)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:function(t,e){return e.bodyFont.size},boxWidth:function(t,e){return e.bodyFont.size},multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Vk,title:function(t){if(t.length>0){var e=t[0],n=e.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return n[e.dataIndex]}return""},afterTitle:Vk,beforeBody:Vk,beforeLabel:Vk,label:function(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;var e=t.dataset.label||"";e&&(e+=": ");var n=t.formattedValue;return $k(n)||(e+=n),e},labelColor:function(t){var e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor:function(){return this.options.bodyColor},labelPointStyle:function(t){var e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Vk,afterBody:Vk,beforeFooter:Vk,footer:Vk,afterFooter:Vk}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:function(t){return"filter"!==t&&"itemSort"!==t&&"external"!==t},_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function XP(t,e,n,i){var r=t.indexOf(e);return-1===r?function(t,e,n,i){return"string"===typeof e?(n=t.push(e)-1,i.unshift({index:n,label:e})):isNaN(e)&&(n=null),n}(t,e,n,i):r!==t.lastIndexOf(e)?n:r}var YP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._startValue=void 0,i._valueRange=0,i._addedLabels=[],i}return Ct(n,[{key:"init",value:function(t){var e=this._addedLabels;if(e.length){var i,r=this.getLabels(),a=wt(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o.index,u=o.label;r[s]===u&&r.splice(s,1)}}catch(Tx){a.e(Tx)}finally{a.f()}this._addedLabels=[]}xt(mt(n.prototype),"init",this).call(this,t)}},{key:"parse",value:function(t,e){if($k(t))return null;var n=this.getLabels();return function(t,e){return null===t?null:LM(Math.round(t),0,e)}(e=isFinite(e)&&n[e]===t?e:XP(n,t,Zk(e,t),this._addedLabels),n.length-1)}},{key:"determineDataLimits",value:function(){var t=this.getUserBounds(),e=t.minDefined,n=t.maxDefined,i=this.getMinMax(!0),r=i.min,a=i.max;"ticks"===this.options.bounds&&(e||(r=0),n||(a=this.getLabels().length-1)),this.min=r,this.max=a}},{key:"buildTicks",value:function(){var t=this.min,e=this.max,n=this.options.offset,i=[],r=this.getLabels();r=0===t&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(var a=t;a<=e;a++)i.push({value:a});return i}},{key:"getLabelForValue",value:function(t){var e=this.getLabels();return t>=0&&t<e.length?e[t]:t}},{key:"configure",value:function(){xt(mt(n.prototype),"configure",this).call(this),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}},{key:"getPixelForValue",value:function(t){return"number"!==typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}},{key:"getPixelForTick",value:function(t){var e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}},{key:"getValueForPixel",value:function(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}},{key:"getBasePixel",value:function(){return this.bottom}}]),n}(PI);function KP(t,e){var n,i,r,a,o=[],s=t.bounds,u=t.step,l=t.min,c=t.max,h=t.precision,p=t.count,f=t.maxTicks,d=t.maxDigits,v=t.includeBounds,m=u||1,g=f-1,y=e.min,_=e.max,b=!$k(l),x=!$k(c),w=!$k(p),S=(_-y)/(d+1),k=xM((_-y)/g/m)*m;if(k<1e-14&&!b&&!x)return[{value:y},{value:_}];(a=Math.ceil(_/k)-Math.floor(y/k))>g&&(k=xM(a*k/g/m)*m),$k(h)||(n=Math.pow(10,h),k=Math.ceil(k*n)/n),"ticks"===s?(i=Math.floor(y/k)*k,r=Math.ceil(_/k)*k):(i=y,r=_),b&&x&&u&&function(t,e){var n=Math.round(t);return n-e<=t&&n+e>=t}((c-l)/u,k/1e3)?(k=(c-l)/(a=Math.round(Math.min((c-l)/k,f))),i=l,r=c):w?k=((r=x?c:r)-(i=b?l:i))/(a=p-1):a=SM(a=(r-i)/k,Math.round(a),k/1e3)?Math.round(a):Math.ceil(a);var M=Math.max(EM(k),EM(i));n=Math.pow(10,$k(h)?M:h),i=Math.round(i*n)/n,r=Math.round(r*n)/n;var T=0;for(b&&(v&&i!==l?(o.push({value:l}),i<l&&T++,SM(Math.round((i+T*k)*n)/n,l,JP(l,S,t))&&T++):i<l&&T++);T<a;++T)o.push({value:Math.round((i+T*k)*n)/n});return x&&v&&r!==c?o.length&&SM(o[o.length-1].value,c,JP(c,S,t))?o[o.length-1].value=c:o.push({value:c}):x&&r!==c||o.push({value:r}),o}function JP(t,e,n){var i=n.horizontal,r=MM(n.minRotation),a=(i?Math.sin(r):Math.cos(r))||.001,o=.75*e*(""+t).length;return Math.min(e/a,o)}YP.id="category",YP.defaults={ticks:{callback:YP.prototype.getLabelForValue}};var QP=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t)).start=void 0,i.end=void 0,i._startValue=void 0,i._endValue=void 0,i._valueRange=0,i}return Ct(n,[{key:"parse",value:function(t,e){return $k(t)||("number"===typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}},{key:"handleTickRangeOptions",value:function(){var t=this.options.beginAtZero,e=this.getUserBounds(),n=e.minDefined,i=e.maxDefined,r=this.min,a=this.max,o=function(t){return r=n?r:t},s=function(t){return a=i?a:t};if(t){var u=bM(r),l=bM(a);u<0&&l<0?s(0):u>0&&l>0&&o(0)}if(r===a){var c=1;(a>=Number.MAX_SAFE_INTEGER||r<=Number.MIN_SAFE_INTEGER)&&(c=Math.abs(.05*a)),s(a+c),t||o(r-c)}this.min=r,this.max=a}},{key:"getTickLimit",value:function(){var t,e=this.options.ticks,n=e.maxTicksLimit,i=e.stepSize;return i?(t=Math.ceil(this.max/i)-Math.floor(this.min/i)+1)>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(t," ticks. Limiting to 1000.")),t=1e3):(t=this.computeTickLimit(),n=n||11),n&&(t=Math.min(n,t)),t}},{key:"computeTickLimit",value:function(){return Number.POSITIVE_INFINITY}},{key:"buildTicks",value:function(){var t=this.options,e=t.ticks,n=this.getTickLimit(),i=KP({maxTicks:n=Math.max(2,n),bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&kM(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}},{key:"configure",value:function(){var t=this.ticks,e=this.min,i=this.max;if(xt(mt(n.prototype),"configure",this).call(this),this.options.offset&&t.length){var r=(i-e)/Math.max(t.length-1,1)/2;e-=r,i+=r}this._startValue=e,this._endValue=i,this._valueRange=i-e}},{key:"getLabelForValue",value:function(t){return BE(t,this.chart.options.locale,this.options.ticks.format)}}]),n}(PI),tA=function(t){kt(n,t);var e=Mt(n);function n(){return Tt(this,n),e.apply(this,arguments)}return Ct(n,[{key:"determineDataLimits",value:function(){var t=this.getMinMax(!0),e=t.min,n=t.max;this.min=Wk(e)?e:0,this.max=Wk(n)?n:1,this.handleTickRangeOptions()}},{key:"computeTickLimit",value:function(){var t=this.isHorizontal(),e=t?this.width:this.height,n=MM(this.options.ticks.minRotation),i=(t?Math.sin(n):Math.cos(n))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}},{key:"getPixelForValue",value:function(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}},{key:"getValueForPixel",value:function(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}]),n}(QP);function eA(t){return 1===t/Math.pow(10,Math.floor(_M(t)))}tA.id="linear",tA.defaults={ticks:{callback:xI.formatters.numeric}};var nA=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t)).start=void 0,i.end=void 0,i._startValue=void 0,i._valueRange=0,i}return Ct(n,[{key:"parse",value:function(t,e){var n=QP.prototype.parse.apply(this,[t,e]);if(0!==n)return Wk(n)&&n>0?n:null;this._zero=!0}},{key:"determineDataLimits",value:function(){var t=this.getMinMax(!0),e=t.min,n=t.max;this.min=Wk(e)?Math.max(0,e):null,this.max=Wk(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}},{key:"handleTickRangeOptions",value:function(){var t=this.getUserBounds(),e=t.minDefined,n=t.maxDefined,i=this.min,r=this.max,a=function(t){return i=e?i:t},o=function(t){return r=n?r:t},s=function(t,e){return Math.pow(10,Math.floor(_M(t))+e)};i===r&&(i<=0?(a(1),o(10)):(a(s(i,-1)),o(s(r,1)))),i<=0&&a(s(r,-1)),r<=0&&o(s(i,1)),this._zero&&this.min!==this._suggestedMin&&i===s(this.min,0)&&a(s(i,-1)),this.min=i,this.max=r}},{key:"buildTicks",value:function(){var t=this.options,e=function(t,e){var n=Math.floor(_M(e.max)),i=Math.ceil(e.max/Math.pow(10,n)),r=[],a=Gk(t.min,Math.pow(10,Math.floor(_M(e.min)))),o=Math.floor(_M(a)),s=Math.floor(a/Math.pow(10,o)),u=o<0?Math.pow(10,Math.abs(o)):1;do{r.push({value:a,major:eA(a)}),10===++s&&(s=1,u=++o>=0?1:u),a=Math.round(s*Math.pow(10,o)*u)/u}while(o<n||o===n&&s<i);var l=Gk(t.max,a);return r.push({value:l,major:eA(a)}),r}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&kM(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}},{key:"getLabelForValue",value:function(t){return void 0===t?"0":BE(t,this.chart.options.locale,this.options.ticks.format)}},{key:"configure",value:function(){var t=this.min;xt(mt(n.prototype),"configure",this).call(this),this._startValue=_M(t),this._valueRange=_M(this.max)-_M(t)}},{key:"getPixelForValue",value:function(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(_M(t)-this._startValue)/this._valueRange)}},{key:"getValueForPixel",value:function(t){var e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}]),n}(PI);function iA(t){var e=t.ticks;if(e.display&&t.display){var n=qT(e.backdropPadding);return Zk(e.font&&e.font.size,kT.font.size)+n.height}return 0}function rA(t,e,n,i,r){return t===i||t===r?{start:e-n/2,end:e+n/2}:t<i||t>r?{start:e-n,end:e}:{start:e,end:e+n}}function aA(t){for(var e,n,i,r={l:0,r:t.width,t:0,b:t.height-t.paddingTop},a={},o=[],s=[],u=t.getLabels().length,l=0;l<u;l++){var c=t.options.pointLabels.setContext(t.getPointLabelContext(l));s[l]=c.padding;var h=t.getPointPosition(l,t.drawingArea+s[l]),p=WT(c.font),f=(e=t.ctx,n=p,i=Hk(i=t._pointLabels[l])?i:[i],{w:TT(e,n.string,i),h:i.length*n.lineHeight});o[l]=f;var d=t.getIndexAngle(l),v=TM(d),m=rA(v,h.x,f.w,0,180),g=rA(v,h.y,f.h,90,270);m.start<r.l&&(r.l=m.start,a.l=d),m.end>r.r&&(r.r=m.end,a.r=d),g.start<r.t&&(r.t=g.start,a.t=d),g.end>r.b&&(r.b=g.end,a.b=d)}t._setReductions(t.drawingArea,r,a),t._pointLabelItems=function(t,e,n){for(var i=[],r=t.getLabels().length,a=t.options,o=iA(a),s=t.getDistanceFromCenterForValue(a.ticks.reverse?t.min:t.max),u=0;u<r;u++){var l=0===u?o/2:0,c=t.getPointPosition(u,s+l+n[u]),h=TM(t.getIndexAngle(u)),p=e[u],f=uA(c.y,p.h,h),d=oA(h),v=sA(c.x,p.w,d);i.push({x:c.x,y:f,textAlign:d,left:v,top:f,right:v+p.w,bottom:f+p.h})}return i}(t,o,s)}function oA(t){return 0===t||180===t?"center":t<180?"left":"right"}function sA(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function uA(t,e,n){return 90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e),t}function lA(t,e,n,i){var r=t.ctx;if(n)r.arc(t.xCenter,t.yCenter,e,0,pM);else{var a=t.getPointPosition(0,e);r.moveTo(a.x,a.y);for(var o=1;o<i;o++)a=t.getPointPosition(o,e),r.lineTo(a.x,a.y)}}function cA(t){return wM(t)?t:0}nA.id="logarithmic",nA.defaults={ticks:{callback:xI.formatters.logarithmic,major:{enabled:!0}}};var hA=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t)).xCenter=void 0,i.yCenter=void 0,i.drawingArea=void 0,i._pointLabels=[],i._pointLabelItems=[],i}return Ct(n,[{key:"setDimensions",value:function(){this.width=this.maxWidth,this.height=this.maxHeight,this.paddingTop=iA(this.options)/2,this.xCenter=Math.floor(this.width/2),this.yCenter=Math.floor((this.height-this.paddingTop)/2),this.drawingArea=Math.min(this.height-this.paddingTop,this.width)/2}},{key:"determineDataLimits",value:function(){var t=this.getMinMax(!1),e=t.min,n=t.max;this.min=Wk(e)&&!isNaN(e)?e:0,this.max=Wk(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}},{key:"computeTickLimit",value:function(){return Math.ceil(this.drawingArea/iA(this.options))}},{key:"generateTickLabels",value:function(t){var e=this;QP.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((function(t,n){var i=Yk(e.options.pointLabels.callback,[t,n],e);return i||0===i?i:""}))}},{key:"fit",value:function(){var t=this.options;t.display&&t.pointLabels.display?aA(this):this.setCenterPoint(0,0,0,0)}},{key:"_setReductions",value:function(t,e,n){var i=e.l/Math.sin(n.l),r=Math.max(e.r-this.width,0)/Math.sin(n.r),a=-e.t/Math.cos(n.t),o=-Math.max(e.b-(this.height-this.paddingTop),0)/Math.cos(n.b);i=cA(i),r=cA(r),a=cA(a),o=cA(o),this.drawingArea=Math.max(t/2,Math.min(Math.floor(t-(i+r)/2),Math.floor(t-(a+o)/2))),this.setCenterPoint(i,r,a,o)}},{key:"setCenterPoint",value:function(t,e,n,i){var r=this.width-e-this.drawingArea,a=t+this.drawingArea,o=n+this.drawingArea,s=this.height-this.paddingTop-i-this.drawingArea;this.xCenter=Math.floor((a+r)/2+this.left),this.yCenter=Math.floor((o+s)/2+this.top+this.paddingTop)}},{key:"getIndexAngle",value:function(t){return PM(t*(pM/this.getLabels().length)+MM(this.options.startAngle||0))}},{key:"getDistanceFromCenterForValue",value:function(t){if($k(t))return NaN;var e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}},{key:"getValueForDistanceFromCenter",value:function(t){if($k(t))return NaN;var e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}},{key:"getPointLabelContext",value:function(t){var e=this._pointLabels||[];if(t>=0&&t<e.length){var n=e[t];return function(t,e,n){return ZT(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}},{key:"getPointPosition",value:function(t,e){var n=this.getIndexAngle(t)-mM;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}},{key:"getPointPositionForValue",value:function(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}},{key:"getBasePosition",value:function(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}},{key:"getPointLabelPosition",value:function(t){var e=this._pointLabelItems[t];return{left:e.left,top:e.top,right:e.right,bottom:e.bottom}}},{key:"drawBackground",value:function(){var t=this.options,e=t.backgroundColor,n=t.grid.circular;if(e){var i=this.ctx;i.save(),i.beginPath(),lA(this,this.getDistanceFromCenterForValue(this._endValue),n,this.getLabels().length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}},{key:"drawGrid",value:function(){var t,e,n,i=this,r=this.ctx,a=this.options,o=a.angleLines,s=a.grid,u=this.getLabels().length;if(a.pointLabels.display&&function(t,e){for(var n=t.ctx,i=t.options.pointLabels,r=e-1;r>=0;r--){var a=i.setContext(t.getPointLabelContext(r)),o=WT(a.font),s=t._pointLabelItems[r],u=s.x,l=s.y,c=s.textAlign,h=s.left,p=s.top,f=s.right,d=s.bottom,v=a.backdropColor;if(!$k(v)){var m=qT(a.backdropPadding);n.fillStyle=v,n.fillRect(h-m.left,p-m.top,f-h+m.width,d-p+m.height)}zT(n,t._pointLabels[r],u,l+o.lineHeight/2,o,{color:a.color,textAlign:c,textBaseline:"middle"})}}(this,u),s.display&&this.ticks.forEach((function(t,n){if(0!==n){e=i.getDistanceFromCenterForValue(t.value);var r=s.setContext(i.getContext(n-1));!function(t,e,n,i){var r=t.ctx,a=e.circular,o=e.color,s=e.lineWidth;!a&&!i||!o||!s||n<0||(r.save(),r.strokeStyle=o,r.lineWidth=s,r.setLineDash(e.borderDash),r.lineDashOffset=e.borderDashOffset,r.beginPath(),lA(t,n,a,i),r.closePath(),r.stroke(),r.restore())}(i,r,e,u)}})),o.display){for(r.save(),t=this.getLabels().length-1;t>=0;t--){var l=o.setContext(this.getPointLabelContext(t)),c=l.color,h=l.lineWidth;h&&c&&(r.lineWidth=h,r.strokeStyle=c,r.setLineDash(l.borderDash),r.lineDashOffset=l.borderDashOffset,e=this.getDistanceFromCenterForValue(a.ticks.reverse?this.min:this.max),n=this.getPointPosition(t,e),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(n.x,n.y),r.stroke())}r.restore()}}},{key:"drawBorder",value:function(){}},{key:"drawLabels",value:function(){var t=this,e=this.ctx,n=this.options,i=n.ticks;if(i.display){var r,a,o=this.getIndexAngle(0);e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(o),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((function(o,s){if(0!==s||n.reverse){var u=i.setContext(t.getContext(s)),l=WT(u.font);if(r=t.getDistanceFromCenterForValue(t.ticks[s].value),u.showLabelBackdrop){e.font=l.string,a=e.measureText(o.label).width,e.fillStyle=u.backdropColor;var c=qT(u.backdropPadding);e.fillRect(-a/2-c.left,-r-l.size/2-c.top,a+c.width,l.size+c.height)}zT(e,o.label,0,-r,l,{color:u.color})}})),e.restore()}}},{key:"drawTitle",value:function(){}}]),n}(QP);hA.id="radialLinear",hA.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:xI.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:function(t){return t},padding:5}},hA.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},hA.descriptors={angleLines:{_fallback:"grid"}};var pA={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},fA=Object.keys(pA);function dA(t,e){return t-e}function vA(t,e){if($k(e))return null;var n=t._adapter,i=t._parseOpts,r=i.parser,a=i.round,o=i.isoWeekday,s=e;return"function"===typeof r&&(s=r(s)),Wk(s)||(s="string"===typeof r?n.parse(s,r):n.parse(s)),null===s?null:(a&&(s="week"!==a||!wM(o)&&!0!==o?n.startOf(s,a):n.startOf(s,"isoWeek",o)),+s)}function mA(t,e,n,i){for(var r=fA.length,a=fA.indexOf(t);a<r-1;++a){var o=pA[fA[a]],s=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((n-e)/(s*o.size))<=i)return fA[a]}return fA[r-1]}function gA(t,e,n){if(n){if(n.length){var i=XT(n,e),r=i.lo,a=i.hi;t[n[r]>=e?n[r]:n[a]]=!0}}else t[e]=!0}function yA(t,e,n){var i,r,a=[],o={},s=e.length;for(i=0;i<s;++i)o[r=e[i]]=i,a.push({value:r,major:!1});return 0!==s&&n?function(t,e,n,i){var r,a,o=t._adapter,s=+o.startOf(e[0].value,i),u=e[e.length-1].value;for(r=s;r<=u;r=+o.add(r,1,i))(a=n[r])>=0&&(e[a].major=!0);return e}(t,a,o,n):a}var _A=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._cache={data:[],labels:[],all:[]},i._unit="day",i._majorUnit=void 0,i._offsets={},i._normalized=!1,i._parseOpts=void 0,i}return Ct(n,[{key:"init",value:function(t,e){var i=t.time||(t.time={}),r=this._adapter=new RC._date(t.adapters.date);iM(i.displayFormats,r.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},xt(mt(n.prototype),"init",this).call(this,t),this._normalized=e.normalized}},{key:"parse",value:function(t,e){return void 0===t?null:vA(this,t)}},{key:"beforeLayout",value:function(){xt(mt(n.prototype),"beforeLayout",this).call(this),this._cache={data:[],labels:[],all:[]}}},{key:"determineDataLimits",value:function(){var t=this.options,e=this._adapter,n=t.time.unit||"day",i=this.getUserBounds(),r=i.min,a=i.max,o=i.minDefined,s=i.maxDefined;function u(t){o||isNaN(t.min)||(r=Math.min(r,t.min)),s||isNaN(t.max)||(a=Math.max(a,t.max))}o&&s||(u(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||u(this.getMinMax(!1))),r=Wk(r)&&!isNaN(r)?r:+e.startOf(Date.now(),n),a=Wk(a)&&!isNaN(a)?a:+e.endOf(Date.now(),n)+1,this.min=Math.min(r,a-1),this.max=Math.max(r+1,a)}},{key:"_getLabelBounds",value:function(){var t=this.getLabelTimestamps(),e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}},{key:"buildTicks",value:function(){var t=this.options,e=t.time,n=t.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);var r=this.min,a=function(t,e,n){for(var i=0,r=t.length;i<r&&t[i]<e;)i++;for(;r>i&&t[r-1]>n;)r--;return i>0||r<t.length?t.slice(i,r):t}(i,r,this.max);return this._unit=e.unit||(n.autoSkip?mA(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(t,e,n,i,r){for(var a=fA.length-1;a>=fA.indexOf(n);a--){var o=fA[a];if(pA[o].common&&t._adapter.diff(r,i,o)>=e-1)return o}return fA[n?fA.indexOf(n):0]}(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(var e=fA.indexOf(t)+1,n=fA.length;e<n;++e)if(pA[fA[e]].common)return fA[e]}(this._unit):void 0,this.initOffsets(i),t.reverse&&a.reverse(),yA(this,a,this._majorUnit)}},{key:"initOffsets",value:function(t){var e,n,i=0,r=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),i=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,n=this.getDecimalForValue(t[t.length-1]),r=1===t.length?n:(n-this.getDecimalForValue(t[t.length-2]))/2);var a=t.length<3?.5:.25;i=LM(i,0,a),r=LM(r,0,a),this._offsets={start:i,end:r,factor:1/(i+1+r)}}},{key:"_generate",value:function(){var t,e,n=this._adapter,i=this.min,r=this.max,a=this.options,o=a.time,s=o.unit||mA(o.minUnit,i,r,this._getLabelCapacity(i)),u=Zk(o.stepSize,1),l="week"===s&&o.isoWeekday,c=wM(l)||!0===l,h={},p=i;if(c&&(p=+n.startOf(p,"isoWeek",l)),p=+n.startOf(p,c?"day":s),n.diff(r,i,s)>1e5*u)throw new Error(i+" and "+r+" are too far apart with stepSize of "+u+" "+s);var f="data"===a.ticks.source&&this.getDataTimestamps();for(t=p,e=0;t<r;t=+n.add(t,u,s),e++)gA(h,t,f);return t!==r&&"ticks"!==a.bounds&&1!==e||gA(h,t,f),Object.keys(h).sort((function(t,e){return t-e})).map((function(t){return+t}))}},{key:"getLabelForValue",value:function(t){var e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}},{key:"_tickFormatFunction",value:function(t,e,n,i){var r=this.options,a=r.time.displayFormats,o=this._unit,s=this._majorUnit,u=o&&a[o],l=s&&a[s],c=n[e],h=s&&l&&c&&c.major,p=this._adapter.format(t,i||(h?l:u)),f=r.ticks.callback;return f?Yk(f,[p,e,n],this):p}},{key:"generateTickLabels",value:function(t){var e,n,i;for(e=0,n=t.length;e<n;++e)(i=t[e]).label=this._tickFormatFunction(i.value,e,t)}},{key:"getDecimalForValue",value:function(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}},{key:"getPixelForValue",value:function(t){var e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}},{key:"getValueForPixel",value:function(t){var e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}},{key:"_getLabelSize",value:function(t){var e=this.options.ticks,n=this.ctx.measureText(t).width,i=MM(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),a=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:n*r+o*a,h:n*a+o*r}}},{key:"_getLabelCapacity",value:function(t){var e=this.options.time,n=e.displayFormats,i=n[e.unit]||n.millisecond,r=this._tickFormatFunction(t,0,yA(this,[t],this._majorUnit),i),a=this._getLabelSize(r),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}},{key:"getDataTimestamps",value:function(){var t,e,n=this._cache.data||[];if(n.length)return n;var i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,e=i.length;t<e;++t)n=n.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}},{key:"getLabelTimestamps",value:function(){var t,e,n=this._cache.labels||[];if(n.length)return n;var i=this.getLabels();for(t=0,e=i.length;t<e;++t)n.push(vA(this,i[t]));return this._cache.labels=this._normalized?n:this.normalize(n)}},{key:"normalize",value:function(t){return tE(t.sort(dA))}}]),n}(PI);function bA(t,e,n){var i,r,a,o,s=0,u=t.length-1;if(n){if(e>=t[s].pos&&e<=t[u].pos){var l=YT(t,"pos",e);s=l.lo,u=l.hi}var c=t[s];i=c.pos,a=c.time;var h=t[u];r=h.pos,o=h.time}else{if(e>=t[s].time&&e<=t[u].time){var p=YT(t,"time",e);s=p.lo,u=p.hi}var f=t[s];i=f.time,a=f.pos;var d=t[u];r=d.time,o=d.pos}var v=r-i;return v?a+(o-a)*(e-i)/v:a}_A.id="time",_A.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};var xA=function(t){kt(n,t);var e=Mt(n);function n(t){var i;return Tt(this,n),(i=e.call(this,t))._table=[],i._minPos=void 0,i._tableRange=void 0,i}return Ct(n,[{key:"initOffsets",value:function(){var t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=bA(e,this.min),this._tableRange=bA(e,this.max)-this._minPos,xt(mt(n.prototype),"initOffsets",this).call(this,t)}},{key:"buildLookupTable",value:function(t){var e,n,i,r,a,o=this.min,s=this.max,u=[],l=[];for(e=0,n=t.length;e<n;++e)(r=t[e])>=o&&r<=s&&u.push(r);if(u.length<2)return[{time:o,pos:0},{time:s,pos:1}];for(e=0,n=u.length;e<n;++e)a=u[e+1],i=u[e-1],r=u[e],Math.round((a+i)/2)!==r&&l.push({time:r,pos:e/(n-1)});return l}},{key:"_getTimestampsForTable",value:function(){var t=this._cache.all||[];if(t.length)return t;var e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t}},{key:"getDecimalForValue",value:function(t){return(bA(this._table,t)-this._minPos)/this._tableRange}},{key:"getValueForPixel",value:function(t){var e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return bA(this._table,n*this._tableRange+this._minPos,!0)}}]),n}(_A);xA.id="timeseries",xA.defaults=_A.defaults;var wA=["height","width","redraw","datasetIdKey","type","data","options","plugins","fallbackContent"],SA="label";function kA(t,e){"function"===typeof t?t(e):t&&(t.current=e)}function MA(t,e){t.labels=e}function TA(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:SA,i=[];t.datasets=e.map((function(e){var r=t.datasets.find((function(t){return t[n]===e[n]}));return r&&e.data&&!i.includes(r)?(i.push(r),Object.assign(r,e),r):Ok({},e)}))}function EA(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:SA,n={labels:[],datasets:[]};return MA(n,t.labels),TA(n,t.datasets,e),n}function CA(e,n){var i=e.height,r=void 0===i?150:i,a=e.width,o=void 0===a?300:a,s=e.redraw,u=void 0!==s&&s,l=e.datasetIdKey,c=e.type,h=e.data,p=e.options,f=e.plugins,d=void 0===f?[]:f,v=e.fallbackContent,m=function(t,e){if(null==t)return{};var n,i,r=V(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}(e,wA),g=(0,t.useRef)(null),y=(0,t.useRef)(),_=function(){g.current&&(y.current=new rP(g.current,{type:c,data:EA(h,l),options:p,plugins:d}),kA(n,y.current))},b=function(){kA(n,null),y.current&&(y.current.destroy(),y.current=null)};return(0,t.useEffect)((function(){var t,e;!u&&y.current&&p&&(t=y.current,e=p,t.options=Ok({},e))}),[u,p]),(0,t.useEffect)((function(){!u&&y.current&&MA(y.current.config.data,h.labels)}),[u,h.labels]),(0,t.useEffect)((function(){!u&&y.current&&h.datasets&&TA(y.current.config.data,h.datasets,l)}),[u,h.datasets]),(0,t.useEffect)((function(){y.current&&(u?(b(),setTimeout(_)):y.current.update())}),[u,p,h.labels,h.datasets]),(0,t.useEffect)((function(){return _(),function(){return b()}}),[]),t.createElement("canvas",Object.assign({ref:g,role:"img",height:r,width:o},m),v)}var IA=(0,t.forwardRef)(CA);function PA(e,n){return rP.register(n),(0,t.forwardRef)((function(n,i){return t.createElement(IA,Object.assign({},n,{ref:i,type:e}))}))}var AA=PA("line",TC);rP.register(YP,tA,SP,xP,zP,ZP,RP);var LA={scales:{y:{beginAtZero:!0,ticks:{color:"#ddd"}},x:{ticks:{color:"#ddd"}}},plugins:{legend:{labels:{color:"white"}}}};function RA(e){var n=e.destinationLng,i=e.destinationLat,r=e.startImage,a=e.winRadius,o=e.revealDistance,s=rt((0,t.useState)("00:00"),2),u=s[0],l=s[1],c=(0,t.useRef)(),h=rt((0,t.useState)([]),1)[0],p=rt((0,t.useState)([]),1)[0],f=rt((0,t.useState)(!1),2),d=f[0],v=f[1],m=rt((0,t.useState)(null),2),g=m[0],y=m[1];return(0,t.useEffect)((function(){var t=-1,e=Dk(c);return e.moveTo(r).then((function(){var r=performance.now();t=setInterval((function(){var s=Math.floor((performance.now()-r)/1e3),u=s%60,c=Math.floor(s/60),f="".concat(c.toString().padStart(2,"0"),":").concat(u.toString().padStart(2,"0"));l(f),e.getPosition().then((function(e){var r=1e3*Ek(i,n,e.lat,e.lng)|0;h.push(f),p.push(r),o&&y(r),r<a&&(clearInterval(t),v(!0))}))}),500)})),function(){clearInterval(t),e.remove()}}),[r,h,p,i,n,a,o]),(0,at.jsxs)(at.Fragment,{children:[(0,at.jsx)("div",{className:"popup",id:"timer",children:u}),g&&(0,at.jsxs)("div",{className:"popup",id:"distance",children:[g,"m"]}),(0,at.jsx)("div",{className:"viewer fill",ref:c}),d&&(0,at.jsxs)("div",{className:"popup",id:"win",children:[(0,at.jsxs)("span",{className:"title inline-block",children:["Won in ",u,"!"]}),(0,at.jsx)(AA,{data:{labels:h,datasets:[{label:"Distance from destination in meters",data:p,lineTension:0,backgroundColor:"rgb(255, 99, 132)",borderColor:"rgba(255, 99, 132, 0.2)"}]},options:LA})]})]})}function DA(t){var e;try{var n=t.match.params.configString,i=e=JSON.parse(atob(n)),r=i.d1,a=i.d2,o=i.wr,s=i.s,u=i.r;if("number"!==typeof r||"number"!==typeof a||"number"!==typeof o||"number"!==typeof s||"boolean"!==typeof u)throw new ot("Invalid types")}catch(l){return(0,at.jsx)(ot,{children:"Invalid challenge."})}return 1!==e.v?(0,at.jsx)(ot,{children:"Invalid challenge version."}):(0,at.jsx)(RA,{config:e,destinationLng:e.d1,destinationLat:e.d2,winRadius:e.wr,startImage:e.s,revealDistance:e.r})}var zA=n(669),OA=n.n(zA);var FA={layers:["mapillary"]};function NA(t,e){var n=e.x,i=e.y;return function(t,e){return t.queryRenderedFeatures(e,FA)}(t,[[n-10,i-10],[n+10,i+10]])}function BA(t,e){t.getElement().style.visibility=e?"visible":"hidden"}var jA=Object.freeze({type:"vector",tiles:["https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4920556504644439|205c8173420810cc93021c7a46464923"],minzoom:6,maxzoom:14}),VA=Object.freeze({version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap Contributors",maxzoom:19}},layers:[{id:"osm",type:"raster",source:"osm"}]});function UA(t){return(0,at.jsx)("button",{className:"copy-btn",onClick:function(e){document.getElementById(t.sourceId).select(),document.execCommand("copy");var n=e.currentTarget,i=n.innerText;n.innerText="Copied!",setTimeout((function(){n.innerText=i}),1e3)},children:"Copy to clipboard"})}function $A(t){return 0!==t.lng||0!==t.lat}var HA=function(t,e){var n=-1;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];var o=-1===n?10:e;clearTimeout(n),n=setTimeout((function(){t.apply(void 0,r),n=-1}),o)}}((function(t,e,n,i){ut(ht().mark((function n(){var i,r,a,o,s,u;return ht().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=0;case 1:if(!(i<10)){n.next=11;break}return r=Tk(t,e),a=rt(r,2),o=a[0],s=a[1],n.next=5,Lk(o,s,Math.min(e/5e3,.75));case 5:if(!(u=n.sent)){n.next=8;break}return n.abrupt("return",u);case 8:++i,n.next=1;break;case 11:throw new Error;case 12:case"end":return n.stop()}}),n)})))().then(n).catch(i)}),100);function qA(){var e=(0,t.useRef)(),n=(0,t.useRef)(),i=rt((0,t.useState)({lng:0,lat:0}),2),r=i[0],a=i[1],o=rt((0,t.useState)(null),2),s=o[0],u=o[1],l=rt((0,t.useState)(0),2),c=l[0],h=l[1],p=rt((0,t.useState)(500),2),f=p[0],d=p[1],v=rt((0,t.useState)(20),2),m=v[0],g=v[1],y=rt((0,t.useState)(null),2),_=y[0],b=y[1],x=rt((0,t.useState)(0),2),w=x[0],S=x[1],k=rt((0,t.useState)(!1),2),M=k[0],T=k[1];return(0,t.useEffect)((function(){$A(r)&&(S(0),HA(r,f,(function(t){b(function(t,e,n,i){return btoa(JSON.stringify({v:1,d1:t.lng,d2:t.lat,wr:e,s:n,r:i}))}(r,m,t,M)),S(1)}),(function(){return S(2)})))}),[r,f,m,M]),(0,t.useEffect)((function(){null===s||void 0===s||s.setLngLat(r)}),[s,r,c]),(0,t.useEffect)((function(){var t=new(OA().Map)({container:n.current,zoom:3,style:VA,center:[0,0],maxzoom:16}),i=function(t){t?(a(t),BA(o,!0)):h((function(t){return t+1}))},r=Dk(e,i),o=function(t){var e="".concat(2*t.radius,"px"),n=document.createElement("div");return n.style.border="3px solid ".concat(t.color),n.style.backgroundColor="white",n.style.borderRadius="50%",n.style.width="".concat(e),n.style.height="".concat(e),new(OA().Marker)({draggable:t.draggable,element:n,rotationAlignment:"map"})}({color:"red",draggable:!0,radius:5});u(o),o.setLngLat([0,0]),BA(o,!1);var s=function(e){var n=function(t){if(t.length>0){var e=t[0];if(e.properties.is_pano)return e;for(var n=1;n<t.length;++n){var i=t[n];if(i.properties.is_pano)return i}return e}return null}(NA(t,e));n?r.moveTo(n.properties.id).then((function(){i(t.unproject(e))})).catch(console.error):i(null)};return o.on("dragend",(function(e){s(t.project(o.getLngLat()))})),t.on("click",(function(t){s(t.point)})),t.on("load",(function(){t.addSource("mapillary",jA),t.addLayer({id:"mapillary",type:"circle",source:"mapillary","source-layer":"image",paint:{"circle-opacity":.2,"circle-color":"rgb(53, 175, 109)","circle-radius":3}}),o.addTo(t)})),r.on("position",function(){var t=ut(ht().mark((function t(e){var n;return ht().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getPosition();case 2:n=t.sent,a(n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),function(){r.remove(),t.remove()}}),[e,n]),(0,at.jsxs)("div",{className:"create-container container",children:[(0,at.jsxs)("div",{children:[(0,at.jsx)("h1",{className:"title",children:"Create challenge"}),(0,at.jsx)("h2",{children:"1. Select a destination location"})]}),(0,at.jsxs)("div",{className:"sideBySide middle",children:[(0,at.jsx)("div",{className:"map",ref:n}),(0,at.jsxs)("div",{className:"viewer",ref:e,children:[(0,at.jsx)("div",{className:"popup preview",children:"Preview"}),!$A(r)&&(0,at.jsx)("div",{className:"viewer-notification",children:"Choose a destination location on the map."})]})]}),(0,at.jsxs)("div",{children:[(0,at.jsx)("h2",{children:"2. Choose parameters"}),(0,at.jsx)("label",{htmlFor:"dropping-radius",children:"Dropping radius in meters"}),(0,at.jsx)("input",{style:{width:"80px"},id:"dropping-radius",type:"number",onChange:function(t){return d(t.currentTarget.valueAsNumber)},min:50,value:f,max:2e4,step:10}),(0,at.jsx)("br",{}),(0,at.jsx)("label",{htmlFor:"win-radius",children:"Win radius in meters"}),(0,at.jsx)("input",{style:{width:"80px"},id:"win-radius",type:"number",onChange:function(t){return g(t.currentTarget.valueAsNumber)},min:10,value:m,max:100,step:10}),(0,at.jsx)("br",{}),(0,at.jsx)("input",{id:"reveal-distance",type:"checkbox",onChange:function(t){return T(t.currentTarget.checked)},checked:M}),(0,at.jsx)("label",{htmlFor:"reveal-distance",children:"Reveal distance to players"}),(0,at.jsx)("h2",{children:"3. Copy URL & share with friends!"}),(0,at.jsx)("div",{style:{height:"40px"},children:_?0===w?(0,at.jsx)("span",{children:"Searching for a start location and preparing challenge URL..."}):2===w?(0,at.jsx)("span",{children:"Could not find a suitable start location, please modify your destination or parameters and try again"}):(0,at.jsxs)(at.Fragment,{children:[(0,at.jsx)("input",{id:"location-bar",value:"".concat(window.location.protocol,"//").concat(window.location.host).concat("/geodropping/","#/drop/").concat(_),readOnly:!0})," ",(0,at.jsx)(UA,{sourceId:"location-bar"})]}):(0,at.jsx)("span",{children:"Choose a location and parameters first and a challenge URL will be generated!"})})]})]})}var WA=function(){return(0,at.jsx)("main",{children:(0,at.jsxs)(et,{baseName:Math.REACT_APP_BASE_NAME,children:[(0,at.jsx)(X,{path:"/drop/:configString",component:DA,exact:!0}),(0,at.jsx)(X,{path:"/",component:qA})]})})};t.Component;var GA=function(e){function n(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).history=A(t.props),t}return r(n,e),n.prototype.render=function(){return t.createElement(q,{history:this.history,children:this.props.children})},n}(t.Component);var ZA=function(t,e){return"function"===typeof t?t(e):t},XA=function(t,e){return"string"===typeof t?y(t,null,null,e):t},YA=function(t){return t},KA=t.forwardRef;"undefined"===typeof KA&&(KA=YA);var JA=KA((function(e,n){var i=e.innerRef,r=e.navigate,a=e.onClick,o=V(e,["innerRef","navigate","onClick"]),u=o.target,l=s({},o,{onClick:function(t){try{a&&a(t)}catch(e){throw t.preventDefault(),e}t.defaultPrevented||0!==t.button||u&&"_self"!==u||function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}(t)||(t.preventDefault(),r())}});return l.ref=YA!==KA&&n||i,t.createElement("a",l)}));var QA=KA((function(e,n){var i=e.component,r=void 0===i?JA:i,a=e.replace,o=e.to,u=e.innerRef,l=V(e,["component","replace","to","innerRef"]);return t.createElement(H.Consumer,null,(function(e){e||p(!1);var i=e.history,c=XA(ZA(o,e.location),e.location),h=c?i.createHref(c):"",f=s({},l,{href:h,navigate:function(){var t=ZA(o,e.location),n=g(e.location)===g(XA(t));(a||n?i.replace:i.push)(t)}});return YA!==KA?f.ref=n||u:f.innerRef=u,t.createElement(r,f)}))})),tL=function(t){return t},eL=t.forwardRef;"undefined"===typeof eL&&(eL=tL);eL((function(e,n){var i=e["aria-current"],r=void 0===i?"page":i,a=e.activeClassName,o=void 0===a?"active":a,u=e.activeStyle,l=e.className,c=e.exact,h=e.isActive,f=e.location,d=e.sensitive,v=e.strict,m=e.style,g=e.to,y=e.innerRef,_=V(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return t.createElement(H.Consumer,null,(function(e){e||p(!1);var i=f||e.location,a=XA(ZA(g,i),i),b=a.pathname,x=b&&b.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),w=x?Z(i.pathname,{path:x,exact:c,sensitive:d,strict:v}):null,S=!!(h?h(w,i):w),k="function"===typeof l?l(S):l,M="function"===typeof m?m(S):m;S&&(k=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.filter((function(t){return t})).join(" ")}(k,o),M=s({},M,u));var T=s({"aria-current":S&&r||null,className:k,style:M,to:a},_);return tL!==eL?T.ref=n||y:T.innerRef=y,t.createElement(QA,T)}))}));e.render((0,at.jsx)(t.StrictMode,{children:(0,at.jsx)(GA,{children:(0,at.jsx)(WA,{})})}),document.getElementById("root"))}()}();
//# sourceMappingURL=main.8393a374.js.map